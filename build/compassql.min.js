!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.cql=e()}}(function(){var e;return function t(e,n,r){function i(a,u){if(!n[a]){if(!e[a]){var c="function"==typeof require&&require;if(!u&&c)return c(a,!0);if(o)return o(a,!0);var s=new Error("Cannot find module '"+a+"'");throw s.code="MODULE_NOT_FOUND",s}var l=n[a]={exports:{}};e[a][0].call(l.exports,function(t){var n=e[a][1][t];return i(n?n:t)},l,l.exports,t,e,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){"use strict";function r(e){return a({},n.DEFAULT_QUERY_CONFIG,e,{"enum":i(e["enum"])})}function i(e){var t=a({},s.DEFAULT_ENUM_INDEX,e,{binProps:o(e,"bin"),scaleProps:o(e,"scale"),axisProps:o(e,"axis"),legendProps:o(e,"legend")});return t}function o(e,t){return a({},s.DEFAULT_ENUM_INDEX[t+"Props"],e[t+"Props"])}var a=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e};Object.defineProperty(n,"__esModule",{value:!0});var u=e("vega-lite/build/src/channel"),c=e("./property"),s=e("./wildcard");n.DEFAULT_QUERY_CONFIG={verbose:!1,defaultSpecConfig:{overlay:{line:!0},scale:{useUnaggregatedDomain:!0}},propertyPrecedence:c.DEFAULT_PROP_PRECEDENCE.map(c.toKey),"enum":s.DEFAULT_ENUM_INDEX,numberNominalProportion:.05,numberNominalLimit:40,constraintManuallySpecifiedValue:!1,autoAddCount:!1,hasAppropriateGraphicTypeForMark:!0,omitAggregate:!1,omitAggregatePlotWithDimensionOnlyOnFacet:!0,omitAggregatePlotWithoutDimension:!1,omitBarLineAreaWithOcclusion:!0,omitBarTickWithSize:!0,omitMultipleNonPositionalChannels:!0,omitNonSumStack:!0,omitRaw:!1,omitRawContinuousFieldForAggregatePlot:!0,omitRepeatedField:!0,omitNonPositionalOrFacetOverPositionalChannels:!0,omitTableWithOcclusionIfAutoAddCount:!0,omitVerticalDotPlot:!1,preferredBinAxis:u.Channel.X,preferredTemporalAxis:u.Channel.X,preferredOrdinalAxis:u.Channel.Y,preferredNominalAxis:u.Channel.Y,preferredFacet:u.Channel.ROW,minCardinalityForBin:15,maxCardinalityForCategoricalColor:20,maxCardinalityForFacet:20,maxCardinalityForShape:6,timeUnitShouldHaveVariation:!0,typeMatchesSchemaType:!0,stylize:!0,smallRangeStepForHighCardinalityOrFacet:{maxCardinality:10,rangeStep:12},nominalColorScaleForHighCardinality:{maxCardinality:10,palette:"category20"},xAxisOnTopForHighYCardinalityWithoutColumn:{maxCardinality:30},maxGoodCardinalityForFacet:5,maxGoodCardinalityForColor:7,minPercentUniqueForKey:.8,minCardinalityForKey:50},n.extendConfig=r},{"./property":13,"./wildcard":39,"vega-lite/build/src/channel":57}],2:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var i=e("../property"),o=e("../wildcard"),a=e("../util"),u=function(){function e(e){this.constraint=e}return e.prototype.name=function(){return this.constraint.name},e.prototype.description=function(){return this.constraint.description},e.prototype.properties=function(){return this.constraint.properties},e.prototype.strict=function(){return this.constraint.strict},e}();n.AbstractConstraintModel=u;var c=function(e){function t(t){return e.call(this,t)||this}return r(t,e),t.prototype.hasAllRequiredPropertiesSpecific=function(e){return a.every(this.constraint.properties,function(t){if(i.isEncodingNestedProp(t)){var n=t.parent,r=t.child;return!e[n]||!o.isWildcard(e[n][r])}return!e[t]||!o.isWildcard(e[t])})},t.prototype.satisfy=function(e,t,n,r){return!this.constraint.allowWildcardForProperties&&!this.hasAllRequiredPropertiesSpecific(e)||this.constraint.satisfy(e,t,n,r)},t}(u);n.EncodingConstraintModel=c},{"../property":13,"../util":38,"../wildcard":39}],3:[function(e,t,n){"use strict";function r(e,t,n,r,u,c){for(var s=o.FIELD_CONSTRAINTS_BY_PROPERTY.get(e)||[],l=r.getEncodingQueryByIndex(n),d=0,f=s;d<f.length;d++){var p=f[d];if(p.strict()||c[p.name()]){var y=p.satisfy(l,u,r.wildcardIndex.encodings[n],c);if(!y){var g="(enc) "+p.name();return c.verbose&&console.log(g+" failed with "+r.toShorthand()+" for "+t.name),g}}}for(var h=a.VALUE_CONSTRAINTS_BY_PROPERTY.get(e)||[],m=0,v=h;m<v.length;m++){var p=v[m];if((p.strict()||c[p.name()])&&i.isValueQuery(l)){var y=p.satisfy(l,u,r.wildcardIndex.encodings[n],c);if(!y){var g="(enc) "+p.name();return c.verbose&&console.log(g+" failed with "+r.toShorthand()+" for "+t.name),g}}}return null}Object.defineProperty(n,"__esModule",{value:!0});var i=e("../query/encoding"),o=e("./field"),a=e("./value");n.checkEncoding=r},{"../query/encoding":15,"./field":4,"./value":7}],4:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e};Object.defineProperty(n,"__esModule",{value:!0});var i=e("vega-lite/build/src/channel"),o=e("vega-lite/build/src/fielddef"),a=e("vega-lite/build/src/scale"),u=e("vega-lite/build/src/type"),c=e("../query/expandedtype"),s=e("../property"),l=e("../propindex"),d=e("../wildcard"),f=e("../schema"),p=e("../util"),y=e("../query/encoding"),g=e("./base");n.FIELD_CONSTRAINTS=[{name:"aggregateOpSupportedByType",description:"Aggregate function should be supported by data type.",properties:[s.Property.TYPE,s.Property.AGGREGATE],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n,r){return!e.aggregate||!c.isDiscrete(e.type)}},{name:"asteriskFieldWithCountOnly",description:'Field="*" should be disallowed except aggregate="count"',properties:[s.Property.FIELD,s.Property.AGGREGATE],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n,r){return"*"===e.field==("count"===e.aggregate)}},{name:"minCardinalityForBin",description:"binned quantitative field should not have too low cardinality",properties:[s.Property.BIN,s.Property.FIELD,s.Property.TYPE],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n,r){if(e.bin&&e.type===u.Type.QUANTITATIVE){var i={channel:e.channel,field:e.field,type:e.type};return t.cardinality(i)>=r.minCardinalityForBin}return!0}},{name:"binAppliedForQuantitative",description:"bin should be applied to quantitative field only.",properties:[s.Property.TYPE,s.Property.BIN],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n,r){return!e.bin||e.type===u.Type.QUANTITATIVE}},{name:"channelFieldCompatible",description:"encoding channel's range type be compatible with channel type.",properties:[s.Property.CHANNEL,s.Property.TYPE,s.Property.BIN,s.Property.TIMEUNIT],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n,i){var a=r({field:"f"},y.toFieldDef(e,["bin","timeUnit","type"]));return o.channelCompatibility(a,e.channel).compatible}},{name:"hasFn",description:"A field with as hasFn flag should have one of aggregate, timeUnit, or bin.",properties:[s.Property.AGGREGATE,s.Property.BIN,s.Property.TIMEUNIT],allowWildcardForProperties:!0,strict:!0,satisfy:function(e,t,n,r){return!e.hasFn||(!!e.aggregate||!!e.bin||!!e.timeUnit)}},{name:"omitScaleZeroWithBinnedField",description:"Do not use scale zero with binned field",properties:[s.Property.SCALE,s.getEncodingNestedProp("scale","zero"),s.Property.BIN],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n,r){return!e.bin||!e.scale||e.scale.zero!==!0}},{name:"onlyOneTypeOfFunction",description:"Only of of aggregate, autoCount, timeUnit, or bin should be applied at the same time.",properties:[s.Property.AGGREGATE,s.Property.AUTOCOUNT,s.Property.TIMEUNIT,s.Property.BIN],allowWildcardForProperties:!0,strict:!0,satisfy:function(e,t,n,r){if(y.isFieldQuery(e)){var i=(!d.isWildcard(e.aggregate)&&e.aggregate?1:0)+(!d.isWildcard(e.bin)&&e.bin?1:0)+(!d.isWildcard(e.timeUnit)&&e.timeUnit?1:0);return i<=1}return!0}},{name:"timeUnitAppliedForTemporal",description:"Time unit should be applied to temporal field only.",properties:[s.Property.TYPE,s.Property.TIMEUNIT],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n,r){return!e.timeUnit||e.type===u.Type.TEMPORAL}},{name:"timeUnitShouldHaveVariation",description:"A particular time unit should be applied only if they produce unique values.",properties:[s.Property.TIMEUNIT,s.Property.TYPE],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n,r){return!e.timeUnit||e.type!==u.Type.TEMPORAL||(!n.has("timeUnit")&&!r.constraintManuallySpecifiedValue||t.timeUnitHasVariation(e))}},{name:"scalePropertiesSupportedByScaleType",description:"Scale properties must be supported by correct scale type",properties:[].concat(s.SCALE_PROPS,[s.Property.SCALE,s.Property.TYPE]),allowWildcardForProperties:!0,strict:!0,satisfy:function(e,t,n,r){if(e.scale){var i=e.scale,o=y.scaleType(e);if(void 0===o||null===o)return!0;for(var u in i)if("type"!==u&&"name"!==u&&"enum"!==u){var c=u;if("point"===o){if(!a.scaleTypeSupportProperty("point",c)&&!a.scaleTypeSupportProperty("band",c))return!1}else if(!a.scaleTypeSupportProperty(o,c))return!1}}return!0}},{name:"scalePropertiesSupportedByChannel",description:"Not all scale properties are supported by all encoding channels",properties:[].concat(s.SCALE_PROPS,[s.Property.SCALE,s.Property.CHANNEL]),allowWildcardForProperties:!0,strict:!0,satisfy:function(e,t,n,r){if(e){var i=e.channel,o=e.scale;if(i&&!d.isWildcard(i)&&o){if("row"===i||"column"===i)return!1;for(var u in o)if(o.hasOwnProperty(u)&&"type"!==u&&"name"!==u&&"enum"!==u){var c=void 0===a.channelScalePropertyIncompatability(i,u);if(!c)return!1}}}return!0}},{name:"typeMatchesPrimitiveType",description:"Data type should be supported by field's primitive type.",properties:[s.Property.FIELD,s.Property.TYPE],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n,r){if("*"===e.field)return!0;var i=t.primitiveType(e.field),o=e.type;if(!n.has("field")&&!n.has("type")&&!r.constraintManuallySpecifiedValue)return!0;switch(i){case f.PrimitiveType.BOOLEAN:case f.PrimitiveType.STRING:return o!==u.Type.QUANTITATIVE&&o!==u.Type.TEMPORAL;case f.PrimitiveType.NUMBER:case f.PrimitiveType.INTEGER:return o!==u.Type.TEMPORAL;case f.PrimitiveType.DATETIME:return o===u.Type.TEMPORAL;case null:return!1}throw new Error("Not implemented")}},{name:"typeMatchesSchemaType",description:"Enumerated data type of a field should match the field's type in the schema.",properties:[s.Property.FIELD,s.Property.TYPE],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n,r){return!(n.has("field")||n.has("type")||r.constraintManuallySpecifiedValue)||("*"===e.field?e.type===u.Type.QUANTITATIVE:t.vlType(e.field)===e.type)}},{name:"maxCardinalityForCategoricalColor",description:"Categorical channel should not have too high cardinality",properties:[s.Property.CHANNEL,s.Property.FIELD],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n,r){return e.channel!==i.Channel.COLOR||e.type!==u.Type.NOMINAL&&e.type!==c.ExpandedType.KEY||t.cardinality(e)<=r.maxCardinalityForCategoricalColor}},{name:"maxCardinalityForFacet",description:"Row/column channel should not have too high cardinality",properties:[s.Property.CHANNEL,s.Property.FIELD,s.Property.BIN,s.Property.TIMEUNIT],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n,r){return e.channel!==i.Channel.ROW&&e.channel!==i.Channel.COLUMN||t.cardinality(e)<=r.maxCardinalityForFacet}},{name:"maxCardinalityForShape",description:"Shape channel should not have too high cardinality",properties:[s.Property.CHANNEL,s.Property.FIELD,s.Property.BIN,s.Property.TIMEUNIT],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n,r){return e.channel!==i.Channel.SHAPE||t.cardinality(e)<=r.maxCardinalityForShape}},{name:"dataTypeAndFunctionMatchScaleType",description:"Scale type must match data type",properties:[s.Property.TYPE,s.Property.SCALE,s.getEncodingNestedProp("scale","type"),s.Property.TIMEUNIT,s.Property.BIN],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n,r){if(e.scale){var i=e.type,o=y.scaleType(e);if(c.isDiscrete(i))return void 0===o||a.hasDiscreteDomain(o);if(i===u.Type.TEMPORAL)return e.timeUnit?p.contains([a.ScaleType.TIME,a.ScaleType.UTC,void 0],o)||a.hasDiscreteDomain(o):p.contains([a.ScaleType.TIME,a.ScaleType.UTC,void 0],o);if(i===u.Type.QUANTITATIVE)return e.bin?p.contains([a.ScaleType.LINEAR,void 0],o):p.contains([a.ScaleType.LOG,a.ScaleType.POW,a.ScaleType.SQRT,a.ScaleType.QUANTILE,a.ScaleType.QUANTIZE,a.ScaleType.LINEAR,void 0],o)}return!0}}].map(function(e){return new g.EncodingConstraintModel(e)}),n.FIELD_CONSTRAINT_INDEX=n.FIELD_CONSTRAINTS.reduce(function(e,t){return e[t.name()]=t,e},{}),n.FIELD_CONSTRAINTS_BY_PROPERTY=n.FIELD_CONSTRAINTS.reduce(function(e,t){for(var n=0,r=t.properties();n<r.length;n++){var i=r[n];e.set(i,e.get(i)||[]),e.get(i).push(t)}return e},new l.PropIndex)},{"../property":13,"../propindex":14,"../query/encoding":15,"../query/expandedtype":16,"../schema":36,"../util":38,"../wildcard":39,"./base":2,"vega-lite/build/src/channel":57,"vega-lite/build/src/fielddef":60,"vega-lite/build/src/scale":65,"vega-lite/build/src/type":67}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./encoding");n.encoding=r;var i=e("./spec");n.spec=i},{"./encoding":3,"./spec":6}],6:[function(e,t,n){"use strict";function r(e,t,n,r,i){for(var o=E.get(e)||[],a=0,u=o;a<u.length;a++){var c=u[a];if(c.strict()||i[c.name()]){var s=c.satisfy(n,r,i);if(!s){var l="(spec) "+c.name();return i.verbose&&console.log(l+" failed with "+n.toShorthand()+" for "+t.name),l}}}return null}var i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("vega-lite/build/src/aggregate"),a=e("vega-lite/build/src/channel"),u=e("vega-lite/build/src/mark"),c=e("vega-lite/build/src/scale"),s=e("vega-lite/build/src/type"),l=e("../query/expandedtype"),d=e("./base"),f=e("../wildcard"),p=e("../property"),y=e("../propindex"),g=e("../util"),h=e("../query/encoding"),m=a.NONSPATIAL_CHANNELS.reduce(function(e,t){return e[t]=!0,e},{}),v=function(e){function t(t){return e.call(this,t)||this}return i(t,e),t.prototype.hasAllRequiredPropertiesSpecific=function(e){return g.every(this.constraint.properties,function(t){if(t===p.Property.MARK)return!f.isWildcard(e.getMark());if(p.isEncodingNestedProp(t)){var n=t.parent,r=t.child;return g.every(e.getEncodings(),function(e){return!e[n]||!f.isWildcard(e[n][r])})}if(!p.isEncodingProperty(t))throw new Error("UNIMPLEMENTED");return g.every(e.getEncodings(),function(e){return!e[t]||!f.isWildcard(e[t])})})},t.prototype.satisfy=function(e,t,n){return!this.constraint.allowWildcardForProperties&&!this.hasAllRequiredPropertiesSpecific(e)||this.constraint.satisfy(e,t,n)},t}(d.AbstractConstraintModel);n.SpecConstraintModel=v,n.SPEC_CONSTRAINTS=[{name:"noRepeatedChannel",description:"Each encoding channel should only be used once.",properties:[p.Property.CHANNEL],allowWildcardForProperties:!0,strict:!0,satisfy:function(e,t,n){var r={};return g.every(e.getEncodings(),function(e){return!!f.isWildcard(e.channel)||!r[e.channel]&&(r[e.channel]=!0,!0)})}},{name:"alwaysIncludeZeroInScaleWithBarMark",description:"Do not recommend bar mark if scale does not start at zero",properties:[p.Property.MARK,p.Property.SCALE,p.getEncodingNestedProp("scale","zero"),p.Property.CHANNEL,p.Property.TYPE],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n){var r=e.getMark(),i=e.getEncodings();if(r===u.Mark.BAR)for(var o=0,c=i;o<c.length;o++){var l=c[o];if(h.isFieldQuery(l)&&(l.channel===a.Channel.X||l.channel===a.Channel.Y)&&l.type===s.Type.QUANTITATIVE&&l.scale&&l.scale.zero===!1)return!1}return!0}},{name:"autoAddCount",description:"Automatically adding count only for plots with only ordinal, binned quantitative, or temporal with timeunit fields.",properties:[p.Property.BIN,p.Property.TIMEUNIT,p.Property.TYPE,p.Property.AUTOCOUNT],allowWildcardForProperties:!0,strict:!1,satisfy:function(e,t,n){var r=g.some(e.getEncodings(),function(e){return h.isEnabledAutoCountQuery(e)});if(r)return g.every(e.getEncodings(),function(e){if(h.isValueQuery(e))return!1;if(h.isAutoCountQuery(e))return!0;switch(e.type){case s.Type.QUANTITATIVE:return!!e.bin;case s.Type.TEMPORAL:return!!e.timeUnit;case s.Type.ORDINAL:case l.ExpandedType.KEY:case s.Type.NOMINAL:return!0}throw new Error("Unsupported Type")});var i=e.wildcardIndex.encodingIndicesByProperty.get("autoCount")||[],o=g.every(i,function(t){var n=e.getEncodingQueryByIndex(t);return h.isAutoCountQuery(n)&&!f.isWildcard(n.autoCount)});return!o||g.some(e.getEncodings(),function(e){return(h.isFieldQuery(e)||h.isAutoCountQuery(e))&&e.type===s.Type.QUANTITATIVE?!h.isDisabledAutoCountQuery(e)&&(h.isFieldQuery(e)&&(!e.bin||f.isWildcard(e.bin))):!(!h.isFieldQuery(e)||e.type!==s.Type.TEMPORAL)&&(!e.timeUnit||f.isWildcard(e.timeUnit))})}},{name:"channelPermittedByMarkType",description:"Each encoding channel should be supported by the mark type",properties:[p.Property.CHANNEL,p.Property.MARK],allowWildcardForProperties:!0,strict:!0,satisfy:function(e,t,n){var r=e.getMark();return!!f.isWildcard(r)||g.every(e.getEncodings(),function(e){return!!f.isWildcard(e.channel)||a.supportMark(e.channel,r)})}},{name:"hasAllRequiredChannelsForMark",description:"All required channels for the specified mark should be specified",properties:[p.Property.CHANNEL,p.Property.MARK],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n){var r=e.getMark();switch(r){case u.Mark.AREA:case u.Mark.LINE:return e.channelUsed(a.Channel.X)&&e.channelUsed(a.Channel.Y);case u.Mark.TEXT:return e.channelUsed(a.Channel.TEXT);case u.Mark.BAR:case u.Mark.CIRCLE:case u.Mark.SQUARE:case u.Mark.TICK:case u.Mark.RULE:return e.channelUsed(a.Channel.X)||e.channelUsed(a.Channel.Y);case u.Mark.POINT:return!e.wildcardIndex.hasProperty(p.Property.CHANNEL)||e.channelUsed(a.Channel.X)||e.channelUsed(a.Channel.Y)}throw new Error("hasAllRequiredChannelsForMark not implemented for mark"+JSON.stringify(r))}},{name:"omitAggregate",description:"Omit aggregate plots.",properties:[p.Property.AGGREGATE,p.Property.AUTOCOUNT],allowWildcardForProperties:!0,strict:!1,satisfy:function(e,t,n){return!e.isAggregate()}},{name:"omitAggregatePlotWithDimensionOnlyOnFacet",description:"Omit aggregate plots with dimensions only on facets as that leads to inefficient use of space.",properties:[p.Property.CHANNEL,p.Property.AGGREGATE,p.Property.AUTOCOUNT],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n){if(e.isAggregate()){var r=!1,i=!1,o=!1;if(e.specQuery.encodings.forEach(function(t,n){h.isValueQuery(t)||h.isDisabledAutoCountQuery(t)||h.isFieldQuery(t)&&!t.aggregate&&(i=!0,g.contains([a.Channel.ROW,a.Channel.COLUMN],t.channel)?e.wildcardIndex.hasEncodingProperty(n,p.Property.CHANNEL)&&(o=!0):r=!0)}),i&&!r&&(o||n.constraintManuallySpecifiedValue))return!1}return!0}},{name:"omitAggregatePlotWithoutDimension",description:"Aggregate plots without dimension should be omitted",properties:[p.Property.AGGREGATE,p.Property.AUTOCOUNT,p.Property.BIN,p.Property.TIMEUNIT,p.Property.TYPE],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n){return!e.isAggregate()||g.some(e.getEncodings(),function(e){return!!(h.isDimension(e)||h.isFieldQuery(e)&&"temporal"===e.type)})}},{name:"omitBarLineAreaWithOcclusion",description:"Don't use bar, line or area to visualize raw plot as they often lead to occlusion.",properties:[p.Property.MARK,p.Property.AGGREGATE,p.Property.AUTOCOUNT],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n){return!g.contains([u.Mark.BAR,u.Mark.LINE,u.Mark.AREA],e.getMark())||e.isAggregate()}},{name:"omitBarTickWithSize",description:"Do not map field to size channel with bar and tick mark",properties:[p.Property.CHANNEL,p.Property.MARK],allowWildcardForProperties:!0,strict:!1,satisfy:function(e,t,n){var r=e.getMark();if(g.contains([u.Mark.TICK,u.Mark.BAR],r)&&e.channelUsed(a.Channel.SIZE)){if(n.constraintManuallySpecifiedValue)return!1;for(var i=e.specQuery.encodings,o=0;o<i.length;o++){var c=i[o];if(c.channel===a.Channel.SIZE)return!e.wildcardIndex.hasEncodingProperty(o,p.Property.CHANNEL)}}return!0}},{name:"omitBarAreaForLogScale",description:"Do not use bar and area mark for x and y's log scale",properties:[p.Property.MARK,p.Property.CHANNEL,p.Property.SCALE,p.getEncodingNestedProp("scale","type"),p.Property.TYPE],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n){var r=e.getMark(),i=e.getEncodings();if(r===u.Mark.AREA||r===u.Mark.BAR)for(var o=0,s=i;o<s.length;o++){var l=s[o];if(h.isFieldQuery(l)&&(l.channel===a.Channel.X||l.channel===a.Channel.Y)&&l.scale){var d=h.scaleType(l);if(d===c.ScaleType.LOG)return!1}}return!0}},{name:"omitMultipleNonPositionalChannels",description:"Unless manually specified, do not use multiple non-positional encoding channel to avoid over-encoding.",properties:[p.Property.CHANNEL],allowWildcardForProperties:!0,strict:!1,satisfy:function(e,t,n){for(var r=e.specQuery.encodings,i=0,o=!1,a=0;a<r.length;a++){var u=r[a];if(!h.isValueQuery(u)&&!h.isDisabledAutoCountQuery(u)){var c=u.channel;if(!f.isWildcard(c)&&m[c+""]&&(i+=1,e.wildcardIndex.hasEncodingProperty(a,p.Property.CHANNEL)&&(o=!0),i>1&&(o||n.constraintManuallySpecifiedValue)))return!1}}return!0}},{name:"omitNonPositionalOrFacetOverPositionalChannels",description:"Do not use non-positional channels unless all positional channels are used",properties:[p.Property.CHANNEL],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n){for(var r=e.specQuery.encodings,i=!1,o=!1,u=!1,c=!1,s=0;s<r.length;s++){var l=r[s];if(!h.isValueQuery(l)&&!h.isDisabledAutoCountQuery(l)){var d=l.channel;d===a.Channel.X?u=!0:d===a.Channel.Y?c=!0:f.isWildcard(d)||(i=!0,e.wildcardIndex.hasEncodingProperty(s,p.Property.CHANNEL)&&(o=!0))}}return!(o||n.constraintManuallySpecifiedValue&&i)||u&&c}},{name:"omitRaw",description:"Omit raw plots.",properties:[p.Property.AGGREGATE,p.Property.AUTOCOUNT],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n){return!!e.isAggregate()}},{name:"omitRawContinuousFieldForAggregatePlot",description:"Aggregate plot should not use raw continuous field as group by values. (Quantitative should be binned. Temporal should have time unit.)",properties:[p.Property.AGGREGATE,p.Property.AUTOCOUNT,p.Property.TIMEUNIT,p.Property.BIN,p.Property.TYPE],allowWildcardForProperties:!0,strict:!1,satisfy:function(e,t,n){if(e.isAggregate())for(var r=e.specQuery.encodings,i=0;i<r.length;i++){var o=r[i];if(!h.isValueQuery(o)&&!h.isDisabledAutoCountQuery(o)){if(h.isFieldQuery(o)&&o.type===s.Type.TEMPORAL&&!o.timeUnit&&(e.wildcardIndex.hasEncodingProperty(i,p.Property.TIMEUNIT)||n.constraintManuallySpecifiedValue))return!1;if(o.type===s.Type.QUANTITATIVE&&h.isFieldQuery(o)&&!o.bin&&!o.aggregate){if(e.wildcardIndex.hasEncodingProperty(i,p.Property.BIN)||e.wildcardIndex.hasEncodingProperty(i,p.Property.AGGREGATE)||e.wildcardIndex.hasEncodingProperty(i,p.Property.AUTOCOUNT))return!1;if(n.constraintManuallySpecifiedValue)return!1}}}return!0}},{name:"omitRawDetail",description:"Do not use detail channel with raw plot.",properties:[p.Property.CHANNEL,p.Property.AGGREGATE,p.Property.AUTOCOUNT],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n){return!!e.isAggregate()||g.every(e.specQuery.encodings,function(t,r){return!(!h.isValueQuery(t)&&!h.isDisabledAutoCountQuery(t))||(t.channel!==a.Channel.DETAIL||!e.wildcardIndex.hasEncodingProperty(r,p.Property.CHANNEL)&&!n.constraintManuallySpecifiedValue)})}},{name:"omitRepeatedField",description:"Each field should be mapped to only one channel",properties:[p.Property.FIELD],allowWildcardForProperties:!0,strict:!1,satisfy:function(e,t,n){for(var r={},i={},o=e.specQuery.encodings,a=0;a<o.length;a++){var u=o[a];if(!h.isValueQuery(u)&&!h.isAutoCountQuery(u)){var c=void 0;if(u.field&&!f.isWildcard(u.field)&&(c=u.field),h.isAutoCountQuery(u)&&!f.isWildcard(u.autoCount)&&(c="count_*"),c){if(e.wildcardIndex.hasEncodingProperty(a,p.Property.FIELD)&&(i[c]=!0),r[c]&&(i[c]||n.constraintManuallySpecifiedValue))return!1;r[c]=!0}}}return!0}},{name:"omitVerticalDotPlot",description:"Do not output vertical dot plot.",properties:[p.Property.CHANNEL],allowWildcardForProperties:!0,strict:!1,satisfy:function(e,t,n){var r=e.getEncodings();return 1!==r.length||r[0].channel!==a.Channel.Y}},{name:"hasAppropriateGraphicTypeForMark",description:"Has appropriate graphic type for mark",properties:[p.Property.CHANNEL,p.Property.MARK,p.Property.TYPE,p.Property.TIMEUNIT,p.Property.BIN,p.Property.AGGREGATE,p.Property.AUTOCOUNT],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n){var r=e.getMark();switch(r){case u.Mark.AREA:case u.Mark.LINE:if(e.isAggregate()){var i=e.getEncodingQueryByChannel(a.Channel.X),o=e.getEncodingQueryByChannel(a.Channel.Y),c=h.isMeasure(i),s=h.isMeasure(o);return i&&o&&c!==s&&!(h.isFieldQuery(i)&&!c&&g.contains(["nominal","key"],i.type))&&!(h.isFieldQuery(o)&&!s&&g.contains(["nominal","key"],o.type))}return!0;case u.Mark.TEXT:return!0;case u.Mark.BAR:case u.Mark.TICK:if(e.channelUsed(a.Channel.SIZE))return!1;var i=e.getEncodingQueryByChannel(a.Channel.X),o=e.getEncodingQueryByChannel(a.Channel.Y),c=h.isMeasure(i),s=h.isMeasure(o);return c!==s;case u.Mark.CIRCLE:case u.Mark.POINT:case u.Mark.SQUARE:case u.Mark.RULE:return!0}throw new Error("hasAllRequiredChannelsForMark not implemented for mark"+r)}},{name:"omitNonLinearScaleTypeWithStack",description:"Stacked plot should only use linear scale",properties:[p.Property.CHANNEL,p.Property.MARK,p.Property.AGGREGATE,p.Property.AUTOCOUNT,p.Property.SCALE,p.getEncodingNestedProp("scale","type"),p.Property.TYPE],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n){var r=e.stack();if(r)for(var i=0,o=e.getEncodings();i<o.length;i++){var u=o[i];if(!h.isValueQuery(u)&&(h.isFieldQuery(u)&&u.aggregate||h.isEnabledAutoCountQuery(u))&&u.type===s.Type.QUANTITATIVE&&g.contains([a.Channel.X,a.Channel.Y],u.channel)&&h.scaleType(u)!==c.ScaleType.LINEAR)return!1}return!0}},{name:"omitNonSumStack",description:"Stacked plot should use summative aggregation such as sum, count, or distinct",properties:[p.Property.CHANNEL,p.Property.MARK,p.Property.AGGREGATE,p.Property.AUTOCOUNT],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n){var r=e.stack();if(r){var i=e.getEncodingQueryByChannel(r.fieldChannel);return h.isFieldQuery(i)&&g.contains(o.SUM_OPS,i.aggregate)||h.isAutoCountQuery(i)&&!!i.autoCount}return!0}},{name:"omitTableWithOcclusionIfAutoAddCount",description:"Plots without aggregation or autocount where x and y are both discrete should be omitted if autoAddCount is enabled as they often lead to occlusion",properties:[p.Property.CHANNEL,p.Property.TYPE,p.Property.TIMEUNIT,p.Property.BIN,p.Property.AGGREGATE,p.Property.AUTOCOUNT],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n){if(n.autoAddCount){var r=e.getEncodingQueryByChannel("x"),i=e.getEncodingQueryByChannel("y");if((!h.isFieldQuery(r)||h.isDimension(r))&&(!h.isFieldQuery(i)||h.isDimension(i)))return!!e.isAggregate()&&g.every(e.getEncodings(),function(e){var t=e.channel;return!(t!==a.Channel.X&&t!==a.Channel.Y&&t!==a.Channel.ROW&&t!==a.Channel.COLUMN&&h.isFieldQuery(e)&&!e.aggregate)})}return!0}}].map(function(e){return new v(e)}),n.SPEC_CONSTRAINT_INDEX=n.SPEC_CONSTRAINTS.reduce(function(e,t){return e[t.name()]=t,e},{});var E=n.SPEC_CONSTRAINTS.reduce(function(e,t){for(var n=0,r=t.properties();n<r.length;n++){var i=r[n];e.set(i,e.get(i)||[]),e.get(i).push(t)}return e},new y.PropIndex);n.checkSpec=r},{"../property":13,"../propindex":14,"../query/encoding":15,"../query/expandedtype":16,"../util":38,"../wildcard":39,"./base":2,"vega-lite/build/src/aggregate":54,"vega-lite/build/src/channel":57,"vega-lite/build/src/mark":64,"vega-lite/build/src/scale":65,"vega-lite/build/src/type":67}],7:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../property"),i=e("../propindex"),o=e("../util"),a=e("./base");n.VALUE_CONSTRAINTS=[{name:"doesNotSupportConstantValue",description:"row, column, x, y, order, and detail should not work with constant values.",properties:[r.Property.TYPE,r.Property.AGGREGATE],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n,r){return!o.contains(["row","column","x","y","detail","order"],e.channel)}}].map(function(e){return new a.EncodingConstraintModel(e)}),n.VALUE_CONSTRAINT_INDEX=n.VALUE_CONSTRAINTS.reduce(function(e,t){return e[t.name()]=t,e},{}),n.VALUE_CONSTRAINTS_BY_PROPERTY=n.VALUE_CONSTRAINTS.reduce(function(e,t){for(var n=0,r=t.properties();n<r.length;n++){var i=r[n];e.set(i,e.get(i)||[]),e.get(i).push(t)}return e},new i.PropIndex)},{"../property":13,"../propindex":14,"../util":38,"./base":2}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.version="0.19.18",n.config=e("./config"),n.constraint=e("./constraint"),n.enumerate=e("./enumerator"),n.wildcard=e("./wildcard");var r=e("./generate");n.generate=r.generate,n.model=e("./model"),n.nest=e("./nest"),n.property=e("./property"),n.query=e("./query"),n.ranking=e("./ranking/ranking");var i=e("./recommend");n.recommend=i.recommend,n.schema=e("./schema"),n.util=e("./util")},{"./config":1,"./constraint":5,"./enumerator":9,"./generate":10,"./model":11,"./nest":12,"./property":13,"./query":18,"./ranking/ranking":34,"./recommend":35,"./schema":36,"./util":38,"./wildcard":39}],9:[function(e,t,n){"use strict";function r(e){return l.get(e)}function i(e){return function(t,n,r){return function(i,u){function c(d){if(d===l.length)return void i.push(u.duplicate());var f=l[d],p=t.encodings[f].get(e),y=u.getEncodingQueryByIndex(f),g=u.getEncodingProperty(f,e);s.isValueQuery(y)||s.isDisabledAutoCountQuery(y)||!g?c(d+1):(p["enum"].forEach(function(t){null===t&&(t=void 0),u.setEncodingProperty(f,e,t,p);var i=o.checkEncoding(e,p,f,u,n,r);if(!i){var s=a.checkSpec(e,p,u,n,r);s||c(d+1)}}),u.resetEncodingProperty(f,e,p))}var l=t.encodingIndicesByProperty.get(e);return c(0),i}}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./constraint/encoding"),a=e("./constraint/spec"),u=e("./property"),c=e("./propindex"),s=e("./query/encoding"),l=new c.PropIndex;n.getEnumerator=r,l.set("mark",function(e,t,n){return function(r,i){var o=i.getMark();return o["enum"].forEach(function(o){i.setMark(o);var u=a.checkSpec("mark",e.mark,i,t,n);u||r.push(i.duplicate())}),i.resetMark(),r}}),u.ENCODING_TOPLEVEL_PROPS.forEach(function(e){l.set(e,i(e))}),u.ENCODING_NESTED_PROPS.forEach(function(e){l.set(e,i(e))}),n.EncodingPropertyGeneratorFactory=i},{"./constraint/encoding":3,"./constraint/spec":6,"./property":13,"./propindex":14,"./query/encoding":15}],10:[function(e,t,n){"use strict";function r(e,t,n){void 0===n&&(n=i.DEFAULT_QUERY_CONFIG);var r=a.SpecQueryModel.build(e,t,n),s=r.wildcardIndex,l=[r];return n.propertyPrecedence.forEach(function(e){var r=u.fromKey(e);if(s.hasProperty(r)){var i=o.getEnumerator(r),a=i(s,t,n);l=l.reduce(a,[])}}),!n.stylize||null===n.nominalColorScaleForHighCardinality&&null===n.smallRangeStepForHighCardinalityOrFacet&&null===n.xAxisOnTopForHighYCardinalityWithoutColumn?l:c.stylize(l,t,n)}Object.defineProperty(n,"__esModule",{value:!0});var i=e("./config"),o=e("./enumerator"),a=e("./model"),u=e("./property"),c=e("./stylize");n.generate=r},{"./config":1,"./enumerator":9,
"./model":11,"./property":13,"./stylize":37}],11:[function(e,t,n){"use strict";function r(e){for(var t=e.items[0];t&&i(t);)t=t.items[0];return t}function i(e){return void 0!==e.items}var o=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e};Object.defineProperty(n,"__esModule",{value:!0});var a=e("vega-lite/build/src/type"),u=e("./property"),c=e("./wildcard"),s=e("./wildcardindex"),l=e("./query/spec"),d=e("./query/encoding"),f=e("./query/groupby"),p=e("./query/shorthand"),y=e("./util"),g=e("datalib/src/util"),h=e("./nest"),m=function(){function e(e,t,n,r,i){this._rankingScore={},this._spec=e,this._channelFieldCount=e.encodings.reduce(function(e,t){return c.isWildcard(t.channel)||d.isAutoCountQuery(t)&&t.autoCount===!1||(e[t.channel+""]=1),e},{}),this._wildcardIndex=t,this._assignedWildcardIndex=i,this._opt=r,this._schema=n}return e.build=function(t,n,r){var i=new s.WildcardIndex;if(c.isWildcard(t.mark)){var o=c.getDefaultName(u.Property.MARK);t.mark=c.initWildcard(t.mark,o,r["enum"].mark),i.setMark(t.mark)}if(t.encodings.forEach(function(e,t){d.isAutoCountQuery(e)&&(console.warn("A field with autoCount should not be included as autoCount meant to be an internal object."),e.type=a.Type.QUANTITATIVE),d.isFieldQuery(e)&&void 0===e.type&&(e.type=c.SHORT_WILDCARD),u.ENCODING_TOPLEVEL_PROPS.forEach(function(o){if(c.isWildcard(e[o])){var a=c.getDefaultName(o)+t,u=c.getDefaultEnumValues(o,n,r),s=e[o]=c.initWildcard(e[o],a,u);i.setEncodingProperty(t,o,s)}}),u.ENCODING_NESTED_PROPS.forEach(function(o){var a=e[o.parent];if(a){var u=o.child;if(c.isWildcard(a[u])){var s=c.getDefaultName(o)+t,l=c.getDefaultEnumValues(o,n,r),d=a[u]=c.initWildcard(a[u],s,l);i.setEncodingProperty(t,o,d)}}})}),r.autoAddCount){var l={name:c.getDefaultName(u.Property.CHANNEL)+t.encodings.length,"enum":c.getDefaultEnumValues(u.Property.CHANNEL,n,r)},f={name:c.getDefaultName(u.Property.AUTOCOUNT)+t.encodings.length,"enum":[!1,!0]},p={channel:l,autoCount:f,type:a.Type.QUANTITATIVE};t.encodings.push(p);var y=t.encodings.length-1;i.setEncodingProperty(y,u.Property.CHANNEL,l),i.setEncodingProperty(y,u.Property.AUTOCOUNT,f)}return new e(t,i,n,r,{})},Object.defineProperty(e.prototype,"wildcardIndex",{get:function(){return this._wildcardIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"schema",{get:function(){return this._schema},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"specQuery",{get:function(){return this._spec},enumerable:!0,configurable:!0}),e.prototype.duplicate=function(){return new e(y.duplicate(this._spec),this._wildcardIndex,this._schema,this._opt,y.duplicate(this._assignedWildcardIndex))},e.prototype.setMark=function(e){var t=this._wildcardIndex.mark.name;this._assignedWildcardIndex[t]=this._spec.mark=e},e.prototype.resetMark=function(){var e=this._spec.mark=this._wildcardIndex.mark;delete this._assignedWildcardIndex[e.name]},e.prototype.getMark=function(){return this._spec.mark},e.prototype.getEncodingProperty=function(e,t){var n=this._spec.encodings[e];return u.isEncodingNestedProp(t)?n[t.parent][t.child]:n[t]},e.prototype.setEncodingProperty=function(e,t,n,r){var i=this._spec.encodings[e];t===u.Property.CHANNEL&&i.channel&&!c.isWildcard(i.channel)&&this._channelFieldCount[i.channel]--,u.isEncodingNestedProp(t)?i[t.parent][t.child]=n:u.hasNestedProperty(t)&&n===!0?i[t]=y.extend({},i[t],{"enum":void 0,name:void 0}):i[t]=n,this._assignedWildcardIndex[r.name]=n,t===u.Property.CHANNEL&&(this._channelFieldCount[n]=(this._channelFieldCount[n]||0)+1)},e.prototype.resetEncodingProperty=function(e,t,n){var r=this._spec.encodings[e];t===u.Property.CHANNEL&&this._channelFieldCount[r.channel]--,u.isEncodingNestedProp(t)?r[t.parent][t.child]=n:r[t]=n,delete this._assignedWildcardIndex[n.name]},e.prototype.channelUsed=function(e){return this._channelFieldCount[e]>0},e.prototype.stack=function(){return l.stack(this._spec)},e.prototype.getEncodings=function(){return this._spec.encodings.filter(function(e){return!d.isDisabledAutoCountQuery(e)})},e.prototype.getEncodingQueryByChannel=function(e){for(var t=0,n=this._spec.encodings;t<n.length;t++){var r=n[t];if(r.channel===e)return r}},e.prototype.getEncodingQueryByIndex=function(e){return this._spec.encodings[e]},e.prototype.isAggregate=function(){return l.isAggregate(this._spec)},e.prototype.toShorthand=function(e){if(e){if(g.isString(e))return h.getGroupByKey(this.specQuery,e);var t=f.parseGroupBy(e);return p.spec(this._spec,t.include,t.replacer)}return p.spec(this._spec)},e.prototype._encoding=function(){for(var e={},t=0,n=this._spec.encodings;t<n.length;t++){var r=n[t],i={};if(d.isEnabledAutoCountQuery(r))i={aggregate:"count",field:"*",type:"quantitative"};else if(d.isValueQuery(r)||d.isDisabledAutoCountQuery(r))continue;if(c.isWildcard(r.channel))return null;for(var s=[u.Property.AGGREGATE,u.Property.BIN,u.Property.TIMEUNIT,u.Property.FIELD,u.Property.TYPE,u.Property.SCALE,u.Property.SORT,u.Property.AXIS,u.Property.LEGEND],l=0,f=s;l<f.length;l++){var g=f[l],h=r[g];if(c.isWildcard(h))return null;var m=!p.PROPERTY_SUPPORTED_CHANNELS[g]||p.PROPERTY_SUPPORTED_CHANNELS[g][r.channel];if(m){if(void 0!==h){if(u.ENCODING_NESTED_PROP_PARENT_INDEX[g])for(var v in r[g])if(c.isWildcard(r[g][v]))return null;i[g]=h}if(g===u.Property.SCALE&&d.isFieldQuery(r)&&r.type===a.Type.ORDINAL){var E=r.scale,T=this._schema.fieldSchema(r.field).ordinalDomain;null!==E&&T&&(i[u.Property.SCALE]=o({domain:T},y.isObject(E)?E:{}))}}}i.bin===!1&&delete i.bin,e[r.channel]=i}return e},e.prototype.toSpec=function(e){if(c.isWildcard(this._spec.mark))return null;var t={};return e=e||this._spec.data,e&&(t.data=e),this._spec.transform&&(t.transform=this._spec.transform),t.mark=this._spec.mark,t.encoding=this._encoding(),null===t.encoding?null:((this._spec.config||this._opt.defaultSpecConfig)&&(t.config=y.extend({},this._opt.defaultSpecConfig,this._spec.config)),t)},e.prototype.getRankingScore=function(e){return this._rankingScore[e]},e.prototype.setRankingScore=function(e,t){this._rankingScore[e]=t},e}();n.SpecQueryModel=m,n.getTopSpecQueryItem=r,n.isSpecQueryGroup=i},{"./nest":12,"./property":13,"./query/encoding":15,"./query/groupby":17,"./query/shorthand":20,"./query/spec":21,"./util":38,"./wildcard":39,"./wildcardindex":40,"datalib/src/util":48,"vega-lite/build/src/type":67}],12:[function(e,t,n){"use strict";function r(e,t){d[e]=t}function i(e,t){if(t){for(var n={name:"",path:"",items:[]},r={},i=[],o=[],u=[],f=0;f<t.length;f++){i.push(f>0?i[f-1].duplicate():new c.PropIndex),o.push(f>0?o[f-1].duplicate():new c.PropIndex);var p=t[f].groupBy;if(a.isArray(p)){var y=s.parseGroupBy(p,i[f],o[f]);u.push(y.replacer)}}return e.forEach(function(e){for(var o="",c=n,s=0;s<t.length;s++){var f=c.groupBy=t[s].groupBy;c.orderGroupBy=t[s].orderGroupBy;var p=a.isArray(f)?l.spec(e.specQuery,i[s],u[s]):d[f](e.specQuery);o+="/"+p,r[o]||(r[o]={name:p,path:o,items:[]},c.items.push(r[o])),c=r[o]}c.items.push(e)}),n}return{name:"",path:"",items:e}}function o(e,t){return d[t](e)}Object.defineProperty(n,"__esModule",{value:!0});var a=e("datalib/src/util"),u=e("./property"),c=e("./propindex"),s=e("./query/groupby"),l=e("./query/shorthand"),d={};n.registerKeyFn=r,n.FIELD="field",n.FIELD_TRANSFORM="fieldTransform",n.ENCODING="encoding",n.SPEC="spec",n.nest=i;var f=[u.Property.FIELD],p=s.parseGroupBy(f);n.getGroupByKey=o,r(n.FIELD,function(e){return l.spec(e,p.include,p.replacer)}),n.PARSED_GROUP_BY_FIELD_TRANSFORM=s.parseGroupBy(s.GROUP_BY_FIELD_TRANSFORM),r(n.FIELD_TRANSFORM,function(e){return l.spec(e,n.PARSED_GROUP_BY_FIELD_TRANSFORM.include,n.PARSED_GROUP_BY_FIELD_TRANSFORM.replacer)}),n.PARSED_GROUP_BY_ENCODING=s.parseGroupBy(s.GROUP_BY_ENCODING),r(n.ENCODING,function(e){return l.spec(e,n.PARSED_GROUP_BY_ENCODING.include,n.PARSED_GROUP_BY_ENCODING.replacer)}),r(n.SPEC,function(e){return JSON.stringify(e)})},{"./property":13,"./propindex":14,"./query/groupby":17,"./query/shorthand":20,"datalib/src/util":48}],13:[function(e,t,n){"use strict";function r(e){return!!e.parent}function i(e){return e in y}function o(e){return n.ENCODING_NESTED_PROP_PARENT_INDEX[e]}function a(e){return r(e)?e.parent+E+e.child:e}function u(e){var t=e.split(E);if(1===t.length)return e;if(2===t.length)return{parent:t[0],child:t[1]};throw"Invalid property key with "+t.length+" dots: "+e}function c(e,t){return(T[e]||{})[t]}function s(e){return i(e)||r(e)}Object.defineProperty(n,"__esModule",{value:!0});var l=e("vega-lite/build/src/axis"),d=e("vega-lite/build/src/scale"),f=e("vega-lite/build/src/legend"),p=e("./util");n.isEncodingNestedProp=r,n.ENCODING_TOPLEVEL_PROPS=["channel","aggregate","autoCount","bin","timeUnit","hasFn","sort","field","type","scale","axis","legend"];var y=p.toMap(n.ENCODING_TOPLEVEL_PROPS);n.isEncodingTopLevelProperty=i;var g=["bin","scale","sort","axis","legend"];n.ENCODING_NESTED_PROP_PARENT_INDEX=p.toMap(g),n.hasNestedProperty=o,n.BIN_CHILD_PROPS=["maxbins","divide","extent","base","step","steps","minstep"],n.SORT_CHILD_PROPS=["field","op","order"];var h=n.BIN_CHILD_PROPS.map(function(e){return{parent:"bin",child:e}});n.SORT_PROPS=n.SORT_CHILD_PROPS.map(function(e){return{parent:"sort",child:e}}),n.SCALE_PROPS=d.SCALE_PROPERTIES.map(function(e){return{parent:"scale",child:e}});var m=l.AXIS_PROPERTIES.map(function(e){return{parent:"axis",child:e}}),v=f.LEGEND_PROPERTIES.map(function(e){return{parent:"legend",child:e}});n.ENCODING_NESTED_PROPS=[].concat(h,n.SORT_PROPS,n.SCALE_PROPS,m,v);var E=".";n.toKey=a,n.fromKey=u;var T=n.ENCODING_NESTED_PROPS.reduce(function(e,t){return e[t.parent]=e[t.parent]||[],e[t.parent][t.child]=t,e},{});n.getEncodingNestedProp=c,n.isEncodingProperty=s,n.ALL_ENCODING_PROPS=[].concat(n.ENCODING_TOPLEVEL_PROPS,n.ENCODING_NESTED_PROPS),n.DEFAULT_PROP_PRECEDENCE=["type","field","bin","timeUnit","aggregate","autoCount","channel","mark","scale","sort","axis","legend"].concat(h,n.SCALE_PROPS,m,v,n.SORT_PROPS);var O;!function(e){e.MARK="mark",e.TRANSFORM="transform",e.STACK="stack",e.CHANNEL="channel",e.AGGREGATE="aggregate",e.AUTOCOUNT="autoCount",e.BIN="bin",e.HAS_FN="hasFn",e.TIMEUNIT="timeUnit",e.FIELD="field",e.TYPE="type",e.SORT="sort",e.SCALE="scale",e.AXIS="axis",e.LEGEND="legend"}(O=n.Property||(n.Property={}))},{"./util":38,"vega-lite/build/src/axis":55,"vega-lite/build/src/legend":61,"vega-lite/build/src/scale":65}],14:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e};Object.defineProperty(n,"__esModule",{value:!0});var i=e("./util"),o=e("./property"),a=function(){function e(e){void 0===e&&(e=null),this.index=e?r({},e):{}}return e.prototype.has=function(e){return o.toKey(e)in this.index},e.prototype.get=function(e){return this.index[o.toKey(e)]},e.prototype.set=function(e,t){return this.index[o.toKey(e)]=t,this},e.prototype.setByKey=function(e,t){this.index[e]=t},e.prototype.map=function(t){var n=new e;for(var r in this.index)n.index[r]=t(this.index[r]);return n},e.prototype.size=function(){return i.keys(this.index).length},e.prototype.duplicate=function(){return new e(this.index)},e}();n.PropIndex=a},{"./property":13,"./util":38}],15:[function(e,t,n){"use strict";function r(e){return null!==e&&void 0!==e&&e.value}function i(e){return null!==e&&void 0!==e&&(e.field||"count"===e.aggregate)}function o(e){return null!==e&&void 0!==e&&"autoCount"in e}function a(e){return o(e)&&e.autoCount===!1}function u(e){return o(e)&&e.autoCount===!0}function c(e,t){if(void 0===t&&(t=["aggregate","bin","timeUnit","field","type"]),i(e))return t.reduce(function(t,n){var r=e[n];if(h.isWildcard(r))throw new Error("Cannot convert "+JSON.stringify(e)+" to fielddef: "+n+" is wildcard");return void 0!==r&&("type"===n?t.type=r:t[n]=r),t},{});if(e.autoCount===!1)throw new Error("Cannot convert {autoCount: false} into a field def");return t.reduce(function(t,n){if(h.isWildcard(e[n]))throw new Error("Cannot convert "+JSON.stringify(e)+" to fielddef: "+n+" is wildcard");switch(n){case"type":t.type="quantitative";break;case"aggregate":t.aggregate="count"}return t},{})}function s(e){return i(e)?p.isContinuous(c(e,["bin","timeUnit","field","type"])):o(e)}function l(e){return i(e)?!d(e)&&"temporal"!==e.type:o(e)}function d(e){if(i(e)){var t=c(e,["bin","timeUnit","field","type"]);return p.isDiscrete(t)||!!t.timeUnit}return!1}function f(e){var t=e.scale===!0||e.scale===h.SHORT_WILDCARD?{}:e.scale||{},n=e.type,r=e.channel,i=e.timeUnit,o=e.bin,a=void 0,u={};if(!(h.isWildcard(t.type)||h.isWildcard(n)||h.isWildcard(r)||h.isWildcard(o))){if(t.type)return t.type;if(!("temporal"===n&&h.isWildcard(i)||"quantitative"===n&&h.isWildcard(o))){var c=n===y.ExpandedType.KEY?"nominal":n,s={type:c,timeUnit:i,bin:o};return g.scaleType(t.type,r,s,a,u)}}}Object.defineProperty(n,"__esModule",{value:!0});var p=e("vega-lite/build/src/fielddef"),y=e("./expandedtype"),g=e("vega-lite/build/src/compile/scale/type"),h=e("../wildcard");n.isValueQuery=r,n.isFieldQuery=i,n.isAutoCountQuery=o,n.isDisabledAutoCountQuery=a,n.isEnabledAutoCountQuery=u,n.toFieldDef=c,n.isContinuous=s,n.isMeasure=l,n.isDimension=d,n.scaleType=f},{"../wildcard":39,"./expandedtype":16,"vega-lite/build/src/compile/scale/type":58,"vega-lite/build/src/fielddef":60}],16:[function(e,t,n){"use strict";function r(e){return e===o.Type.ORDINAL||e===o.Type.NOMINAL||e===i.KEY}Object.defineProperty(n,"__esModule",{value:!0});var i,o=e("vega-lite/build/src/type");!function(e){e.QUANTITATIVE=o.Type.QUANTITATIVE,e.ORDINAL=o.Type.ORDINAL,e.TEMPORAL=o.Type.TEMPORAL,e.NOMINAL=o.Type.NOMINAL,e.KEY="key"}(i=n.ExpandedType||(n.ExpandedType={})),n.isDiscrete=r},{"vega-lite/build/src/type":67}],17:[function(e,t,n){"use strict";function r(e){return a.isObject(e)&&!!e.property}function i(e,t,n){return t=t||new s.PropIndex,n=n||new s.PropIndex,e.forEach(function(e){r(e)?(t.setByKey(e.property,!0),n.setByKey(e.property,e.replace)):t.setByKey(e,!0)}),{include:t,replaceIndex:n,replacer:u.getReplacerIndex(n)}}function o(e){return a.isArray(e)?e.map(function(e){if(r(e)){if(e.replace){var t=l.keys(e.replace).reduce(function(t,n){var r=e.replace[n];return(t[r]=t[r]||[]).push(n),t},{});return e.property+"["+l.keys(t).map(function(e){var n=t[e].sort();return n.join(",")+"=>"+e}).join(";")+"]"}return e.property}return e}).join(","):e}Object.defineProperty(n,"__esModule",{value:!0});var a=e("datalib/src/util"),u=e("./shorthand"),c=e("../property"),s=e("../propindex"),l=e("../util");n.REPLACE_BLANK_FIELDS={"*":""},n.REPLACE_XY_CHANNELS={x:"xy",y:"xy"},n.REPLACE_FACET_CHANNELS={row:"facet",column:"facet"},n.REPLACE_MARK_STYLE_CHANNELS={color:"style",opacity:"style",shape:"style",size:"style"},n.isExtendedGroupBy=r,n.parseGroupBy=i,n.toString=o,n.GROUP_BY_FIELD_TRANSFORM=[c.Property.FIELD,c.Property.TYPE,c.Property.AGGREGATE,c.Property.BIN,c.Property.TIMEUNIT,c.Property.STACK],n.GROUP_BY_ENCODING=n.GROUP_BY_FIELD_TRANSFORM.concat([{property:c.Property.CHANNEL,replace:{x:"xy",y:"xy",color:"style",size:"style",shape:"style",opacity:"style",row:"facet",column:"facet"}}])},{"../property":13,"../propindex":14,"../util":38,"./shorthand":20,"datalib/src/util":48}],18:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.encoding=e("./encoding");var r=e("./normalize");n.normalize=r.normalize,n.groupBy=e("./groupby"),n.shorthand=e("./shorthand"),n.spec=e("./spec"),n.transform=e("./transform")},{"./encoding":15,"./groupby":17,"./normalize":19,"./shorthand":20,"./spec":21,"./transform":22}],19:[function(e,t,n){"use strict";function r(e){if(e.groupBy){var t={groupBy:e.groupBy};e.orderBy&&(t.orderGroupBy=e.orderBy);var n={spec:i.duplicate(e.spec),nest:[t]};return e.chooseBy&&(n.chooseBy=e.chooseBy),e.config&&(n.config=e.config),n}return i.duplicate(e)}Object.defineProperty(n,"__esModule",{value:!0});var i=e("../util");n.normalize=r},{"../util":38}],20:[function(e,t,n){"use strict";function r(e){return e.map(function(e){return i(e)})}function i(e){return function(t){return void 0!==e[t]?e[t]:t}}function o(e,t){return P.isWildcard(e)?!P.isShortWildcard(e)&&e["enum"]?P.SHORT_WILDCARD+JSON.stringify(e["enum"]):P.SHORT_WILDCARD:t?t(e):e}function a(e,t){return t?t(e):e}function u(e,t,r){void 0===t&&(t=n.INCLUDE_ALL),void 0===r&&(r=n.REPLACE_NONE);var i=N.fromSpec(e);return c(i,t,r)}function c(e,t,r){void 0===t&&(t=n.INCLUDE_ALL),void 0===r&&(r=n.REPLACE_NONE);var i=[];if(t.get(A.Property.MARK)&&i.push(o(e.mark,r.get(A.Property.MARK))),e.transform&&e.transform.length>0&&i.push("transform:"+JSON.stringify(e.transform)),t.get(A.Property.STACK)){var a=N.stack(e);if(a){var u=t.duplicate().set("type",!1),c=l(a.fieldEncQ,u,r),d=a.groupByEncQ?l(a.groupByEncQ,u,r):void 0;i.push("stack={field:"+c+","+(d?"by:"+d+",":"")+"offset:"+a.offset+"}")}}if(e.encodings){var f=e.encodings.reduce(function(e,n){if(!O.isDisabledAutoCountQuery(n)){var i=s(n,t,r);i&&e.push(i)}return e},[]).sort().join("|");f&&i.push(f)}return i.join("|")}function s(e,t,r){void 0===t&&(t=n.INCLUDE_ALL),void 0===r&&(r=n.REPLACE_NONE);var i=[];if(t.get(A.Property.CHANNEL)&&i.push(o(e.channel,r.get(A.Property.CHANNEL))),O.isFieldQuery(e)){var a=l(e,t,r);a&&i.push(a)}else O.isValueQuery(e)&&i.push(e.value);return i.join(":")}function l(e,t,r){if(void 0===t&&(t=n.INCLUDE_ALL),void 0===r&&(r=n.REPLACE_NONE),t.get(A.Property.AGGREGATE)&&O.isDisabledAutoCountQuery(e))return"-";var i,a=d(e,t,r),u=f(e,t,r);if(O.isFieldQuery(e)){if(i=t.get("field")?o(e.field,r.get("field")):"...",t.get(A.Property.TYPE))if(P.isWildcard(e.type))i+=","+o(e.type,r.get(A.Property.TYPE));else{var c=((e.type||E.Type.QUANTITATIVE)+"").substr(0,1);i+=","+o(c,r.get(A.Property.TYPE))}i+=u.map(function(e){var t=e.value instanceof Array?"["+e.value+"]":e.value;return","+e.key+"="+t}).join("")}else O.isAutoCountQuery(e)&&(i="*,q");if(!i)return null;if(a){var s=T.isString(a)?a:P.SHORT_WILDCARD+(b.keys(a).length>0?JSON.stringify(a):"");return s+"("+i+")"}return i}function d(e,t,n){if(t.get(A.Property.AGGREGATE)&&e.aggregate&&!P.isWildcard(e.aggregate))return a(e.aggregate,n.get(A.Property.AGGREGATE));if(t.get(A.Property.AGGREGATE)&&O.isEnabledAutoCountQuery(e))return a("count",n.get(A.Property.AGGREGATE));if(t.get(A.Property.TIMEUNIT)&&e.timeUnit&&!P.isWildcard(e.timeUnit))return a(e.timeUnit,n.get(A.Property.TIMEUNIT));if(t.get(A.Property.BIN)&&e.bin&&!P.isWildcard(e.bin))return"bin";for(var r=null,i=0,o=[A.Property.AGGREGATE,A.Property.AUTOCOUNT,A.Property.TIMEUNIT,A.Property.BIN];i<o.length;i++){var u=o[i],c=e[u];t.get(u)&&e[u]&&P.isWildcard(c)&&(r=r||{},r[u]=P.isShortWildcard(c)?c:c["enum"])}return r&&e.hasFn&&(r.hasFn=!0),r}function f(e,t,r){var i=[];if(!b.isBoolean(e.bin)&&!P.isShortWildcard(e.bin)){var u=e.bin;for(var c in u){var s=A.getEncodingNestedProp("bin",c);s&&t.get(s)&&void 0!==u[c]&&i.push({key:c,value:o(u[c],r.get(s))})}i.sort(function(e,t){return e.key.localeCompare(t.key)})}for(var l=0,d=[A.Property.SCALE,A.Property.SORT,A.Property.AXIS,A.Property.LEGEND];l<d.length;l++){var f=d[l];if((P.isWildcard(e.channel)||n.PROPERTY_SUPPORTED_CHANNELS[f][e.channel])&&t.get(f)&&void 0!==e[f]){var p=e[f];if(b.isBoolean(p)||null===p)i.push({key:f+"",value:p||!1});else if(T.isString(p))i.push({key:f+"",value:a(JSON.stringify(p),r.get(f))});else{var y=[];for(var c in p){var g=A.getEncodingNestedProp(f,c);g&&t.get(g)&&void 0!==p[c]&&y.push({key:c,value:o(p[c],r.get(g))})}if(y.length>0){var h=y.sort(function(e,t){return e.key.localeCompare(t.key)}).reduce(function(e,t){return e[t.key]=t.value,e},{});i.push({key:f+"",value:JSON.stringify(h)})}}}}return i}function p(e){for(var t=e.split("|"),n={mark:t[0],encodings:[]},r=1;r<t.length;r++){var i=t[r],o=y(i,":",1),a=o[0],u=o[1];if(m.isChannel(a)||"?"===a){var c=_.encoding(a,u);n.encodings.push(c)}else"transform"!==a||(n.transform=JSON.parse(u))}return n}function y(e,t,n){for(var r=[],i=0,o=0;o<n;o++){var a=e.indexOf(t,i);if(a===-1)break;r.push(e.substring(i,a)),i=a+1}if(r.push(e.substr(i)),r.length!==n+1)for(;r.length!==n+1;)r.push("");return r}var g=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e};Object.defineProperty(n,"__esModule",{value:!0});var h=e("vega-lite/build/src/aggregate"),m=e("vega-lite/build/src/channel"),v=e("vega-lite/build/src/timeunit"),E=e("vega-lite/build/src/type"),T=e("datalib/src/util"),O=e("./encoding"),N=e("./spec"),P=e("../wildcard"),A=e("../property"),S=e("../propindex"),b=e("../util");n.getReplacerIndex=r,n.getReplacer=i,n.value=o,n.replace=a,n.REPLACE_NONE=new S.PropIndex,n.INCLUDE_ALL=[].concat(A.DEFAULT_PROP_PRECEDENCE,A.SORT_PROPS,[A.Property.TRANSFORM,A.Property.STACK]).reduce(function(e,t){return e.set(t,!0)},new S.PropIndex),n.vlSpec=u,n.PROPERTY_SUPPORTED_CHANNELS={axis:{x:!0,y:!0,row:!0,column:!0},legend:{color:!0,opacity:!0,size:!0,shape:!0},scale:{x:!0,y:!0,color:!0,opacity:!0,row:!0,column:!0,size:!0,shape:!0},sort:{x:!0,y:!0,path:!0,order:!0}},n.spec=c,n.encoding=s,n.fieldDef=l,n.parse=p,n.splitWithTail=y;var _;!function(e){function t(e,t){var r=t.indexOf("(")!==-1?i(t):n(y(t,",",2));return g({channel:e},r)}function n(e){var t={};t.field=e[0],t.type=E.getFullName(e[1].toUpperCase())||"?";for(var n=e[2],i=0,o=0;o<n.length;){var a=n.indexOf("=",o),u=void 0;if(a===-1)break;var c=n.substring(o,a);if("{"===n[o+c.length+1]){var s=o+c.length+1;i=r(s,n,"}");var l=n.substring(s,i+1);u=JSON.parse(l),o=i+2}else if("["===n[o+c.length+1]){var d=o+c.length+1,f=r(d,n,"]"),p=n.substring(d,f+1);u=JSON.parse(p),o=f+2}else{var y=o,g=n.indexOf(",",o+c.length);g===-1&&(g=n.length),o=g+1,u=JSON.parse(n.substring(y+c.length+1,g))}A.hasNestedProperty(c)?t[c]=u:(t.bin=t.bin||{},t.bin[c]=u)}return t}function r(e,t,n){for(var r=e;r<t.length;r++)if(t[r]===n)return r}function i(e){var t={};if("?"===e[0]){var i=r(1,e,"}"),o=JSON.parse(e.substring(1,i+1));for(var a in o)b.isArray(o[a])?t[a]={"enum":o[a]}:t[a]=o[a];return g({},t,n(y(e.substring(i+2,e.length-1),",",2)))}var u=e.substring(0,e.indexOf("(")),c=e.substring(u.length+1,e.length-1),s=y(c,",",2);return h.isAggregateOp(u)?g({aggregate:u},n(s)):v.isTimeUnit(u)?g({timeUnit:u},n(s)):"bin"===u?g({bin:{}},n(s)):void 0}e.encoding=t,e.rawFieldDef=n,e.getClosingIndex=r,e.fn=i}(_=n.shorthandParser||(n.shorthandParser={}))},{"../property":13,"../propindex":14,"../util":38,"../wildcard":39,"./encoding":15,"./spec":21,"datalib/src/util":48,"vega-lite/build/src/aggregate":54,"vega-lite/build/src/channel":57,"vega-lite/build/src/timeunit":66,"vega-lite/build/src/type":67}],21:[function(e,t,n){"use strict";function r(e){return l.extend(e.data?{data:e.data}:{},e.transform?{transform:e.transform}:{},{mark:e.mark,encodings:l.keys(e.encoding).map(function(t){var n={channel:t},r=e.encoding[t];for(var i in r)s.isEncodingTopLevelProperty(i)&&void 0!==r[i]&&(l.contains(["bin","scale","axis","legend"],i)&&null===r[i]?n[i]=!1:n[i]=r[i]);return d.isFieldQuery(n)&&"count"===n.aggregate&&!n.field&&(n.field="*"),n})},e.config?{config:e.config}:{})}function i(e){return l.some(e.encodings,function(e){return d.isFieldQuery(e)&&!c.isWildcard(e.aggregate)&&!!e.aggregate||d.isEnabledAutoCountQuery(e)})}function o(e){var t=e.config,n=t?t.stack:void 0;if(l.contains(["none",null,!1],n))return null;if(!l.contains(["bar","area"],e.mark))return null;if(!i(e))return null;var r=e.encodings.reduce(function(e,t){return l.contains(u.NONSPATIAL_CHANNELS,t.channel)&&(d.isValueQuery(t)||d.isFieldQuery(t)&&!t.aggregate)&&e.push({channel:t.channel,fieldDef:t}),e},[]);if(0===r.length)return null;var o=e.encodings.reduce(function(e,t){return e||(t.channel===u.Channel.X?t:null)},null),a=e.encodings.reduce(function(e,t){return e||(t.channel===u.Channel.Y?t:null)},null),c=d.isFieldQuery(o)&&!!o.aggregate||d.isAutoCountQuery(o)&&!!o.autoCount,s=d.isFieldQuery(a)&&!!a.aggregate||d.isAutoCountQuery(a)&&!!a.autoCount;return c!==s?{groupbyChannel:c?a?u.Y:null:o?u.X:null,groupByEncQ:c?a:o,fieldChannel:c?u.X:u.Y,fieldEncQ:c?o:a,impute:l.contains(["area","line"],e.mark),stackBy:r,offset:n||"zero"}:null}function a(e,t){void 0===t&&(t={});var n=t.exclude?f.toMap(t.exclude.map(s.toKey)):{};if(c.isWildcard(e.mark)&&!n.mark)return!0;for(var r=0,i=e.encodings;r<i.length;r++){var o=i[r];for(var a in o){var u=a;if(o.hasOwnProperty(u)&&s.isEncodingTopLevelProperty(u)){if(c.isWildcard(o[u])&&!n[u])return!0;var d=o[u];for(var p in d)if(d.hasOwnProperty(p)&&!l.contains(["enum","name"],p)){var y={parent:u,child:p};if(c.isWildcard(d[p])&&!n[s.toKey(y)])return!0}}}}return!1}Object.defineProperty(n,"__esModule",{value:!0});var u=e("vega-lite/build/src/channel"),c=e("../wildcard"),s=e("../property"),l=e("../util"),d=e("./encoding"),f=e("datalib/src/util");n.fromSpec=r,n.isAggregate=i,n.stack=o,n.hasWildcard=a},{"../property":13,"../util":38,"../wildcard":39,"./encoding":15,"datalib/src/util":48,"vega-lite/build/src/channel":57}],22:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],23:[function(e,t,n){"use strict";function r(e,t,n){var r=i(e,t,n);return{score:r.score,features:[r]}}function i(e,t,r){var i=e.getEncodings();if(e.isAggregate()){var c=function(e){return u.isFieldQuery(e)&&(e.type===o.Type.QUANTITATIVE&&!e.bin&&!e.aggregate||e.type===o.Type.TEMPORAL&&!e.timeUnit)};if(a.some(i,c))return{type:n.name,score:.1,feature:"Aggregate with raw continuous"};if(a.some(i,function(e){return u.isFieldQuery(e)&&u.isDimension(e)})){var s=a.some(i,function(e){return u.isFieldQuery(e)&&"count"===e.aggregate||u.isEnabledAutoCountQuery(e)}),l=a.some(i,function(e){return u.isFieldQuery(e)&&!!e.bin});return s?{type:n.name,score:.8,feature:"Aggregate with count"}:l?{type:n.name,score:.7,feature:"Aggregate with bin but without count"}:{type:n.name,score:.9,feature:"Aggregate without count and without bin"}}return{type:n.name,score:.3,feature:"Aggregate without dimension"}}return a.some(i,function(e){return u.isFieldQuery(e)&&!u.isDimension(e)})?{type:n.name,score:1,feature:"Raw with measure"}:{type:n.name,score:.2,feature:"Raw without measure"}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("vega-lite/build/src/type"),a=e("../util"),u=e("../query/encoding");n.name="aggregationQuality",n.score=r},{"../query/encoding":15,"../util":38,"vega-lite/build/src/type":67}],24:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e};Object.defineProperty(n,"__esModule",{value:!0});var o=e("vega-lite/build/src/channel"),a=e("../../config"),u=e("./type"),c=e("./base"),s=function(e){function t(){return e.call(this,"Axis")||this}return r(t,e),t.prototype.initScore=function(e){void 0===e&&(e={}),e=i({},a.DEFAULT_QUERY_CONFIG,e);var t={},n=[{feature:u.BIN_Q,opt:"preferredBinAxis"},{feature:u.T,opt:"preferredTemporalAxis"},{feature:u.TIMEUNIT_T,opt:"preferredTemporalAxis"},{feature:u.TIMEUNIT_O,opt:"preferredTemporalAxis"},{feature:u.O,opt:"preferredOrdinalAxis"},{feature:u.N,opt:"preferredNominalAxis"}];return n.forEach(function(n){e[n.opt]===o.Channel.X?t[n.feature+"_"+o.Channel.Y]=-.01:e[n.opt]===o.Channel.Y&&(t[n.feature+"_"+o.Channel.X]=-.01)}),t},t.prototype.featurize=function(e,t){return e+"_"+t},t.prototype.getScore=function(e,t,n){var r=this;return e.getEncodings().reduce(function(e,t){var n=u.getExtendedType(t),i=r.featurize(n,t.channel),o=r.getFeatureScore(i);return o&&e.push(o),e},[])},t}(c.Scorer);n.AxisScorer=s},{"../../config":1,"./base":25,"./type":31,"vega-lite/build/src/channel":57}],25:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e){this.type=e,this.scoreIndex=this.initScore()}return e.prototype.getFeatureScore=function(e){var t=this.type,n=this.scoreIndex[e];if(void 0!==n)return{type:t,feature:e,score:n}},e}();n.Scorer=r},{}],26:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var i=e("./base"),o=e("../../query/encoding"),a=function(e){function t(){return e.call(this,"Dimension")||this}return r(t,e),t.prototype.initScore=function(){return{row:-2,column:-2,color:0,opacity:0,size:0,shape:0}},t.prototype.getScore=function(e,t,n){var r=this;return e.isAggregate()&&e.getEncodings().reduce(function(e,t){if(o.isFieldQuery(t)&&!t.aggregate){var n=r.getFeatureScore(t.channel+"");if(n&&n.score>e.score)return n}return e},{type:"Dimension",feature:"No Dimension",score:-5}),[]},t}(i.Scorer);n.DimensionScorer=a},{"../../query/encoding":15,"./base":25}],27:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e};Object.defineProperty(n,"__esModule",{value:!0});var o=e("./base"),a=e("../../config"),u=e("vega-lite/build/src/channel"),c=function(e){function t(){return e.call(this,"Facet")||this}return r(t,e),t.prototype.initScore=function(e){e=i({},a.DEFAULT_QUERY_CONFIG,e);var t={};return e.preferredFacet===u.Channel.ROW?t[u.Channel.COLUMN]=-.01:e.preferredFacet===u.Channel.COLUMN&&(t[u.Channel.ROW]=-.01),t},t.prototype.getScore=function(e,t,n){var r=this;return e.getEncodings().reduce(function(e,t){var n=r.getFeatureScore(t.channel);return n&&e.push(n),e},[])},t}(o.Scorer);n.FacetScorer=c},{"../../config":1,"./base":25,"vega-lite/build/src/channel":57}],28:[function(e,t,n){"use strict";function r(e,t,n){var r=l.reduce(function(r,i){var o=i.getScore(e,t,n);return r.concat(o)},[]);return{score:r.reduce(function(e,t){return e+t.score},0),features:r}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("./axis"),o=e("./dimension"),a=e("./facet"),u=e("./sizechannel"),c=e("./typechannel"),s=e("./mark"),l=[new i.AxisScorer,new o.DimensionScorer,new a.FacetScorer,new s.MarkScorer,new u.SizeChannelScorer,new c.TypeChannelScorer];n.effectiveness=r},{"./axis":24,"./dimension":26,"./facet":27,"./mark":29,"./sizechannel":30,"./typechannel":32}],29:[function(e,t,n){"use strict";function r(e,t,n,r){return e+"_"+t+"_"+n+"_"+r}function i(){var e=[s.Q,s.T],t=[s.BIN_Q,s.TIMEUNIT_O,s.O,s.N],n=t.concat([s.NONE]),i={};return e.forEach(function(t){e.forEach(function(e){var n={point:0,text:-.2,tick:-.5,rect:-1,bar:-2,line:-2,area:-2,rule:-2.5};c.forEach(n,function(n,o){var a=r(t,e,!0,o);i[a]=n});var o={point:0,text:-.2,tick:-.5,bar:-2,line:-2,area:-2,rule:-2.5};c.forEach(o,function(n,o){var a=r(t,e,!1,o);i[a]=n})})}),e.forEach(function(e){n.forEach(function(t){var n={tick:0,point:-.2,text:-.5,bar:-2,line:-2,area:-2,rule:-2.5};c.forEach(n,function(n,o){var a=r(e,t,!0,o);i[a]=n;var u=r(t,e,!0,o);i[u]=n})}),[s.TIMEUNIT_T].forEach(function(t){var n={point:0,text:-.5,tick:-1,bar:-2,line:-2,area:-2,rule:-2.5};c.forEach(n,function(n,o){var a=r(e,t,!0,o);i[a]=n;
var u=r(t,e,!0,o);i[u]=n})}),[s.NONE,s.N,s.O].forEach(function(t){var n={bar:0,point:-.2,tick:-.25,text:-.3,line:-2,area:-2,rule:-2.5};c.forEach(n,function(n,o){var a=r(e,t,!1,o);i[a]=n;var u=r(t,e,!1,o);i[u]=n})}),[s.BIN_Q].forEach(function(t){var n={bar:0,point:-.2,tick:-.25,text:-.3,line:-.5,area:-.5,rule:-2.5};c.forEach(n,function(n,o){var a=r(e,t,!1,o);i[a]=n;var u=r(t,e,!1,o);i[u]=n})}),[s.TIMEUNIT_T,s.TIMEUNIT_O].forEach(function(t){var n={line:0,area:-.1,bar:-.2,point:-.3,tick:-.35,text:-.4,rule:-2.5};c.forEach(n,function(n,o){var a=r(e,t,!1,o);i[a]=n;var u=r(t,e,!1,o);i[u]=n})})}),[s.TIMEUNIT_T].forEach(function(e){[s.TIMEUNIT_T].forEach(function(t){var n={point:0,rect:-.1,text:-.5,tick:-1,bar:-2,line:-2,area:-2,rule:-2.5};c.forEach(n,function(n,o){var a=r(e,t,!0,o);i[a]=n}),c.forEach(n,function(n,o){var a=r(e,t,!1,o);i[a]=n})}),n.forEach(function(t){var n={tick:0,point:-.2,text:-.5,rect:-1,bar:-2,line:-2,area:-2,rule:-2.5};c.forEach(n,function(n,o){var a=r(e,t,!0,o);i[a]=n}),c.forEach(n,function(n,o){var a=r(t,e,!0,o);i[a]=n}),c.forEach(n,function(n,o){var a=r(e,t,!1,o);i[a]=n}),c.forEach(n,function(n,o){var a=r(t,e,!1,o);i[a]=n})})}),n.forEach(function(e){n.forEach(function(t){var n={point:0,rect:0,text:-.1,tick:-1,bar:-2,line:-2,area:-2,rule:-2.5};c.forEach(n,function(n,o){var a=r(e,t,!0,o);i[a]=n}),c.forEach(n,function(n,o){var a=r(e,t,!1,o);i[a]=n})})}),i}var o=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var a=e("vega-lite/build/src/channel"),u=e("vega-lite/build/src/mark"),c=e("../../util"),s=e("./type"),l=e("./base"),d=function(e){function t(){return e.call(this,"Mark")||this}return o(t,e),t.prototype.initScore=function(){return i()},t.prototype.getScore=function(e,t,n){var r=e.getMark();r!==u.Mark.CIRCLE&&r!==u.Mark.SQUARE||(r=u.Mark.POINT);var i=e.getEncodingQueryByChannel(a.Channel.X),o=i?s.getExtendedType(i):s.NONE,c=e.getEncodingQueryByChannel(a.Channel.Y),l=c?s.getExtendedType(c):s.NONE,d=!e.isAggregate(),f=o+"_"+l+"_"+d+"_"+r,p=this.getFeatureScore(f);return[p]},t}(l.Scorer);n.MarkScorer=d,n.featurize=r},{"../../util":38,"./base":25,"./type":31,"vega-lite/build/src/channel":57,"vega-lite/build/src/mark":64}],30:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var i=e("./base"),o=function(e){function t(){return e.call(this,"SizeChannel")||this}return r(t,e),t.prototype.initScore=function(){return{bar_size:-2,tick_size:-2}},t.prototype.getScore=function(e,t,n){var r=this,i=e.getMark();return e.getEncodings().reduce(function(e,t){var n=i+"_"+t.channel,o=r.getFeatureScore(n);return o&&e.push(o),e},[])},t}(i.Scorer);n.SizeChannelScorer=o},{"./base":25}],31:[function(e,t,n){"use strict";function r(e){if(e.bin)return i.BIN_Q;if(e.timeUnit){var t=u.scaleType(e);return o.hasDiscreteDomain(t)?i.TIMEUNIT_O:i.TIMEUNIT_T}return e.type}Object.defineProperty(n,"__esModule",{value:!0});var i,o=e("vega-lite/build/src/scale"),a=e("vega-lite/build/src/type"),u=e("../../query/encoding"),c=e("../../query/expandedtype");!function(e){e[e.Q=a.Type.QUANTITATIVE]="Q",e[e.BIN_Q="bin_"+a.Type.QUANTITATIVE]="BIN_Q",e[e.T=a.Type.TEMPORAL]="T",e[e.TIMEUNIT_T="timeUnit_time"]="TIMEUNIT_T",e[e.TIMEUNIT_O="timeUnit_"+a.Type.ORDINAL]="TIMEUNIT_O",e[e.O=a.Type.ORDINAL]="O",e[e.N=a.Type.NOMINAL]="N",e[e.K=c.ExpandedType.KEY]="K",e[e.NONE="-"]="NONE"}(i=n.ExtendedType||(n.ExtendedType={})),n.Q=i.Q,n.BIN_Q=i.BIN_Q,n.T=i.T,n.TIMEUNIT_T=i.TIMEUNIT_T,n.TIMEUNIT_O=i.TIMEUNIT_O,n.O=i.O,n.N=i.N,n.K=i.K,n.NONE=i.NONE,n.getExtendedType=r},{"../../query/encoding":15,"../../query/expandedtype":16,"vega-lite/build/src/scale":65,"vega-lite/build/src/type":67}],32:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../query/shorthand"),o=e("../../util"),a=e("./type"),u=e("./base");n.TERRIBLE=-10;var c=function(e){function t(){return e.call(this,"TypeChannel")||this}return r(t,e),t.prototype.initScore=function(){var e=this,t={},r={x:0,y:0,size:-.575,color:-.725,text:-2,opacity:-3,shape:n.TERRIBLE,row:n.TERRIBLE,column:n.TERRIBLE,detail:2*n.TERRIBLE};[a.Q,a.T,a.TIMEUNIT_T].forEach(function(n){o.keys(r).forEach(function(i){t[e.featurize(n,i)]=r[i]})});var i=o.extend({},r,{row:-.75,column:-.75,shape:-3.1,text:-3.2,detail:-4});[a.BIN_Q,a.TIMEUNIT_O,a.O].forEach(function(n){o.keys(i).forEach(function(r){t[e.featurize(n,r)]=i[r]})});var u={x:0,y:0,color:-.6,shape:-.65,row:-.7,column:-.7,text:-.8,detail:-2,size:-3,opacity:-3.1};return o.keys(u).forEach(function(n){t[e.featurize(a.N,n)]=u[n]}),t},t.prototype.featurize=function(e,t){return e+"_"+t},t.prototype.getScore=function(e,t,n){var r=this,u=e.getEncodings().reduce(function(e,t){var n=i.fieldDef(t);return(e[n]=e[n]||[]).push(t),e},{}),c=[];return o.forEach(u,function(e){var t=e.reduce(function(e,t){var n=a.getExtendedType(t),i=r.featurize(n,t.channel),o=r.getFeatureScore(i);return null===e||o.score>e.score?o:e},null);c.push(t)}),c},t}(u.Scorer);n.TypeChannelScorer=c},{"../../query/shorthand":20,"../../util":38,"./base":25,"./type":31}],33:[function(e,t,n){"use strict";function r(e,t,n){var r=e.wildcardIndex.encodingIndicesByProperty.get("field");if(!r)return{score:0,features:[]};for(var o=e.specQuery.encodings,a=t.fieldSchemas.length,u=[],c=0,s=1,l=r.length-1;l>=0;l--){var d=r[l],f=o[d],p=void 0;if(i.isFieldQuery(f)){p=f.field;var y=e.wildcardIndex.encodings[d].get("field"),g=t.fieldSchema(p).index,h=-g*s;c+=h,u.push({score:h,type:"fieldOrder",feature:"field "+y.name+" is "+p+" (#"+g+" in the schema)"}),s*=a}}return{score:c,features:u}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("../query/encoding");n.name="fieldOrder",n.score=r},{"../query/encoding":15}],34:[function(e,t,n){"use strict";function r(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}function i(e,t){p[e]=t}function o(e){return p[e]}function a(e,t,n,r){return t.nest&&r!==t.nest.length?(e.items.forEach(function(e){a(e,t,n,r+1)}),t.nest[r].orderGroupBy&&e.items.sort(c(t.nest[r].orderGroupBy,n,t.config))):(t.orderBy||t.chooseBy)&&(e.items.sort(u(t.orderBy||t.chooseBy,n,t.config)),t.chooseBy&&e.items.length>0&&e.items.splice(1)),e}function u(e,t,n){return function(r,i){return e instanceof Array?s(e,r,i,t,n):s([e],r,i,t,n)}}function c(e,t,n){return function(r,i){var o=d.getTopSpecQueryItem(r),a=d.getTopSpecQueryItem(i);return e instanceof Array?s(e,o,a,t,n):s([e],o,a,t,n)}}function s(e,t,n,r,i){for(var o=0,a=e;o<a.length;o++){var u=a[o],c=l(n,u,r,i).score-l(t,u,r,i).score;if(0!==c)return c}return 0}function l(e,t,n,r){if(void 0!==e.getRankingScore(t))return e.getRankingScore(t);var i=o(t),a=i(e,n,r);return e.setRankingScore(t,a),a}Object.defineProperty(n,"__esModule",{value:!0});var d=e("../model"),f=e("./effectiveness");r(e("./effectiveness")),n.aggregation=e("./aggregation"),n.fieldOrder=e("./fieldorder");var p={};n.register=i,n.get=o,n.rank=a,n.comparatorFactory=u,n.groupComparatorFactory=c,n.getScore=l,n.EFFECTIVENESS="effectiveness",i(n.EFFECTIVENESS,f.effectiveness),i(n.aggregation.name,n.aggregation.score),i(n.fieldOrder.name,n.fieldOrder.score)},{"../model":11,"./aggregation":23,"./effectiveness":28,"./fieldorder":33}],35:[function(e,t,n){"use strict";function r(e,t,n){e=i({},c.normalize(e),{config:i({},o.DEFAULT_QUERY_CONFIG,n,e.config)});var r=a.generate(e.spec,t,e.config),l=u.nest(r,e.nest),d=s.rank(l,e,t,0);return{query:e,result:d}}var i=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e};Object.defineProperty(n,"__esModule",{value:!0});var o=e("./config"),a=e("./generate"),u=e("./nest"),c=e("./query/normalize"),s=e("./ranking/ranking");n.recommend=r},{"./config":1,"./generate":10,"./nest":12,"./query/normalize":19,"./ranking/ranking":34}],36:[function(e,t,n){"use strict";function r(e,t,n){void 0===t&&(t={fields:[]}),void 0===n&&(n={}),n=v.extend({},m.DEFAULT_QUERY_CONFIG,n);for(var r=f.summary(e),a=p.inferAll(e),u=t.fields.reduce(function(e,t){return e[t.name]=t,e},{}),l=r.map(function(t,r){var i,o=t.field,c="date"===a[o]?O.DATETIME:a[o],l=t.distinct;if(c===O.NUMBER)i=s.Type.QUANTITATIVE;else if(c===O.INTEGER)i=l<n.numberNominalLimit&&l/t.count<n.numberNominalProportion?s.Type.NOMINAL:s.Type.QUANTITATIVE;else if(c===O.DATETIME){i=s.Type.TEMPORAL,t.min=new Date(e[0][o]),t.max=new Date(e[0][o]);for(var d=0,f=e;d<f.length;d++){var p=f[d],y=new Date(p[o]).getTime();y<t.min.getTime()&&(t.min=new Date(y)),y>t.max.getTime()&&(t.max=new Date(y))}}else i=s.Type.NOMINAL;i===s.Type.NOMINAL&&l/t.count>n.minPercentUniqueForKey&&t.count>n.minCardinalityForKey&&(i=h.ExpandedType.KEY);var g={name:o,originalIndex:r,vlType:i,type:c,stats:t,timeStats:{},binStats:{}},m=u[g.name];return g=v.extend(g,m)}),d=0,y=l;d<y.length;d++){var g=y[d];if(g.vlType===s.Type.QUANTITATIVE)for(var E=0,N=n["enum"].binProps.maxbins;E<N.length;E++){var P=N[E];g.binStats[P]=i(P,g.stats)}else if(g.vlType===s.Type.TEMPORAL)for(var A=0,S=n["enum"].timeUnit;A<S.length;A++){var b=S[A];void 0!==b&&(g.timeStats[b]=o(b,g.stats))}}var _=c({},t,{fields:l});return new T(_)}function i(e,t){var n=y({min:t.min,max:t.max,maxbins:e}),r=v.extend({},t);return r.unique=a(n,t.unique),r.distinct=(n.stop-n.start)/n.step,r.min=n.start,r.max=n.stop,r}function o(e,t){var n=v.extend({},t),r={};return v.keys(t.unique).forEach(function(n){var i,o="null"===n?null:new Date(n);i=null===o?null:isNaN(o.getTime())?"Invalid Date":(e===d.TimeUnit.DAY?o.getDay():d.convert(e,o)).toString(),r[i]=(r[i]||0)+t.unique[n]}),n.unique=r,n.distinct=v.keys(r).length,n}function a(e,t){var n={};for(var r in t){var i=void 0;i=null===r?null:isNaN(Number(r))?NaN:e.value(Number(r)),n[i]=(n[i]||0)+t[r]}return n}function u(e,t){return t.reduce(function(t,n){return e[n]?t+1:t},0)}var c=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e};Object.defineProperty(n,"__esModule",{value:!0});var s=e("vega-lite/build/src/type"),l=e("vega-lite/build/src/bin"),d=e("vega-lite/build/src/timeunit"),f=e("datalib/src/stats"),p=e("datalib/src/import/type"),y=e("datalib/src/bins/bins"),g=e("./query/encoding"),h=e("./query/expandedtype"),m=e("./config"),v=e("./util");n.build=r;var E={nominal:0,key:1,ordinal:2,temporal:3,quantitative:4},T=function(){function e(e){this._tableSchema=e,e.fields.sort(function(e,t){return E[e.vlType]<E[t.vlType]?-1:E[e.vlType]>E[t.vlType]?1:e.name.localeCompare(t.name)}),e.fields.forEach(function(e,t){return e.index=t}),this._fieldSchemaIndex=e.fields.reduce(function(e,t){return e[t.name]=t,e},{})}return e.prototype.fieldNames=function(){return this._tableSchema.fields.map(function(e){return e.name})},Object.defineProperty(e.prototype,"fieldSchemas",{get:function(){return this._tableSchema.fields},enumerable:!0,configurable:!0}),e.prototype.fieldSchema=function(e){return this._fieldSchemaIndex[e]},e.prototype.tableSchema=function(){var e=v.duplicate(this._tableSchema);return e.fields.sort(function(e,t){return e.originalIndex-t.originalIndex}),e},e.prototype.primitiveType=function(e){return this._fieldSchemaIndex[e]?this._fieldSchemaIndex[e].type:null},e.prototype.vlType=function(e){return this._fieldSchemaIndex[e]?this._fieldSchemaIndex[e].vlType:null},e.prototype.cardinality=function(e,t,n){void 0===t&&(t=!0),void 0===n&&(n=!1);var r=this._fieldSchemaIndex[e.field];if(e.aggregate||g.isAutoCountQuery(e)&&e.autoCount)return 1;if(e.bin){var a=void 0;a="boolean"==typeof e.bin?{maxbins:l.autoMaxBins(e.channel)}:"?"===e.bin?{"enum":[!0,!1]}:e.bin;var s=a.maxbins;return r.binStats[s]||(r.binStats[s]=i(s,r.stats)),r.binStats[s].distinct}if(e.timeUnit){if(t)switch(e.timeUnit){case d.TimeUnit.SECONDS:return 60;case d.TimeUnit.MINUTES:return 60;case d.TimeUnit.HOURS:return 24;case d.TimeUnit.DAY:return 7;case d.TimeUnit.DATE:return 31;case d.TimeUnit.MONTH:return 12;case d.TimeUnit.QUARTER:return 4;case d.TimeUnit.MILLISECONDS:return 1e3}var f=e.timeUnit,p=r.timeStats;return p&&p[f]||(p=c({},p,(y={},y[f]=o(e.timeUnit,r.stats),y))),n?p[f].distinct-u(p[f].unique,["Invalid Date",null]):p[f].distinct}return r?n?r.stats.distinct-u(r.stats.unique,[NaN,null]):r.stats.distinct:null;var y},e.prototype.timeUnitHasVariation=function(e){if(e.timeUnit){if(e.timeUnit===d.TimeUnit.DAY){var t=v.extend({},e,{timeUnit:d.TimeUnit.DATE});if(this.cardinality(t,!1,!0)<=1)return!1}for(var n=e.timeUnit,r=0,i=d.TIMEUNIT_PARTS;r<i.length;r++){var o=i[r];if(d.containsTimeUnit(n,o)){var a=v.extend({},e,{timeUnit:o});if(this.cardinality(a,!1,!0)<=1)return!1}}return!0}},e.prototype.domain=function(e){var t=this._fieldSchemaIndex[e.field],n=v.keys(t.stats.unique);return t.vlType===s.Type.QUANTITATIVE?[+t.stats.min,+t.stats.max]:t.type===O.DATETIME?[t.stats.min,t.stats.max]:t.type===O.INTEGER||t.type===O.NUMBER?(n=n.map(function(e){return+e}),n.sort(v.cmp)):t.vlType===s.Type.ORDINAL&&t.ordinalDomain?t.ordinalDomain:n.map(function(e){return"null"===e?null:e}).sort(v.cmp)},e.prototype.stats=function(e){var t=this._fieldSchemaIndex[e.field];return t?t.stats:null},e}();n.Schema=T;var O;!function(e){e[e.STRING="string"]="STRING",e[e.NUMBER="number"]="NUMBER",e[e.INTEGER="integer"]="INTEGER",e[e.BOOLEAN="boolean"]="BOOLEAN",e[e.DATETIME="datetime"]="DATETIME"}(O=n.PrimitiveType||(n.PrimitiveType={}))},{"./config":1,"./query/encoding":15,"./query/expandedtype":16,"./util":38,"datalib/src/bins/bins":43,"datalib/src/import/type":45,"datalib/src/stats":46,"vega-lite/build/src/bin":56,"vega-lite/build/src/timeunit":66,"vega-lite/build/src/type":67}],37:[function(e,t,n){"use strict";function r(e,t,n){var r={};return e=e.map(function(e){return n.smallRangeStepForHighCardinalityOrFacet&&(e=i(e,t,r,n)),n.nominalColorScaleForHighCardinality&&(e=o(e,t,r,n)),n.xAxisOnTopForHighYCardinalityWithoutColumn&&(e=a(e,t,r,n)),e})}function i(e,t,n,r){[u.Channel.ROW,u.Channel.Y,u.Channel.COLUMN,u.Channel.X].forEach(function(t){n[t]=e.getEncodingQueryByChannel(t)});var i=n[u.Channel.Y];if(void 0!==i&&l.isFieldQuery(i)&&(n[u.Channel.ROW]||t.cardinality(i)>r.smallRangeStepForHighCardinalityOrFacet.maxCardinality)){void 0===i.scale&&(i.scale={});var o=l.scaleType(i);i.scale&&(void 0===o||c.hasDiscreteDomain(o))&&(i.scale.rangeStep||(i.scale.rangeStep=12))}var a=n[u.Channel.X];if(l.isFieldQuery(a)&&(n[u.Channel.COLUMN]||t.cardinality(a)>r.smallRangeStepForHighCardinalityOrFacet.maxCardinality)){void 0===a.scale&&(a.scale={});var s=l.scaleType(a);a.scale&&(void 0===s||c.hasDiscreteDomain(s))&&(a.scale.rangeStep||(a.scale.rangeStep=12))}return e}function o(e,t,n,r){n[u.Channel.COLOR]=e.getEncodingQueryByChannel(u.Channel.COLOR);var i=n[u.Channel.COLOR];return l.isFieldQuery(i)&&void 0!==i&&(i.type===s.Type.NOMINAL||i.type===d.ExpandedType.KEY)&&t.cardinality(i)>r.nominalColorScaleForHighCardinality.maxCardinality&&(void 0===i.scale&&(i.scale={}),i.scale&&(i.scale.range||(i.scale.scheme=r.nominalColorScaleForHighCardinality.palette))),e}function a(e,t,n,r){if([u.Channel.COLUMN,u.Channel.X,u.Channel.Y].forEach(function(t){n[t]=e.getEncodingQueryByChannel(t)}),void 0===n[u.Channel.COLUMN]){var i=n[u.Channel.X],o=n[u.Channel.Y];l.isFieldQuery(i)&&l.isFieldQuery(o)&&void 0!==o&&o.field&&c.hasDiscreteDomain(l.scaleType(o))&&void 0!==i&&t.cardinality(o)>r.xAxisOnTopForHighYCardinalityWithoutColumn.maxCardinality&&(void 0===i.axis&&(i.axis={}),i.axis&&!i.axis.orient&&(i.axis.orient="top"))}return e}Object.defineProperty(n,"__esModule",{value:!0});var u=e("vega-lite/build/src/channel"),c=e("vega-lite/build/src/scale"),s=e("vega-lite/build/src/type"),l=e("./query/encoding"),d=e("./query/expandedtype");n.stylize=r,n.smallRangeStepForHighCardinalityOrFacet=i,n.nominalColorScaleForHighCardinality=o,n.xAxisOnTopForHighYCardinalityWithoutColumn=a},{"./query/encoding":15,"./query/expandedtype":16,"vega-lite/build/src/channel":57,"vega-lite/build/src/scale":65,"vega-lite/build/src/type":67}],38:[function(e,t,n){"use strict";function r(e,t){return e.indexOf(t)!==-1}function i(e,t){for(var n=0;n<e.length;n++)if(!t(e[n],n))return!1;return!0}function o(e,t,n){if(e.forEach)e.forEach.call(n,t);else for(var r in e)t.call(n,e[r],r,e)}function a(e,t){var n,r=0;for(n in e)if(t(e[n],n,r++))return!0;return!1}function u(e,t){return e.map(function(e){return s.isArray(e)?u(e,t):t(e)})}function c(e,t){return e.filter(function(e){return!r(t,e)})}Object.defineProperty(n,"__esModule",{value:!0});var s=e("datalib/src/util"),l=e("datalib/src/util");n.cmp=l.cmp,n.keys=l.keys,n.duplicate=l.duplicate,n.extend=l.extend,n.isObject=l.isObject,n.isArray=l.isArray,n.isBoolean=l.isBoolean,n.toMap=l.toMap,n.contains=r,n.every=i,n.forEach=o,n.some=a,n.nestedMap=u,n.without=c},{"datalib/src/util":48}],39:[function(e,t,n){"use strict";function r(e){return i(e)||o(e)}function i(e){return e===n.SHORT_WILDCARD}function o(e){return!(void 0===e||!e["enum"]&&!e.name||d.isArray(e))}function a(e,t,r){return d.extend({},{name:t,"enum":r},e===n.SHORT_WILDCARD?{}:e)}function u(e){for(var t={},n={},r=function(e){for(var r=[0],i=0;i<e.length;i++)e.charAt(i).toUpperCase()===e.charAt(i)&&r.push(i);var o=r.map(function(t){return e.charAt(t)}).join("").toLowerCase();if(!n[o])return t[e]=o,n[o]=!0,"continue";if(r[r.length-1]!==e.length-1&&(o=r.concat([e.length-1]).map(function(t){return e.charAt(t)}).join("").toLowerCase(),!n[o]))return t[e]=o,n[o]=!0,"continue";for(var i=1;!t[e];i++){var a=o+"_"+i;if(!n[a]){t[e]=a,n[a]=!0;break}}},i=0,o=e;i<o.length;i++){var a=o[i];r(a)}return t}function c(e){if(l.isEncodingNestedProp(e))return n.DEFAULT_NAME[e.parent]+"-"+n.DEFAULT_NAME[e.parent+"Props"][e.child];if(n.DEFAULT_NAME[e])return n.DEFAULT_NAME[e];throw new Error("Default name undefined for "+e)}function s(e,t,n){if("field"===e||l.isEncodingNestedProp(e)&&"sort"===e.parent&&"field"===e.child)return t.fieldNames();var r;if(r=l.isEncodingNestedProp(e)?n["enum"][e.parent+"Props"][e.child]:n["enum"][e],void 0!==r)return r;throw new Error("No default enumValues for "+JSON.stringify(e))}Object.defineProperty(n,"__esModule",{value:!0});var l=e("./property"),d=e("./util"),f=e("vega-lite/build/src/axis"),p=e("vega-lite/build/src/channel"),y=e("vega-lite/build/src/mark"),g=e("vega-lite/build/src/scale"),h=e("vega-lite/build/src/legend"),m=e("vega-lite/build/src/timeunit"),v=e("vega-lite/build/src/type");n.SHORT_WILDCARD="?",n.isWildcard=r,n.isShortWildcard=i,n.isWildcardDef=o,n.initWildcard=a,n.DEFAULT_NAME={mark:"m",channel:"c",aggregate:"a",autoCount:"#",hasFn:"h",bin:"b",sort:"so",scale:"s",axis:"ax",legend:"l",timeUnit:"tu",field:"f",type:"t",binProps:{maxbins:"mb",min:"mi",max:"ma",base:"b",step:"s",steps:"ss",minstep:"ms",divide:"d"},sortProps:{field:"f",op:"o",order:"or"},scaleProps:u(g.SCALE_PROPERTIES),axisProps:u(f.AXIS_PROPERTIES),legendProps:u(h.LEGEND_PROPERTIES)},n.getDefaultName=c;var E=[!1,!0],T={maxbins:[5,10,20],extent:[void 0],base:[10],step:[void 0],steps:[void 0],minstep:[void 0],divide:[[5,2]]},O={field:[void 0],op:["min","mean"],order:["ascending","descending"]},N={type:[void 0,g.ScaleType.LOG],domain:[void 0],base:[void 0],exponent:[1,2],clamp:E,nice:E,reverse:E,round:E,zero:E,padding:[void 0],paddingInner:[void 0],paddingOuter:[void 0],interpolate:[void 0],range:[void 0],rangeStep:[17,21],scheme:[void 0]},P={zindex:[1,0],offset:[void 0],orient:[void 0],values:[void 0],domain:E,grid:E,format:[void 0],labels:E,labelAngle:[void 0],labelOverlap:[void 0],labelPadding:[void 0],maxExtent:[void 0],minExtent:[void 0],position:[void 0],ticks:E,tickCount:[void 0],tickSize:[void 0],title:[void 0],titleMaxLength:[void 0],titlePadding:[void 0]},A={entryPadding:[void 0],orient:["left","right"],offset:[void 0],format:[void 0],values:[void 0],tickCount:[void 0],title:[void 0],type:[void 0],zindex:[void 0]};n.DEFAULT_ENUM_INDEX={mark:[y.Mark.POINT,y.Mark.BAR,y.Mark.LINE,y.Mark.AREA,y.Mark.TICK,y.Mark.TEXT],channel:[p.X,p.Y,p.ROW,p.COLUMN,p.SIZE,p.COLOR],aggregate:[void 0,"mean"],autoCount:E,bin:E,hasFn:E,timeUnit:[void 0,m.TimeUnit.YEAR,m.TimeUnit.MONTH,m.TimeUnit.MINUTES,m.TimeUnit.SECONDS],field:[void 0],type:[v.Type.NOMINAL,v.Type.ORDINAL,v.Type.QUANTITATIVE,v.Type.TEMPORAL],sort:["ascending","descending"],scale:[!0],axis:E,legend:E,binProps:T,sortProps:O,scaleProps:N,axisProps:P,legendProps:A},n.getDefaultEnumValues=s},{"./property":13,"./util":38,"vega-lite/build/src/axis":55,"vega-lite/build/src/channel":57,"vega-lite/build/src/legend":61,"vega-lite/build/src/mark":64,"vega-lite/build/src/scale":65,"vega-lite/build/src/timeunit":66,"vega-lite/build/src/type":67}],40:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./property"),i=e("./propindex"),o=function(){function e(){this._mark=void 0,this._encodings={},this._encodingIndicesByProperty=new i.PropIndex}return e.prototype.setEncodingProperty=function(e,t,n){var r=this._encodings,o=r[e]=r[e]||new i.PropIndex;o.set(t,n);var a=this._encodingIndicesByProperty;return a.set(t,a.get(t)||[]),a.get(t).push(e),this},e.prototype.hasEncodingProperty=function(e,t){return!!this._encodings[e]&&this._encodings[e].has(t)},e.prototype.hasProperty=function(e){if(r.isEncodingProperty(e))return this.encodingIndicesByProperty.has(e);if("mark"===e)return!!this.mark;throw new Error("Unimplemented for property "+e)},e.prototype.isEmpty=function(){return!this.mark&&0===this.encodingIndicesByProperty.size()},e.prototype.setMark=function(e){return this._mark=e,this},Object.defineProperty(e.prototype,"mark",{get:function(){return this._mark},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"encodings",{get:function(){return this._encodings},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"encodingIndicesByProperty",{get:function(){return this._encodingIndicesByProperty},enumerable:!0,configurable:!0}),e}();n.WildcardIndex=o},{"./property":13,"./propindex":14}],41:[function(e,t,n){},{}],42:[function(t,n,r){!function(t,i){"object"==typeof r&&"undefined"!=typeof n?i(r):"function"==typeof e&&e.amd?e("d3-time",["exports"],i):i(t.d3_time={})}(this,function(e){"use strict";function t(e,n,r,a){function u(t){return e(t=new Date((+t))),t}return u.floor=u,u.round=function(t){var r=new Date((+t)),i=new Date(t-1);return e(r),e(i),n(i,1),t-r<i-t?r:i},u.ceil=function(t){return e(t=new Date(t-1)),n(t,1),t},u.offset=function(e,t){return n(e=new Date((+e)),null==t?1:Math.floor(t)),e},u.range=function(t,r,i){var o=[];if(t=new Date(t-1),r=new Date((+r)),i=null==i?1:Math.floor(i),!(t<r&&i>0))return o;for(n(t,1),e(t),t<r&&o.push(new Date((+t)));n(t,i),e(t),t<r;)o.push(new Date((+t)));return o},u.filter=function(r){return t(function(t){for(;e(t),!r(t);)t.setTime(t-1)},function(e,t){for(;--t>=0;)for(;n(e,1),!r(e););})},r&&(u.count=function(t,n){return i.setTime(+t),o.setTime(+n),e(i),e(o),Math.floor(r(i,o))},u.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?u.filter(a?function(t){return a(t)%e===0}:function(t){return u.count(0,t)%e===0}):u:null}),u}function n(e){return t(function(t){t.setHours(0,0,0,0),t.setDate(t.getDate()-(t.getDay()+7-e)%7)},function(e,t){e.setDate(e.getDate()+7*t)},function(e,t){return(t-e-6e4*(t.getTimezoneOffset()-e.getTimezoneOffset()))/6048e5})}function r(e){return t(function(t){t.setUTCHours(0,0,0,0),t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7)},function(e,t){e.setUTCDate(e.getUTCDate()+7*t)},function(e,t){return(t-e)/6048e5})}var i=new Date,o=new Date,a=t(function(){},function(e,t){e.setTime(+e+t)},function(e,t){return t-e});a.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?t(function(t){t.setTime(Math.floor(t/e)*e)},function(t,n){t.setTime(+t+n*e)},function(t,n){return(n-t)/e}):a:null};var u=t(function(e){e.setMilliseconds(0)},function(e,t){e.setTime(+e+1e3*t)},function(e,t){return(t-e)/1e3},function(e){return e.getSeconds()}),c=t(function(e){e.setSeconds(0,0)},function(e,t){e.setTime(+e+6e4*t)},function(e,t){return(t-e)/6e4},function(e){return e.getMinutes()}),s=t(function(e){e.setMinutes(0,0,0)},function(e,t){e.setTime(+e+36e5*t)},function(e,t){return(t-e)/36e5},function(e){return e.getHours()}),l=t(function(e){e.setHours(0,0,0,0)},function(e,t){e.setDate(e.getDate()+t)},function(e,t){return(t-e-6e4*(t.getTimezoneOffset()-e.getTimezoneOffset()))/864e5},function(e){return e.getDate()-1}),d=n(0),f=n(1),p=n(2),y=n(3),g=n(4),h=n(5),m=n(6),v=t(function(e){e.setHours(0,0,0,0),e.setDate(1)},function(e,t){e.setMonth(e.getMonth()+t)},function(e,t){return t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear())},function(e){return e.getMonth()}),E=t(function(e){e.setHours(0,0,0,0),e.setMonth(0,1)},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e,t){return t.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()}),T=t(function(e){e.setUTCMilliseconds(0)},function(e,t){e.setTime(+e+1e3*t)},function(e,t){return(t-e)/1e3},function(e){return e.getUTCSeconds()}),O=t(function(e){e.setUTCSeconds(0,0)},function(e,t){e.setTime(+e+6e4*t)},function(e,t){return(t-e)/6e4},function(e){return e.getUTCMinutes()}),N=t(function(e){e.setUTCMinutes(0,0,0)},function(e,t){e.setTime(+e+36e5*t)},function(e,t){return(t-e)/36e5},function(e){return e.getUTCHours()}),P=t(function(e){e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCDate(e.getUTCDate()+t)},function(e,t){return(t-e)/864e5},function(e){return e.getUTCDate()-1}),A=r(0),S=r(1),b=r(2),_=r(3),C=r(4),I=r(5),M=r(6),R=t(function(e){e.setUTCHours(0,0,0,0),e.setUTCDate(1)},function(e,t){e.setUTCMonth(e.getUTCMonth()+t)},function(e,t){return t.getUTCMonth()-e.getUTCMonth()+12*(t.getUTCFullYear()-e.getUTCFullYear())},function(e){return e.getUTCMonth()}),U=t(function(e){e.setUTCHours(0,0,0,0),e.setUTCMonth(0,1)},function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)},function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()}),D=a.range,w=u.range,x=c.range,L=s.range,F=l.range,k=d.range,Q=f.range,j=p.range,B=y.range,W=g.range,G=h.range,q=m.range,Y=d.range,H=v.range,V=E.range,z=a,K=D,X=T.range,$=O.range,J=N.range,Z=P.range,ee=A.range,te=S.range,ne=b.range,re=_.range,ie=C.range,oe=I.range,ae=M.range,ue=A.range,ce=R.range,se=U.range,le="0.1.1";e.version=le,e.milliseconds=D,e.seconds=w,e.minutes=x,e.hours=L,e.days=F,e.sundays=k,e.mondays=Q,e.tuesdays=j,e.wednesdays=B,e.thursdays=W,e.fridays=G,e.saturdays=q,e.weeks=Y,e.months=H,e.years=V,e.utcMillisecond=z,e.utcMilliseconds=K,e.utcSeconds=X,e.utcMinutes=$,e.utcHours=J,e.utcDays=Z,e.utcSundays=ee,e.utcMondays=te,e.utcTuesdays=ne,e.utcWednesdays=re,e.utcThursdays=ie,e.utcFridays=oe,e.utcSaturdays=ae,e.utcWeeks=ue,e.utcMonths=ce,e.utcYears=se,e.millisecond=a,e.second=u,e.minute=c,e.hour=s,e.day=l,e.sunday=d,e.monday=f,e.tuesday=p,e.wednesday=y,e.thursday=g,e.friday=h,e.saturday=m,e.week=d,e.month=v,e.year=E,e.utcSecond=T,e.utcMinute=O,e.utcHour=N,e.utcDay=P,e.utcSunday=A,e.utcMonday=S,e.utcTuesday=b,e.utcWednesday=_,e.utcThursday=C,e.utcFriday=I,e.utcSaturday=M,e.utcWeek=A,e.utcMonth=R,e.utcYear=U,e.interval=t})},{}],43:[function(e,t,n){function r(e){if(!e)throw Error("Missing binning options.");var t,n,r,u,c,s,l,d=e.maxbins||15,f=e.base||10,p=Math.log(f),y=e.div||[5,2],g=e.min,h=e.max,m=h-g;if(e.step)t=e.step;else if(e.steps)t=e.steps[Math.min(e.steps.length-1,i(e.steps,m/d,0,e.steps.length))];else{for(n=Math.ceil(Math.log(d)/p),r=e.minstep||0,t=Math.max(r,Math.pow(f,Math.round(Math.log(m)/p)-n));Math.ceil(m/t)>d;)t*=f;for(s=0;s<y.length;++s)c=t/y[s],c>=r&&m/c<=d&&(t=c)}return c=Math.log(t),u=c>=0?0:~~(-c/p)+1,l=Math.pow(f,-u-1),g=Math.min(g,Math.floor(g/t+l)*t),h=Math.ceil(h/t)*t,{start:g,stop:h,step:t,unit:{precision:u},value:o,index:a}}function i(e,t,n,r){for(;n<r;){var i=n+r>>>1;s.cmp(e[i],t)<0?n=i+1:r=i}return n}function o(e){return this.step*Math.floor(e/this.step+d)}function a(e){return Math.floor((e-this.start)/this.step+d)}function u(e){return this.unit.date(o.call(this,e))}function c(e){return a.call(this,this.unit.unit(e))}var s=e("../util"),l=e("../time"),d=1e-15;r.date=function(e){if(!e)throw Error("Missing date binning options.");var t=e.utc?l.utc:l,n=e.min,i=e.max,o=e.maxbins||20,a=e.minbins||4,s=+i-+n,d=e.unit?t[e.unit]:t.find(s,a,o),f=r({min:null!=d.min?d.min:d.unit(n),max:null!=d.max?d.max:d.unit(i),maxbins:o,minstep:d.minstep,steps:d.step});return f.unit=d,f.index=c,e.raw||(f.value=u),f},t.exports=r},{"../time":47,"../util":48}],44:[function(e,t,n){var r=e("./util"),i=t.exports;i.repeat=function(e,t){var n,r=Array(t);for(n=0;n<t;++n)r[n]=e;return r},i.zeros=function(e){return i.repeat(0,e)},i.range=function(e,t,n){if(arguments.length<3&&(n=1,arguments.length<2&&(t=e,e=0)),(t-e)/n==1/0)throw new Error("Infinite range");var r,i=[],o=-1;if(n<0)for(;(r=e+n*++o)>t;)i.push(r);else for(;(r=e+n*++o)<t;)i.push(r);return i},i.random={},i.random.uniform=function(e,t){void 0===t&&(t=void 0===e?1:e,e=0);var n=t-e,r=function(){return e+n*Math.random()};return r.samples=function(e){return i.zeros(e).map(r)},r.pdf=function(r){return r>=e&&r<=t?1/n:0},r.cdf=function(r){return r<e?0:r>t?1:(r-e)/n},r.icdf=function(t){return t>=0&&t<=1?e+t*n:NaN},r},i.random.integer=function(e,t){void 0===t&&(t=e,e=0);var n=t-e,r=function(){return e+Math.floor(n*Math.random())};return r.samples=function(e){return i.zeros(e).map(r)},r.pdf=function(r){return r===Math.floor(r)&&r>=e&&r<t?1/n:0},r.cdf=function(r){var i=Math.floor(r);return i<e?0:i>=t?1:(i-e+1)/n},r.icdf=function(t){return t>=0&&t<=1?e-1+Math.floor(t*n):NaN},r},i.random.normal=function(e,t){e=e||0,t=t||1;var n,r=function(){var r,i,o=0,a=0;if(void 0!==n)return o=n,n=void 0,o;do o=2*Math.random()-1,a=2*Math.random()-1,r=o*o+a*a;while(0===r||r>1);return i=Math.sqrt(-2*Math.log(r)/r),n=e+a*i*t,e+o*i*t};return r.samples=function(e){return i.zeros(e).map(r)},r.pdf=function(n){var r=Math.exp(Math.pow(n-e,2)/(-2*Math.pow(t,2)));return 1/(t*Math.sqrt(2*Math.PI))*r},r.cdf=function(n){var r,i=(n-e)/t,o=Math.abs(i);if(o>37)r=0;else{var a,u=Math.exp(-o*o/2);o<7.07106781186547?(a=.0352624965998911*o+.700383064443688,a=a*o+6.37396220353165,a=a*o+33.912866078383,a=a*o+112.079291497871,a=a*o+221.213596169931,a=a*o+220.206867912376,r=u*a,a=.0883883476483184*o+1.75566716318264,a=a*o+16.064177579207,a=a*o+86.7807322029461,a=a*o+296.564248779674,a=a*o+637.333633378831,a=a*o+793.826512519948,a=a*o+440.413735824752,r/=a):(a=o+.65,a=o+4/a,a=o+3/a,a=o+2/a,a=o+1/a,r=u/a/2.506628274631)}return i>0?1-r:r},r.icdf=function(n){if(n<=0||n>=1)return NaN;var r=2*n-1,i=8*(Math.PI-3)/(3*Math.PI*(4-Math.PI)),o=2/(Math.PI*i)+Math.log(1-Math.pow(r,2))/2,a=Math.log(1-r*r)/i,u=(r>0?1:-1)*Math.sqrt(Math.sqrt(o*o-a)-o);return e+t*Math.SQRT2*u},r},i.random.bootstrap=function(e,t){var n=e.filter(r.isValid),o=n.length,a=t?i.random.normal(0,t):null,u=function(){return n[~~(Math.random()*o)]+(a?a():0)};return u.samples=function(e){return i.zeros(e).map(u)},u}},{"./util":48}],45:[function(e,t,n){function r(e,t){return t?void(e[d]=t):e&&e[d]||null}function i(e){return l.keys(e)}function o(e){return"["+e+"]"}function a(e,t){e=l.array(e),t=l.$(t);var n,r,i;if(e[d]&&(n=t(e[d]),l.isString(n)))return n;
for(r=0,i=e.length;!l.isValid(n)&&r<i;++r)n=t?t(e[r]):e[r];return l.isDate(n)?"date":l.isNumber(n)?"number":l.isBoolean(n)?"boolean":l.isString(n)?"string":null}function u(e,t){if(e.length){var n=t?l.identity:(t=i(e[0]),o);return t.reduce(function(t,r){return t[r]=a(e,n(r)),t},{})}}function c(e,t){e=l.array(e),t=l.$(t);var n,r,i,o=["boolean","integer","number","date"];for(n=0;n<e.length;++n){for(i=t?t(e[n]):e[n],r=0;r<o.length;++r)l.isValid(i)&&!p[o[r]](i)&&(o.splice(r,1),r-=1);if(0===o.length)return"string"}return o[0]}function s(e,t){var n=t?l.identity:(t=i(e[0]),o);return t.reduce(function(t,r){return t[r]=c(e,n(r)),t},{})}var l=e("../util"),d="__types__",f={"boolean":l["boolean"],integer:l.number,number:l.number,date:l.date,string:function(e){return null==e||""===e?null:e+""}},p={"boolean":function(e){return"true"===e||"false"===e||l.isBoolean(e)},integer:function(e){return p.number(e)&&(e=+e)===~~e},number:function(e){return!isNaN(+e)&&!l.isDate(e)},date:function(e){return!isNaN(Date.parse(e))}};a.annotation=r,a.all=u,a.infer=c,a.inferAll=s,a.parsers=f,t.exports=a},{"../util":48}],46:[function(e,t,n){function r(e,t,n){var r=e&&e.nullh||0,i=c.random.normal(0,1),o=s.mean(t,n),a=s.stdev(t,n)/Math.sqrt(s.count.valid(t,n));if(0===a)return o-r===0?1:0;var u=(o-r)/a;return 2*i.cdf(-Math.abs(u))}function i(e,t,n,r){var i,o=r?t.map(a.$(n)):t,u=r?t.map(a.$(r)):n,c=s.count(o),l=s.count(u),d=Array();if(c!==l)throw Error("Array lengths must match.");for(i=0;i<c;++i)a.isValid(o[i])&&a.isValid(u[i])&&d.push(o[i]-u[i]);return s.z.test(d,e&&e.nullh||0)}function o(e,t,n,r){var i=r?t.map(a.$(n)):t,o=r?t.map(a.$(r)):n,u=s.count.valid(i),l=s.count.valid(o),d=c.random.normal(0,1),f=s.mean(i)-s.mean(o)-(e&&e.nullh||0),p=Math.sqrt(s.variance(i)/u+s.variance(o)/l);if(0===p)return 0===f?1:0;var y=f/p;return 2*d.cdf(-Math.abs(y))}var a=e("./util"),u=e("./import/type"),c=e("./generate"),s=t.exports;s.unique=function(e,t,n){t=a.$(t),n=n||[];var r,i,o,u={};for(i=0,o=e.length;i<o;++i)r=t?t(e[i]):e[i],r in u||(u[r]=1,n.push(r));return n},s.count=function(e){return e&&e.length||0},s.count.valid=function(e,t){t=a.$(t);var n,r,i,o=0;for(r=0,i=e.length;r<i;++r)n=t?t(e[r]):e[r],a.isValid(n)&&(o+=1);return o},s.count.missing=function(e,t){t=a.$(t);var n,r,i,o=0;for(r=0,i=e.length;r<i;++r)n=t?t(e[r]):e[r],null==n&&(o+=1);return o},s.count.distinct=function(e,t){t=a.$(t);var n,r,i,o={},u=0;for(r=0,i=e.length;r<i;++r)n=t?t(e[r]):e[r],n in o||(o[n]=1,u+=1);return u},s.count.map=function(e,t){t=a.$(t);var n,r,i,o={};for(r=0,i=e.length;r<i;++r)n=t?t(e[r]):e[r],o[n]=n in o?o[n]+1:1;return o},s.median=function(e,t){return t&&(e=e.map(a.$(t))),e=e.filter(a.isValid).sort(a.cmp),s.quantile(e,.5)},s.quartile=function(e,t){t&&(e=e.map(a.$(t))),e=e.filter(a.isValid).sort(a.cmp);var n=s.quantile;return[n(e,.25),n(e,.5),n(e,.75)]},s.quantile=function(e,t,n){void 0===n&&(n=t,t=a.identity),t=a.$(t);var r=(e.length-1)*n+1,i=Math.floor(r),o=+t(e[i-1]),u=r-i;return u?o+u*(t(e[i])-o):o},s.sum=function(e,t){t=a.$(t);for(var n,r=0,i=0,o=e.length;i<o;++i)n=t?t(e[i]):e[i],a.isValid(n)&&(r+=n);return r},s.mean=function(e,t){t=a.$(t);var n,r,i,o,u,c=0;for(r=0,o=0,i=e.length;r<i;++r)u=t?t(e[r]):e[r],a.isValid(u)&&(n=u-c,c+=n/++o);return c},s.mean.geometric=function(e,t){t=a.$(t);var n,r,i,o,u=1;for(o=0,n=0,r=e.length;o<r;++o)if(i=t?t(e[o]):e[o],a.isValid(i)){if(i<=0)throw Error("Geometric mean only defined for positive values.");u*=i,++n}return u=n>0?Math.pow(u,1/n):0},s.mean.harmonic=function(e,t){t=a.$(t);var n,r,i,o,u=0;for(o=0,n=0,r=e.length;o<r;++o)i=t?t(e[o]):e[o],a.isValid(i)&&(u+=1/i,++n);return n/u},s.variance=function(e,t){if(t=a.$(t),!a.isArray(e)||e.length<2)return 0;var n,r,i,o,u=0,c=0;for(r=0,i=0;r<e.length;++r)o=t?t(e[r]):e[r],a.isValid(o)&&(n=o-u,u+=n/++i,c+=n*(o-u));return c/=i-1},s.stdev=function(e,t){return Math.sqrt(s.variance(e,t))},s.modeskew=function(e,t){var n=s.mean(e,t),r=s.median(e,t),i=s.stdev(e,t);return 0===i?0:(n-r)/i},s.min=function(e,t){return s.extent(e,t)[0]},s.max=function(e,t){return s.extent(e,t)[1]},s.extent=function(e,t){t=a.$(t);var n,r,i,o,u=e.length;for(o=0;o<u;++o)if(i=t?t(e[o]):e[o],a.isValid(i)){n=r=i;break}for(;o<u;++o)i=t?t(e[o]):e[o],a.isValid(i)&&(i<n&&(n=i),i>r&&(r=i));return[n,r]},s.extent.index=function(e,t){t=a.$(t);var n,r,i,o,u=-1,c=-1,s=e.length;for(o=0;o<s;++o)if(i=t?t(e[o]):e[o],a.isValid(i)){n=r=i,u=c=o;break}for(;o<s;++o)i=t?t(e[o]):e[o],a.isValid(i)&&(i<n&&(n=i,u=o),i>r&&(r=i,c=o));return[u,c]},s.dot=function(e,t,n){var r,i,o=0;if(n)for(t=a.$(t),n=a.$(n),r=0;r<e.length;++r)i=t(e[r])*n(e[r]),i===i&&(o+=i);else{if(e.length!==t.length)throw Error("Array lengths must match.");for(r=0;r<e.length;++r)i=e[r]*t[r],i===i&&(o+=i)}return o},s.dist=function(e,t,n,r){var i,o,u=a.isFunction(n)||a.isString(n),c=e,s=u?e:t,l=u?r:n,d=2===l||null==l,f=e.length,p=0;for(u&&(t=a.$(t),n=a.$(n)),o=0;o<f;++o)i=u?t(c[o])-n(s[o]):c[o]-s[o],p+=d?i*i:Math.pow(Math.abs(i),l);return d?Math.sqrt(p):Math.pow(p,1/l)},s.cohensd=function(e,t,n){var r=n?e.map(a.$(t)):e,i=n?e.map(a.$(n)):t,o=s.mean(r),u=s.mean(i),c=s.count.valid(r),l=s.count.valid(i);if(c+l-2<=0)return 0;var d=s.variance(r),f=s.variance(i),p=Math.sqrt(((c-1)*d+(l-1)*f)/(c+l-2));return 0===p?0:(o-u)/p},s.covariance=function(e,t,n){var r,i,o,u,c,l=n?e.map(a.$(t)):e,d=n?e.map(a.$(n)):t,f=l.length,p=s.mean(l),y=s.mean(d),g=0,h=0;if(f!==d.length)throw Error("Input lengths must match.");for(r=0;r<f;++r)if(i=l[r],u=a.isValid(i),o=d[r],c=a.isValid(o),u&&c)g+=(i-p)*(o-y),++h;else if(u||c)throw Error("Valid values must align.");return g/(h-1)},s.rank=function(e,t){t=a.$(t)||a.identity;var n,r,i,o=e.map(function(e,n){return{idx:n,val:t(e)}}).sort(a.comparator("val")),u=e.length,c=Array(u),s=-1,l={};for(n=0;n<u;++n){if(r=o[n].val,s<0&&l===r)s=n-1;else if(s>-1&&l!==r){for(i=1+(n-1+s)/2;s<n;++s)c[o[s].idx]=i;s=-1}c[o[n].idx]=n+1,l=r}if(s>-1)for(i=1+(u-1+s)/2;s<u;++s)c[o[s].idx]=i;return c},s.cor=function(e,t,n){var r=n;n=r?e.map(a.$(n)):t,t=r?e.map(a.$(t)):e;var i=s.dot(t,n),o=s.mean(t),u=s.mean(n),c=s.stdev(t),l=s.stdev(n),d=e.length;return(i-d*o*u)/((d-1)*c*l)},s.cor.rank=function(e,t,n){var r,i,o,a=n?s.rank(e,t):s.rank(e),u=n?s.rank(e,n):s.rank(t),c=e.length;for(r=0,i=0;r<c;++r)o=a[r]-u[r],i+=o*o;return 1-6*i/(c*(c*c-1))},s.cor.dist=function(e,t,n){var r,i,o,u,c=n?e.map(a.$(t)):e,l=n?e.map(a.$(n)):t,d=s.dist.mat(c),f=s.dist.mat(l),p=d.length;for(r=0,i=0,o=0,u=0;r<p;++r)i+=d[r]*d[r],o+=f[r]*f[r],u+=d[r]*f[r];return Math.sqrt(u/Math.sqrt(i*o))},s.linearRegression=function(e,t,n){var r,i,o=n?e.map(a.$(t)):e,u=n?e.map(a.$(n)):t,c=o.length,l=s.covariance(o,u),d=s.stdev(o),f=s.stdev(u),p=l/(d*d),y=s.mean(u)-p*s.mean(o),g={slope:p,intercept:y,R:l/(d*f),rss:0};for(i=0;i<c;++i)a.isValid(o[i])&&a.isValid(u[i])&&(r=p*o[i]+y-u[i],g.rss+=r*r);return g},s.bootstrap={},s.bootstrap.ci=function(e,t,n,r,i){var o,u,l,d,f,p,y;for(a.isFunction(t)||a.isString(t)?(o=e.map(a.$(t)),u=n,l=r,d=i):(o=e,u=t,l=n,d=r),u=u?+u:1e3,l=l||.05,f=c.random.bootstrap(o,d),y=0,p=Array(u);y<u;++y)p[y]=s.mean(f.samples(o.length));return p.sort(a.numcmp),[s.quantile(p,l/2),s.quantile(p,1-l/2)]},s.z={},s.z.ci=function(e,t,n){var r=e,i=t;(a.isFunction(t)||a.isString(t))&&(r=e.map(a.$(t)),i=n),i=i||.05;var o=.05===i?1.96:c.random.normal(0,1).icdf(1-i/2),u=s.mean(r),l=s.stdev(r)/Math.sqrt(s.count.valid(r));return[u-o*l,u+o*l]},s.z.test=function(e,t,n,u){return a.isFunction(n)||a.isString(n)?(u&&u.paired?i:o)(u,e,t,n):a.isArray(t)?(n&&n.paired?i:o)(n,e,t):a.isFunction(t)||a.isString(t)?r(n,e,t):r(t,e)},s.dist.mat=function(e){var t,n,r,i=e.length,o=i*i,a=Array(o),u=c.zeros(i),s=0;for(n=0;n<i;++n)for(a[n*i+n]=0,r=n+1;r<i;++r)a[n*i+r]=t=Math.abs(e[n]-e[r]),a[r*i+n]=t,u[n]+=t,u[r]+=t;for(n=0;n<i;++n)s+=u[n],u[n]/=i;for(s/=o,n=0;n<i;++n)for(r=n;r<i;++r)a[n*i+r]+=s-u[n]-u[r],a[r*i+n]=a[n*i+r];return a},s.entropy=function(e,t){t=a.$(t);var n,r,i=0,o=0,u=e.length;for(n=0;n<u;++n)i+=t?t(e[n]):e[n];if(0===i)return 0;for(n=0;n<u;++n)r=(t?t(e[n]):e[n])/i,r&&(o+=r*Math.log(r));return-o/Math.LN2},s.mutual=function(e,t,n,r){var i,o,u,c=r?e.map(a.$(t)):e,s=r?e.map(a.$(n)):t,l=r?e.map(a.$(r)):n,d={},f={},p=l.length,y=0,g=0,h=0;for(u=0;u<p;++u)d[c[u]]=0,f[s[u]]=0;for(u=0;u<p;++u)d[c[u]]+=l[u],f[s[u]]+=l[u],y+=l[u];for(o=1/(y*Math.LN2),u=0;u<p;++u)0!==l[u]&&(i=y*l[u]/(d[c[u]]*f[s[u]]),g+=l[u]*o*Math.log(i),h+=l[u]*o*Math.log(l[u]/y));return[g,1+g/h]},s.mutual.info=function(e,t,n,r){return s.mutual(e,t,n,r)[0]},s.mutual.dist=function(e,t,n,r){return s.mutual(e,t,n,r)[1]},s.profile=function(e,t){var n,r,i,o,c,l=0,d=0,f=0,p=0,y=null,g=null,h=0,m=[],v={};for(i=0;i<e.length;++i)o=t?t(e[i]):e[i],v[o]=o in v?v[o]+1:(p+=1,1),null==o?++f:a.isValid(o)&&(c="string"==typeof o?o.length:o,(null===y||c<y)&&(y=c),(null===g||c>g)&&(g=c),n=c-l,l+=n/++d,h+=n*(c-l),m.push(c));return h/=d-1,r=Math.sqrt(h),m.sort(a.cmp),{type:u(e,t),unique:v,count:e.length,valid:d,missing:f,distinct:p,min:y,max:g,mean:l,stdev:r,median:o=s.quantile(m,.5),q1:s.quantile(m,.25),q3:s.quantile(m,.75),modeskew:0===r?0:(l-o)/r}},s.summary=function(e,t){t=t||a.keys(e[0]);var n=t.map(function(t){var n=s.profile(e,a.$(t));return n.field=t,n});return n.__summary__=!0,n}},{"./generate":44,"./import/type":45,"./util":48}],47:[function(e,t,n){function r(e){return s.setTime(+e),s}function i(e,t,n,r,i,o){var a={type:e,date:t,unit:n};return r?a.step=r:a.minstep=1,null!=i&&(a.min=i),null!=o&&(a.max=o),a}function o(e,t,n,r,o,a){return i(e,function(e){return t.offset(n,e)},function(e){return t.count(n,e)},r,o,a)}function a(e,t,n,r){var i,o,a,u=y[0];for(i=1,o=y.length;i<o;++i)if(u=y[i],t>u[0]){if(a=t/u[0],a>r)return e[y[i-1][1]];if(a>=n)return e[u[1]]}return e[y[o-1][1]]}function u(e){var t,n,r={};for(t=0,n=e.length;t<n;++t)r[e[t].type]=e[t];return r.find=function(t,n,r){return a(e,t,n,r)},r}var c=e("d3-time"),s=new Date,l=new Date(0,0,1).setFullYear(0),d=new Date(Date.UTC(0,0,1)).setUTCFullYear(0),f=[o("second",c.second,l),o("minute",c.minute,l),o("hour",c.hour,l),o("day",c.day,l,[1,7]),o("month",c.month,l,[1,3,6]),o("year",c.year,l),i("seconds",function(e){return new Date(1970,0,1,0,0,e)},function(e){return r(e).getSeconds()},null,0,59),i("minutes",function(e){return new Date(1970,0,1,0,e)},function(e){return r(e).getMinutes()},null,0,59),i("hours",function(e){return new Date(1970,0,1,e)},function(e){return r(e).getHours()},null,0,23),i("weekdays",function(e){return new Date(1970,0,4+e)},function(e){return r(e).getDay()},[1],0,6),i("dates",function(e){return new Date(1970,0,e)},function(e){return r(e).getDate()},[1],1,31),i("months",function(e){return new Date(1970,e%12,1)},function(e){return r(e).getMonth()},[1],0,11)],p=[o("second",c.utcSecond,d),o("minute",c.utcMinute,d),o("hour",c.utcHour,d),o("day",c.utcDay,d,[1,7]),o("month",c.utcMonth,d,[1,3,6]),o("year",c.utcYear,d),i("seconds",function(e){return new Date(Date.UTC(1970,0,1,0,0,e))},function(e){return r(e).getUTCSeconds()},null,0,59),i("minutes",function(e){return new Date(Date.UTC(1970,0,1,0,e))},function(e){return r(e).getUTCMinutes()},null,0,59),i("hours",function(e){return new Date(Date.UTC(1970,0,1,e))},function(e){return r(e).getUTCHours()},null,0,23),i("weekdays",function(e){return new Date(Date.UTC(1970,0,4+e))},function(e){return r(e).getUTCDay()},[1],0,6),i("dates",function(e){return new Date(Date.UTC(1970,0,e))},function(e){return r(e).getUTCDate()},[1],1,31),i("months",function(e){return new Date(Date.UTC(1970,e%12,1))},function(e){return r(e).getUTCMonth()},[1],0,11)],y=[[31536e6,5],[7776e6,4],[2592e6,4],[12096e5,3],[6048e5,3],[1728e5,3],[864e5,3],[432e5,2],[216e5,2],[108e5,2],[36e5,2],[18e5,1],[9e5,1],[3e5,1],[6e4,1],[3e4,0],[15e3,0],[5e3,0],[1e3,0]];t.exports=u(f),t.exports.utc=u(p)},{"d3-time":42}],48:[function(e,t,n){(function(e){function n(e,t){var n,r="";for(n=0;n<e;++n)r+=t;return r}function r(e,t,n){var r=0,i=e.split(c);return e=n?(i=i.reverse()).filter(function(e){return r+=e.length,r<=t}).reverse():i.filter(function(e){return r+=e.length,r<=t}),e.length?e.join("").trim():i[0].slice(0,t)}var i=t.exports,o="__name__";i.namedfunc=function(e,t){return t[o]=e,t},i.name=function(e){return null==e?null:e[o]},i.identity=function(e){return e},i["true"]=i.namedfunc("true",function(){return!0}),i["false"]=i.namedfunc("false",function(){return!1}),i.duplicate=function(e){return JSON.parse(JSON.stringify(e))},i.equal=function(e,t){return JSON.stringify(e)===JSON.stringify(t)},i.extend=function(e){for(var t,n,r=1,i=arguments.length;r<i;++r){t=arguments[r];for(n in t)e[n]=t[n]}return e},i.length=function(e){return null!=e&&null!=e.length?e.length:null},i.keys=function(e){var t,n=[];for(t in e)n.push(t);return n},i.vals=function(e){var t,n=[];for(t in e)n.push(e[t]);return n},i.toMap=function(e,t){return(t=i.$(t))?e.reduce(function(e,n){return e[t(n)]=1,e},{}):e.reduce(function(e,t){return e[t]=1,e},{})},i.keystr=function(e){var t=e.length;if(!t)return"";for(var n=String(e[0]),r=1;r<t;++r)n+="|"+String(e[r]);return n};var a=Object.prototype.toString;i.isObject=function(e){return e===Object(e)},i.isFunction=function(e){return"[object Function]"===a.call(e)},i.isString=function(e){return"string"==typeof value||"[object String]"===a.call(e)},i.isArray=Array.isArray||function(e){return"[object Array]"===a.call(e)},i.isNumber=function(e){return"number"==typeof e||"[object Number]"===a.call(e)},i.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==a.call(e)},i.isDate=function(e){return"[object Date]"===a.call(e)},i.isValid=function(e){return null!=e&&e===e},i.isBuffer="function"==typeof e&&e.isBuffer||i["false"],i.number=function(e){return null==e||""===e?null:+e},i["boolean"]=function(e){return null==e||""===e?null:"false"!==e&&!!e},i.date=function(e,t){var n=t?t:Date;return null==e||""===e?null:n.parse(e)},i.array=function(e){return null!=e?i.isArray(e)?e:[e]:[]},i.str=function(e){return i.isArray(e)?"["+e.map(i.str)+"]":i.isObject(e)||i.isString(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e};var u=/\[(.*?)\]|[^.\[]+/g;i.field=function(e){return String(e).match(u).map(function(e){return"["!==e[0]?e:"'"!==e[1]&&'"'!==e[1]?e.slice(1,-1):e.slice(2,-2).replace(/\\(["'])/g,"$1")})},i.accessor=function(e){return null==e||i.isFunction(e)?e:i.namedfunc(e,Function("x","return x["+i.field(e).map(i.str).join("][")+"];"))},i.$=i.accessor,i.mutator=function(e){var t;return i.isString(e)&&(t=i.field(e)).length>1?function(e,n){for(var r=0;r<t.length-1;++r)e=e[t[r]];e[t[r]]=n}:function(t,n){t[e]=n}},i.$func=function(e,t){return function(n){n=i.$(n)||i.identity;var r=e+(i.name(n)?"_"+i.name(n):"");return i.namedfunc(r,function(e){return t(n(e))})}},i.$valid=i.$func("valid",i.isValid),i.$length=i.$func("length",i.length),i.$in=function(e,t){e=i.$(e);var n=i.isArray(t)?i.toMap(t):t;return function(t){return!!n[e(t)]}},i.comparator=function(e){var t=[];return void 0===e&&(e=[]),e=i.array(e).map(function(e){var n=1;return"-"===e[0]?(n=-1,e=e.slice(1)):"+"===e[0]&&(n=1,e=e.slice(1)),t.push(n),i.accessor(e)}),function(n,r){var o,a,u,c;for(o=0,a=e.length;o<a;++o)if(u=e[o],c=i.cmp(u(n),u(r)))return c*t[o];return 0}},i.cmp=function(e,t){return(e<t||null==e)&&null!=t?-1:(e>t||null==t)&&null!=e?1:(t=t instanceof Date?+t:t,(e=e instanceof Date?+e:e)!==e&&t===t?-1:t!==t&&e===e?1:0)},i.numcmp=function(e,t){return e-t},i.stablesort=function(e,t,n){var r=e.reduce(function(e,t,r){return e[n(t)]=r,e},{});return e.sort(function(e,i){var o=t(e),a=t(i);return o<a?-1:o>a?1:r[n(e)]-r[n(i)]}),e},i.permute=function(e){for(var t,n,r=e.length;r;)n=Math.floor(Math.random()*r--),t=e[r],e[r]=e[n],e[n]=t},i.pad=function(e,t,r,i){i=i||" ";var o=t-e.length;if(o<=0)return e;switch(r){case"left":return n(o,i)+e;case"middle":case"center":return n(Math.floor(o/2),i)+e+n(Math.ceil(o/2),i);default:return e+n(o,i)}},i.truncate=function(e,t,n,i,o){var a=e.length;if(a<=t)return e;o=void 0!==o?String(o):"…";var u=Math.max(0,t-o.length);switch(n){case"left":return o+(i?r(e,u,1):e.slice(a-u));case"middle":case"center":var c=Math.ceil(u/2),s=Math.floor(u/2);return(i?r(e,c):e.slice(0,c))+o+(i?r(e,s,1):e.slice(a-s));default:return(i?r(e,u):e.slice(0,u))+o}};var c=/([\u0009\u000A\u000B\u000C\u000D\u0020\u00A0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u2028\u2029\u3000\uFEFF])/}).call(this,e("buffer").Buffer)},{buffer:41}],49:[function(e,t,n){var r="undefined"!=typeof JSON?JSON:e("jsonify");t.exports=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var n=t.space||"";"number"==typeof n&&(n=Array(n+1).join(" "));var a="boolean"==typeof t.cycles&&t.cycles,u=t.replacer||function(e,t){return t},c=t.cmp&&function(e){return function(t){return function(n,r){var i={key:n,value:t[n]},o={key:r,value:t[r]};return e(i,o)}}}(t.cmp),s=[];return function l(e,t,d,f){var p=n?"\n"+new Array(f+1).join(n):"",y=n?": ":":";if(d&&d.toJSON&&"function"==typeof d.toJSON&&(d=d.toJSON()),d=u.call(e,t,d),void 0!==d){if("object"!=typeof d||null===d)return r.stringify(d);if(i(d)){for(var g=[],h=0;h<d.length;h++){var m=l(d,h,d[h],f+1)||r.stringify(null);g.push(p+n+m)}return"["+g.join(",")+p+"]"}if(s.indexOf(d)!==-1){if(a)return r.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}s.push(d);for(var v=o(d).sort(c&&c(d)),g=[],h=0;h<v.length;h++){var t=v[h],E=l(d,t,d[t],f+1);if(E){var T=r.stringify(t)+y+E;g.push(p+n+T)}}return s.splice(s.indexOf(d),1),"{"+g.join(",")+p+"}"}}({"":e},"",e,0)};var i=Array.isArray||function(e){return"[object Array]"==={}.toString.call(e)},o=Object.keys||function(e){var t=Object.prototype.hasOwnProperty||function(){return!0},n=[];for(var r in e)t.call(e,r)&&n.push(r);return n}},{jsonify:50}],50:[function(e,t,n){n.parse=e("./lib/parse"),n.stringify=e("./lib/stringify")},{"./lib/parse":51,"./lib/stringify":52}],51:[function(e,t,n){var r,i,o,a,u={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},c=function(e){throw{name:"SyntaxError",message:e,at:r,text:o}},s=function(e){return e&&e!==i&&c("Expected '"+e+"' instead of '"+i+"'"),i=o.charAt(r),r+=1,i},l=function(){var e,t="";for("-"===i&&(t="-",s("-"));i>="0"&&i<="9";)t+=i,s();if("."===i)for(t+=".";s()&&i>="0"&&i<="9";)t+=i;if("e"===i||"E"===i)for(t+=i,s(),"-"!==i&&"+"!==i||(t+=i,s());i>="0"&&i<="9";)t+=i,s();return e=+t,isFinite(e)?e:void c("Bad number")},d=function(){var e,t,n,r="";if('"'===i)for(;s();){if('"'===i)return s(),r;if("\\"===i)if(s(),"u"===i){for(n=0,t=0;t<4&&(e=parseInt(s(),16),isFinite(e));t+=1)n=16*n+e;r+=String.fromCharCode(n)}else{if("string"!=typeof u[i])break;r+=u[i]}else r+=i}c("Bad string")},f=function(){for(;i&&i<=" ";)s()},p=function(){switch(i){case"t":return s("t"),s("r"),s("u"),s("e"),!0;case"f":return s("f"),s("a"),s("l"),s("s"),s("e"),!1;case"n":return s("n"),s("u"),s("l"),s("l"),null}c("Unexpected '"+i+"'")},y=function(){var e=[];if("["===i){if(s("["),f(),"]"===i)return s("]"),e;for(;i;){if(e.push(a()),f(),"]"===i)return s("]"),e;s(","),f()}}c("Bad array")},g=function(){var e,t={};if("{"===i){if(s("{"),f(),"}"===i)return s("}"),t;for(;i;){if(e=d(),f(),s(":"),Object.hasOwnProperty.call(t,e)&&c('Duplicate key "'+e+'"'),t[e]=a(),f(),"}"===i)return s("}"),t;s(","),f()}}c("Bad object")};a=function(){switch(f(),i){case"{":return g();case"[":return y();case'"':return d();case"-":return l();default:return i>="0"&&i<="9"?l():p()}},t.exports=function(e,t){var n;return o=e,r=0,i=" ",n=a(),f(),i&&c("Syntax error"),"function"==typeof t?function u(e,n){var r,i,o=e[n];if(o&&"object"==typeof o)for(r in o)Object.prototype.hasOwnProperty.call(o,r)&&(i=u(o,r),void 0!==i?o[r]=i:delete o[r]);return t.call(e,n,o)}({"":n},""):n}},{}],52:[function(e,t,n){function r(e){return c.lastIndex=0,c.test(e)?'"'+e.replace(c,function(e){var t=s[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function i(e,t){var n,c,s,l,d,f=o,p=t[e];switch(p&&"object"==typeof p&&"function"==typeof p.toJSON&&(p=p.toJSON(e)),"function"==typeof u&&(p=u.call(t,e,p)),typeof p){case"string":return r(p);case"number":return isFinite(p)?String(p):"null";case"boolean":case"null":return String(p);case"object":if(!p)return"null";if(o+=a,d=[],"[object Array]"===Object.prototype.toString.apply(p)){for(l=p.length,n=0;n<l;n+=1)d[n]=i(n,p)||"null";return s=0===d.length?"[]":o?"[\n"+o+d.join(",\n"+o)+"\n"+f+"]":"["+d.join(",")+"]",o=f,s}if(u&&"object"==typeof u)for(l=u.length,n=0;n<l;n+=1)c=u[n],"string"==typeof c&&(s=i(c,p),s&&d.push(r(c)+(o?": ":":")+s));else for(c in p)Object.prototype.hasOwnProperty.call(p,c)&&(s=i(c,p),s&&d.push(r(c)+(o?": ":":")+s));return s=0===d.length?"{}":o?"{\n"+o+d.join(",\n"+o)+"\n"+f+"}":"{"+d.join(",")+"}",o=f,s}}var o,a,u,c=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,s={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};t.exports=function(e,t,n){var r;if(o="",a="","number"==typeof n)for(r=0;r<n;r+=1)a+=" ";else"string"==typeof n&&(a=n);if(u=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return i("",{"":e})}},{}],53:[function(t,n,r){(function(t){var r,i,o,a,u,c,s,l,d,f,p,y,g,h,m,v;!function(r){function i(e,t){return function(n,r){return e[n]=t?t(n,r):r}}var o="object"==typeof t?t:"object"==typeof self?self:"object"==typeof this?this:{};"function"==typeof e&&e.amd?e("tslib",["exports"],function(e){r(i(o,i(e)))}):r("object"==typeof n&&"object"==typeof n.exports?i(o,i(n.exports)):i(o))}(function(e){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};r=function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)},i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},o=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&(n[r[i]]=e[r[i]]);return n},a=function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var u=e.length-1;u>=0;u--)(i=e[u])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},u=function(e,t){return function(n,r){t(n,r,e)}},c=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{c(r.next(e))}catch(t){o(t)}}function u(e){try{c(r["throw"](e))}catch(t){o(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,u)}c((r=r.apply(e,t||[])).next())})},l=function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;c;)try{if(i=1,o&&(a=o[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,o=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(a=c.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){c.label=n[1];break}if(6===n[0]&&c.label<a[1]){c.label=a[1],a=n;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(n);break}a[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(r){n=[6,r],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,u,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return u={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u},d=function(e,t){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])},f=function(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}},p=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(u){i={error:u}}finally{try{r&&!r.done&&(n=o["return"])&&n.call(o)}finally{if(i)throw i.error}}return a},y=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(p(arguments[t]));return e},g=function(e){return this instanceof g?(this.v=e,this):new g(e)},h=function(e,t,n){function r(e){l[e]&&(s[e]=function(t){return new Promise(function(n,r){d.push([e,t,n,r])>1||i(e,t)})})}function i(e,t){try{o(l[e](t))}catch(n){c(d[0][3],n)}}function o(e){e.value instanceof g?Promise.resolve(e.value.v).then(a,u):c(d[0][2],e)}function a(e){i("next",e)}function u(e){i("throw",e)}function c(e,t){e(t),d.shift(),d.length&&i(d[0][0],d[0][1])}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s,l=n.apply(e,t||[]),d=[];return s={},r("next"),r("throw"),r("return"),s[Symbol.asyncIterator]=function(){return this},s},m=function(e){function t(t,i){e[t]&&(n[t]=function(n){return(r=!r)?{value:g(e[t](n)),done:"return"===t}:i?i(n):n})}var n,r;return n={},t("next"),t("throw",function(e){throw e}),t("return"),n[Symbol.iterator]=function(){return this},n},v=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator];return t?t.call(e):"function"==typeof f?f(e):e[Symbol.iterator]()},e("__extends",r),e("__assign",i),e("__rest",o),e("__decorate",a),e("__param",u),e("__metadata",c),e("__awaiter",s),e("__generator",l),e("__exportStar",d),e("__values",f),e("__read",p),e("__spread",y),e("__await",g),e("__asyncGenerator",h),e("__asyncDelegator",m),e("__asyncValues",v)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],54:[function(e,t,n){"use strict";function r(e){return!!a[e]}function i(e){return e&&o.contains(n.COUNTING_OPS,e)}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./util"),a={values:1,count:1,valid:1,missing:1,distinct:1,sum:1,mean:1,average:1,variance:1,variancep:1,stdev:1,stdevp:1,median:1,q1:1,q3:1,ci0:1,ci1:1,min:1,max:1,argmin:1,argmax:1};n.AGGREGATE_OPS=o.flagKeys(a),n.isAggregateOp=r,n.COUNTING_OPS=["count","valid","missing","distinct"],n.isCountingAggregateOp=i,n.SUM_OPS=["count","sum","distinct","valid","missing"],n.SHARED_DOMAIN_OPS=["mean","average","median","q1","q3","min","max"],n.SHARED_DOMAIN_OP_INDEX=o.toSet(n.SHARED_DOMAIN_OPS)},{"./util":68}],55:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AXIS_PROPERTY_TYPE={grid:"grid",labelOverlap:"main",offset:"main",title:"main"},n.AXIS_PROPERTIES=["domain","format","grid","labelPadding","labels","labelOverlap","maxExtent","minExtent","offset","orient","position","tickCount","ticks","tickSize","title","titlePadding","values","zindex"],n.VG_AXIS_PROPERTIES=[].concat(n.AXIS_PROPERTIES,["gridScale"])},{}],56:[function(e,t,n){"use strict";function r(e){return a.isBoolean(e)?"bin":"bin"+a.keys(e).map(function(t){return"_"+t+"_"+e[t]}).join("")}function i(e){switch(e){case o.ROW:case o.COLUMN:case o.SIZE:case o.COLOR:case o.OPACITY:case o.SHAPE:return 6;default:return 10}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./channel"),a=e("./util");n.binToString=r,n.autoMaxBins=i},{"./channel":57,"./util":68}],57:[function(e,t,n){"use strict";function r(e){return!!p[e]}function i(e){return!!v[e]}function o(e,t){return t in a(e)}function a(e){switch(e){case n.X:case n.Y:case n.COLOR:case n.DETAIL:case n.TOOLTIP:case n.ORDER:case n.OPACITY:case n.ROW:case n.COLUMN:return{point:!0,tick:!0,rule:!0,circle:!0,square:!0,bar:!0,rect:!0,line:!0,area:!0,text:!0};case n.X2:case n.Y2:return{rule:!0,bar:!0,rect:!0,area:!0};case n.SIZE:return{point:!0,tick:!0,rule:!0,circle:!0,square:!0,bar:!0,text:!0,line:!0};case n.SHAPE:return{point:!0};case n.TEXT:return{text:!0}}}function u(e){switch(e){case n.X:case n.Y:case n.SIZE:case n.OPACITY:case n.X2:case n.Y2:return"continuous";case n.ROW:case n.COLUMN:case n.SHAPE:case n.TEXT:case n.TOOLTIP:return"discrete";case n.COLOR:return"flexible";case n.DETAIL:case n.ORDER:return}throw new Error("getSupportedRole not implemented for "+e)}Object.defineProperty(n,"__esModule",{value:!0});var c,s=e("tslib"),l=e("./util");!function(e){e.ROW="row",e.COLUMN="column",e.X="x",e.Y="y",e.X2="x2",e.Y2="y2",e.COLOR="color",e.SHAPE="shape",e.SIZE="size",e.OPACITY="opacity",e.TEXT="text",e.ORDER="order",e.DETAIL="detail",e.TOOLTIP="tooltip"}(c=n.Channel||(n.Channel={})),n.X=c.X,n.Y=c.Y,n.X2=c.X2,n.Y2=c.Y2,n.ROW=c.ROW,n.COLUMN=c.COLUMN,n.SHAPE=c.SHAPE,n.SIZE=c.SIZE,n.COLOR=c.COLOR,n.TEXT=c.TEXT,n.DETAIL=c.DETAIL,n.ORDER=c.ORDER,n.OPACITY=c.OPACITY,n.TOOLTIP=c.TOOLTIP;var d={x:1,y:1,x2:1,y2:1,size:1,shape:1,color:1,order:1,opacity:1,text:1,detail:1,tooltip:1},f={row:1,column:1},p=s.__assign({},d,f);n.CHANNELS=l.flagKeys(p);var y=(p.order,p.detail,s.__rest(p,["order","detail"]));n.SINGLE_DEF_CHANNELS=l.flagKeys(y),n.isChannel=r,n.UNIT_CHANNELS=l.flagKeys(d);var g=(d.x,d.y,d.x2,d.y2,s.__rest(d,["x","y","x2","y2"]));n.NONSPATIAL_CHANNELS=l.flagKeys(g);var h={x:1,y:1};n.SPATIAL_SCALE_CHANNELS=l.flagKeys(h);var m=(g.text,g.tooltip,g.detail,g.order,s.__rest(g,["text","tooltip","detail","order"]));n.NONSPATIAL_SCALE_CHANNELS=l.flagKeys(m);var v=s.__assign({},h,m);n.SCALE_CHANNELS=l.flagKeys(v),n.isScaleChannel=i,n.supportMark=o,n.getSupportedMark=a,n.rangeType=u},{"./util":68,tslib:53}],58:[function(e,t,n){"use strict";function r(e,t,n,r,s){var l=i(t,n,r,s);return a.isScaleChannel(t)?void 0!==e?c.channelSupportScaleType(t,e)?o(e,n)?e:(u.warn(u.message.scaleTypeNotWorkWithFieldDef(e,l)),l):(u.warn(u.message.scaleTypeNotWorkWithChannel(t,e,l)),l):l:null}function i(e,t,n,r){switch(t.type){case"nominal":case"ordinal":if("color"===e||"discrete"===a.rangeType(e))return"shape"===e&&"ordinal"===t.type&&u.warn(u.message.discreteChannelCannotEncode(e,"ordinal")),"ordinal";if(d.contains(["x","y"],e)){if("rect"===n)return"band";if("bar"===n)return"band"}return"point";case"temporal":return"color"===e?"sequential":"discrete"===a.rangeType(e)?(u.warn(u.message.discreteChannelCannotEncode(e,"temporal")),"ordinal"):"time";case"quantitative":return"color"===e?t.bin?"bin-ordinal":"sequential":"discrete"===a.rangeType(e)?(u.warn(u.message.discreteChannelCannotEncode(e,"quantitative")),"ordinal"):t.bin&&"x"!==e&&"y"!==e?"bin-linear":"linear"}throw new Error(u.message.invalidFieldType(t.type))}function o(e,t){var n=t.type;return f.contains([l.Type.ORDINAL,l.Type.NOMINAL],n)?void 0===e||s.hasDiscreteDomain(e):n===l.Type.TEMPORAL?f.contains([c.ScaleType.TIME,c.ScaleType.UTC,c.ScaleType.SEQUENTIAL,void 0],e):n!==l.Type.QUANTITATIVE||(t.bin?f.contains([c.ScaleType.BIN_LINEAR,c.ScaleType.BIN_ORDINAL,c.ScaleType.LINEAR],e):f.contains([c.ScaleType.LOG,c.ScaleType.POW,c.ScaleType.SQRT,c.ScaleType.QUANTILE,c.ScaleType.QUANTIZE,c.ScaleType.LINEAR,c.ScaleType.SEQUENTIAL,void 0],e))}Object.defineProperty(n,"__esModule",{value:!0});var a=e("../../channel"),u=e("../../log"),c=e("../../scale"),s=e("../../scale"),l=e("../../type"),d=e("../../util"),f=e("../../util");n.scaleType=r,n.fieldDefMatchScaleType=o},{"../../channel":57,"../../log":62,"../../scale":65,"../../type":67,"../../util":68}],59:[function(e,t,n){"use strict";function r(e){return!!(e&&(e.year||e.quarter||e.month||e.date||e.day||e.hours||e.minutes||e.seconds||e.milliseconds))}function i(e){if(s.isNumber(e))return e>4&&c.warn(c.message.invalidTimeUnit("quarter",e)),e-1+"";throw new Error(c.message.invalidTimeUnit("quarter",e))}function o(e){if(s.isNumber(e))return e-1+"";var t=e.toLowerCase(),r=n.MONTHS.indexOf(t);if(r!==-1)return r+"";var i=t.substr(0,3),o=n.SHORT_MONTHS.indexOf(i);
if(o!==-1)return o+"";throw new Error(c.message.invalidTimeUnit("month",e))}function a(e){if(s.isNumber(e))return e%7+"";var t=e.toLowerCase(),r=n.DAYS.indexOf(t);if(r!==-1)return r+"";var i=t.substr(0,3),o=n.SHORT_DAYS.indexOf(i);if(o!==-1)return o+"";throw new Error(c.message.invalidTimeUnit("day",e))}function u(e,t){void 0===t&&(t=!1);var n=[];if(t&&void 0!==e.day&&s.keys(e).length>1&&(c.warn(c.message.droppedDay(e)),e=s.duplicate(e),delete e.day),void 0!==e.year?n.push(e.year):void 0!==e.day?n.push(l):n.push(0),void 0!==e.month){var r=t?o(e.month):e.month;n.push(r)}else if(void 0!==e.quarter){var u=t?i(e.quarter):e.quarter;n.push(u+"*3")}else n.push(0);if(void 0!==e.date)n.push(e.date);else if(void 0!==e.day){var d=t?a(e.day):e.day;n.push(d+"+1")}else n.push(1);for(var f=0,p=["hours","minutes","seconds","milliseconds"];f<p.length;f++){var y=p[f];void 0!==e[y]?n.push(e[y]):n.push(0)}return e.utc?"utc("+n.join(", ")+")":"datetime("+n.join(", ")+")"}Object.defineProperty(n,"__esModule",{value:!0});var c=e("./log"),s=e("./util"),l=2006;n.isDateTime=r,n.MONTHS=["january","february","march","april","may","june","july","august","september","october","november","december"],n.SHORT_MONTHS=n.MONTHS.map(function(e){return e.substr(0,3)}),n.DAYS=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],n.SHORT_DAYS=n.DAYS.map(function(e){return e.substr(0,3)}),n.dateTimeExpr=u},{"./log":62,"./util":68}],60:[function(e,t,n){"use strict";function r(e){return e&&!I.isString(e)&&"repeat"in e}function i(e){return!!e&&!!e.condition}function o(e){return!!e&&!!e.condition&&a(e.condition)}function a(e){return!(!e||!e.field&&"count"!==e.aggregate)}function u(e){return e&&"value"in e&&void 0!==e.value}function c(e){return!(!e||!e.scale&&!e.sort)}function s(e,t){void 0===t&&(t={});var n=e.field,r=t.prefix,i=t.suffix;if(f(e))n="count_*";else{var o=void 0;t.nofn||(e.bin?(o=A.binToString(e.bin),i=t.binSuffix||""):e.aggregate?o=String(t.aggregate||e.aggregate):e.timeUnit&&(o=String(e.timeUnit))),o&&(n=o+"_"+n)}return i&&(n=n+"_"+i),r&&(n=r+"_"+n),t.expr&&(n=t.expr+"["+I.stringValue(n)+"]"),n}function l(e){switch(e.type){case"nominal":case"ordinal":return!0;case"quantitative":return!!e.bin;case"temporal":return!1}throw new Error(b.message.invalidFieldType(e.type))}function d(e){return!l(e)}function f(e){return"count"===e.aggregate}function p(e,t){if(f(e))return t.countTitle;var n=e.aggregate||e.timeUnit||e.bin&&"bin";return n?n.toUpperCase()+"("+e.field+")":e.field}function y(e,t){if(e.timeUnit)return"temporal";if(e.bin)return"quantitative";switch(S.rangeType(t)){case"continuous":return"quantitative";case"discrete":return"nominal";case"flexible":return"nominal";default:return"quantitative"}}function g(e){return a(e)?e:o(e)?e.condition:void 0}function h(e,t){return a(e)?m(e,t):o(e)?N.__assign({},e,{condition:m(e.condition,t)}):e}function m(e,t){if(e.aggregate&&!P.isAggregateOp(e.aggregate)){var n=(e.aggregate,N.__rest(e,["aggregate"]));b.warn(b.message.invalidAggregate(e.aggregate)),e=n}if(e.timeUnit&&(e=N.__assign({},e,{timeUnit:_.normalizeTimeUnit(e.timeUnit)})),e.bin&&(e=N.__assign({},e,{bin:v(e.bin,t)})),e.type){var r=C.getFullName(e.type);e.type!==r&&(e=N.__assign({},e,{type:r})),"quantitative"!==e.type&&P.isCountingAggregateOp(e.aggregate)&&(b.warn(b.message.invalidFieldTypeForCountAggregate(e.type,e.aggregate)),e=N.__assign({},e,{type:"quantitative"}))}else{var i=y(e,t);b.warn(b.message.emptyOrInvalidFieldType(e.type,t,i)),e=N.__assign({},e,{type:i})}var o=E(e,t),a=o.compatible,u=o.warning;return a||b.warn(u),e}function v(e,t){return I.isBoolean(e)?{maxbins:A.autoMaxBins(t)}:e.maxbins||e.step?e:N.__assign({},e,{maxbins:A.autoMaxBins(t)})}function E(e,t){switch(t){case"row":case"column":return d(e)&&!e.timeUnit?{compatible:!1,warning:b.message.facetChannelShouldBeDiscrete(t)}:M;case"x":case"y":case"color":case"text":case"detail":case"tooltip":return M;case"opacity":case"size":case"x2":case"y2":return l(e)&&!e.bin?{compatible:!1,warning:"Channel "+t+" should not be used with discrete field."}:M;case"shape":return"nominal"!==e.type?{compatible:!1,warning:"Shape channel should be used with nominal data only"}:M;case"order":return"nominal"===e.type?{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}:M}throw new Error("channelCompatability not implemented for channel "+t)}function T(e){return"quantitative"===e.type||!!e.bin}function O(e){return"temporal"===e.type||!!e.timeUnit}Object.defineProperty(n,"__esModule",{value:!0});var N=e("tslib"),P=e("./aggregate"),A=e("./bin"),S=e("./channel"),b=e("./log"),_=e("./timeunit"),C=e("./type"),I=e("./util");n.isRepeatRef=r,n.isConditionalDef=i,n.hasConditionFieldDef=o,n.isFieldDef=a,n.isValueDef=u,n.isScaleFieldDef=c,n.field=s,n.isDiscrete=l,n.isContinuous=d,n.isCount=f,n.title=p,n.defaultType=y,n.getFieldDef=g,n.normalize=h,n.normalizeFieldDef=m,n.normalizeBin=v;var M={compatible:!0};n.channelCompatibility=E,n.isNumberFieldDef=T,n.isTimeFieldDef=O},{"./aggregate":54,"./bin":56,"./channel":57,"./log":62,"./timeunit":66,"./type":67,"./util":68,tslib:53}],61:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.defaultLegendConfig={},n.LEGEND_PROPERTIES=["entryPadding","format","offset","orient","tickCount","title","type","values","zindex"],n.VG_LEGEND_PROPERTIES=[].concat(["fill","stroke","shape","size","opacity","encode"],n.LEGEND_PROPERTIES)},{}],62:[function(e,t,n){"use strict";function r(e){var t=f=new p;e(t),a()}function i(e){return function(){var t=f=new p;e(t),a()}}function o(e){return f=e}function a(){return f=d}function u(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];f.warn.apply(f,arguments)}function c(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];f.info.apply(f,arguments)}function s(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];f.debug.apply(f,arguments)}Object.defineProperty(n,"__esModule",{value:!0});var l=e("vega-util"),d=l.logger(l.Warn),f=d,p=function(){function e(){this.warns=[],this.infos=[],this.debugs=[]}return e.prototype.level=function(){return this},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(n=this.warns).push.apply(n,e),this;var n},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(n=this.infos).push.apply(n,e),this;var n},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(n=this.debugs).push.apply(n,e),this;var n},e}();n.LocalLogger=p,n.runLocalLogger=r,n.wrap=i,n.set=o,n.reset=a,n.warn=u,n.info=c,n.debug=s;var y;!function(e){function t(e){return'Cannot project a selection on encoding channel "'+e+'", which has no field.'}function n(e){return'Cannot find a selection named "'+e+'"'}function r(e){return'Unknown repeated value "'+e+'".'}function i(e){return'Cannot set title "anchor" for a '+e+" spec"}function o(e){return'Unrecognized parse "'+e+'".'}function a(e,t,n){return'An ancestor parsed field "'+e+'" as '+n+" but a child wants to parse the field as "+t+"."}function u(e){return"Ignoring an invalid transform: "+JSON.stringify(e)+"."}function c(e){return'Invalid field type "'+e+'"'}function s(e,t){return'Invalid field type "'+e+'" for aggregate: "'+t+'", using "quantitative" instead.'}function l(e){return'Invalid aggregation operator "'+e+'"'}function d(e,t,n){return'Invalid field type "'+e+'" for channel "'+t+'", using "'+n+'" instead.'}function f(e,t){return"Dropping "+JSON.stringify(e)+' from channel "'+t+'" since it does not contain data field or value.'}function p(e,t,n){return e+' dropped as it is incompatible with "'+t+'"'+(n?" when "+n:"")+"."}function y(e){return e+" encoding should be discrete (ordinal / nominal / binned)."}function g(e,t){return'Using discrete channel "'+e+'" to encode "'+t+'" field can be misleading as it does not encode '+("ordinal"===t?"order":"magnitude")+"."}function h(e){return'Cannot clearly determine orientation for "'+e+'" since both x and y channel encode continous fields. In this case, we use vertical by default'}function m(e){return'Cannot clearly determine orientation for "'+e+'" since both x and y channel encode discrete or empty fields.'}function v(e,t){return'Specified orient "'+e+'" overridden with "'+t+'"'}function E(e){return'Cannot use the scale property "'+e+'" with non-color channel.'}function T(e){return"Using unaggregated domain with raw field has no effect ("+JSON.stringify(e)+")."}function O(e){return'Unaggregated domain not applicable for "'+e+'" since it produces values outside the origin domain of the source data.'}function N(e){return"Unaggregated domain is currently unsupported for log scale ("+JSON.stringify(e)+")."}function P(e){return"Using size field when "+e+"-channel has a band scale is not supported."}function A(e){return'Cannot apply size to non-oriented mark "'+e+'".'}function S(e){return'rangeStep for "'+e+'" is dropped as top-level '+("x"===e?"width":"height")+" is provided."}function b(e,t,n){return'Channel "'+e+'" does not work with "'+t+'" scale. We are using "'+n+'" scale instead.'}function _(e,t){return'FieldDef does not work with "'+e+'" scale. We are using "'+t+'" scale instead.'}function C(e,t,n){return n+"-scale's \""+t+'" is dropped as it does not work with '+e+" scale."}function I(e,t){return'Scale type "'+t+'" does not work with mark "'+e+'".'}function M(e,t,n,r){return"Conflicting "+t+' property "'+e+'" ("'+n+'" and "'+r+'").  Using "'+n+'".'}function R(e){return'Setting the scale to be independent for "'+e+'" means we also have to set the guide (axis or legend) to be independent.'}function U(e){return"Cannot set "+e+'-scale\'s "domain" as it is binned. Please use "bin"\'s "extent" instead.'}function D(e){return'Dropping sort property "'+JSON.stringify(e)+"\" as unioned domains only support boolean or op 'count'."}function w(e){return'Cannot stack "'+e+'" if there is already "'+e+'2"'}function x(e){return"Cannot stack non-linear scale ("+e+")"}function L(e){return'Cannot stack when the aggregate function is non-summative ("'+e+'")'}function F(e,t){return"Invalid "+e+': "'+t+'"'}function k(e){return'Time unit "'+e+'" is not supported. We are replacing it with '+e.replace("day","date")+"."}function Q(e){return"Dropping day from datetime "+JSON.stringify(e)+" as day cannot be combined with other units."}e.INVALID_SPEC="Invalid spec",e.cannotProjectOnChannelWithoutField=t,e.selectionNotFound=n,e.noSuchRepeatedValue=r,e.cannotSetTitleAnchor=i,e.unrecognizedParse=o,e.differentParse=a,e.invalidTransformIgnored=u,e.NO_FIELDS_NEEDS_AS='If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the the data from the secondary source.',e.invalidFieldType=c,e.invalidFieldTypeForCountAggregate=s,e.invalidAggregate=l,e.emptyOrInvalidFieldType=d,e.emptyFieldDef=f,e.incompatibleChannel=p,e.facetChannelShouldBeDiscrete=y,e.discreteChannelCannotEncode=g,e.BAR_WITH_POINT_SCALE_AND_RANGESTEP_NULL="Bar mark should not be used with point scale when rangeStep is null. Please use band scale instead.",e.unclearOrientContinuous=h,e.unclearOrientDiscreteOrEmpty=m,e.orientOverridden=v,e.CANNOT_UNION_CUSTOM_DOMAIN_WITH_FIELD_DOMAIN="custom domain scale cannot be unioned with default field-based domain",e.cannotUseScalePropertyWithNonColor=E,e.unaggregateDomainHasNoEffectForRawField=T,e.unaggregateDomainWithNonSharedDomainOp=O,e.unaggregatedDomainWithLogScale=N,e.CANNOT_USE_RANGE_WITH_POSITION='Cannot use a custom "range" with x or y channel.  Please customize width, height, padding, or rangeStep instead.',e.cannotUseSizeFieldWithBandSize=P,e.cannotApplySizeToNonOrientedMark=A,e.rangeStepDropped=S,e.scaleTypeNotWorkWithChannel=b,e.scaleTypeNotWorkWithFieldDef=_,e.scalePropertyNotWorkWithScaleType=C,e.scaleTypeNotWorkWithMark=I,e.mergeConflictingProperty=M,e.independentScaleMeansIndependentGuide=R,e.conflictedDomain=U,e.domainSortDropped=D,e.UNABLE_TO_MERGE_DOMAINS="Unable to merge domains",e.MORE_THAN_ONE_SORT="Domains that should be unioned has conflicting sort properties. Sort will be set to true.",e.INVALID_CHANNEL_FOR_AXIS="Invalid channel for axis.",e.cannotStackRangedMark=w,e.cannotStackNonLinearScale=x,e.cannotStackNonSummativeAggregate=L,e.invalidTimeUnit=F,e.dayReplacedWithDate=k,e.droppedDay=Q}(y=n.message||(n.message={}))},{"vega-util":69}],63:[function(e,t,n){"use strict";function r(e){return!!e.or}function i(e){return!!e.and}function o(e){return!!e.not}function a(e,t){if(o(e))a(e.not,t);else if(i(e))for(var n=0,u=e.and;n<u.length;n++){var c=u[n];a(c,t)}else if(r(e))for(var s=0,l=e.or;s<l.length;s++){var c=l[s];a(c,t)}else t(e)}function u(e,t){return o(e)?{not:u(e.not,t)}:i(e)?{and:e.and.map(function(e){return u(e,t)})}:r(e)?{or:e.or.map(function(e){return u(e,t)})}:t(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.isLogicalOr=r,n.isLogicalAnd=i,n.isLogicalNot=o,n.forEachLeave=a,n.normalizeLogicalOperand=u},{}],64:[function(e,t,n){"use strict";function r(e){return!!c[e]}function i(e){return e.type}function o(e){var t=i(e)?e.type:e;return t in s}Object.defineProperty(n,"__esModule",{value:!0});var a,u=e("./util");!function(e){e.AREA="area",e.BAR="bar",e.LINE="line",e.POINT="point",e.RECT="rect",e.RULE="rule",e.TEXT="text",e.TICK="tick",e.CIRCLE="circle",e.SQUARE="square"}(a=n.Mark||(n.Mark={})),n.AREA=a.AREA,n.BAR=a.BAR,n.LINE=a.LINE,n.POINT=a.POINT,n.TEXT=a.TEXT,n.TICK=a.TICK,n.RECT=a.RECT,n.RULE=a.RULE,n.CIRCLE=a.CIRCLE,n.SQUARE=a.SQUARE;var c={area:1,bar:1,line:1,point:1,text:1,tick:1,rect:1,rule:1,circle:1,square:1};n.isMark=r,n.PRIMITIVE_MARKS=u.flagKeys(c),n.isMarkDef=i;var s=u.toSet(n.PRIMITIVE_MARKS);n.isPrimitiveMark=o,n.STROKE_CONFIG=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity"],n.FILL_CONFIG=["fill","fillOpacity"],n.FILL_STROKE_CONFIG=[].concat(n.STROKE_CONFIG,n.FILL_CONFIG),n.VL_ONLY_MARK_CONFIG_PROPERTIES=["filled","color"],n.VL_ONLY_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX={bar:["binSpacing","continuousBandSize","discreteBandSize"],text:["shortTimeLabels"],tick:["bandSize","thickness"]},n.defaultMarkConfig={color:"#4c78a8"},n.defaultBarConfig={binSpacing:1,continuousBandSize:2},n.defaultTickConfig={thickness:1}},{"./util":68}],65:[function(e,t,n){"use strict";function r(e,t){var n=E[e],r=E[t];return n===r||"ordinal-position"===n&&"time"===r||"ordinal-position"===r&&"time"===n}function i(e){return T[e]}function o(e){return e in P}function a(e){return e in A}function u(e){return e in N}function c(e){return e in O}function s(e){return e&&!!e.name}function l(e){return e&&e.selection}function d(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":return v.contains(["sequential","ordinal","bin-ordinal","quantile","quantize"],e);case"interpolate":return v.contains(["linear","bin-linear","pow","log","sqrt","utc","time"],e);case"round":return c(e)||"band"===e||"point"===e;case"rangeStep":case"padding":case"paddingOuter":return v.contains(["point","band"],e);case"paddingInner":return"band"===e;case"clamp":return c(e)||"sequential"===e;case"nice":return c(e)||"sequential"===e||"quantize"===e;case"exponent":return"pow"===e;case"base":return"log"===e;case"zero":return u(e)&&!v.contains(["log","time","utc","bin-linear","threshold","quantile"],e)}throw new Error("Invalid scale property "+t+".")}function f(e,t){switch(t){case"range":if("x"===e||"y"===e)return m.message.CANNOT_USE_RANGE_WITH_POSITION;return;case"interpolate":case"scheme":if("color"!==e)return m.message.cannotUseScalePropertyWithNonColor(e);return;case"type":case"domain":case"base":case"exponent":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"rangeStep":case"reverse":case"round":case"clamp":case"zero":return}throw new Error('Invalid scale property "'+t+'".')}function p(e,t){switch(e){case h.Channel.X:case h.Channel.Y:case h.Channel.SIZE:case h.Channel.OPACITY:return c(t)||v.contains(["band","point"],t);case h.Channel.COLOR:return"band"!==t;case h.Channel.SHAPE:return"ordinal"===t}return!1}Object.defineProperty(n,"__esModule",{value:!0});var y,g=e("tslib"),h=e("./channel"),m=e("./log"),v=e("./util");!function(e){e.LINEAR="linear",e.BIN_LINEAR="bin-linear",e.LOG="log",e.POW="pow",e.SQRT="sqrt",e.TIME="time",e.UTC="utc",e.SEQUENTIAL="sequential",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.ORDINAL="ordinal",e.BIN_ORDINAL="bin-ordinal",e.POINT="point",e.BAND="band"}(y=n.ScaleType||(n.ScaleType={}));var E={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric","bin-linear":"bin-linear",time:"time",utc:"time",sequential:"sequential",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position"};n.SCALE_TYPES=v.keys(E),n.scaleCompatible=r;var T={linear:0,log:1,pow:1,sqrt:1,time:0,utc:0,point:10,band:11,"bin-linear":0,sequential:0,ordinal:0,"bin-ordinal":0};n.scaleTypePrecedence=i,n.CONTINUOUS_TO_CONTINUOUS_SCALES=["linear","bin-linear","log","pow","sqrt","time","utc"];var O=v.toSet(n.CONTINUOUS_TO_CONTINUOUS_SCALES);n.CONTINUOUS_DOMAIN_SCALES=n.CONTINUOUS_TO_CONTINUOUS_SCALES.concat(["sequential"]);var N=v.toSet(n.CONTINUOUS_DOMAIN_SCALES);n.DISCRETE_DOMAIN_SCALES=["ordinal","bin-ordinal","point","band"];var P=v.toSet(n.DISCRETE_DOMAIN_SCALES),A=v.toSet(["bin-linear","bin-ordinal"]);n.TIME_SCALE_TYPES=["time","utc"],n.hasDiscreteDomain=o,n.isBinScale=a,n.hasContinuousDomain=u,n.isContinuousToContinuous=c,n.defaultScaleConfig={textXRangeStep:90,rangeStep:21,pointPadding:.5,bandPaddingInner:.1,facetSpacing:16,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4},n.isExtendedScheme=s,n.isSelectionDomain=l;var S={type:1,domain:1,range:1,rangeStep:1,scheme:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1};n.SCALE_PROPERTIES=v.flagKeys(S);var b=(S.type,S.domain,S.range,S.rangeStep,S.scheme,g.__rest(S,["type","domain","range","rangeStep","scheme"]));n.NON_TYPE_DOMAIN_RANGE_VEGA_SCALE_PROPERTIES=v.flagKeys(b),n.scaleTypeSupportProperty=d,n.channelScalePropertyIncompatability=f,n.channelSupportScaleType=p},{"./channel":57,"./log":62,"./util":68,tslib:53}],66:[function(e,t,n){"use strict";function r(e){return!!T[e]}function i(e){return!!O[e]}function o(e){return!!A[e]}function a(e){return e.substr(3)}function u(e){return!!S[e]}function c(e,t){var r=o(e),i=r?new Date(Date.UTC(0,0,1,0,0,0,0)):new Date(0,0,1,0,0,0,0);return n.TIMEUNIT_PARTS.forEach(function(n){if(l(e,n))switch(n){case g.DAY:throw new Error("Cannot convert to TimeUnits containing 'day'");case g.QUARTER:var o=s("month",r),a=o.getDateMethod,u=o.setDateMethod;i[u](3*Math.floor(t[a]()/3));break;default:var c=s(n,r),d=c.getDateMethod,f=c.setDateMethod;i[f](t[d]())}}),i}function s(e,t){var n=b[e],r=t?"setUTC"+n.substr(3):n,i="get"+(t?"UTC":"")+n.substr(3);return{setDateMethod:r,getDateMethod:i}}function l(e,t){var n=e.indexOf(t);return n>-1&&(t!==g.SECONDS||0===n||"i"!==e.charAt(n-1))}function d(e,t){function r(e){return e===g.QUARTER?"("+a+"quarter("+i+")-1)":""+a+e+"("+i+")"}var i="datum["+E.stringValue(t)+"]",a=o(e)?"utc":"",u=n.TIMEUNIT_PARTS.reduce(function(t,n){return l(e,n)&&(t[n]=r(n)),t},{});return m.dateTimeExpr(u)}function f(e){if(e)return l(e,g.SECONDS)?"second":l(e,g.MINUTES)?"minute":l(e,g.HOURS)?"hour":l(e,g.DAY)||l(e,g.DATE)?"day":l(e,g.MONTH)?"month":l(e,g.YEAR)?"year":void 0}function p(e,t,n,r){if(e){var i=[],o="",a=l(e,g.YEAR);l(e,g.QUARTER)&&(o="'Q' + quarter("+t+")"),l(e,g.MONTH)&&i.push(n!==!1?"%b":"%B"),l(e,g.DAY)?i.push(n?"%a":"%A"):l(e,g.DATE)&&i.push("%d"+(a?",":"")),a&&i.push(n?"%y":"%Y");var u=[];l(e,g.HOURS)&&u.push("%H"),l(e,g.MINUTES)&&u.push("%M"),l(e,g.SECONDS)&&u.push("%S"),l(e,g.MILLISECONDS)&&u.push("%L");var c=[];return i.length>0&&c.push(i.join(" ")),u.length>0&&c.push(u.join(":")),c.length>0&&(o&&(o+=" + ' ' + "),o+=r?"utcFormat("+t+", '"+c.join(" ")+"')":"timeFormat("+t+", '"+c.join(" ")+"')"),o||void 0}}function y(e){return"day"!==e&&e.indexOf("day")>=0?(v.warn(v.message.dayReplacedWithDate(e)),e.replace("day","date")):e}Object.defineProperty(n,"__esModule",{value:!0});var g,h=e("tslib"),m=e("./datetime"),v=e("./log"),E=e("./util");!function(e){e.YEAR="year",e.MONTH="month",e.DAY="day",e.DATE="date",e.HOURS="hours",e.MINUTES="minutes",e.SECONDS="seconds",e.MILLISECONDS="milliseconds",e.YEARMONTH="yearmonth",e.YEARMONTHDATE="yearmonthdate",e.YEARMONTHDATEHOURS="yearmonthdatehours",e.YEARMONTHDATEHOURSMINUTES="yearmonthdatehoursminutes",e.YEARMONTHDATEHOURSMINUTESSECONDS="yearmonthdatehoursminutesseconds",e.MONTHDATE="monthdate",e.HOURSMINUTES="hoursminutes",e.HOURSMINUTESSECONDS="hoursminutesseconds",e.MINUTESSECONDS="minutesseconds",e.SECONDSMILLISECONDS="secondsmilliseconds",e.QUARTER="quarter",e.YEARQUARTER="yearquarter",e.QUARTERMONTH="quartermonth",e.YEARQUARTERMONTH="yearquartermonth",e.UTCYEAR="utcyear",e.UTCMONTH="utcmonth",e.UTCDAY="utcday",e.UTCDATE="utcdate",e.UTCHOURS="utchours",e.UTCMINUTES="utcminutes",e.UTCSECONDS="utcseconds",e.UTCMILLISECONDS="utcmilliseconds",e.UTCYEARMONTH="utcyearmonth",e.UTCYEARMONTHDATE="utcyearmonthdate",e.UTCYEARMONTHDATEHOURS="utcyearmonthdatehours",e.UTCYEARMONTHDATEHOURSMINUTES="utcyearmonthdatehoursminutes",e.UTCYEARMONTHDATEHOURSMINUTESSECONDS="utcyearmonthdatehoursminutesseconds",e.UTCMONTHDATE="utcmonthdate",e.UTCHOURSMINUTES="utchoursminutes",e.UTCHOURSMINUTESSECONDS="utchoursminutesseconds",e.UTCMINUTESSECONDS="utcminutesseconds",e.UTCSECONDSMILLISECONDS="utcsecondsmilliseconds",e.UTCQUARTER="utcquarter",e.UTCYEARQUARTER="utcyearquarter",e.UTCQUARTERMONTH="utcquartermonth",e.UTCYEARQUARTERMONTH="utcyearquartermonth"}(g=n.TimeUnit||(n.TimeUnit={}));var T={year:1,quarter:1,month:1,day:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1};n.TIMEUNIT_PARTS=E.flagKeys(T),n.isLocalSingleTimeUnit=r;var O={utcyear:1,utcquarter:1,utcmonth:1,utcday:1,utcdate:1,utchours:1,utcminutes:1,utcseconds:1,utcmilliseconds:1};n.isUtcSingleTimeUnit=i;var N={yearquarter:1,yearquartermonth:1,yearmonth:1,yearmonthdate:1,yearmonthdatehours:1,yearmonthdatehoursminutes:1,yearmonthdatehoursminutesseconds:1,quartermonth:1,monthdate:1,hoursminutes:1,hoursminutesseconds:1,minutesseconds:1,secondsmilliseconds:1},P={utcyearquarter:1,utcyearquartermonth:1,utcyearmonth:1,utcyearmonthdate:1,utcyearmonthdatehours:1,utcyearmonthdatehoursminutes:1,utcyearmonthdatehoursminutesseconds:1,utcquartermonth:1,utcmonthdate:1,utchoursminutes:1,utchoursminutesseconds:1,utcminutesseconds:1,utcsecondsmilliseconds:1},A=h.__assign({},O,P);n.isUTCTimeUnit=o,n.getLocalTimeUnit=a;var S=h.__assign({},T,O,N,P);n.TIMEUNITS=E.flagKeys(S),n.isTimeUnit=u;var b={year:"setFullYear",month:"setMonth",date:"setDate",hours:"setHours",minutes:"setMinutes",seconds:"setSeconds",milliseconds:"setMilliseconds",quarter:null,day:null};n.convert=c,n.containsTimeUnit=l,n.fieldExpr=d,n.smallestUnit=f,n.formatExpression=p,n.normalizeTimeUnit=y},{"./datetime":59,"./log":62,"./util":68,tslib:53}],67:[function(e,t,n){"use strict";function r(e){return!!a[e]}function i(e){if(e)switch(e=e.toLowerCase()){case"q":case n.QUANTITATIVE:return"quantitative";case"t":case n.TEMPORAL:return"temporal";case"o":case n.ORDINAL:return"ordinal";case"n":case n.NOMINAL:return"nominal"}}Object.defineProperty(n,"__esModule",{value:!0});var o;!function(e){e.QUANTITATIVE="quantitative",e.ORDINAL="ordinal",e.TEMPORAL="temporal",e.NOMINAL="nominal"}(o=n.Type||(n.Type={}));var a={quantitative:1,ordinal:1,temporal:1,nominal:1};n.isType=r,n.QUANTITATIVE=o.QUANTITATIVE,n.ORDINAL=o.ORDINAL,n.TEMPORAL=o.TEMPORAL,n.NOMINAL=o.NOMINAL,n.getFullName=i},{}],68:[function(e,t,n){"use strict";function r(e,t){var n={};return t.forEach(function(t){e.hasOwnProperty(t)&&(n[t]=e[t])}),n}function i(e,t){var n=T(e);return t.forEach(function(e){delete n[e]}),n}function o(e){return b.isString(e)||b.isNumber(e)||O(e)?String(e):S(e)}function a(e,t){return e.indexOf(t)>-1}function u(e,t){return e.filter(function(e){return!a(t,e)})}function c(e,t){return e.concat(u(t,e))}function s(e,t){for(var n=0,r=0;r<e.length;r++)if(t(e[r],r,n++))return!0;return!1}function l(e,t){for(var n=0,r=0;r<e.length;r++)if(!t(e[r],r,n++))return!1;return!0}function d(e){return[].concat.apply([],e)}function f(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=0,i=t;r<i.length;r++){var o=i[r];e=p(e,o)}return e}function p(e,t){if("object"!=typeof t||null===t)return e;for(var n in t)t.hasOwnProperty(n)&&void 0!==t[n]&&("object"!=typeof t[n]||b.isArray(t[n])||null===t[n]?e[n]=t[n]:"object"!=typeof e[n]||null===e[n]?e[n]=f(b.isArray(t[n].constructor)?[]:{},t[n]):f(e[n],t[n]));return e}function y(e,t){for(var n,r=[],i={},o=0,a=e;o<a.length;o++){var u=a[o];n=t(u),n in i||(i[n]=1,r.push(u))}return r}function g(e,t){for(var n in e)if(e.hasOwnProperty(n)&&t[n]&&e[n]&&t[n]!==e[n])return!0;return!1}function h(e,t){for(var n in e)if(n in t)return!0;return!1}function m(e,t){if(e.length!==t.length)return!0;e.sort(),t.sort();for(var n=0;n<e.length;n++)if(t[n]!==e[n])return!0;return!1}function v(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t}function E(e){return n.keys(e)}function T(e){return JSON.parse(JSON.stringify(e))}function O(e){return e===!0||e===!1}function N(e){var t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function P(e,t){return _.isLogicalNot(e)?"!("+P(e.not,t)+")":_.isLogicalAnd(e)?"("+e.and.map(function(e){return P(e,t)}).join(") && (")+")":_.isLogicalOr(e)?"("+e.or.map(function(e){return P(e,t)}).join(") || (")+")":t(e)}function A(e,t){for(var r=!0;t.length>0&&r;){for(var i=e,o=0;o<t.length-1;o++)i=i[t[o]];delete i[t.pop()],0!==n.keys(i).length&&(r=!1)}}Object.defineProperty(n,"__esModule",{value:!0});var S=e("json-stable-stringify"),b=e("vega-util"),_=e("./logical"),C=e("vega-util");n.isArray=C.isArray,n.isObject=C.isObject,n.isNumber=C.isNumber,n.isString=C.isString,n.truncate=C.truncate,n.toSet=C.toSet,n.stringValue=C.stringValue,n.pick=r,n.omit=i,n.hash=o,n.contains=a,n.without=u,n.union=c,n.some=s,n.every=l,n.flatten=d,n.mergeDeep=f,n.unique=y,n.differ=g,n.hasIntersection=h,n.differArray=m,n.keys=Object.keys,n.vals=v,n.flagKeys=E,n.duplicate=T,n.isBoolean=O,n.varName=N,n.logicalExpr=P,n.deleteNestedProperty=A},{"./logical":63,"json-stable-stringify":49,"vega-util":69}],69:[function(t,n,r){!function(t,i){"object"==typeof r&&"undefined"!=typeof n?i(r):"function"==typeof e&&e.amd?e(["exports"],i):i(t.vega=t.vega||{})}(this,function(e){"use strict";function t(e){return null==e?null:e.fname}function n(e){return null==e?null:e.fields}function r(e){return s(e)?"["+e.map(r)+"]":l(e)||d(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function i(e,t,n){var r=[t].concat([].slice.call(n));console[e].apply(console,r)}function o(e){return k(e)?e:F(e)?e:Date.parse(e)}var a=function(e,t,n){return e.fields=t||[],e.fname=n,e},u=function(e){throw Error(e)},c=function(e){function t(){o.push(l+e.substring(n,r)),l="",n=r+1}var n,r,i,o=[],a=null,c=0,s=e.length,l="";for(e+="",n=r=0;r<s;++r)if(i=e[r],"\\"===i)l+=e.substring(n,r),n=++r;else if(i===a)t(),a=null,c=-1;else{if(a)continue;n===c&&'"'===i?(n=r+1,a=i):n===c&&"'"===i?(n=r+1,a=i):"."!==i||c?"["===i?(r>n&&t(),c=n=r+1):"]"===i&&(c||u("Access path missing open bracket: "+e),c>0&&t(),c=0,n=r+1):r>n?t():n=r+1}return c&&u("Access path missing closing bracket: "+e),a&&u("Access path missing closing quote: "+e),r>n&&(r++,t()),o},s=Array.isArray,l=function(e){return e===Object(e)},d=function(e){return"string"==typeof e},f=function(e,t){var n=c(e),i="return _["+n.map(r).join("][")+"];";return a(Function("_",i),[e=1===n.length?n[0]:e],t||e)},p=[],y=f("id"),g=a(function(e){return e},p,"identity"),h=a(function(){return 0},p,"zero"),m=a(function(){return 1},p,"one"),v=a(function(){return!0},p,"true"),E=a(function(){return!1},p,"false"),T=0,O=1,N=2,P=3,A=4,S=function(e){var t=e||T;return{level:function(e){return arguments.length?(t=+e,this):t},error:function(){return t>=O&&i("error","ERROR",arguments),this},warn:function(){return t>=N&&i("warn","WARN",arguments),this},info:function(){return t>=P&&i("log","INFO",arguments),this},debug:function(){return t>=A&&i("log","DEBUG",arguments),this}}},b=function(e){return null!=e?s(e)?e:[e]:[]},_=function(e){return"function"==typeof e},C=function(e,t){var i,o,u,s,l,d,f,p,y,g=[],h=(e=b(e)).map(function(e,t){return null==e?null:(g.push(t),_(e)?e:c(e).map(r).join("]["))}),m=g.length-1,v=b(t),E="var u,v;return ";if(m<0)return null;for(o=0;o<=m;++o)i=g[o],u=h[i],_(u)?(d="f"+i,s="(u=this."+d+"(a))",l="(v=this."+d+"(b))",(f=f||{})[d]=u):(s="(u=a["+u+"])",l="(v=b["+u+"])"),d="((v=v instanceof Date?+v:v),(u=u instanceof Date?+u:u))","descending"!==v[i]?(y=1,p=-1):(y=-1,p=1),E+="("+s+"<"+l+"||u==null)&&v!=null?"+p+":(u>v||v==null)&&u!=null?"+y+":"+d+"!==u&&v===v?"+p+":v!==v&&u===u?"+y+(i<m?":":":0");return u=Function("a","b",E+";"),f&&(u=u.bind(f)),e=e.reduce(function(e,t){return _(t)?(n(t)||[]).forEach(function(t){e[t]=1}):null!=t&&(e[t+""]=1),e},{}),a(u,Object.keys(e))},I=function(e){return _(e)?e:function(){return e}},M=function(e,t){function n(){t(i),r=i=null}var r,i;return function(t){i=t,r&&clearTimeout(r),r=setTimeout(n,e)}},R=function(e){for(var t,n,r=1,i=arguments.length;r<i;++r){t=arguments[r];for(n in t)e[n]=t[n]}return e},U=function(e,t){var n,r,i,o,a,u=-1,c=e.length;if(null==t){for(;++u<c;)if(r=e[u],null!=r&&r>=r){n=i=r;break}for(o=a=u;++u<c;)r=e[u],null!=r&&(n>r&&(n=r,o=u),i<r&&(i=r,a=u))}else{for(;++u<c;)if(r=t(e[u],u,e),null!=r&&r>=r){n=i=r;break}for(o=a=u;++u<c;)r=t(e[u],u,e),null!=r&&(n>r&&(n=r,o=u),i<r&&(i=r,a=u))}return[o,a]},D={},w=function(e){function t(e){return i.hasOwnProperty(e)&&i[e]!==D}var n,r,i={};return n={size:0,empty:0,object:i,has:t,get:function(e){return t(e)?i[e]:void 0},set:function(e,r){return t(e)||(++n.size,i[e]===D&&--n.empty),i[e]=r,this},"delete":function(e){return t(e)&&(--n.size,++n.empty,i[e]=D),this},clear:function(){n.size=n.empty=0,n.object=i={}},test:function(e){return arguments.length?(r=e,n):r},clean:function(){var e,t,o={},a=0;for(e in i)t=i[e],t===D||r&&r(t)||(o[e]=t,++a);n.size=a,n.empty=0,n.object=i=o}},e&&Object.keys(e).forEach(function(t){n.set(t,e[t])}),n},x=function(e,t){var n=e.prototype=Object.create(t.prototype);return n.constructor=e,n},L=function(e){return"boolean"==typeof e},F=function(e){return"[object Date]"===Object.prototype.toString.call(e)},k=function(e){return"number"==typeof e},Q=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},j=function(e){e=e?b(e):e;var t=e&&e.length?Function("_","return ''+"+e.map(function(e){return"_["+c(e).map(r).join("][")+"]"}).join("+'|'+")+";"):function(){return""};return a(t,e,"key")},B=function(e,t,n,r){var i=t.length,o=n.length;if(!o)return t;if(!i)return n;for(var a=r||new t.constructor(i+o),u=0,c=0,s=0;u<i&&c<o;++s)a[s]=e(t[u],n[c])>0?n[c++]:t[u++];for(;u<i;++u,++s)a[s]=t[u];for(;c<o;++c,++s)a[s]=n[c];return a},W=function(e,t){for(var n="";--t>=0;)n+=e;return n},G=function(e,t,n,r){var i=n||" ",o=e+"",a=t-o.length;return a<=0?o:"left"===r?W(i,a)+o:"center"===r?W(i,~~(a/2))+o+W(i,Math.ceil(a/2)):o+W(i,a)},q=function(e){return e[e.length-1]},Y=function(e){return null==e||""===e?null:!(!e||"false"===e||"0"===e)&&!!e},H=function(e,t){return t=t||o,null==e||""===e?null:t(e)},V=function(e){return null==e||""===e?null:+e},z=function(e){return null==e||""===e?null:e+""},K=function(e){for(var t={},n=0,r=e.length;n<r;++n)t[e[n]]=1;return t},X=function(e,t,n,r){var i=null!=r?r:"…",o=e+"",a=o.length,u=Math.max(0,t-i.length);return a<=t?o:"left"===n?i+o.slice(a-u):"center"===n?o.slice(0,Math.ceil(u/2))+i+o.slice(a-~~(u/2)):o.slice(0,u)+i},$=function(e,t,n){if(e){var r,i=0,o=e.length;if(t)for(;i<o;++i)(r=t(e[i]))&&n(r,i,e);else e.forEach(n)}};e.accessor=a,e.accessorName=t,e.accessorFields=n,e.id=y,e.identity=g,e.zero=h,e.one=m,e.truthy=v,e.falsy=E,e.logger=S,e.None=T,e.Error=O,e.Warn=N,e.Info=P,e.Debug=A,e.array=b,e.compare=C,
e.constant=I,e.debounce=M,e.error=u,e.extend=R,e.extentIndex=U,e.fastmap=w,e.field=f,e.inherits=x,e.isArray=s,e.isBoolean=L,e.isDate=F,e.isFunction=_,e.isNumber=k,e.isObject=l,e.isRegExp=Q,e.isString=d,e.key=j,e.merge=B,e.pad=G,e.peek=q,e.repeat=W,e.splitAccessPath=c,e.stringValue=r,e.toBoolean=Y,e.toDate=H,e.toNumber=V,e.toString=z,e.toSet=K,e.truncate=X,e.visitArray=$,Object.defineProperty(e,"__esModule",{value:!0})})},{}]},{},[8])(8)});
//# sourceMappingURL=build/compassql.min.js.map
