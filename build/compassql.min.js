!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.cql={})}(this,function(e){"use strict";function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e["default"]:e}function n(e,t){return t={exports:{}},e(t,t.exports),t.exports}function r(e,t){function n(){this.constructor=e}Be(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function i(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&(n[r[i]]=e[r[i]]);return n}function o(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var u=e.length-1;u>=0;u--)(i=e[u])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a}function a(e,t){return function(n,r){t(n,r,e)}}function u(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function s(e,t,n,r){return new(n||(n=Promise))(function(i,o){function a(e){try{s(r.next(e))}catch(t){o(t)}}function u(e){try{s(r["throw"](e))}catch(t){o(t)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,u)}s((r=r.apply(e,t||[])).next())})}function c(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(a=o[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,o=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(a=s.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){s.label=n[1];break}if(6===n[0]&&s.label<a[1]){s.label=a[1],a=n;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(n);break}a[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(r){n=[6,r],o=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,o,a,u,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return u={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u}function l(e,t){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}function d(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}function f(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(u){i={error:u}}finally{try{r&&!r.done&&(n=o["return"])&&n.call(o)}finally{if(i)throw i.error}}return a}function p(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(f(arguments[t]));return e}function y(e){return this instanceof y?(this.v=e,this):new y(e)}function g(e,t,n){function r(e){l[e]&&(c[e]=function(t){return new Promise(function(n,r){d.push([e,t,n,r])>1||i(e,t)})})}function i(e,t){try{o(l[e](t))}catch(n){s(d[0][3],n)}}function o(e){e.value instanceof y?Promise.resolve(e.value.v).then(a,u):s(d[0][2],e)}function a(e){i("next",e)}function u(e){i("throw",e)}function s(e,t){e(t),d.shift(),d.length&&i(d[0][0],d[0][1])}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var c,l=n.apply(e,t||[]),d=[];return c={},r("next"),r("throw"),r("return"),c[Symbol.asyncIterator]=function(){return this},c}function h(e){function t(t,i){e[t]&&(n[t]=function(n){return(r=!r)?{value:y(e[t](n)),done:"return"===t}:i?i(n):n})}var n,r;return n={},t("next"),t("throw",function(e){throw e}),t("return"),n[Symbol.iterator]=function(){return this},n}function m(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator];return t?t.call(e):"function"==typeof d?d(e):e[Symbol.iterator]()}function E(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}function T(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function v(e){return e&&e.__esModule?e:{"default":e}}function _(e){return it.lastIndex=0,it.test(e)?'"'+e.replace(it,function(e){var t=ot[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function O(e,t){var n,r,i,o,a,u=Ze,s=t[e];switch(s&&"object"==typeof s&&"function"==typeof s.toJSON&&(s=s.toJSON(e)),"function"==typeof tt&&(s=tt.call(t,e,s)),typeof s){case"string":return _(s);case"number":return isFinite(s)?String(s):"null";case"boolean":case"null":return String(s);case"object":if(!s)return"null";if(Ze+=et,a=[],"[object Array]"===Object.prototype.toString.apply(s)){for(o=s.length,n=0;n<o;n+=1)a[n]=O(n,s)||"null";return i=0===a.length?"[]":Ze?"[\n"+Ze+a.join(",\n"+Ze)+"\n"+u+"]":"["+a.join(",")+"]",Ze=u,i}if(tt&&"object"==typeof tt)for(o=tt.length,n=0;n<o;n+=1)r=tt[n],"string"==typeof r&&(i=O(r,s),i&&a.push(_(r)+(Ze?": ":":")+i));else for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(i=O(r,s),i&&a.push(_(r)+(Ze?": ":":")+i));return i=0===a.length?"{}":Ze?"{\n"+Ze+a.join(",\n"+Ze)+"\n"+u+"}":"{"+a.join(",")+"}",Ze=u,i}}function S(e,t,n){return e.fields=t||[],e.fname=n,e}function N(e){return null==e?null:e.fname}function A(e){return null==e?null:e.fields}function P(e){throw Error(e)}function C(e){function t(){o.push(c+e.substring(n,r)),c="",n=r+1}var n,r,i,o=[],a=null,u=0,s=e.length,c="";for(e+="",n=r=0;r<s;++r)if(i=e[r],"\\"===i)c+=e.substring(n,r),n=++r;else if(i===a)t(),a=null,u=-1;else{if(a)continue;n===u&&'"'===i?(n=r+1,a=i):n===u&&"'"===i?(n=r+1,a=i):"."!==i||u?"["===i?(r>n&&t(),u=n=r+1):"]"===i&&(u||P("Access path missing open bracket: "+e),u>0&&t(),u=0,n=r+1):r>n?t():n=r+1}return u&&P("Access path missing closing bracket: "+e),a&&P("Access path missing closing quote: "+e),r>n&&(r++,t()),o}function I(e){return e===Object(e)}function b(e){return"string"==typeof e}function R(e){return vt(e)?"["+e.map(R)+"]":I(e)||b(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function D(e,t){var n=C(e),r="return _["+n.map(R).join("][")+"];";return S(Function("_",r),[e=1===n.length?n[0]:e],t||e)}function L(e,t,n){var r=[t].concat([].slice.call(n));console[e].apply(console,r)}function M(e){var t=e||It;return{level:function(e){return arguments.length?(t=+e,this):t},error:function(){return t>=bt&&L("error","ERROR",arguments),this},warn:function(){return t>=Rt&&L("warn","WARN",arguments),this},info:function(){return t>=Dt&&L("log","INFO",arguments),this},debug:function(){return t>=Lt&&L("log","DEBUG",arguments),this}}}function U(e){return e[e.length-1]}function x(e){return null==e||""===e?null:+e}function F(e){return function(t){return e*Math.exp(t)}}function w(e){return function(t){return Math.log(e*t)}}function k(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function j(e,t,n,r){var i=n(e[0]),o=n(U(e)),a=(o-i)*t;return[r(i-a),r(o-a)]}function G(e,t){return j(e,t,x,St)}function B(e,t){var n=Math.sign(e[0]);return j(e,t,w(n),F(n))}function H(e,t,n){return j(e,t,k(n),k(1/n))}function Y(e,t,n,r,i){var o=r(e[0]),a=r(U(e)),u=null!=t?r(t):(o+a)/2;return[i(u+(o-u)*n),i(u+(a-u)*n)]}function W(e,t,n){return Y(e,t,n,x,St)}function Q(e,t,n){var r=Math.sign(e[0]);return Y(e,t,n,w(r),F(r))}function z(e,t,n,r){return Y(e,t,n,k(r),k(1/r))}function V(e){return null!=e?vt(e)?e:[e]:[]}function K(e){return"function"==typeof e}function q(e,t){var n,r,i,o,a,u,s,c,l,d=[],f=(e=V(e)).map(function(e,t){return null==e?null:(d.push(t),K(e)?e:C(e).map(R).join("]["))}),p=d.length-1,y=V(t),g="var u,v;return ";if(p<0)return null;for(r=0;r<=p;++r)n=d[r],i=f[n],K(i)?(u="f"+n,o="(u=this."+u+"(a))",a="(v=this."+u+"(b))",(s=s||{})[u]=i):(o="(u=a["+i+"])",a="(v=b["+i+"])"),u="((v=v instanceof Date?+v:v),(u=u instanceof Date?+u:u))","descending"!==y[n]?(l=1,c=-1):(l=-1,c=1),g+="("+o+"<"+a+"||u==null)&&v!=null?"+c+":(u>v||v==null)&&u!=null?"+l+":"+u+"!==u&&v===v?"+c+":v!==v&&u===u?"+l+(n<p?":":":0");return i=Function("a","b",g+";"),s&&(i=i.bind(s)),e=e.reduce(function(e,t){return K(t)?(A(t)||[]).forEach(function(t){e[t]=1}):null!=t&&(e[t+""]=1),e},{}),S(i,Object.keys(e))}function X(e){return K(e)?e:function(){return e}}function $(e,t){function n(){t(i),r=i=null}var r,i;return function(t){i=t,r&&clearTimeout(r),r=setTimeout(n,e)}}function J(e){for(var t,n,r=1,i=arguments.length;r<i;++r){t=arguments[r];for(n in t)e[n]=t[n]}return e}function Z(e,t){var n,r,i,o,a,u=-1,s=e.length;if(null==t){for(;++u<s;)if(r=e[u],null!=r&&r>=r){n=i=r;break}for(o=a=u;++u<s;)r=e[u],null!=r&&(n>r&&(n=r,o=u),i<r&&(i=r,a=u))}else{for(;++u<s;)if(r=t(e[u],u,e),null!=r&&r>=r){n=i=r;break}for(o=a=u;++u<s;)r=t(e[u],u,e),null!=r&&(n>r&&(n=r,o=u),i<r&&(i=r,a=u))}return[o,a]}function ee(e){function t(e){return i.hasOwnProperty(e)&&i[e]!==Mt}var n,r,i={};return n={size:0,empty:0,object:i,has:t,get:function(e){return t(e)?i[e]:void 0},set:function(e,r){return t(e)||(++n.size,i[e]===Mt&&--n.empty),i[e]=r,this},"delete":function(e){return t(e)&&(--n.size,++n.empty,i[e]=Mt),this},clear:function(){n.size=n.empty=0,n.object=i={}},test:function(e){return arguments.length?(r=e,n):r},clean:function(){var e,t,o={},a=0;for(e in i)t=i[e],t===Mt||r&&r(t)||(o[e]=t,++a);n.size=a,n.empty=0,n.object=i=o}},e&&Object.keys(e).forEach(function(t){n.set(t,e[t])}),n}function te(e,t){var n=e.prototype=Object.create(t.prototype);return n.constructor=e,n}function ne(e){return"boolean"==typeof e}function re(e){return"[object Date]"===Object.prototype.toString.call(e)}function ie(e){return"number"==typeof e}function oe(e){return"[object RegExp]"===Object.prototype.toString.call(e)}function ae(e,t){e&&(e=t?V(e).map(function(e){return e.replace(/\\(.)/g,"$1")}):V(e));var n=e&&e.length?Function("_","return ''+"+e.map(function(e){return"_["+(t?R(e):C(e).map(R).join("]["))+"]"}).join("+'|'+")+";"):function(){return""};return S(n,e,"key")}function ue(e,t,n,r){var i=t.length,o=n.length;if(!o)return t;if(!i)return n;for(var a=r||new t.constructor(i+o),u=0,s=0,c=0;u<i&&s<o;++c)a[c]=e(t[u],n[s])>0?n[s++]:t[u++];for(;u<i;++u,++c)a[c]=t[u];for(;s<o;++s,++c)a[c]=n[s];return a}function se(e,t){for(var n="";--t>=0;)n+=e;return n}function ce(e,t,n,r){var i=n||" ",o=e+"",a=t-o.length;return a<=0?o:"left"===r?se(i,a)+o:"center"===r?se(i,~~(a/2))+o+se(i,Math.ceil(a/2)):o+se(i,a)}function le(e){return null==e||""===e?null:!(!e||"false"===e||"0"===e)&&!!e}function de(e){return ie(e)?e:re(e)?e:Date.parse(e)}function fe(e,t){return t=t||de,null==e||""===e?null:t(e)}function pe(e){return null==e||""===e?null:e+""}function ye(e){for(var t={},n=0,r=e.length;n<r;++n)t[e[n]]=!0;return t}function ge(e,t,n,r){var i=null!=r?r:"…",o=e+"",a=o.length,u=Math.max(0,t-i.length);return a<=t?o:"left"===n?i+o.slice(a-u):"center"===n?o.slice(0,Math.ceil(u/2))+i+o.slice(a-~~(u/2)):o.slice(0,u)+i}function he(e,t,n){if(e){var r,i=0,o=e.length;if(t)for(;i<o;++i)(r=t(e[i]))&&n(r,i,e);else e.forEach(n)}}function me(e,t){return t?void(e[cc]=t):e&&e[cc]||null}function Ee(e){return Bi.keys(e)}function Te(e){return"["+e+"]"}function ve(e,t){e=Bi.array(e),t=Bi.$(t);var n,r,i;if(e[cc]&&(n=t(e[cc]),Bi.isString(n)))return n;for(r=0,i=e.length;!Bi.isValid(n)&&r<i;++r)n=t?t(e[r]):e[r];return Bi.isDate(n)?"date":Bi.isNumber(n)?"number":Bi.isBoolean(n)?"boolean":Bi.isString(n)?"string":null}function _e(e,t){if(e.length){var n=t?Bi.identity:(t=Ee(e[0]),Te);return t.reduce(function(t,r){return t[r]=ve(e,n(r)),t},{})}}function Oe(e,t){e=Bi.array(e),t=Bi.$(t);var n,r,i,o=["boolean","integer","number","date"];for(n=0;n<e.length;++n){for(i=t?t(e[n]):e[n],r=0;r<o.length;++r)Bi.isValid(i)&&!dc[o[r]](i)&&(o.splice(r,1),r-=1);if(0===o.length)return"string"}return o[0]}function Se(e,t){var n=t?Bi.identity:(t=Ee(e[0]),Te);return t.reduce(function(t,r){return t[r]=Oe(e,n(r)),t},{})}function Ne(e){return Ac.setTime(+e),Ac}function Ae(e,t,n,r,i,o){var a={type:e,date:t,unit:n};return r?a.step=r:a.minstep=1,null!=i&&(a.min=i),null!=o&&(a.max=o),a}function Pe(e,t,n,r,i,o){return Ae(e,function(e){return t.offset(n,e)},function(e){return t.count(n,e)},r,i,o)}function Ce(e,t,n,r){var i,o,a,u=Rc[0];for(i=1,o=Rc.length;i<o;++i)if(u=Rc[i],t>u[0]){if(a=t/u[0],a>r)return e[Rc[i-1][1]];if(a>=n)return e[u[1]]}return e[Rc[o-1][1]]}function Ie(e){var t,n,r={};for(t=0,n=e.length;t<n;++t)r[e[t].type]=e[t];return r.find=function(t,n,r){return Ce(e,t,n,r)},r}function be(e){if(!e)throw Error("Missing binning options.");var t,n,r,i,o,a,u,s=e.maxbins||15,c=e.base||10,l=Math.log(c),d=e.div||[5,2],f=e.min,p=e.max,y=p-f;if(e.step)t=e.step;else if(e.steps)t=e.steps[Math.min(e.steps.length-1,Re(e.steps,y/s,0,e.steps.length))];else{for(n=Math.ceil(Math.log(s)/l),r=e.minstep||0,t=Math.max(r,Math.pow(c,Math.round(Math.log(y)/l)-n));Math.ceil(y/t)>s;)t*=c;for(a=0;a<d.length;++a)o=t/d[a],o>=r&&y/o<=s&&(t=o)}return o=Math.log(t),i=o>=0?0:~~(-o/l)+1,u=Math.pow(c,-i-1),f=Math.min(f,Math.floor(f/t+u)*t),p=Math.ceil(p/t)*t,{start:f,stop:p,step:t,unit:{precision:i},value:De,index:Le}}function Re(e,t,n,r){for(;n<r;){var i=n+r>>>1;Bi.cmp(e[i],t)<0?n=i+1:r=i}return n}function De(e){return this.step*Math.floor(e/this.step+xc)}function Le(e){return Math.floor((e-this.start)/this.step+xc)}function Me(e){return this.unit.date(De.call(this,e))}function Ue(e){return Le.call(this,this.unit.unit(e))}var xe,Fe,we,ke,je=Object.freeze({get default(){return Xs},get __moduleExports(){return qs},get isValueQuery(){return $s},get isFieldQuery(){return Js},get isAutoCountQuery(){return Zs},get isDisabledAutoCountQuery(){return ec},get isEnabledAutoCountQuery(){return tc},get toEncoding(){return nc},get toValueDef(){return rc},get toFieldDef(){return ic},get isContinuous(){return oc},get isMeasure(){return ac},get isDimension(){return uc},get scaleType(){return sc}}),Ge="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Be=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},He=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},Ye=Object.freeze({__extends:r,__assign:He,__rest:i,__decorate:o,__param:a,__metadata:u,__awaiter:s,__generator:c,__exportStar:l,__values:d,__read:f,__spread:p,__await:y,__asyncGenerator:g,__asyncDelegator:h,__asyncValues:m,__makeTemplateObject:E,__importStar:T,__importDefault:v}),We={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},Qe=function(e){throw{name:"SyntaxError",message:e,at:xe,text:we}},ze=function(e){return e&&e!==Fe&&Qe("Expected '"+e+"' instead of '"+Fe+"'"),Fe=we.charAt(xe),xe+=1,Fe},Ve=function(){var e,t="";for("-"===Fe&&(t="-",ze("-"));Fe>="0"&&Fe<="9";)t+=Fe,ze();if("."===Fe)for(t+=".";ze()&&Fe>="0"&&Fe<="9";)t+=Fe;if("e"===Fe||"E"===Fe)for(t+=Fe,ze(),"-"!==Fe&&"+"!==Fe||(t+=Fe,ze());Fe>="0"&&Fe<="9";)t+=Fe,ze();return e=+t,isFinite(e)?e:void Qe("Bad number")},Ke=function(){var e,t,n,r="";if('"'===Fe)for(;ze();){if('"'===Fe)return ze(),r;if("\\"===Fe)if(ze(),"u"===Fe){for(n=0,t=0;t<4&&(e=parseInt(ze(),16),isFinite(e));t+=1)n=16*n+e;r+=String.fromCharCode(n)}else{if("string"!=typeof We[Fe])break;r+=We[Fe]}else r+=Fe}Qe("Bad string")},qe=function(){for(;Fe&&Fe<=" ";)ze()},Xe=function(){switch(Fe){case"t":return ze("t"),ze("r"),ze("u"),ze("e"),!0;case"f":return ze("f"),ze("a"),ze("l"),ze("s"),ze("e"),!1;case"n":return ze("n"),ze("u"),ze("l"),ze("l"),null}Qe("Unexpected '"+Fe+"'")},$e=function(){var e=[];if("["===Fe){if(ze("["),qe(),"]"===Fe)return ze("]"),e;for(;Fe;){if(e.push(ke()),qe(),"]"===Fe)return ze("]"),e;ze(","),qe()}}Qe("Bad array")},Je=function(){var e,t={};if("{"===Fe){if(ze("{"),qe(),"}"===Fe)return ze("}"),t;for(;Fe;){if(e=Ke(),qe(),ze(":"),Object.hasOwnProperty.call(t,e)&&Qe('Duplicate key "'+e+'"'),t[e]=ke(),qe(),"}"===Fe)return ze("}"),t;ze(","),qe()}}Qe("Bad object")};ke=function(){switch(qe(),Fe){case"{":return Je();case"[":return $e();case'"':return Ke();case"-":return Ve();default:return Fe>="0"&&Fe<="9"?Ve():Xe()}};var Ze,et,tt,nt=function(e,t){var n;return we=e,xe=0,Fe=" ",n=ke(),qe(),Fe&&Qe("Syntax error"),"function"==typeof t?function r(e,n){var i,o,a=e[n];if(a&&"object"==typeof a)for(i in a)Object.prototype.hasOwnProperty.call(a,i)&&(o=r(a,i),void 0!==o?a[i]=o:delete a[i]);return t.call(e,n,a)}({"":n},""):n},rt=Object.freeze({"default":nt,__moduleExports:nt}),it=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,ot={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},at=function(e,t,n){var r;if(Ze="",et="","number"==typeof n)for(r=0;r<n;r+=1)et+=" ";else"string"==typeof n&&(et=n);if(tt=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return O("",{"":e})},ut=Object.freeze({"default":at,__moduleExports:at}),st=rt&&nt||rt,ct=ut&&at||ut,lt=st,dt=ct,ft={parse:lt,stringify:dt},pt=Object.freeze({"default":ft,__moduleExports:ft,parse:lt,stringify:dt}),yt=pt&&ft||pt,gt="undefined"!=typeof JSON?JSON:yt,ht=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var n=t.space||"";"number"==typeof n&&(n=Array(n+1).join(" "));var r="boolean"==typeof t.cycles&&t.cycles,i=t.replacer||function(e,t){return t},o=t.cmp&&function(e){return function(t){return function(n,r){var i={key:n,value:t[n]},o={key:r,value:t[r]};return e(i,o)}}}(t.cmp),a=[];return function u(e,t,s,c){var l=n?"\n"+new Array(c+1).join(n):"",d=n?": ":":";if(s&&s.toJSON&&"function"==typeof s.toJSON&&(s=s.toJSON()),s=i.call(e,t,s),void 0!==s){if("object"!=typeof s||null===s)return gt.stringify(s);if(mt(s)){for(var f=[],p=0;p<s.length;p++){var y=u(s,p,s[p],c+1)||gt.stringify(null);f.push(l+n+y)}return"["+f.join(",")+l+"]"}if(a.indexOf(s)!==-1){if(r)return gt.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}a.push(s);for(var g=Et(s).sort(o&&o(s)),f=[],p=0;p<g.length;p++){var t=g[p],h=u(s,t,s[t],c+1);if(h){var m=gt.stringify(t)+d+h;f.push(l+n+m)}}return a.splice(a.indexOf(s),1),"{"+f.join(",")+l+"}"}}({"":e},"",e,0)},mt=Array.isArray||function(e){return"[object Array]"==={}.toString.call(e)},Et=Object.keys||function(e){var t=Object.prototype.hasOwnProperty||function(){return!0},n=[];for(var r in e)t.call(e,r)&&n.push(r);return n},Tt=Object.freeze({"default":ht,__moduleExports:ht}),vt=Array.isArray,_t=[],Ot=D("id"),St=S(function(e){return e},_t,"identity"),Nt=S(function(){return 0},_t,"zero"),At=S(function(){return 1},_t,"one"),Pt=S(function(){return!0},_t,"true"),Ct=S(function(){return!1},_t,"false"),It=0,bt=1,Rt=2,Dt=3,Lt=4,Mt={},Ut=Object.freeze({accessor:S,accessorName:N,accessorFields:A,id:Ot,identity:St,zero:Nt,one:At,truthy:Pt,falsy:Ct,logger:M,None:It,Error:bt,Warn:Rt,Info:Dt,Debug:Lt,panLinear:G,panLog:B,panPow:H,zoomLinear:W,zoomLog:Q,zoomPow:z,array:V,compare:q,constant:X,debounce:$,error:P,extend:J,extentIndex:Z,fastmap:ee,field:D,inherits:te,isArray:vt,isBoolean:ne,isDate:re,isFunction:K,isNumber:ie,isObject:I,isRegExp:oe,isString:b,key:ae,merge:ue,pad:ce,peek:U,repeat:se,splitAccessPath:C,stringValue:R,toBoolean:le,toDate:fe,toNumber:x,toString:pe,toSet:ye,truncate:ge,visitArray:he}),xt=n(function(e,t){function n(e){return!!e.or}function r(e){return!!e.and}function i(e){return!!e.not}function o(e,t){if(i(e))o(e.not,t);else if(r(e))for(var a=0,u=e.and;a<u.length;a++){var s=u[a];o(s,t)}else if(n(e))for(var c=0,l=e.or;c<l.length;c++){var s=l[c];o(s,t)}else t(e)}function a(e,t){return i(e)?{not:a(e.not,t)}:r(e)?{and:e.and.map(function(e){return a(e,t)})}:n(e)?{or:e.or.map(function(e){return a(e,t)})}:t(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.isLogicalOr=n,t.isLogicalAnd=r,t.isLogicalNot=i,t.forEachLeave=o,t.normalizeLogicalOperand=a}),Ft=t(xt),wt=xt.isLogicalOr,kt=xt.isLogicalAnd,jt=xt.isLogicalNot,Gt=xt.forEachLeave,Bt=xt.normalizeLogicalOperand,Ht=Object.freeze({"default":Ft,__moduleExports:xt,isLogicalOr:wt,isLogicalAnd:kt,isLogicalNot:jt,forEachLeave:Gt,normalizeLogicalOperand:Bt}),Yt=Tt&&ht||Tt,Wt=Ut&&void 0||Ut,Qt=Ht&&Ft||Ht,zt=n(function(e,t){function n(e,t){for(var n={},r=0,i=t;r<i.length;r++){var o=i[r];e.hasOwnProperty(o)&&(n[o]=e[o])}return n}function r(e,t){for(var n=v(e),r=0,i=t;r<i.length;r++){var o=i[r];delete n[o]}return n}function i(e){if(Wt.isNumber(e))return e;var t=Wt.isString(e)?e:C(e);if(t.length<100)return t;for(var n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);n=(n<<5)-n+i,n&=n}return n}function o(e,t){return e.indexOf(t)>-1}function a(e,t){return e.filter(function(e){return!o(t,e)})}function u(e,t){return e.concat(a(t,e))}function s(e,t){for(var n=0,r=0;r<e.length;r++)if(t(e[r],r,n++))return!0;return!1}function c(e,t){for(var n=0,r=0;r<e.length;r++)if(!t(e[r],r,n++))return!1;return!0}function l(e){return[].concat.apply([],e)}function d(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=0,i=t;r<i.length;r++){var o=i[r];e=f(e,o)}return e}function f(e,t){if("object"!=typeof t||null===t)return e;for(var n in t)t.hasOwnProperty(n)&&void 0!==t[n]&&("object"!=typeof t[n]||Wt.isArray(t[n])||null===t[n]?e[n]=t[n]:"object"!=typeof e[n]||null===e[n]?e[n]=d(Wt.isArray(t[n].constructor)?[]:{},t[n]):d(e[n],t[n]));return e}function p(e,t){for(var n,r=[],i={},o=0,a=e;o<a.length;o++){var u=a[o];n=t(u),n in i||(i[n]=1,r.push(u))}return r}function y(e,t){for(var n in e)if(e.hasOwnProperty(n)&&t[n]&&e[n]&&t[n]!==e[n])return!0;return!1}function g(e,t){for(var n in e)if(n in t)return!0;return!1}function h(e){return!isNaN(e)}function m(e,t){if(e.length!==t.length)return!0;e.sort(),t.sort();for(var n=0;n<e.length;n++)if(t[n]!==e[n])return!0;return!1}function E(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t}function T(e){return t.keys(e)}function v(e){return JSON.parse(JSON.stringify(e))}function _(e){return e===!0||e===!1}function O(e){var t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function S(e,t){return Qt.isLogicalNot(e)?"!("+S(e.not,t)+")":Qt.isLogicalAnd(e)?"("+e.and.map(function(e){return S(e,t)}).join(") && (")+")":Qt.isLogicalOr(e)?"("+e.or.map(function(e){return S(e,t)}).join(") || (")+")":t(e)}function N(e,t){if(0===t.length)return!0;var n=t.shift();return N(e[n],t)&&delete e[n],0===Object.keys(e).length}function A(e){return e.charAt(0).toUpperCase()+e.substr(1)}function P(e){return"["+Wt.splitAccessPath(e).map(Wt.stringValue).join("][")+"]"}Object.defineProperty(t,"__esModule",{value:!0});var C=Yt["default"]||Yt;t.pick=n,t.omit=r,t.stringify=C,t.hash=i,t.contains=o,t.without=a,t.union=u,t.some=s,t.every=c,t.flatten=l,t.mergeDeep=d,t.unique=p,t.differ=y,t.hasIntersection=g,t.isNumeric=h,t.differArray=m,t.keys=Object.keys,t.vals=E,t.flagKeys=T,t.duplicate=v,t.isBoolean=_,t.varName=O,t.logicalExpr=S,t.deleteNestedProperty=N,t.titlecase=A,t.accessPath=P}),Vt=t(zt),Kt=zt.pick,qt=zt.omit,Xt=zt.stringify,$t=zt.hash,Jt=zt.contains,Zt=zt.without,en=zt.union,tn=zt.some,nn=zt.every,rn=zt.flatten,on=zt.mergeDeep,an=zt.unique,un=zt.differ,sn=zt.hasIntersection,cn=zt.isNumeric,ln=zt.differArray,dn=zt.keys,fn=zt.vals,pn=zt.flagKeys,yn=zt.duplicate,gn=zt.isBoolean,hn=zt.varName,mn=zt.logicalExpr,En=zt.deleteNestedProperty,Tn=zt.titlecase,vn=zt.accessPath,_n=Object.freeze({"default":Vt,__moduleExports:zt,pick:Kt,omit:qt,stringify:Xt,hash:$t,contains:Jt,without:Zt,union:en,some:tn,every:nn,flatten:rn,mergeDeep:on,unique:an,differ:un,hasIntersection:sn,isNumeric:cn,differArray:ln,keys:dn,vals:fn,flagKeys:pn,duplicate:yn,isBoolean:gn,varName:hn,logicalExpr:mn,deleteNestedProperty:En,titlecase:Tn,accessPath:vn}),On=Ye&&void 0||Ye,Sn=_n&&Vt||_n,Nn=n(function(e,t){function n(e){return"color"===e||"fill"===e||"stroke"===e}function r(e){return!!d[e]}function i(e){return!!h[e]}function o(e,t){return t in a(e)}function a(e){switch(e){case t.COLOR:case t.FILL:case t.STROKE:case t.DETAIL:case t.KEY:case t.TOOLTIP:case t.HREF:case t.ORDER:case t.OPACITY:case t.ROW:case t.COLUMN:return{point:!0,tick:!0,rule:!0,circle:!0,square:!0,bar:!0,rect:!0,line:!0,trail:!0,area:!0,text:!0,geoshape:!0};case t.X:case t.Y:case t.LATITUDE:case t.LONGITUDE:return{point:!0,tick:!0,rule:!0,circle:!0,square:!0,bar:!0,rect:!0,line:!0,trail:!0,area:!0,text:!0};case t.X2:case t.Y2:case t.LATITUDE2:case t.LONGITUDE2:return{rule:!0,bar:!0,rect:!0,area:!0};case t.SIZE:return{point:!0,tick:!0,rule:!0,circle:!0,square:!0,bar:!0,text:!0,line:!0,trail:!0};case t.SHAPE:return{point:!0,geoshape:!0};case t.TEXT:return{text:!0}}}function u(e){switch(e){case t.X:case t.Y:case t.SIZE:case t.OPACITY:case t.X2:case t.Y2:return"continuous";case t.ROW:case t.COLUMN:case t.SHAPE:case t.TEXT:case t.TOOLTIP:case t.HREF:return"discrete";case t.COLOR:case t.FILL:case t.STROKE:return"flexible";case t.LATITUDE:case t.LONGITUDE:case t.LATITUDE2:case t.LONGITUDE2:case t.DETAIL:case t.KEY:case t.ORDER:return}throw new Error("rangeType not implemented for "+e)}Object.defineProperty(t,"__esModule",{value:!0});var s;!function(e){e.ROW="row",e.COLUMN="column",e.X="x",e.Y="y",e.X2="x2",e.Y2="y2",e.LATITUDE="latitude",e.LONGITUDE="longitude",e.LATITUDE2="latitude2",e.LONGITUDE2="longitude2",e.COLOR="color",e.FILL="fill",e.STROKE="stroke",e.SHAPE="shape",e.SIZE="size",e.OPACITY="opacity",e.TEXT="text",e.ORDER="order",e.DETAIL="detail",e.KEY="key",e.TOOLTIP="tooltip",e.HREF="href"}(s=t.Channel||(t.Channel={})),t.X=s.X,t.Y=s.Y,t.X2=s.X2,t.Y2=s.Y2,t.LATITUDE=s.LATITUDE,t.LATITUDE2=s.LATITUDE2,t.LONGITUDE=s.LONGITUDE,t.LONGITUDE2=s.LONGITUDE2,t.ROW=s.ROW,t.COLUMN=s.COLUMN,t.SHAPE=s.SHAPE,t.SIZE=s.SIZE,t.COLOR=s.COLOR,t.FILL=s.FILL,t.STROKE=s.STROKE,t.TEXT=s.TEXT,t.DETAIL=s.DETAIL,t.KEY=s.KEY,t.ORDER=s.ORDER,t.OPACITY=s.OPACITY,t.TOOLTIP=s.TOOLTIP,t.HREF=s.HREF,t.GEOPOSITION_CHANNEL_INDEX={longitude:1,longitude2:1,latitude:1,latitude2:1},t.GEOPOSITION_CHANNELS=Sn.flagKeys(t.GEOPOSITION_CHANNEL_INDEX);var c=On.__assign({x:1,y:1,x2:1,y2:1},t.GEOPOSITION_CHANNEL_INDEX,{color:1,fill:1,stroke:1,opacity:1,size:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1});t.isColorChannel=n;var l={row:1,column:1},d=On.__assign({},c,l);t.CHANNELS=Sn.flagKeys(d);var f=(d.order,d.detail,On.__rest(d,["order","detail"]));t.SINGLE_DEF_CHANNELS=Sn.flagKeys(f),t.isChannel=r,t.UNIT_CHANNELS=Sn.flagKeys(c);var p=(c.x,c.y,c.x2,c.y2,c.latitude,c.longitude,c.latitude2,c.longitude2,On.__rest(c,["x","y","x2","y2","latitude","longitude","latitude2","longitude2"]));t.NONPOSITION_CHANNELS=Sn.flagKeys(p);var y={x:1,y:1};t.POSITION_SCALE_CHANNELS=Sn.flagKeys(y);var g=(p.text,p.tooltip,p.href,p.detail,p.key,p.order,On.__rest(p,["text","tooltip","href","detail","key","order"]));t.NONPOSITION_SCALE_CHANNELS=Sn.flagKeys(g);var h=On.__assign({},y,g);t.SCALE_CHANNELS=Sn.flagKeys(h),t.isScaleChannel=i,t.supportMark=o,t.getSupportedMark=a,t.rangeType=u}),An=t(Nn),Pn=Nn.Channel,Cn=Nn.X,In=Nn.Y,bn=Nn.X2,Rn=Nn.Y2,Dn=Nn.LATITUDE,Ln=Nn.LATITUDE2,Mn=Nn.LONGITUDE,Un=Nn.LONGITUDE2,xn=Nn.ROW,Fn=Nn.COLUMN,wn=Nn.SHAPE,kn=Nn.SIZE,jn=Nn.COLOR,Gn=Nn.FILL,Bn=Nn.STROKE,Hn=Nn.TEXT,Yn=Nn.DETAIL,Wn=Nn.KEY,Qn=Nn.ORDER,zn=Nn.OPACITY,Vn=Nn.TOOLTIP,Kn=Nn.HREF,qn=Nn.GEOPOSITION_CHANNEL_INDEX,Xn=Nn.GEOPOSITION_CHANNELS,$n=Nn.isColorChannel,Jn=Nn.CHANNELS,Zn=Nn.SINGLE_DEF_CHANNELS,er=Nn.isChannel,tr=Nn.UNIT_CHANNELS,nr=Nn.NONPOSITION_CHANNELS,rr=Nn.POSITION_SCALE_CHANNELS,ir=Nn.NONPOSITION_SCALE_CHANNELS,or=Nn.SCALE_CHANNELS,ar=Nn.isScaleChannel,ur=Nn.supportMark,sr=Nn.getSupportedMark,cr=Nn.rangeType,lr=Object.freeze({"default":An,__moduleExports:Nn,Channel:Pn,X:Cn,Y:In,X2:bn,Y2:Rn,LATITUDE:Dn,LATITUDE2:Ln,LONGITUDE:Mn,LONGITUDE2:Un,ROW:xn,COLUMN:Fn,SHAPE:wn,SIZE:kn,COLOR:jn,FILL:Gn,STROKE:Bn,TEXT:Hn,DETAIL:Yn,KEY:Wn,ORDER:Qn,OPACITY:zn,TOOLTIP:Vn,HREF:Kn,GEOPOSITION_CHANNEL_INDEX:qn,GEOPOSITION_CHANNELS:Xn,isColorChannel:$n,CHANNELS:Jn,SINGLE_DEF_CHANNELS:Zn,isChannel:er,UNIT_CHANNELS:tr,NONPOSITION_CHANNELS:nr,POSITION_SCALE_CHANNELS:rr,NONPOSITION_SCALE_CHANNELS:ir,SCALE_CHANNELS:or,isScaleChannel:ar,supportMark:ur,getSupportedMark:sr,rangeType:cr}),dr=n(function(e,t){function n(e){return!!i[e]}Object.defineProperty(t,"__esModule",{value:!0}),t.AXIS_PARTS=["domain","grid","labels","ticks","title"],t.AXIS_PROPERTY_TYPE={grid:"grid",gridScale:"grid",domain:"main",labels:"main",labelFlush:"main",labelOverlap:"main",minExtent:"main",maxExtent:"main",offset:"main",ticks:"main",title:"main",values:"both",scale:"both",zindex:"both"};var r={orient:1,domain:1,format:1,grid:1,labelBound:1,labelFlush:1,labelPadding:1,labels:1,labelOverlap:1,maxExtent:1,minExtent:1,offset:1,position:1,tickCount:1,ticks:1,tickSize:1,title:1,titlePadding:1,values:1,zindex:1},i=On.__assign({},r,{encoding:1,labelAngle:1,titleMaxLength:1}),o=On.__assign({scale:1},r,{gridScale:1,encode:1});t.isAxisProperty=n,t.VG_AXIS_PROPERTIES=Sn.flagKeys(o),t.AXIS_PROPERTIES=Sn.flagKeys(i)}),fr=t(dr),pr=dr.AXIS_PARTS,yr=dr.AXIS_PROPERTY_TYPE,gr=dr.isAxisProperty,hr=dr.VG_AXIS_PROPERTIES,mr=dr.AXIS_PROPERTIES,Er=Object.freeze({"default":fr,__moduleExports:dr,AXIS_PARTS:pr,AXIS_PROPERTY_TYPE:yr,isAxisProperty:gr,VG_AXIS_PROPERTIES:hr,AXIS_PROPERTIES:mr}),Tr=n(function(e,t){function n(e){return function(){c=new l,e(c),i()}}function r(e){return c=e}function i(){return c=s}function o(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];c.warn.apply(c,arguments)}function a(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];c.info.apply(c,arguments)}function u(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];c.debug.apply(c,arguments)}Object.defineProperty(t,"__esModule",{value:!0});var s=Wt.logger(Wt.Warn),c=s,l=function(){function e(){this.warns=[],this.infos=[],this.debugs=[]}return e.prototype.level=function(){return this},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(n=this.warns).push.apply(n,e),this;var n},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(n=this.infos).push.apply(n,e),this;var n},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(n=this.debugs).push.apply(n,e),this;var n},e}();t.LocalLogger=l,t.wrap=n,t.set=r,t.reset=i,t.warn=o,t.info=a,t.debug=u;var d;!function(e){function t(e){return'Cannot project a selection on encoding channel "'+e+'", which has no field.'}function n(e){return'The "nearest" transform is not supported for '+e+" marks."}function r(e){return'Cannot find a selection named "'+e+'"'}function i(e){return'Unknown repeated value "'+e+'".'}function o(e){return'Cannot set title "anchor" for a '+e+" spec"}function a(e){return'Unrecognized parse "'+e+'".'}function u(e,t,n){return'An ancestor parsed field "'+e+'" as '+n+" but a child wants to parse the field as "+t+"."}function s(e){return"Ignoring an invalid transform: "+Sn.stringify(e)+"."}function c(e){return"Layer's shared "+e.join(",")+" channel "+(1===e.length?"is":"are")+" overriden"}function l(e){var t=e.parentProjection,n=e.projection;return"Layer's shared projection "+Sn.stringify(t)+" is overridden by a child projection "+Sn.stringify(n)+"."}function d(e,t,n){return"Channel "+e+" is a "+t+". Converted to {value: "+Sn.stringify(n)+"}."}function f(e){return'Invalid field type "'+e+'"'}function p(e,t,n){var r=n.scaleType?n.scaleType+" scale":n.zeroFalse?"scale with zero=false":"scale with custom domain that excludes zero";return"A "+r+" is used with "+e+" mark. This can be misleading as the "+("x"===t?"width":"height")+" of the "+e+" can be arbitrary based on the scale domain. You may want to use point mark instead."}function y(e,t){return'Invalid field type "'+e+'" for aggregate: "'+t+'", using "quantitative" instead.';
}function g(e){return'Invalid aggregation operator "'+e+'"'}function h(e,t,n){return'Invalid field type "'+e+'" for channel "'+t+'", using "'+n+'" instead.'}function m(e,t){var n=t.fill,r=t.stroke;return"Dropping color "+e+" as the plot also has "+(n&&r?"fill and stroke":n?"fill":"stroke")}function E(e,t){return"Dropping "+Sn.stringify(e)+' from channel "'+t+'" since it does not contain data field or value.'}function T(e,t,n){return e+"-encoding with type "+t+" is deprecated. Replacing with "+n+"-encoding."}function v(e,t,n){return e+' dropped as it is incompatible with "'+t+'"'+(n?" when "+n:"")+"."}function _(e){return e+"-encoding is dropped as "+e+" is not a valid encoding channel."}function O(e){return e+" encoding should be discrete (ordinal / nominal / binned)."}function S(e,t){return'Using discrete channel "'+e+'" to encode "'+t+'" field can be misleading as it does not encode '+("ordinal"===t?"order":"magnitude")+"."}function N(e,t){var n=e&&t?"x2 and y2":e?"x2":"y2";return"Line mark is for continuous lines and thus cannot be used with "+n+". We will use the rule mark (line segments) instead."}function A(e){return'Cannot clearly determine orientation for "'+e+'" since both x and y channel encode continuous fields. In this case, we use vertical by default'}function P(e){return'Cannot clearly determine orientation for "'+e+'" since both x and y channel encode discrete or empty fields.'}function C(e,t){return'Specified orient "'+e+'" overridden with "'+t+'"'}function I(e){return'Cannot use the scale property "'+e+'" with non-color channel.'}function b(e){return"Using unaggregated domain with raw field has no effect ("+Sn.stringify(e)+")."}function R(e){return'Unaggregated domain not applicable for "'+e+'" since it produces values outside the origin domain of the source data.'}function D(e){return"Unaggregated domain is currently unsupported for log scale ("+Sn.stringify(e)+")."}function L(e){return"Using size field when "+e+"-channel has a band scale is not supported."}function M(e){return'Cannot apply size to non-oriented mark "'+e+'".'}function U(e){return'rangeStep for "'+e+'" is dropped as top-level '+("x"===e?"width":"height")+" is provided."}function x(e,t,n){return'Channel "'+e+'" does not work with "'+t+'" scale. We are using "'+n+'" scale instead.'}function F(e,t){return'FieldDef does not work with "'+e+'" scale. We are using "'+t+'" scale instead.'}function w(e,t,n){return n+"-scale's \""+t+'" is dropped as it does not work with '+e+" scale."}function k(e,t){return'Scale type "'+t+'" does not work with mark "'+e+'".'}function j(e,t,n,r){return"Conflicting "+t+' property "'+e+'" ('+Sn.stringify(n)+" and "+Sn.stringify(r)+").  Using "+Sn.stringify(n)+"."}function G(e){return'Setting the scale to be independent for "'+e+'" means we also have to set the guide (axis or legend) to be independent.'}function B(e){return"Cannot set "+e+'-scale\'s "domain" as it is binned. Please use "bin"\'s "extent" instead.'}function H(e){return"Dropping sort property "+Sn.stringify(e)+" as unioned domains only support boolean or op 'count'."}function Y(e){return'Cannot stack "'+e+'" if there is already "'+e+'2"'}function W(e){return"Cannot stack non-linear scale ("+e+")"}function Q(e){return'Stacking is applied even though the aggregate function is non-summative ("'+e+'")'}function z(e,t){return"Invalid "+e+": "+Sn.stringify(t)}function V(e){return'Time unit "'+e+'" is not supported. We are replacing it with '+e.replace("day","date")+"."}function K(e){return"Dropping day from datetime "+Sn.stringify(e)+" as day cannot be combined with other units."}e.INVALID_SPEC="Invalid spec",e.FIT_NON_SINGLE='Autosize "fit" only works for single views and layered views.',e.CANNOT_FIX_RANGE_STEP_WITH_FIT='Cannot use a fixed value of "rangeStep" when "autosize" is "fit".',e.cannotProjectOnChannelWithoutField=t,e.nearestNotSupportForContinuous=n,e.selectionNotFound=r,e.SCALE_BINDINGS_CONTINUOUS="Scale bindings are currently only supported for scales with unbinned, continuous domains.",e.noSuchRepeatedValue=i,e.CONCAT_CANNOT_SHARE_AXIS="Axes cannot be shared in concatenated views.",e.REPEAT_CANNOT_SHARE_AXIS="Axes cannot be shared in repeated views.",e.cannotSetTitleAnchor=o,e.unrecognizedParse=a,e.differentParse=u,e.invalidTransformIgnored=s,e.NO_FIELDS_NEEDS_AS='If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.',e.encodingOverridden=c,e.projectionOverridden=l,e.primitiveChannelDef=d,e.invalidFieldType=f,e.nonZeroScaleUsedWithLengthMark=p,e.invalidFieldTypeForCountAggregate=y,e.invalidAggregate=g,e.emptyOrInvalidFieldType=h,e.droppingColor=m,e.emptyFieldDef=E,e.latLongDeprecated=T,e.LINE_WITH_VARYING_SIZE="Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead.",e.incompatibleChannel=v,e.invalidEncodingChannel=_,e.facetChannelShouldBeDiscrete=O,e.discreteChannelCannotEncode=S,e.BAR_WITH_POINT_SCALE_AND_RANGESTEP_NULL="Bar mark should not be used with point scale when rangeStep is null. Please use band scale instead.",e.lineWithRange=N,e.unclearOrientContinuous=A,e.unclearOrientDiscreteOrEmpty=P,e.orientOverridden=C,e.CANNOT_UNION_CUSTOM_DOMAIN_WITH_FIELD_DOMAIN="custom domain scale cannot be unioned with default field-based domain",e.cannotUseScalePropertyWithNonColor=I,e.unaggregateDomainHasNoEffectForRawField=b,e.unaggregateDomainWithNonSharedDomainOp=R,e.unaggregatedDomainWithLogScale=D,e.cannotUseSizeFieldWithBandSize=L,e.cannotApplySizeToNonOrientedMark=M,e.rangeStepDropped=U,e.scaleTypeNotWorkWithChannel=x,e.scaleTypeNotWorkWithFieldDef=F,e.scalePropertyNotWorkWithScaleType=w,e.scaleTypeNotWorkWithMark=k,e.mergeConflictingProperty=j,e.independentScaleMeansIndependentGuide=G,e.conflictedDomain=B,e.domainSortDropped=H,e.UNABLE_TO_MERGE_DOMAINS="Unable to merge domains",e.MORE_THAN_ONE_SORT="Domains that should be unioned has conflicting sort properties. Sort will be set to true.",e.INVALID_CHANNEL_FOR_AXIS="Invalid channel for axis.",e.cannotStackRangedMark=Y,e.cannotStackNonLinearScale=W,e.stackNonSummativeAggregate=Q,e.invalidTimeUnit=z,e.dayReplacedWithDate=V,e.droppedDay=K}(d=t.message||(t.message={}))}),vr=t(Tr),_r=Tr.LocalLogger,Or=Tr.wrap,Sr=Tr.set,Nr=Tr.reset,Ar=Tr.warn,Pr=Tr.info,Cr=Tr.debug,Ir=Tr.message,br=Object.freeze({"default":vr,__moduleExports:Tr,LocalLogger:_r,wrap:Or,set:Sr,reset:Nr,warn:Ar,info:Pr,debug:Cr,message:Ir}),Rr=lr&&An||lr,Dr=br&&vr||br,Lr=n(function(e,t){function n(e,t){var n=y[e],r=y[t];return n===r||"ordinal-position"===n&&"time"===r||"ordinal-position"===r&&"time"===n}function r(e){return g[e]}function i(e){return e in E}function o(e){return e in T}function a(e){return e in m}function u(e){return e in h}function s(e){return e&&!!e.name}function c(e){return e&&e.selection}function l(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":return Sn.contains(["sequential","ordinal","bin-ordinal","quantile","quantize"],e);case"interpolate":return Sn.contains(["linear","bin-linear","pow","log","sqrt","utc","time"],e);case"round":return u(e)||"band"===e||"point"===e;case"padding":return u(e)||Sn.contains(["point","band"],e);case"paddingOuter":case"rangeStep":return Sn.contains(["point","band"],e);case"paddingInner":return"band"===e;case"clamp":return u(e)||"sequential"===e;case"nice":return u(e)||"sequential"===e||"quantize"===e;case"exponent":return"pow"===e;case"base":return"log"===e;case"zero":return a(e)&&!Sn.contains(["log","time","utc","bin-linear","threshold","quantile"],e)}throw new Error("Invalid scale property "+t+".")}function d(e,t){switch(t){case"interpolate":case"scheme":if(!Rr.isColorChannel(e))return Dr.message.cannotUseScalePropertyWithNonColor(e);return;case"type":case"domain":case"range":case"base":case"exponent":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"rangeStep":case"reverse":case"round":case"clamp":case"zero":return}throw new Error('Invalid scale property "'+t+'".')}function f(e,t){switch(e){case Rr.Channel.X:case Rr.Channel.Y:case Rr.Channel.SIZE:case Rr.Channel.OPACITY:return u(t)||Sn.contains(["band","point"],t);case Rr.Channel.COLOR:case Rr.Channel.FILL:case Rr.Channel.STROKE:return"band"!==t;case Rr.Channel.SHAPE:return"ordinal"===t}return!1}Object.defineProperty(t,"__esModule",{value:!0});var p;!function(e){e.LINEAR="linear",e.BIN_LINEAR="bin-linear",e.LOG="log",e.POW="pow",e.SQRT="sqrt",e.TIME="time",e.UTC="utc",e.SEQUENTIAL="sequential",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.ORDINAL="ordinal",e.BIN_ORDINAL="bin-ordinal",e.POINT="point",e.BAND="band"}(p=t.ScaleType||(t.ScaleType={}));var y={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric","bin-linear":"bin-linear",time:"time",utc:"time",sequential:"sequential",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position"};t.SCALE_TYPES=Sn.keys(y),t.scaleCompatible=n;var g={linear:0,log:1,pow:1,sqrt:1,time:0,utc:0,point:10,band:11,"bin-linear":0,sequential:0,ordinal:0,"bin-ordinal":0};t.scaleTypePrecedence=r,t.CONTINUOUS_TO_CONTINUOUS_SCALES=["linear","bin-linear","log","pow","sqrt","time","utc"];var h=Wt.toSet(t.CONTINUOUS_TO_CONTINUOUS_SCALES);t.CONTINUOUS_DOMAIN_SCALES=t.CONTINUOUS_TO_CONTINUOUS_SCALES.concat(["sequential"]);var m=Wt.toSet(t.CONTINUOUS_DOMAIN_SCALES);t.DISCRETE_DOMAIN_SCALES=["ordinal","bin-ordinal","point","band"];var E=Wt.toSet(t.DISCRETE_DOMAIN_SCALES),T=Wt.toSet(["bin-linear","bin-ordinal"]);t.TIME_SCALE_TYPES=["time","utc"],t.hasDiscreteDomain=i,t.isBinScale=o,t.hasContinuousDomain=a,t.isContinuousToContinuous=u,t.defaultScaleConfig={textXRangeStep:90,rangeStep:21,pointPadding:.5,bandPaddingInner:.1,facetSpacing:16,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4},t.isExtendedScheme=s,t.isSelectionDomain=c;var v={type:1,domain:1,range:1,rangeStep:1,scheme:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1};t.SCALE_PROPERTIES=Sn.flagKeys(v);var _=On.__rest(v,["type","domain","range","rangeStep","scheme"]);t.NON_TYPE_DOMAIN_RANGE_VEGA_SCALE_PROPERTIES=Sn.flagKeys(_),t.scaleTypeSupportProperty=l,t.channelScalePropertyIncompatability=d,t.channelSupportScaleType=f}),Mr=t(Lr),Ur=Lr.ScaleType,xr=Lr.SCALE_TYPES,Fr=Lr.scaleCompatible,wr=Lr.scaleTypePrecedence,kr=Lr.CONTINUOUS_TO_CONTINUOUS_SCALES,jr=Lr.CONTINUOUS_DOMAIN_SCALES,Gr=Lr.DISCRETE_DOMAIN_SCALES,Br=Lr.TIME_SCALE_TYPES,Hr=Lr.hasDiscreteDomain,Yr=Lr.isBinScale,Wr=Lr.hasContinuousDomain,Qr=Lr.isContinuousToContinuous,zr=Lr.defaultScaleConfig,Vr=Lr.isExtendedScheme,Kr=Lr.isSelectionDomain,qr=Lr.SCALE_PROPERTIES,Xr=Lr.NON_TYPE_DOMAIN_RANGE_VEGA_SCALE_PROPERTIES,$r=Lr.scaleTypeSupportProperty,Jr=Lr.channelScalePropertyIncompatability,Zr=Lr.channelSupportScaleType,ei=Object.freeze({"default":Mr,__moduleExports:Lr,ScaleType:Ur,SCALE_TYPES:xr,scaleCompatible:Fr,scaleTypePrecedence:wr,CONTINUOUS_TO_CONTINUOUS_SCALES:kr,CONTINUOUS_DOMAIN_SCALES:jr,DISCRETE_DOMAIN_SCALES:Gr,TIME_SCALE_TYPES:Br,hasDiscreteDomain:Hr,isBinScale:Yr,hasContinuousDomain:Wr,isContinuousToContinuous:Qr,defaultScaleConfig:zr,isExtendedScheme:Vr,isSelectionDomain:Kr,SCALE_PROPERTIES:qr,NON_TYPE_DOMAIN_RANGE_VEGA_SCALE_PROPERTIES:Xr,scaleTypeSupportProperty:$r,channelScalePropertyIncompatability:Jr,channelSupportScaleType:Zr}),ti=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.defaultLegendConfig={};var n={entryPadding:1,format:1,offset:1,orient:1,padding:1,tickCount:1,title:1,type:1,values:1,zindex:1},r=On.__assign({},n,{opacity:1,shape:1,stroke:1,fill:1,size:1,encode:1});t.LEGEND_PROPERTIES=Sn.flagKeys(n),t.VG_LEGEND_PROPERTIES=Sn.flagKeys(r)}),ni=t(ti),ri=ti.defaultLegendConfig,ii=ti.LEGEND_PROPERTIES,oi=ti.VG_LEGEND_PROPERTIES,ai=Object.freeze({"default":ni,__moduleExports:ti,defaultLegendConfig:ri,LEGEND_PROPERTIES:ii,VG_LEGEND_PROPERTIES:oi}),ui=Er&&fr||Er,si=ei&&Mr||ei,ci=ai&&ni||ai,li=n(function(e,t){function n(e){return!!e.parent}function r(e){return e in c}function i(e){return l[e]}function o(e){return n(e)?e.parent+y+e.child:e}function a(e){var t=e.split(y);if(1===t.length)return e;if(2===t.length)return{parent:t[0],child:t[1]};throw"Invalid property key with "+t.length+" dots: "+e}function u(e,t){return(g[e]||{})[t]}function s(e){return r(e)||n(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.isEncodingNestedProp=n;var c={channel:1,aggregate:1,autoCount:1,bin:1,timeUnit:1,hasFn:1,sort:1,stack:1,field:1,type:1,format:1,scale:1,axis:1,legend:1,value:1};t.ENCODING_TOPLEVEL_PROPS=Sn.flagKeys(c),t.isEncodingTopLevelProperty=r;var l={bin:1,scale:1,sort:1,axis:1,legend:1};t.isEncodingNestedParent=i,t.BIN_CHILD_PROPS=["maxbins","divide","extent","base","step","steps","minstep"],t.SORT_CHILD_PROPS=["field","op","order"];var d=t.BIN_CHILD_PROPS.map(function(e){return{parent:"bin",child:e}});t.SORT_PROPS=t.SORT_CHILD_PROPS.map(function(e){return{parent:"sort",child:e}}),t.SCALE_PROPS=si.SCALE_PROPERTIES.map(function(e){return{parent:"scale",child:e}});var f=ui.AXIS_PROPERTIES.map(function(e){return{parent:"axis",child:e}}),p=ci.LEGEND_PROPERTIES.map(function(e){return{parent:"legend",child:e}});t.ENCODING_NESTED_PROPS=[].concat(d,t.SORT_PROPS,t.SCALE_PROPS,f,p),t.VIEW_PROPS=["width","height","background","padding","title"];var y=".";t.toKey=o,t.fromKey=a;var g=t.ENCODING_NESTED_PROPS.reduce(function(e,t){return e[t.parent]=e[t.parent]||[],e[t.parent][t.child]=t,e},{});t.getEncodingNestedProp=u,t.isEncodingProperty=s,t.ALL_ENCODING_PROPS=[].concat(t.ENCODING_TOPLEVEL_PROPS,t.ENCODING_NESTED_PROPS),t.DEFAULT_PROP_PRECEDENCE=["type","field","bin","timeUnit","aggregate","autoCount","channel","mark","stack","scale","sort","axis","legend"].concat(d,t.SCALE_PROPS,f,p,t.SORT_PROPS);var h;!function(e){e.MARK="mark",e.TRANSFORM="transform",e.STACK="stack",e.FORMAT="format",e.CHANNEL="channel",e.AGGREGATE="aggregate",e.AUTOCOUNT="autoCount",e.BIN="bin",e.HAS_FN="hasFn",e.TIMEUNIT="timeUnit",e.FIELD="field",e.TYPE="type",e.SORT="sort",e.SCALE="scale",e.AXIS="axis",e.LEGEND="legend",e.WIDTH="width",e.HEIGHT="height",e.BACKGROUND="background",e.PADDING="padding",e.TITLE="title"}(h=t.Property||(t.Property={}))}),di=t(li),fi=li.isEncodingNestedProp,pi=li.ENCODING_TOPLEVEL_PROPS,yi=li.isEncodingTopLevelProperty,gi=li.isEncodingNestedParent,hi=li.BIN_CHILD_PROPS,mi=li.SORT_CHILD_PROPS,Ei=li.SORT_PROPS,Ti=li.SCALE_PROPS,vi=li.ENCODING_NESTED_PROPS,_i=li.VIEW_PROPS,Oi=li.toKey,Si=li.fromKey,Ni=li.getEncodingNestedProp,Ai=li.isEncodingProperty,Pi=li.ALL_ENCODING_PROPS,Ci=li.DEFAULT_PROP_PRECEDENCE,Ii=li.Property,bi=Object.freeze({"default":di,__moduleExports:li,isEncodingNestedProp:fi,ENCODING_TOPLEVEL_PROPS:pi,isEncodingTopLevelProperty:yi,isEncodingNestedParent:gi,BIN_CHILD_PROPS:hi,SORT_CHILD_PROPS:mi,SORT_PROPS:Ei,SCALE_PROPS:Ti,ENCODING_NESTED_PROPS:vi,VIEW_PROPS:_i,toKey:Oi,fromKey:Si,getEncodingNestedProp:Ni,isEncodingProperty:Ai,ALL_ENCODING_PROPS:Pi,DEFAULT_PROP_PRECEDENCE:Ci,Property:Ii}),Ri=n(function(e){function t(e,t){var n,r="";for(n=0;n<e;++n)r+=t;return r}function n(e,t,n){var r=0,i=e.split(u);return e=n?(i=i.reverse()).filter(function(e){return r+=e.length,r<=t}).reverse():i.filter(function(e){return r+=e.length,r<=t}),e.length?e.join("").trim():i[0].slice(0,t)}var r=e.exports,i="__name__";r.namedfunc=function(e,t){return t[i]=e,t},r.name=function(e){return null==e?null:e[i]},r.identity=function(e){return e},r["true"]=r.namedfunc("true",function(){return!0}),r["false"]=r.namedfunc("false",function(){return!1}),r.duplicate=function(e){return JSON.parse(JSON.stringify(e))},r.equal=function(e,t){return JSON.stringify(e)===JSON.stringify(t)},r.extend=function(e){for(var t,n,r=1,i=arguments.length;r<i;++r){t=arguments[r];for(n in t)e[n]=t[n]}return e},r.length=function(e){return null!=e&&null!=e.length?e.length:null},r.keys=function(e){var t,n=[];for(t in e)n.push(t);return n},r.vals=function(e){var t,n=[];for(t in e)n.push(e[t]);return n},r.toMap=function(e,t){return(t=r.$(t))?e.reduce(function(e,n){return e[t(n)]=1,e},{}):e.reduce(function(e,t){return e[t]=1,e},{})},r.keystr=function(e){var t=e.length;if(!t)return"";for(var n=String(e[0]),r=1;r<t;++r)n+="|"+String(e[r]);return n};var o=Object.prototype.toString;r.isObject=function(e){return e===Object(e)},r.isFunction=function(e){return"[object Function]"===o.call(e)},r.isString=function(e){return"string"==typeof value||"[object String]"===o.call(e)},r.isArray=Array.isArray||function(e){return"[object Array]"===o.call(e)},r.isNumber=function(e){return"number"==typeof e||"[object Number]"===o.call(e)},r.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==o.call(e)},r.isDate=function(e){return"[object Date]"===o.call(e)},r.isValid=function(e){return null!=e&&e===e},r.isBuffer="function"==typeof Buffer&&Buffer.isBuffer||r["false"],r.number=function(e){return null==e||""===e?null:+e},r["boolean"]=function(e){return null==e||""===e?null:"false"!==e&&!!e},r.date=function(e,t){var n=t?t:Date;return null==e||""===e?null:n.parse(e)},r.array=function(e){return null!=e?r.isArray(e)?e:[e]:[]},r.str=function(e){return r.isArray(e)?"["+e.map(r.str)+"]":r.isObject(e)||r.isString(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e};var a=/\[(.*?)\]|[^.\[]+/g;r.field=function(e){return String(e).match(a).map(function(e){return"["!==e[0]?e:"'"!==e[1]&&'"'!==e[1]?e.slice(1,-1):e.slice(2,-2).replace(/\\(["'])/g,"$1")})},r.accessor=function(e){return null==e||r.isFunction(e)?e:r.namedfunc(e,Function("x","return x["+r.field(e).map(r.str).join("][")+"];"))},r.$=r.accessor,r.mutator=function(e){var t;return r.isString(e)&&(t=r.field(e)).length>1?function(e,n){for(var r=0;r<t.length-1;++r)e=e[t[r]];e[t[r]]=n}:function(t,n){t[e]=n}},r.$func=function(e,t){return function(n){n=r.$(n)||r.identity;var i=e+(r.name(n)?"_"+r.name(n):"");return r.namedfunc(i,function(e){return t(n(e))})}},r.$valid=r.$func("valid",r.isValid),r.$length=r.$func("length",r.length),r.$in=function(e,t){e=r.$(e);var n=r.isArray(t)?r.toMap(t):t;return function(t){return!!n[e(t)]}},r.comparator=function(e){var t=[];return void 0===e&&(e=[]),e=r.array(e).map(function(e){var n=1;return"-"===e[0]?(n=-1,e=e.slice(1)):"+"===e[0]&&(n=1,e=e.slice(1)),t.push(n),r.accessor(e)}),function(n,i){var o,a,u,s;for(o=0,a=e.length;o<a;++o)if(u=e[o],s=r.cmp(u(n),u(i)))return s*t[o];return 0}},r.cmp=function(e,t){return(e<t||null==e)&&null!=t?-1:(e>t||null==t)&&null!=e?1:(t=t instanceof Date?+t:t,(e=e instanceof Date?+e:e)!==e&&t===t?-1:t!==t&&e===e?1:0)},r.numcmp=function(e,t){return e-t},r.stablesort=function(e,t,n){var r=e.reduce(function(e,t,r){return e[n(t)]=r,e},{});return e.sort(function(e,i){var o=t(e),a=t(i);return o<a?-1:o>a?1:r[n(e)]-r[n(i)]}),e},r.permute=function(e){for(var t,n,r=e.length;r;)n=Math.floor(Math.random()*r--),t=e[r],e[r]=e[n],e[n]=t},r.pad=function(e,n,r,i){i=i||" ";var o=n-e.length;if(o<=0)return e;switch(r){case"left":return t(o,i)+e;case"middle":case"center":return t(Math.floor(o/2),i)+e+t(Math.ceil(o/2),i);default:return e+t(o,i)}},r.truncate=function(e,t,r,i,o){var a=e.length;if(a<=t)return e;o=void 0!==o?String(o):"…";var u=Math.max(0,t-o.length);switch(r){case"left":return o+(i?n(e,u,1):e.slice(a-u));case"middle":case"center":var s=Math.ceil(u/2),c=Math.floor(u/2);return(i?n(e,s):e.slice(0,s))+o+(i?n(e,c,1):e.slice(a-c));default:return(i?n(e,u):e.slice(0,u))+o}};var u=/([\u0009\u000A\u000B\u000C\u000D\u0020\u00A0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u2028\u2029\u3000\uFEFF])/}),Di=Ri.isArray,Li=Ri.cmp,Mi=Ri.keys,Ui=Ri.duplicate,xi=Ri.extend,Fi=Ri.isObject,wi=Ri.isBoolean,ki=Ri.toMap,ji=Ri.isString,Gi=Object.freeze({"default":Ri,__moduleExports:Ri,isArray:Di,cmp:Li,keys:Mi,duplicate:Ui,extend:xi,isObject:Fi,isBoolean:wi,toMap:ki,isString:ji}),Bi=Gi&&Ri||Gi,Hi=n(function(e,t){function n(e,t){return e.indexOf(t)!==-1}function r(e,t){for(var n=0;n<e.length;n++)if(!t(e[n],n))return!1;return!0}function i(e,t,n){if(e.forEach)e.forEach.call(n,t);else for(var r in e)t.call(n,e[r],r,e)}function o(e,t){var n,r=0;for(n in e)if(t(e[n],n,r++))return!0;return!1}function a(e,t){return e.map(function(e){return Bi.isArray(e)?a(e,t):t(e)})}function u(e,t){return e.filter(function(e){return!n(t,e)})}Object.defineProperty(t,"__esModule",{value:!0}),t.isArray=Bi.isArray;var s=Bi;t.cmp=s.cmp,t.keys=s.keys,t.duplicate=s.duplicate,t.extend=s.extend,t.isObject=s.isObject,t.isBoolean=s.isBoolean,t.toMap=s.toMap,t.contains=n,t.every=r,t.forEach=i,t.some=o,t.nestedMap=a,t.without=u}),Yi=t(Hi),Wi=Hi.isArray,Qi=Hi.cmp,zi=Hi.keys,Vi=Hi.duplicate,Ki=Hi.extend,qi=Hi.isObject,Xi=Hi.isBoolean,$i=Hi.toMap,Ji=Hi.contains,Zi=Hi.every,eo=Hi.forEach,to=Hi.some,no=Hi.nestedMap,ro=Hi.without,io=Object.freeze({"default":Yi,__moduleExports:Hi,isArray:Wi,cmp:Qi,keys:zi,duplicate:Vi,extend:Ki,isObject:qi,isBoolean:Xi,toMap:$i,contains:Ji,every:Zi,forEach:eo,some:to,nestedMap:no,without:ro}),oo=n(function(e,t){function n(e){return!!u[e]}function r(e){return Sn.contains(["line","area","trail"],e)}function i(e){return e.type}function o(e){var t=i(e)?e.type:e;return t in s}Object.defineProperty(t,"__esModule",{value:!0});var a;!function(e){e.AREA="area",e.BAR="bar",e.LINE="line",e.POINT="point",e.RECT="rect",e.RULE="rule",e.TEXT="text",e.TICK="tick",e.TRAIL="trail",e.CIRCLE="circle",e.SQUARE="square",e.GEOSHAPE="geoshape"}(a=t.Mark||(t.Mark={})),t.AREA=a.AREA,t.BAR=a.BAR,t.LINE=a.LINE,t.POINT=a.POINT,t.TEXT=a.TEXT,t.TICK=a.TICK,t.TRAIL=a.TRAIL,t.RECT=a.RECT,t.RULE=a.RULE,t.GEOSHAPE=a.GEOSHAPE,t.CIRCLE=a.CIRCLE,t.SQUARE=a.SQUARE;var u={area:1,bar:1,line:1,point:1,text:1,tick:1,trail:1,rect:1,geoshape:1,rule:1,circle:1,square:1};t.isMark=n,t.isPathMark=r,t.PRIMITIVE_MARKS=Sn.flagKeys(u),t.isMarkDef=i;var s=Wt.toSet(t.PRIMITIVE_MARKS);t.isPrimitiveMark=o,t.STROKE_CONFIG=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity"],t.FILL_CONFIG=["fill","fillOpacity"],t.FILL_STROKE_CONFIG=[].concat(t.STROKE_CONFIG,t.FILL_CONFIG),t.VL_ONLY_MARK_CONFIG_PROPERTIES=["filled","color"],t.VL_ONLY_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX={area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],text:["shortTimeLabels"],tick:["bandSize","thickness"]},t.defaultMarkConfig={color:"#4c78a8"},t.defaultBarConfig={binSpacing:1,continuousBandSize:5},t.defaultTickConfig={thickness:1}}),ao=t(oo),uo=oo.Mark,so=oo.AREA,co=oo.BAR,lo=oo.LINE,fo=oo.POINT,po=oo.TEXT,yo=oo.TICK,go=oo.TRAIL,ho=oo.RECT,mo=oo.RULE,Eo=oo.GEOSHAPE,To=oo.CIRCLE,vo=oo.SQUARE,_o=oo.isMark,Oo=oo.isPathMark,So=oo.PRIMITIVE_MARKS,No=oo.isMarkDef,Ao=oo.isPrimitiveMark,Po=oo.STROKE_CONFIG,Co=oo.FILL_CONFIG,Io=oo.FILL_STROKE_CONFIG,bo=oo.VL_ONLY_MARK_CONFIG_PROPERTIES,Ro=oo.VL_ONLY_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX,Do=oo.defaultMarkConfig,Lo=oo.defaultBarConfig,Mo=oo.defaultTickConfig,Uo=Object.freeze({"default":ao,__moduleExports:oo,Mark:uo,AREA:so,BAR:co,LINE:lo,POINT:fo,TEXT:po,TICK:yo,TRAIL:go,RECT:ho,RULE:mo,GEOSHAPE:Eo,CIRCLE:To,SQUARE:vo,isMark:_o,isPathMark:Oo,PRIMITIVE_MARKS:So,isMarkDef:No,isPrimitiveMark:Ao,STROKE_CONFIG:Po,FILL_CONFIG:Co,FILL_STROKE_CONFIG:Io,VL_ONLY_MARK_CONFIG_PROPERTIES:bo,VL_ONLY_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX:Ro,defaultMarkConfig:Do,defaultBarConfig:Lo,defaultTickConfig:Mo}),xo=n(function(e,t){function n(e){return!!(e&&(e.year||e.quarter||e.month||e.date||e.day||e.hours||e.minutes||e.seconds||e.milliseconds))}function r(e){if(Wt.isNumber(e))return e>4&&Dr.warn(Dr.message.invalidTimeUnit("quarter",e)),e-1+"";throw new Error(Dr.message.invalidTimeUnit("quarter",e))}function i(e){if(Wt.isNumber(e))return e-1+"";var n=e.toLowerCase(),r=t.MONTHS.indexOf(n);if(r!==-1)return r+"";var i=n.substr(0,3),o=t.SHORT_MONTHS.indexOf(i);if(o!==-1)return o+"";throw new Error(Dr.message.invalidTimeUnit("month",e))}function o(e){if(Wt.isNumber(e))return e%7+"";var n=e.toLowerCase(),r=t.DAYS.indexOf(n);if(r!==-1)return r+"";var i=n.substr(0,3),o=t.SHORT_DAYS.indexOf(i);if(o!==-1)return o+"";throw new Error(Dr.message.invalidTimeUnit("day",e))}function a(e,t){void 0===t&&(t=!1);var n=[];if(t&&void 0!==e.day&&Sn.keys(e).length>1&&(Dr.warn(Dr.message.droppedDay(e)),e=Sn.duplicate(e),delete e.day),void 0!==e.year?n.push(e.year):void 0!==e.day?n.push(u):n.push(0),void 0!==e.month){var a=t?i(e.month):e.month;n.push(a)}else if(void 0!==e.quarter){var s=t?r(e.quarter):e.quarter;n.push(s+"*3")}else n.push(0);if(void 0!==e.date)n.push(e.date);else if(void 0!==e.day){var c=t?o(e.day):e.day;n.push(c+"+1")}else n.push(1);for(var l=0,d=["hours","minutes","seconds","milliseconds"];l<d.length;l++){var f=d[l];void 0!==e[f]?n.push(e[f]):n.push(0)}return e.utc?"utc("+n.join(", ")+")":"datetime("+n.join(", ")+")"}Object.defineProperty(t,"__esModule",{value:!0});var u=2006;t.isDateTime=n,t.MONTHS=["january","february","march","april","may","june","july","august","september","october","november","december"],t.SHORT_MONTHS=t.MONTHS.map(function(e){return e.substr(0,3)}),t.DAYS=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],t.SHORT_DAYS=t.DAYS.map(function(e){return e.substr(0,3)}),t.dateTimeExpr=a}),Fo=t(xo),wo=xo.isDateTime,ko=xo.MONTHS,jo=xo.SHORT_MONTHS,Go=xo.DAYS,Bo=xo.SHORT_DAYS,Ho=xo.dateTimeExpr,Yo=Object.freeze({"default":Fo,__moduleExports:xo,isDateTime:wo,MONTHS:ko,SHORT_MONTHS:jo,DAYS:Go,SHORT_DAYS:Bo,dateTimeExpr:Ho}),Wo=Yo&&Fo||Yo,Qo=n(function(e,t){function n(e){return!!g[e]}function r(e){return!!h[e]}function i(e){return!!T[e]}function o(e){return e.substr(3)}function a(e){return!!v[e]}function u(e,n){for(var r=i(e),o=r?new Date(Date.UTC(0,0,1,0,0,0,0)):new Date(0,0,1,0,0,0,0),a=0,u=t.TIMEUNIT_PARTS;a<u.length;a++){var c=u[a];if(l(e,c))switch(c){case y.DAY:throw new Error("Cannot convert to TimeUnits containing 'day'");case y.QUARTER:var d=s("month",r),f=d.getDateMethod,p=d.setDateMethod;o[p](3*Math.floor(n[f]()/3));break;default:var g=s(c,r),h=g.getDateMethod,m=g.setDateMethod;o[m](n[h]())}}return o}function s(e,t){var n=_[e],r=t?"setUTC"+n.substr(3):n,i="get"+(t?"UTC":"")+n.substr(3);return{setDateMethod:r,getDateMethod:i}}function c(e){return t.TIMEUNIT_PARTS.reduce(function(t,n){return l(e,n)?t.concat(n):t},[])}function l(e,t){var n=e.indexOf(t);return n>-1&&(t!==y.SECONDS||0===n||"i"!==e.charAt(n-1))}function d(e,n){function r(e){return e===y.QUARTER?"("+a+"quarter("+o+")-1)":""+a+e+"("+o+")"}var o="datum"+Sn.accessPath(n),a=i(e)?"utc":"",u=t.TIMEUNIT_PARTS.reduce(function(t,n){return l(e,n)&&(t[n]=r(n)),t},{});return Wo.dateTimeExpr(u)}function f(e,t,n,r){if(e){var i=[],o="",a=l(e,y.YEAR);l(e,y.QUARTER)&&(o="'Q' + quarter("+t+")"),l(e,y.MONTH)&&i.push(n!==!1?"%b":"%B"),l(e,y.DAY)?i.push(n?"%a":"%A"):l(e,y.DATE)&&i.push("%d"+(a?",":"")),a&&i.push(n?"%y":"%Y");var u=[];l(e,y.HOURS)&&u.push("%H"),l(e,y.MINUTES)&&u.push("%M"),l(e,y.SECONDS)&&u.push("%S"),l(e,y.MILLISECONDS)&&u.push("%L");var s=[];return i.length>0&&s.push(i.join(" ")),u.length>0&&s.push(u.join(":")),s.length>0&&(o&&(o+=" + ' ' + "),o+=r?"utcFormat("+t+", '"+s.join(" ")+"')":"timeFormat("+t+", '"+s.join(" ")+"')"),o||void 0}}function p(e){return"day"!==e&&e.indexOf("day")>=0?(Dr.warn(Dr.message.dayReplacedWithDate(e)),e.replace("day","date")):e}Object.defineProperty(t,"__esModule",{value:!0});var y;!function(e){e.YEAR="year",e.MONTH="month",e.DAY="day",e.DATE="date",e.HOURS="hours",e.MINUTES="minutes",e.SECONDS="seconds",e.MILLISECONDS="milliseconds",e.YEARMONTH="yearmonth",e.YEARMONTHDATE="yearmonthdate",e.YEARMONTHDATEHOURS="yearmonthdatehours",e.YEARMONTHDATEHOURSMINUTES="yearmonthdatehoursminutes",e.YEARMONTHDATEHOURSMINUTESSECONDS="yearmonthdatehoursminutesseconds",e.MONTHDATE="monthdate",e.HOURSMINUTES="hoursminutes",e.HOURSMINUTESSECONDS="hoursminutesseconds",e.MINUTESSECONDS="minutesseconds",e.SECONDSMILLISECONDS="secondsmilliseconds",e.QUARTER="quarter",e.YEARQUARTER="yearquarter",e.QUARTERMONTH="quartermonth",e.YEARQUARTERMONTH="yearquartermonth",e.UTCYEAR="utcyear",e.UTCMONTH="utcmonth",e.UTCDAY="utcday",e.UTCDATE="utcdate",e.UTCHOURS="utchours",e.UTCMINUTES="utcminutes",e.UTCSECONDS="utcseconds",e.UTCMILLISECONDS="utcmilliseconds",e.UTCYEARMONTH="utcyearmonth",e.UTCYEARMONTHDATE="utcyearmonthdate",e.UTCYEARMONTHDATEHOURS="utcyearmonthdatehours",e.UTCYEARMONTHDATEHOURSMINUTES="utcyearmonthdatehoursminutes",e.UTCYEARMONTHDATEHOURSMINUTESSECONDS="utcyearmonthdatehoursminutesseconds",e.UTCMONTHDATE="utcmonthdate",e.UTCHOURSMINUTES="utchoursminutes",e.UTCHOURSMINUTESSECONDS="utchoursminutesseconds",e.UTCMINUTESSECONDS="utcminutesseconds",e.UTCSECONDSMILLISECONDS="utcsecondsmilliseconds",e.UTCQUARTER="utcquarter",e.UTCYEARQUARTER="utcyearquarter",e.UTCQUARTERMONTH="utcquartermonth",e.UTCYEARQUARTERMONTH="utcyearquartermonth"}(y=t.TimeUnit||(t.TimeUnit={}));var g={year:1,quarter:1,month:1,day:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1};t.TIMEUNIT_PARTS=Sn.flagKeys(g),t.isLocalSingleTimeUnit=n;var h={utcyear:1,utcquarter:1,utcmonth:1,utcday:1,utcdate:1,utchours:1,utcminutes:1,utcseconds:1,utcmilliseconds:1};t.isUtcSingleTimeUnit=r;var m={yearquarter:1,yearquartermonth:1,yearmonth:1,yearmonthdate:1,yearmonthdatehours:1,yearmonthdatehoursminutes:1,yearmonthdatehoursminutesseconds:1,quartermonth:1,monthdate:1,hoursminutes:1,hoursminutesseconds:1,minutesseconds:1,secondsmilliseconds:1},E={utcyearquarter:1,utcyearquartermonth:1,utcyearmonth:1,utcyearmonthdate:1,utcyearmonthdatehours:1,utcyearmonthdatehoursminutes:1,utcyearmonthdatehoursminutesseconds:1,utcquartermonth:1,utcmonthdate:1,utchoursminutes:1,utchoursminutesseconds:1,utcminutesseconds:1,utcsecondsmilliseconds:1},T=On.__assign({},h,E);t.isUTCTimeUnit=i,t.getLocalTimeUnit=o;var v=On.__assign({},g,h,m,E);t.TIMEUNITS=Sn.flagKeys(v),t.isTimeUnit=a;var _={year:"setFullYear",month:"setMonth",date:"setDate",hours:"setHours",minutes:"setMinutes",seconds:"setSeconds",milliseconds:"setMilliseconds",quarter:null,day:null};t.convert=u,t.getTimeUnitParts=c,t.containsTimeUnit=l,t.fieldExpr=d,t.formatExpression=f,t.normalizeTimeUnit=p}),zo=t(Qo),Vo=Qo.TimeUnit,Ko=Qo.TIMEUNIT_PARTS,qo=Qo.isLocalSingleTimeUnit,Xo=Qo.isUtcSingleTimeUnit,$o=Qo.isUTCTimeUnit,Jo=Qo.getLocalTimeUnit,Zo=Qo.TIMEUNITS,ea=Qo.isTimeUnit,ta=Qo.convert,na=Qo.getTimeUnitParts,ra=Qo.containsTimeUnit,ia=Qo.fieldExpr,oa=Qo.formatExpression,aa=Qo.normalizeTimeUnit,ua=Object.freeze({"default":zo,__moduleExports:Qo,TimeUnit:Vo,TIMEUNIT_PARTS:Ko,isLocalSingleTimeUnit:qo,isUtcSingleTimeUnit:Xo,isUTCTimeUnit:$o,getLocalTimeUnit:Jo,TIMEUNITS:Zo,isTimeUnit:ea,convert:ta,getTimeUnitParts:na,containsTimeUnit:ra,fieldExpr:ia,formatExpression:oa,normalizeTimeUnit:aa}),sa=n(function(e,t){function n(e){return!!o[e]}function r(e){if(e)switch(e=e.toLowerCase()){case"q":case t.QUANTITATIVE:return"quantitative";case"t":case t.TEMPORAL:return"temporal";case"o":case t.ORDINAL:return"ordinal";case"n":case t.NOMINAL:return"nominal";case i.LATITUDE:return"latitude";case i.LONGITUDE:return"longitude";case t.GEOJSON:return"geojson"}}Object.defineProperty(t,"__esModule",{value:!0});var i;!function(e){e.QUANTITATIVE="quantitative",e.ORDINAL="ordinal",e.TEMPORAL="temporal",e.NOMINAL="nominal",e.LATITUDE="latitude",e.LONGITUDE="longitude",e.GEOJSON="geojson"}(i=t.Type||(t.Type={}));var o={quantitative:1,ordinal:1,temporal:1,nominal:1,latitude:1,longitude:1,geojson:1};t.isType=n,t.QUANTITATIVE=i.QUANTITATIVE,t.ORDINAL=i.ORDINAL,t.TEMPORAL=i.TEMPORAL,t.NOMINAL=i.NOMINAL,t.GEOJSON=i.GEOJSON,t.getFullName=r}),ca=t(sa),la=sa.Type,da=sa.isType,fa=sa.QUANTITATIVE,pa=sa.ORDINAL,ya=sa.TEMPORAL,ga=sa.NOMINAL,ha=sa.GEOJSON,ma=sa.getFullName,Ea=Object.freeze({"default":ca,__moduleExports:sa,Type:la,isType:da,QUANTITATIVE:fa,ORDINAL:pa,TEMPORAL:ya,NOMINAL:ga,GEOJSON:ha,getFullName:ma}),Ta=bi&&di||bi,va=io&&Yi||io,_a=Uo&&ao||Uo,Oa=ua&&zo||ua,Sa=Ea&&ca||Ea,Na=n(function(e,t){function n(e){return r(e)||i(e)}function r(e){return e===t.SHORT_WILDCARD}function i(e){
return!(void 0===e||null==e||!e["enum"]&&!e.name||va.isArray(e))}function o(e,n,r){return va.extend({},{name:n,"enum":r},e===t.SHORT_WILDCARD?{}:e)}function a(e){for(var t={},n={},r=function(e){for(var r=[0],i=0;i<e.length;i++)e.charAt(i).toUpperCase()===e.charAt(i)&&r.push(i);var o=r.map(function(t){return e.charAt(t)}).join("").toLowerCase();if(!n[o])return t[e]=o,n[o]=!0,"continue";if(r[r.length-1]!==e.length-1&&(o=r.concat([e.length-1]).map(function(t){return e.charAt(t)}).join("").toLowerCase(),!n[o]))return t[e]=o,n[o]=!0,"continue";for(var i=1;!t[e];i++){var a=o+"_"+i;if(!n[a]){t[e]=a,n[a]=!0;break}}},i=0,o=e;i<o.length;i++){var a=o[i];r(a)}return t}function u(e){if(Ta.isEncodingNestedProp(e))return t.DEFAULT_NAME[e.parent]+"-"+t.DEFAULT_NAME[e.parent+"Props"][e.child];if(t.DEFAULT_NAME[e])return t.DEFAULT_NAME[e];throw new Error("Default name undefined for "+e)}function s(e,t,n){if("field"===e||Ta.isEncodingNestedProp(e)&&"sort"===e.parent&&"field"===e.child)return t.fieldNames();var r;if(r=Ta.isEncodingNestedProp(e)?n["enum"][e.parent+"Props"][e.child]:n["enum"][e],void 0!==r)return r;throw new Error("No default enumValues for "+JSON.stringify(e))}Object.defineProperty(t,"__esModule",{value:!0}),t.SHORT_WILDCARD="?",t.isWildcard=n,t.isShortWildcard=r,t.isWildcardDef=i,t.initWildcard=o,t.DEFAULT_NAME={mark:"m",channel:"c",aggregate:"a",autoCount:"#",hasFn:"h",bin:"b",sort:"so",stack:"st",scale:"s",format:"f",axis:"ax",legend:"l",value:"v",timeUnit:"tu",field:"f",type:"t",binProps:{maxbins:"mb",min:"mi",max:"ma",base:"b",step:"s",steps:"ss",minstep:"ms",divide:"d"},sortProps:{field:"f",op:"o",order:"or"},scaleProps:a(si.SCALE_PROPERTIES),axisProps:a(ui.AXIS_PROPERTIES),legendProps:a(ci.LEGEND_PROPERTIES)},t.getDefaultName=u;var c=[!1,!0],l={maxbins:[5,10,20],extent:[void 0],base:[10],step:[void 0],steps:[void 0],minstep:[void 0],divide:[[5,2]]},d={field:[void 0],op:["min","mean"],order:["ascending","descending"]},f={type:[void 0,si.ScaleType.LOG],domain:[void 0],base:[void 0],exponent:[1,2],clamp:c,nice:c,reverse:c,round:c,zero:c,padding:[void 0],paddingInner:[void 0],paddingOuter:[void 0],interpolate:[void 0],range:[void 0],rangeStep:[17,21],scheme:[void 0]},p={zindex:[1,0],offset:[void 0],orient:[void 0],values:[void 0],encoding:[void 0],domain:c,grid:c,format:[void 0],labels:c,labelAngle:[void 0],labelOverlap:[void 0],labelPadding:[void 0],labelBound:[void 0],labelFlush:[void 0],maxExtent:[void 0],minExtent:[void 0],position:[void 0],ticks:c,tickCount:[void 0],tickSize:[void 0],title:[void 0],titleMaxLength:[void 0],titlePadding:[void 0]},y={entryPadding:[void 0],orient:["left","right"],offset:[void 0],padding:[void 0],format:[void 0],values:[void 0],tickCount:[void 0],title:[void 0],type:[void 0],zindex:[void 0]};t.DEFAULT_ENUM_INDEX={mark:[_a.Mark.POINT,_a.Mark.BAR,_a.Mark.LINE,_a.Mark.AREA,_a.Mark.RECT,_a.Mark.TICK,_a.Mark.TEXT],channel:[Rr.X,Rr.Y,Rr.ROW,Rr.COLUMN,Rr.SIZE,Rr.COLOR],aggregate:[void 0,"mean"],autoCount:c,bin:c,hasFn:c,timeUnit:[void 0,Oa.TimeUnit.YEAR,Oa.TimeUnit.MONTH,Oa.TimeUnit.MINUTES,Oa.TimeUnit.SECONDS],field:[void 0],type:[Sa.Type.NOMINAL,Sa.Type.ORDINAL,Sa.Type.QUANTITATIVE,Sa.Type.TEMPORAL],sort:["ascending","descending"],stack:["zero","normalize","center",null],value:[void 0],format:[void 0],scale:[!0],axis:c,legend:c,binProps:l,sortProps:d,scaleProps:f,axisProps:p,legendProps:y},t.getDefaultEnumValues=s}),Aa=t(Na),Pa=Na.SHORT_WILDCARD,Ca=Na.isWildcard,Ia=Na.isShortWildcard,ba=Na.isWildcardDef,Ra=Na.initWildcard,Da=Na.DEFAULT_NAME,La=Na.getDefaultName,Ma=Na.DEFAULT_ENUM_INDEX,Ua=Na.getDefaultEnumValues,xa=Object.freeze({"default":Aa,__moduleExports:Na,SHORT_WILDCARD:Pa,isWildcard:Ca,isShortWildcard:Ia,isWildcardDef:ba,initWildcard:Ra,DEFAULT_NAME:Da,getDefaultName:La,DEFAULT_ENUM_INDEX:Ma,getDefaultEnumValues:Ua}),Fa=xa&&Aa||xa,wa=n(function(e,t){function n(e){return o({},t.DEFAULT_QUERY_CONFIG,e,{"enum":r(e["enum"])})}function r(e){var t=o({},Fa.DEFAULT_ENUM_INDEX,e,{binProps:i(e,"bin"),scaleProps:i(e,"scale"),axisProps:i(e,"axis"),legendProps:i(e,"legend")});return t}function i(e,t){return o({},Fa.DEFAULT_ENUM_INDEX[t+"Props"],e[t+"Props"])}var o=Ge&&Ge.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e};Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_QUERY_CONFIG={verbose:!1,defaultSpecConfig:{line:{point:!0},scale:{useUnaggregatedDomain:!0}},propertyPrecedence:Ta.DEFAULT_PROP_PRECEDENCE.map(Ta.toKey),"enum":Fa.DEFAULT_ENUM_INDEX,numberNominalProportion:.05,numberNominalLimit:40,constraintManuallySpecifiedValue:!1,autoAddCount:!1,hasAppropriateGraphicTypeForMark:!0,omitAggregate:!1,omitAggregatePlotWithDimensionOnlyOnFacet:!0,omitAggregatePlotWithoutDimension:!1,omitBarLineAreaWithOcclusion:!0,omitBarTickWithSize:!0,omitMultipleNonPositionalChannels:!0,omitRaw:!1,omitRawContinuousFieldForAggregatePlot:!0,omitRepeatedField:!0,omitNonPositionalOrFacetOverPositionalChannels:!0,omitTableWithOcclusionIfAutoAddCount:!0,omitVerticalDotPlot:!1,omitInvalidStackSpec:!0,omitNonSumStack:!0,preferredBinAxis:Rr.Channel.X,preferredTemporalAxis:Rr.Channel.X,preferredOrdinalAxis:Rr.Channel.Y,preferredNominalAxis:Rr.Channel.Y,preferredFacet:Rr.Channel.ROW,minCardinalityForBin:15,maxCardinalityForCategoricalColor:20,maxCardinalityForFacet:20,maxCardinalityForShape:6,timeUnitShouldHaveVariation:!0,typeMatchesSchemaType:!0,stylize:!0,smallRangeStepForHighCardinalityOrFacet:{maxCardinality:10,rangeStep:12},nominalColorScaleForHighCardinality:{maxCardinality:10,palette:"category20"},xAxisOnTopForHighYCardinalityWithoutColumn:{maxCardinality:30},maxGoodCardinalityForFacet:5,maxGoodCardinalityForColor:7,minPercentUniqueForKey:.8,minCardinalityForKey:50},t.extendConfig=n}),ka=t(wa),ja=wa.DEFAULT_QUERY_CONFIG,Ga=wa.extendConfig,Ba=Object.freeze({"default":ka,__moduleExports:wa,DEFAULT_QUERY_CONFIG:ja,extendConfig:Ga}),Ha=n(function(e,t){function n(e){return!!i[e]}function r(e){return e&&Sn.contains(t.COUNTING_OPS,e)}Object.defineProperty(t,"__esModule",{value:!0});var i={argmax:1,argmin:1,average:1,count:1,distinct:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1};t.AGGREGATE_OPS=Sn.flagKeys(i),t.isAggregateOp=n,t.COUNTING_OPS=["count","valid","missing","distinct"],t.isCountingAggregateOp=r,t.SUM_OPS=["count","sum","distinct","valid","missing"],t.SHARED_DOMAIN_OPS=["mean","average","median","q1","q3","min","max"],t.SHARED_DOMAIN_OP_INDEX=Wt.toSet(t.SHARED_DOMAIN_OPS)}),Ya=t(Ha),Wa=Ha.AGGREGATE_OPS,Qa=Ha.isAggregateOp,za=Ha.COUNTING_OPS,Va=Ha.isCountingAggregateOp,Ka=Ha.SUM_OPS,qa=Ha.SHARED_DOMAIN_OPS,Xa=Ha.SHARED_DOMAIN_OP_INDEX,$a=Object.freeze({"default":Ya,__moduleExports:Ha,AGGREGATE_OPS:Wa,isAggregateOp:Qa,COUNTING_OPS:za,isCountingAggregateOp:Va,SUM_OPS:Ka,SHARED_DOMAIN_OPS:qa,SHARED_DOMAIN_OP_INDEX:Xa}),Ja=n(function(e,t){function n(e){return Wt.isBoolean(e)?"bin":"bin"+Sn.keys(e).map(function(t){return Sn.varName("_"+t+"_"+e[t])}).join("")}function r(e){switch(e){case Rr.ROW:case Rr.COLUMN:case Rr.SIZE:case Rr.COLOR:case Rr.FILL:case Rr.STROKE:case Rr.OPACITY:case Rr.SHAPE:return 6;default:return 10}}Object.defineProperty(t,"__esModule",{value:!0}),t.binToString=n,t.autoMaxBins=r}),Za=t(Ja),eu=Ja.binToString,tu=Ja.autoMaxBins,nu=Object.freeze({"default":Za,__moduleExports:Ja,binToString:eu,autoMaxBins:tu}),ru=$a&&Ya||$a,iu=nu&&Za||nu,ou=n(function(e,t){function n(e){return e.selection}function r(e){return e&&!Wt.isString(e)&&"repeat"in e}function i(e){var t=e.field,n=e.timeUnit,r=e.bin,i=e.aggregate;return On.__assign({},n?{timeUnit:n}:{},r?{bin:r}:{},i?{aggregate:i}:{},{field:t})}function o(e){return!!e&&!!e.condition}function a(e){return!!e&&!!e.condition&&!Wt.isArray(e.condition)&&s(e.condition)}function u(e){return!!e&&!!e.condition&&(Wt.isArray(e.condition)||l(e.condition))}function s(e){return!(!e||!e.field&&"count"!==e.aggregate)}function c(e){return s(e)&&Wt.isString(e.field)}function l(e){return e&&"value"in e&&void 0!==e.value}function d(e){return!(!e||!e.scale&&!e.sort)}function f(e,t){void 0===t&&(t={});var n=e.field,r=t.prefix,i=t.suffix;if(g(e))n="count_*";else{var o=void 0;t.nofn||(e.bin?(o=iu.binToString(e.bin),i=t.binSuffix||""):e.aggregate?o=String(t.aggregate||e.aggregate):e.timeUnit&&(o=String(e.timeUnit))),o&&(n=o+"_"+n)}return i&&(n=n+"_"+i),r&&(n=r+"_"+n),t.expr&&(n=""+t.expr+Sn.accessPath(n)),n}function p(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return!!e.bin;case"latitude":case"longitude":case"temporal":return!1}throw new Error(Dr.message.invalidFieldType(e.type))}function y(e){return!p(e)}function g(e){return"count"===e.aggregate}function h(e,t){var n=e.field,r=e.bin,i=e.timeUnit,o=e.aggregate;if("count"===o)return t.countTitle;if(r)return n+" (binned)";if(i){var a=Oa.getTimeUnitParts(i).join("-");return n+" ("+a+")"}return o?Sn.titlecase(o)+" of "+n:n}function m(e,t){var n=e.aggregate||e.timeUnit||e.bin&&"bin";return n?n.toUpperCase()+"("+e.field+")":e.field}function E(e){b=e}function T(){E(t.defaultTitleFormatter)}function v(e,t){return b(e,t)}function _(e,t){if(e.timeUnit)return"temporal";if(e.bin)return"quantitative";switch(Rr.rangeType(t)){case"continuous":return"quantitative";case"discrete":return"nominal";case"flexible":return"nominal";default:return"quantitative"}}function O(e){return s(e)?e:a(e)?e.condition:void 0}function S(e,t){if(Wt.isString(e)||Wt.isNumber(e)||Wt.isBoolean(e)){var n=Wt.isString(e)?"string":Wt.isNumber(e)?"number":"boolean";return Dr.warn(Dr.message.primitiveChannelDef(t,n,e)),{value:e}}return s(e)?N(e,t):a(e)?On.__assign({},e,{condition:N(e.condition,t)}):e}function N(e,t){if(e.aggregate&&!ru.isAggregateOp(e.aggregate)){var n=(e.aggregate,On.__rest(e,["aggregate"]));Dr.warn(Dr.message.invalidAggregate(e.aggregate)),e=n}if(e.timeUnit&&(e=On.__assign({},e,{timeUnit:Oa.normalizeTimeUnit(e.timeUnit)})),e.bin&&(e=On.__assign({},e,{bin:A(e.bin,t)})),e.type){var r=Sa.getFullName(e.type);e.type!==r&&(e=On.__assign({},e,{type:r})),"quantitative"!==e.type&&ru.isCountingAggregateOp(e.aggregate)&&(Dr.warn(Dr.message.invalidFieldTypeForCountAggregate(e.type,e.aggregate)),e=On.__assign({},e,{type:"quantitative"}))}else{var i=_(e,t);Dr.warn(Dr.message.emptyOrInvalidFieldType(e.type,t,i)),e=On.__assign({},e,{type:i})}var o=P(e,t),a=o.compatible,u=o.warning;return a||Dr.warn(u),e}function A(e,t){return Wt.isBoolean(e)?{maxbins:iu.autoMaxBins(t)}:e.maxbins||e.step?e:On.__assign({},e,{maxbins:iu.autoMaxBins(t)})}function P(e,t){switch(t){case"row":case"column":return y(e)&&!e.timeUnit?{compatible:!1,warning:Dr.message.facetChannelShouldBeDiscrete(t)}:R;case"x":case"y":case"color":case"fill":case"stroke":case"text":case"detail":case"key":case"tooltip":case"href":return R;case"longitude":case"longitude2":case"latitude":case"latitude2":return e.type!==Sa.QUANTITATIVE?{compatible:!1,warning:"Channel "+t+" should not be used with "+e.type+" field."}:R;case"opacity":case"size":case"x2":case"y2":return p(e)&&!e.bin?{compatible:!1,warning:"Channel "+t+" should not be used with discrete field."}:R;case"shape":return"nominal"!==e.type&&"geojson"!==e.type?{compatible:!1,warning:"Shape channel should be used with nominal data or geojson only"}:R;case"order":return"nominal"===e.type?{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}:R}throw new Error("channelCompatability not implemented for channel "+t)}function C(e){return"quantitative"===e.type||!!e.bin}function I(e){return"temporal"===e.type||!!e.timeUnit}Object.defineProperty(t,"__esModule",{value:!0}),t.isConditionalSelection=n,t.isRepeatRef=r,t.toFieldDefBase=i,t.isConditionalDef=o,t.hasConditionalFieldDef=a,t.hasConditionalValueDef=u,t.isFieldDef=s,t.isStringFieldDef=c,t.isValueDef=l,t.isScaleFieldDef=d,t.vgField=f,t.isDiscrete=p,t.isContinuous=y,t.isCount=g,t.verbalTitleFormatter=h,t.functionalTitleFormatter=m,t.defaultTitleFormatter=function(e,t){switch(t.fieldTitle){case"plain":return e.field;case"functional":return m(e,t);default:return h(e,t)}};var b=t.defaultTitleFormatter;t.setTitleFormatter=E,t.resetTitleFormatter=T,t.title=v,t.defaultType=_,t.getFieldDef=O,t.normalize=S,t.normalizeFieldDef=N,t.normalizeBin=A;var R={compatible:!0};t.channelCompatibility=P,t.isNumberFieldDef=C,t.isTimeFieldDef=I}),au=t(ou),uu=ou.isConditionalSelection,su=ou.isRepeatRef,cu=ou.toFieldDefBase,lu=ou.isConditionalDef,du=ou.hasConditionalFieldDef,fu=ou.hasConditionalValueDef,pu=ou.isFieldDef,yu=ou.isStringFieldDef,gu=ou.isValueDef,hu=ou.isScaleFieldDef,mu=ou.vgField,Eu=ou.isDiscrete,Tu=ou.isContinuous,vu=ou.isCount,_u=ou.verbalTitleFormatter,Ou=ou.functionalTitleFormatter,Su=ou.defaultTitleFormatter,Nu=ou.setTitleFormatter,Au=ou.resetTitleFormatter,Pu=ou.title,Cu=ou.defaultType,Iu=ou.getFieldDef,bu=ou.normalize,Ru=ou.normalizeFieldDef,Du=ou.normalizeBin,Lu=ou.channelCompatibility,Mu=ou.isNumberFieldDef,Uu=ou.isTimeFieldDef,xu=Object.freeze({"default":au,__moduleExports:ou,isConditionalSelection:uu,isRepeatRef:su,toFieldDefBase:cu,isConditionalDef:lu,hasConditionalFieldDef:du,hasConditionalValueDef:fu,isFieldDef:pu,isStringFieldDef:yu,isValueDef:gu,isScaleFieldDef:hu,vgField:mu,isDiscrete:Eu,isContinuous:Tu,isCount:vu,verbalTitleFormatter:_u,functionalTitleFormatter:Ou,defaultTitleFormatter:Su,setTitleFormatter:Nu,resetTitleFormatter:Au,title:Pu,defaultType:Cu,getFieldDef:Iu,normalize:bu,normalizeFieldDef:Ru,normalizeBin:Du,channelCompatibility:Lu,isNumberFieldDef:Mu,isTimeFieldDef:Uu}),Fu=n(function(e,t){function n(e){return e===Sa.Type.ORDINAL||e===Sa.Type.NOMINAL||e===r.KEY}Object.defineProperty(t,"__esModule",{value:!0});var r;!function(e){e.QUANTITATIVE=Sa.Type.QUANTITATIVE,e.ORDINAL=Sa.Type.ORDINAL,e.TEMPORAL=Sa.Type.TEMPORAL,e.NOMINAL=Sa.Type.NOMINAL,e.KEY="key"}(r=t.ExpandedType||(t.ExpandedType={})),t.isDiscrete=n}),wu=t(Fu),ku=Fu.ExpandedType,ju=Fu.isDiscrete,Gu=Object.freeze({"default":wu,__moduleExports:Fu,ExpandedType:ku,isDiscrete:ju}),Bu=n(function(e,t){function n(e,t,n,o,a){var u=r(t,n,o,a);return Rr.isScaleChannel(t)?void 0!==e?si.channelSupportScaleType(t,e)?i(e,n)?e:(Dr.warn(Dr.message.scaleTypeNotWorkWithFieldDef(e,u)),u):(Dr.warn(Dr.message.scaleTypeNotWorkWithChannel(t,e,u)),u):u:null}function r(e,t,n,r){switch(t.type){case"nominal":case"ordinal":if(Rr.isColorChannel(e)||"discrete"===Rr.rangeType(e))return"shape"===e&&"ordinal"===t.type&&Dr.warn(Dr.message.discreteChannelCannotEncode(e,"ordinal")),"ordinal";if(Sn.contains(["x","y"],e)){if(Sn.contains(["rect","bar","rule"],n))return"band";if("bar"===n)return"band"}return"point";case"temporal":return Rr.isColorChannel(e)?"sequential":"discrete"===Rr.rangeType(e)?(Dr.warn(Dr.message.discreteChannelCannotEncode(e,"temporal")),"ordinal"):"time";case"quantitative":return Rr.isColorChannel(e)?t.bin?"bin-ordinal":"sequential":"discrete"===Rr.rangeType(e)?(Dr.warn(Dr.message.discreteChannelCannotEncode(e,"quantitative")),"ordinal"):t.bin&&"x"!==e&&"y"!==e?"bin-linear":"linear";case"latitude":case"longitude":case"geojson":return}throw new Error(Dr.message.invalidFieldType(t.type))}function i(e,t){var n=t.type;return a.contains([Sa.Type.ORDINAL,Sa.Type.NOMINAL],n)?void 0===e||o.hasDiscreteDomain(e):n===Sa.Type.TEMPORAL?a.contains([si.ScaleType.TIME,si.ScaleType.UTC,si.ScaleType.SEQUENTIAL,void 0],e):n!==Sa.Type.QUANTITATIVE||(t.bin?a.contains([si.ScaleType.BIN_LINEAR,si.ScaleType.BIN_ORDINAL,si.ScaleType.LINEAR],e):a.contains([si.ScaleType.LOG,si.ScaleType.POW,si.ScaleType.SQRT,si.ScaleType.QUANTILE,si.ScaleType.QUANTIZE,si.ScaleType.LINEAR,si.ScaleType.SEQUENTIAL,void 0],e))}Object.defineProperty(t,"__esModule",{value:!0});var o=si,a=Sn;t.scaleType=n,t.fieldDefMatchScaleType=i}),Hu=t(Bu),Yu=Bu.scaleType,Wu=Bu.fieldDefMatchScaleType,Qu=Object.freeze({"default":Hu,__moduleExports:Bu,scaleType:Yu,fieldDefMatchScaleType:Wu}),zu=xu&&au||xu,Vu=n(function(e,t){function n(e,t){var n=e&&e[t];return!!n&&(Wt.isArray(n)?Sn.some(n,function(e){return!!e.field}):zu.isFieldDef(n)||zu.hasConditionalFieldDef(n))}function r(e){return Sn.some(Rr.CHANNELS,function(t){if(n(e,t)){var r=e[t];if(Wt.isArray(r))return Sn.some(r,function(e){return!!e.aggregate});var i=zu.getFieldDef(r);return i&&!!i.aggregate}return!1})}function i(e,t){return Sn.keys(e).reduce(function(n,r){if(!Rr.isChannel(r))return Dr.warn(Dr.message.invalidEncodingChannel(r)),n;if(!Rr.supportMark(r,t))return Dr.warn(Dr.message.incompatibleChannel(r,t)),n;if("size"===r&&"line"===t){var i=zu.getFieldDef(e[r]);if(i&&i.aggregate)return Dr.warn(Dr.message.LINE_WITH_VARYING_SIZE),n}if("color"===r&&("fill"in e||"stroke"in e))return Dr.warn(Dr.message.droppingColor("encoding",{fill:"fill"in e,stroke:"stroke"in e})),n;if("detail"===r||"order"===r||"tooltip"===r&&Wt.isArray(e[r])){var o=e[r];o&&(n[r]=(Wt.isArray(o)?o:[o]).reduce(function(e,t){return zu.isFieldDef(t)?e.push(zu.normalizeFieldDef(t,r)):Dr.warn(Dr.message.emptyFieldDef(t,r)),e},[]))}else{var o=e[r],i=zu.getFieldDef(e[r]);if(i&&Sn.contains([Sa.Type.LATITUDE,Sa.Type.LONGITUDE],i.type)){var a=r,u=(n[a],On.__rest(n,["symbol"==typeof a?a:a+""])),s="x"===r?"longitude":"y"===r?"latitude":"x2"===r?"longitude2":"y2"===r?"latitude2":void 0;return Dr.warn(Dr.message.latLongDeprecated(r,i.type,s)),On.__assign({},u,(c={},c[s]=On.__assign({},zu.normalize(i,r),{type:"quantitative"}),c))}if(!zu.isFieldDef(o)&&!zu.isValueDef(o)&&!zu.isConditionalDef(o))return Dr.warn(Dr.message.emptyFieldDef(o,r)),n;n[r]=zu.normalize(o,r)}return n;var c},{})}function o(e){return e&&(!!e.x&&!!e.x2||!!e.y&&!!e.y2)}function a(e){var t=[];return Rr.CHANNELS.forEach(function(r){if(n(e,r)){var i=e[r];(Wt.isArray(i)?i:[i]).forEach(function(e){zu.isFieldDef(e)?t.push(e):zu.hasConditionalFieldDef(e)&&t.push(e.condition)})}}),t}function u(e,t,n){if(e)for(var r=function(r){Wt.isArray(e[r])?e[r].forEach(function(e){t.call(n,e,r)}):t.call(n,e[r],r)},i=0,o=Sn.keys(e);i<o.length;i++){var a=o[i];r(a)}}function s(e,t,n,r){return e?Sn.keys(e).reduce(function(n,i){var o=e[i];return Wt.isArray(o)?o.reduce(function(e,n){return t.call(r,e,n,i)},n):t.call(r,n,o,i)},n):n}Object.defineProperty(t,"__esModule",{value:!0}),t.channelHasField=n,t.isAggregate=r,t.normalizeEncoding=i,t.isRanged=o,t.fieldDefs=a,t.forEach=u,t.reduce=s}),Ku=t(Vu),qu=Vu.channelHasField,Xu=Vu.isAggregate,$u=Vu.normalizeEncoding,Ju=Vu.isRanged,Zu=Vu.fieldDefs,es=Vu.forEach,ts=Vu.reduce,ns=Object.freeze({"default":Ku,__moduleExports:Vu,channelHasField:qu,isAggregate:Xu,normalizeEncoding:$u,isRanged:Ju,fieldDefs:Zu,forEach:es,reduce:ts}),rs=ns&&Ku||ns,is=n(function(e,t){function n(e){return!!o[e]}function r(e){var t=e.x,n=e.y;if(zu.isFieldDef(t)&&zu.isFieldDef(n))if("quantitative"===t.type&&"quantitative"===n.type){if(t.stack)return"x";if(n.stack)return"y";if(!!t.aggregate!=!!n.aggregate)return t.aggregate?"x":"y"}else{if("quantitative"===t.type)return"x";if("quantitative"===n.type)return"y"}else{if(zu.isFieldDef(t)&&"quantitative"===t.type)return"x";if(zu.isFieldDef(n)&&"quantitative"===n.type)return"y"}}function i(e,i,o){var a=_a.isMarkDef(e)?e.type:e;if(!Sn.contains(t.STACKABLE_MARKS,a))return null;var u=r(i);if(!u)return null;var s=i[u],c=zu.isStringFieldDef(s)?zu.vgField(s,{}):void 0,l="x"===u?"y":"x",d=i[l],f=zu.isStringFieldDef(d)?zu.vgField(d,{}):void 0,p=Rr.NONPOSITION_CHANNELS.reduce(function(e,t){if(rs.channelHasField(i,t)){var n=i[t];(Wt.isArray(n)?n:[n]).forEach(function(n){var r=zu.getFieldDef(n);if(!r.aggregate){var i=zu.isStringFieldDef(r)?zu.vgField(r,{}):void 0;(!i||i!==f&&i!==c)&&e.push({channel:t,fieldDef:r})}})}return e},[]);if(0===p.length)return null;var y=void 0;return y=void 0!==s.stack?s.stack:Sn.contains(t.STACK_BY_DEFAULT_MARKS,a)&&void 0===o?"zero":o,y&&n(y)?s.scale&&s.scale.type&&s.scale.type!==si.ScaleType.LINEAR?(Dr.warn(Dr.message.cannotStackNonLinearScale(s.scale.type)),null):rs.channelHasField(i,u===Rr.X?Rr.X2:Rr.Y2)?(Dr.warn(Dr.message.cannotStackRangedMark(u)),null):(s.aggregate&&!Sn.contains(ru.SUM_OPS,s.aggregate)&&Dr.warn(Dr.message.stackNonSummativeAggregate(s.aggregate)),{groupbyChannel:d?l:void 0,fieldChannel:u,impute:_a.isPathMark(a),stackBy:p,offset:y}):null}Object.defineProperty(t,"__esModule",{value:!0});var o={zero:1,center:1,normalize:1};t.isStackOffset=n,t.STACKABLE_MARKS=[_a.BAR,_a.AREA,_a.RULE,_a.POINT,_a.CIRCLE,_a.SQUARE,_a.LINE,_a.TEXT,_a.TICK],t.STACK_BY_DEFAULT_MARKS=[_a.BAR,_a.AREA],t.stack=i}),os=t(is),as=is.isStackOffset,us=is.STACKABLE_MARKS,ss=is.STACK_BY_DEFAULT_MARKS,cs=is.stack,ls=Object.freeze({"default":os,__moduleExports:is,isStackOffset:as,STACKABLE_MARKS:us,STACK_BY_DEFAULT_MARKS:ss,stack:cs}),ds=ls&&os||ls,fs=je&&Xs||je,ps=n(function(e,t){function n(e){return va.extend(e.data?{data:e.data}:{},e.transform?{transform:e.transform}:{},e.width?{width:e.width}:{},e.height?{height:e.height}:{},e.background?{background:e.background}:{},e.padding?{padding:e.padding}:{},e.title?{title:e.title}:{},{mark:e.mark,encodings:va.keys(e.encoding).map(function(t){var n={channel:t},r=e.encoding[t];for(var i in r)Ta.isEncodingTopLevelProperty(i)&&void 0!==r[i]&&(va.contains(["bin","scale","axis","legend"],i)&&null===r[i]?n[i]=!1:n[i]=r[i]);return fs.isFieldQuery(n)&&"count"===n.aggregate&&!n.field&&(n.field="*"),n})},e.config?{config:e.config}:{})}function r(e){return va.some(e.encodings,function(e){return fs.isFieldQuery(e)&&!Fa.isWildcard(e.aggregate)&&!!e.aggregate||fs.isEnabledAutoCountQuery(e)})}function i(e){if(!u(e))return null;var t=fs.toEncoding(e.encodings,{schema:null,wildcardMode:"null"}),n=e.mark;return ds.stack(n,t,o(e))}function o(e){for(var t=0,n=e.encodings;t<n.length;t++){var r=n[t];if(void 0!==r[Ta.Property.STACK]&&!Fa.isWildcard(r[Ta.Property.STACK]))return r[Ta.Property.STACK]}}function a(e){for(var t=0,n=e.encodings;t<n.length;t++){var r=n[t];if(void 0!==r[Ta.Property.STACK]&&!Fa.isWildcard(r.channel))return r.channel}return null}function u(e){if(Fa.isWildcard(e.mark))return!1;for(var t=[Ta.Property.STACK,Ta.Property.CHANNEL,Ta.Property.MARK,Ta.Property.FIELD,Ta.Property.AGGREGATE,Ta.Property.AUTOCOUNT,Ta.Property.SCALE,Ta.getEncodingNestedProp("scale","type"),Ta.Property.TYPE],n=Bi.toMap(va.without(Ta.ALL_ENCODING_PROPS,t)),r=e.encodings.filter(function(e){return!fs.isDisabledAutoCountQuery(e)}),i=0,o=r;i<o.length;i++){var a=o[i];if(s(a,{exclude:n}))return!1}return!0}function s(e,t){if(void 0===t&&(t={}),!va.isObject(e))return!1;for(var n in e)if(e.hasOwnProperty(n)){var r=Fa.isWildcard(e[n]);if(r&&(!t.exclude||!t.exclude[n])||s(e[n],t))return!0}return!1}function c(e,t){void 0===t&&(t={});var n=t.exclude?Bi.toMap(t.exclude.map(Ta.toKey)):{};if(Fa.isWildcard(e.mark)&&!n.mark)return!0;for(var r=0,i=e.encodings;r<i.length;r++){var o=i[r];if(s(o,n))return!0}return!1}Object.defineProperty(t,"__esModule",{value:!0}),t.fromSpec=n,t.isAggregate=r,t.getVlStack=i,t.getStackOffset=o,t.getStackChannel=a,t.hasRequiredStackProperties=u,t.hasWildcard=c}),ys=t(ps),gs=ps.fromSpec,hs=ps.isAggregate,ms=ps.getVlStack,Es=ps.getStackOffset,Ts=ps.getStackChannel,vs=ps.hasRequiredStackProperties,_s=ps.hasWildcard,Os=Object.freeze({"default":ys,__moduleExports:ps,fromSpec:gs,isAggregate:hs,getVlStack:ms,getStackOffset:Es,getStackChannel:Ts,hasRequiredStackProperties:vs,hasWildcard:_s}),Ss=n(function(e,t){var n=Ge&&Ge.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e};Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){void 0===e&&(e=null),this.index=e?n({},e):{}}return e.prototype.has=function(e){return Ta.toKey(e)in this.index},e.prototype.get=function(e){return this.index[Ta.toKey(e)]},e.prototype.set=function(e,t){return this.index[Ta.toKey(e)]=t,this},e.prototype.setByKey=function(e,t){this.index[e]=t},e.prototype.map=function(t){var n=new e;for(var r in this.index)n.index[r]=t(this.index[r]);return n},e.prototype.size=function(){return va.keys(this.index).length},e.prototype.duplicate=function(){return new e(this.index)},e}();t.PropIndex=r}),Ns=t(Ss),As=Ss.PropIndex,Ps=Object.freeze({"default":Ns,__moduleExports:Ss,PropIndex:As}),Cs=Os&&ys||Os,Is=Ps&&Ns||Ps,bs=n(function(e,t){function n(e){return e.map(function(e){return r(e)})}function r(e){return function(t){return void 0!==e[t]?e[t]:t}}function i(e,t){return Fa.isWildcard(e)?!Fa.isShortWildcard(e)&&e["enum"]?Fa.SHORT_WILDCARD+JSON.stringify(e["enum"]):Fa.SHORT_WILDCARD:t?t(e):e}function o(e,t){return t?t(e):e}function a(e,n,r){void 0===n&&(n=t.INCLUDE_ALL),void 0===r&&(r=t.REPLACE_NONE);var i=Cs.fromSpec(e);return u(i,n,r)}function u(e,n,r){void 0===n&&(n=t.INCLUDE_ALL),void 0===r&&(r=t.REPLACE_NONE);var o=[];n.get(Ta.Property.MARK)&&o.push(i(e.mark,r.get(Ta.Property.MARK))),e.transform&&e.transform.length>0&&o.push("transform:"+JSON.stringify(e.transform));var a;if(n.get(Ta.Property.STACK)&&(a=Cs.getVlStack(e)),e.encodings){var u=e.encodings.reduce(function(e,t){if(!fs.isDisabledAutoCountQuery(t)){var i=void 0;i=a&&t.channel===a.fieldChannel?s(y({},t,{stack:a.offset}),n,r):s(t,n,r),i&&e.push(i)}return e},[]).sort().join("|");u&&o.push(u)}for(var c=0,l=Ta.VIEW_PROPS;c<l.length;c++){var d=l[c],f=d.toString();if(n.get(d)&&e[f]){var p=e[f];o.push(f+"="+JSON.stringify(p))}}return o.join("|")}function s(e,n,r){void 0===n&&(n=t.INCLUDE_ALL),void 0===r&&(r=t.REPLACE_NONE);var o=[];if(n.get(Ta.Property.CHANNEL)&&o.push(i(e.channel,r.get(Ta.Property.CHANNEL))),fs.isFieldQuery(e)){var a=c(e,n,r);a&&o.push(a)}else fs.isValueQuery(e)?o.push(e.value):fs.isAutoCountQuery(e)&&o.push("autocount()");return o.join(":")}function c(e,n,r){if(void 0===n&&(n=t.INCLUDE_ALL),void 0===r&&(r=t.REPLACE_NONE),n.get(Ta.Property.AGGREGATE)&&fs.isDisabledAutoCountQuery(e))return"-";var o,a=l(e,n,r),u=d(e,n,r);if(fs.isFieldQuery(e)){if(o=n.get("field")?i(e.field,r.get("field")):"...",n.get(Ta.Property.TYPE))if(Fa.isWildcard(e.type))o+=","+i(e.type,r.get(Ta.Property.TYPE));else{var s=((e.type||Sa.Type.QUANTITATIVE)+"").substr(0,1);o+=","+i(s,r.get(Ta.Property.TYPE))}o+=u.map(function(e){var t=e.value instanceof Array?"["+e.value+"]":e.value;return","+e.key+"="+t}).join("")}else fs.isAutoCountQuery(e)&&(o="*,q");if(!o)return null;if(a){var c=Bi.isString(a)?a:Fa.SHORT_WILDCARD+(va.keys(a).length>0?JSON.stringify(a):"");return c+"("+o+")"}return o}function l(e,t,n){if(t.get(Ta.Property.AGGREGATE)&&e.aggregate&&!Fa.isWildcard(e.aggregate))return o(e.aggregate,n.get(Ta.Property.AGGREGATE));if(t.get(Ta.Property.AGGREGATE)&&fs.isEnabledAutoCountQuery(e))return o("count",n.get(Ta.Property.AGGREGATE));if(t.get(Ta.Property.TIMEUNIT)&&e.timeUnit&&!Fa.isWildcard(e.timeUnit))return o(e.timeUnit,n.get(Ta.Property.TIMEUNIT));if(t.get(Ta.Property.BIN)&&e.bin&&!Fa.isWildcard(e.bin))return"bin";for(var r=null,i=0,a=[Ta.Property.AGGREGATE,Ta.Property.AUTOCOUNT,Ta.Property.TIMEUNIT,Ta.Property.BIN];i<a.length;i++){var u=a[i],s=e[u];t.get(u)&&e[u]&&Fa.isWildcard(s)&&(r=r||{},r[u]=Fa.isShortWildcard(s)?s:s["enum"])}return r&&e.hasFn&&(r.hasFn=!0),r}function d(e,n,r){var a=[];if(!va.isBoolean(e.bin)&&!Fa.isShortWildcard(e.bin)){var u=e.bin;for(var s in u){var c=Ta.getEncodingNestedProp("bin",s);c&&n.get(c)&&void 0!==u[s]&&a.push({key:s,value:i(u[s],r.get(c))})}a.sort(function(e,t){return e.key.localeCompare(t.key)})}for(var l=0,d=[Ta.Property.SCALE,Ta.Property.SORT,Ta.Property.STACK,Ta.Property.AXIS,Ta.Property.LEGEND];l<d.length;l++){var f=d[l];if((Fa.isWildcard(e.channel)||t.PROPERTY_SUPPORTED_CHANNELS[f][e.channel])&&n.get(f)&&void 0!==e[f]){var p=e[f];if(va.isBoolean(p)||null===p)a.push({key:f+"",value:p||!1});else if(Bi.isString(p))a.push({key:f+"",value:o(JSON.stringify(p),r.get(f))});else{var y=[];for(var s in p){var g=Ta.getEncodingNestedProp(f,s);g&&n.get(g)&&void 0!==p[s]&&y.push({key:s,value:i(p[s],r.get(g))})}if(y.length>0){var h=y.sort(function(e,t){return e.key.localeCompare(t.key)}).reduce(function(e,t){return e[t.key]=t.value,e},{});a.push({key:f+"",value:JSON.stringify(h)})}}}}return a}function f(e){for(var t=e.split("|"),n={mark:t[0],encodings:[]},r=1;r<t.length;r++){var i=t[r],o=p(i,":",1),a=o[0],u=o[1];if(Rr.isChannel(a)||"?"===a){var s=g.encoding(a,u);n.encodings.push(s)}else"transform"!==a||(n.transform=JSON.parse(u))}return n}function p(e,t,n){for(var r=[],i=0,o=0;o<n;o++){var a=e.indexOf(t,i);if(a===-1)break;r.push(e.substring(i,a)),i=a+1}if(r.push(e.substr(i)),r.length!==n+1)for(;r.length!==n+1;)r.push("");return r}var y=Ge&&Ge.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e};Object.defineProperty(t,"__esModule",{value:!0}),t.getReplacerIndex=n,t.getReplacer=r,t.value=i,t.replace=o,t.REPLACE_NONE=new Is.PropIndex,t.INCLUDE_ALL=[].concat(Ta.DEFAULT_PROP_PRECEDENCE,Ta.SORT_PROPS,[Ta.Property.TRANSFORM,Ta.Property.STACK],Ta.VIEW_PROPS).reduce(function(e,t){return e.set(t,!0)},new Is.PropIndex),t.vlSpec=a,t.PROPERTY_SUPPORTED_CHANNELS={axis:{x:!0,y:!0,row:!0,column:!0},legend:{color:!0,opacity:!0,size:!0,shape:!0},scale:{x:!0,y:!0,color:!0,opacity:!0,row:!0,column:!0,size:!0,shape:!0},sort:{x:!0,y:!0,path:!0,order:!0},stack:{x:!0,y:!0}},t.spec=u,t.encoding=s,t.fieldDef=c,t.parse=f,t.splitWithTail=p;var g;!function(e){function t(e,t){var r=t.indexOf("(")!==-1?i(t):n(p(t,",",2));return y({channel:e},r)}function n(e){var t={};t.field=e[0],t.type=Sa.getFullName(e[1].toUpperCase())||"?";for(var n=e[2],i=0,o=0;o<n.length;){var a=n.indexOf("=",o),u=void 0;if(a===-1)break;var s=n.substring(o,a);if("{"===n[o+s.length+1]){var c=o+s.length+1;i=r(c,n,"}");var l=n.substring(c,i+1);u=JSON.parse(l),o=i+2}else if("["===n[o+s.length+1]){var d=o+s.length+1,f=r(d,n,"]"),p=n.substring(d,f+1);u=JSON.parse(p),o=f+2}else{var y=o,g=n.indexOf(",",o+s.length);g===-1&&(g=n.length),o=g+1,u=JSON.parse(n.substring(y+s.length+1,g))}Ta.isEncodingNestedParent(s)?t[s]=u:(t.bin=t.bin||{},t.bin[s]=u)}return t}function r(e,t,n){for(var r=e;r<t.length;r++)if(t[r]===n)return r}function i(e){var t={};if("?"===e[0]){var i=r(1,e,"}"),o=JSON.parse(e.substring(1,i+1));for(var a in o)va.isArray(o[a])?t[a]={"enum":o[a]}:t[a]=o[a];return y({},t,n(p(e.substring(i+2,e.length-1),",",2)))}var u=e.substring(0,e.indexOf("(")),s=e.substring(u.length+1,e.length-1),c=p(s,",",2);return ru.isAggregateOp(u)?y({aggregate:u},n(c)):Oa.isTimeUnit(u)?y({timeUnit:u},n(c)):"bin"===u?y({bin:{}},n(c)):void 0}e.encoding=t,e.rawFieldDef=n,e.getClosingIndex=r,e.fn=i}(g=t.shorthandParser||(t.shorthandParser={}))}),Rs=t(bs),Ds=bs.getReplacerIndex,Ls=bs.getReplacer,Ms=bs.value,Us=bs.replace,xs=bs.REPLACE_NONE,Fs=bs.INCLUDE_ALL,ws=bs.vlSpec,ks=bs.PROPERTY_SUPPORTED_CHANNELS,js=bs.spec,Gs=bs.encoding,Bs=bs.fieldDef,Hs=bs.parse,Ys=bs.splitWithTail,Ws=bs.shorthandParser,Qs=Object.freeze({"default":Rs,__moduleExports:bs,getReplacerIndex:Ds,getReplacer:Ls,value:Ms,replace:Us,REPLACE_NONE:xs,INCLUDE_ALL:Fs,vlSpec:ws,PROPERTY_SUPPORTED_CHANNELS:ks,spec:js,encoding:Gs,fieldDef:Bs,parse:Hs,splitWithTail:Ys,shorthandParser:Ws}),zs=Gu&&wu||Gu,Vs=Qu&&Hu||Qu,Ks=Qs&&Rs||Qs,qs=n(function(e,t){function n(e){return null!==e&&void 0!==e&&void 0!==e.value}function r(e){return null!==e&&void 0!==e&&(e.field||"count"===e.aggregate)}function i(e){return null!==e&&void 0!==e&&"autoCount"in e}function o(e){return i(e)&&e.autoCount===!1}function a(e){return i(e)&&e.autoCount===!0}function u(e,t){for(var r=(t.wildcardMode,{}),i=0,a=e;i<a.length;i++){var u=a[i];if(!o(u)){var l=u.channel;if(Fa.isWildcard(l))throw new Error("Cannot convert wildcard channel to a fixed channel");var d=n(u)?s(u):c(u,t);if(null!==d)r[l]=d;else if("null"===t.wildcardMode)return null}}return r}function s(e){var t=e.value;return Fa.isWildcard(t)?null:{value:t}}function c(e,t){void 0===t&&(t={});var n=t.props,i=void 0===n?g:n,o=t.schema,a=t.wildcardMode,u=void 0===a?"skip":a;if(r(e)){for(var s={},c=0,l=i;c<l.length;c++){
var d=l[c],f=e[d];if(Fa.isWildcard(f)){if("skip"===u)continue;return null}if(void 0!==f){var p=!Ks.PROPERTY_SUPPORTED_CHANNELS[d]||Ks.PROPERTY_SUPPORTED_CHANNELS[d][e.channel];if(!p)continue;if(Ta.isEncodingNestedParent(d)&&Bi.isObject(f)){f=y({},f);for(var h in f)if(Fa.isWildcard(f[h])){if("null"===u)return null;delete f[h]}}if("bin"===d&&f===!1)continue;"type"===d&&"key"===f?s.type="nominal":s[d]=f}if(d===Ta.Property.SCALE&&o&&e.type===Sa.Type.ORDINAL){var m=e.scale,E=o.fieldSchema(e.field).ordinalDomain;null!==m&&E&&(s[Ta.Property.SCALE]=y({domain:E},Bi.isObject(m)?m:{}))}}return s}if(e.autoCount===!1)throw new Error("Cannot convert {autoCount: false} into a field def");return{aggregate:"count",field:"*",type:"quantitative"}}function l(e){return r(e)?zu.isContinuous(c(e,{props:["bin","timeUnit","field","type"]})):i(e)}function d(e){return r(e)?!f(e)&&"temporal"!==e.type:i(e)}function f(e){if(r(e)){var t=c(e,{props:["bin","timeUnit","type"]});return zu.isDiscrete(t)||!!t.timeUnit}return!1}function p(e){var t=e.scale===!0||e.scale===Fa.SHORT_WILDCARD?{}:e.scale||{},n=e.type,r=e.channel,i=e.timeUnit,o=e.bin,a=void 0,u={};if(!(Fa.isWildcard(t.type)||Fa.isWildcard(n)||Fa.isWildcard(r)||Fa.isWildcard(o))){if(t.type)return t.type;if(!("temporal"===n&&Fa.isWildcard(i)||"quantitative"===n&&Fa.isWildcard(o))){var s=n===zs.ExpandedType.KEY?"nominal":n,c={type:s,timeUnit:i,bin:o};return Vs.scaleType(t.type,r,c,a,u)}}}var y=Ge&&Ge.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e};Object.defineProperty(t,"__esModule",{value:!0}),t.isValueQuery=n,t.isFieldQuery=r,t.isAutoCountQuery=i,t.isDisabledAutoCountQuery=o,t.isEnabledAutoCountQuery=a;var g=[Ta.Property.AGGREGATE,Ta.Property.BIN,Ta.Property.TIMEUNIT,Ta.Property.FIELD,Ta.Property.TYPE,Ta.Property.SCALE,Ta.Property.SORT,Ta.Property.AXIS,Ta.Property.LEGEND,Ta.Property.STACK,Ta.Property.FORMAT];t.toEncoding=u,t.toValueDef=s,t.toFieldDef=c,t.isContinuous=l,t.isMeasure=d,t.isDimension=f,t.scaleType=p}),Xs=t(qs),$s=qs.isValueQuery,Js=qs.isFieldQuery,Zs=qs.isAutoCountQuery,ec=qs.isDisabledAutoCountQuery,tc=qs.isEnabledAutoCountQuery,nc=qs.toEncoding,rc=qs.toValueDef,ic=qs.toFieldDef,oc=qs.isContinuous,ac=qs.isMeasure,uc=qs.isDimension,sc=qs.scaleType,cc="__types__",lc={"boolean":Bi["boolean"],integer:Bi.number,number:Bi.number,date:Bi.date,string:function(e){return null==e||""===e?null:e+""}},dc={"boolean":function(e){return"true"===e||"false"===e||Bi.isBoolean(e)},integer:function(e){return dc.number(e)&&(e=+e)===~~e},number:function(e){return!isNaN(+e)&&!Bi.isDate(e)},date:function(e){return!isNaN(Date.parse(e))}};ve.annotation=me,ve.all=_e,ve.infer=Oe,ve.inferAll=Se,ve.parsers=lc;var fc=ve,pc=fc.inferAll,yc=Object.freeze({"default":fc,__moduleExports:fc,inferAll:pc}),gc=n(function(e){var t=e.exports;t.repeat=function(e,t){var n,r=Array(t);for(n=0;n<t;++n)r[n]=e;return r},t.zeros=function(e){return t.repeat(0,e)},t.range=function(e,t,n){if(arguments.length<3&&(n=1,arguments.length<2&&(t=e,e=0)),(t-e)/n==1/0)throw new Error("Infinite range");var r,i=[],o=-1;if(n<0)for(;(r=e+n*++o)>t;)i.push(r);else for(;(r=e+n*++o)<t;)i.push(r);return i},t.random={},t.random.uniform=function(e,n){void 0===n&&(n=void 0===e?1:e,e=0);var r=n-e,i=function(){return e+r*Math.random()};return i.samples=function(e){return t.zeros(e).map(i)},i.pdf=function(t){return t>=e&&t<=n?1/r:0},i.cdf=function(t){return t<e?0:t>n?1:(t-e)/r},i.icdf=function(t){return t>=0&&t<=1?e+t*r:NaN},i},t.random.integer=function(e,n){void 0===n&&(n=e,e=0);var r=n-e,i=function(){return e+Math.floor(r*Math.random())};return i.samples=function(e){return t.zeros(e).map(i)},i.pdf=function(t){return t===Math.floor(t)&&t>=e&&t<n?1/r:0},i.cdf=function(t){var i=Math.floor(t);return i<e?0:i>=n?1:(i-e+1)/r},i.icdf=function(t){return t>=0&&t<=1?e-1+Math.floor(t*r):NaN},i},t.random.normal=function(e,n){e=e||0,n=n||1;var r,i=function(){var t,i,o=0,a=0;if(void 0!==r)return o=r,r=void 0,o;do o=2*Math.random()-1,a=2*Math.random()-1,t=o*o+a*a;while(0===t||t>1);return i=Math.sqrt(-2*Math.log(t)/t),r=e+a*i*n,e+o*i*n};return i.samples=function(e){return t.zeros(e).map(i)},i.pdf=function(t){var r=Math.exp(Math.pow(t-e,2)/(-2*Math.pow(n,2)));return 1/(n*Math.sqrt(2*Math.PI))*r},i.cdf=function(t){var r,i=(t-e)/n,o=Math.abs(i);if(o>37)r=0;else{var a,u=Math.exp(-o*o/2);o<7.07106781186547?(a=.0352624965998911*o+.700383064443688,a=a*o+6.37396220353165,a=a*o+33.912866078383,a=a*o+112.079291497871,a=a*o+221.213596169931,a=a*o+220.206867912376,r=u*a,a=.0883883476483184*o+1.75566716318264,a=a*o+16.064177579207,a=a*o+86.7807322029461,a=a*o+296.564248779674,a=a*o+637.333633378831,a=a*o+793.826512519948,a=a*o+440.413735824752,r/=a):(a=o+.65,a=o+4/a,a=o+3/a,a=o+2/a,a=o+1/a,r=u/a/2.506628274631)}return i>0?1-r:r},i.icdf=function(t){if(t<=0||t>=1)return NaN;var r=2*t-1,i=8*(Math.PI-3)/(3*Math.PI*(4-Math.PI)),o=2/(Math.PI*i)+Math.log(1-Math.pow(r,2))/2,a=Math.log(1-r*r)/i,u=(r>0?1:-1)*Math.sqrt(Math.sqrt(o*o-a)-o);return e+n*Math.SQRT2*u},i},t.random.bootstrap=function(e,n){var r=e.filter(Bi.isValid),i=r.length,o=n?t.random.normal(0,n):null,a=function(){return r[~~(Math.random()*i)]+(o?o():0)};return a.samples=function(e){return t.zeros(e).map(a)},a}}),hc=Object.freeze({"default":gc,__moduleExports:gc}),mc=yc&&fc||yc,Ec=hc&&gc||hc,Tc=n(function(e){function t(e,t,n){var r=e&&e.nullh||0,o=Ec.random.normal(0,1),a=i.mean(t,n),u=i.stdev(t,n)/Math.sqrt(i.count.valid(t,n));if(0===u)return a-r===0?1:0;var s=(a-r)/u;return 2*o.cdf(-Math.abs(s))}function n(e,t,n,r){var o,a=r?t.map(Bi.$(n)):t,u=r?t.map(Bi.$(r)):n,s=i.count(a),c=i.count(u),l=Array();if(s!==c)throw Error("Array lengths must match.");for(o=0;o<s;++o)Bi.isValid(a[o])&&Bi.isValid(u[o])&&l.push(a[o]-u[o]);return i.z.test(l,e&&e.nullh||0)}function r(e,t,n,r){var o=r?t.map(Bi.$(n)):t,a=r?t.map(Bi.$(r)):n,u=i.count.valid(o),s=i.count.valid(a),c=Ec.random.normal(0,1),l=i.mean(o)-i.mean(a)-(e&&e.nullh||0),d=Math.sqrt(i.variance(o)/u+i.variance(a)/s);if(0===d)return 0===l?1:0;var f=l/d;return 2*c.cdf(-Math.abs(f))}var i=e.exports;i.unique=function(e,t,n){t=Bi.$(t),n=n||[];var r,i,o,a={};for(i=0,o=e.length;i<o;++i)r=t?t(e[i]):e[i],r in a||(a[r]=1,n.push(r));return n},i.count=function(e){return e&&e.length||0},i.count.valid=function(e,t){t=Bi.$(t);var n,r,i,o=0;for(r=0,i=e.length;r<i;++r)n=t?t(e[r]):e[r],Bi.isValid(n)&&(o+=1);return o},i.count.missing=function(e,t){t=Bi.$(t);var n,r,i,o=0;for(r=0,i=e.length;r<i;++r)n=t?t(e[r]):e[r],null==n&&(o+=1);return o},i.count.distinct=function(e,t){t=Bi.$(t);var n,r,i,o={},a=0;for(r=0,i=e.length;r<i;++r)n=t?t(e[r]):e[r],n in o||(o[n]=1,a+=1);return a},i.count.map=function(e,t){t=Bi.$(t);var n,r,i,o={};for(r=0,i=e.length;r<i;++r)n=t?t(e[r]):e[r],o[n]=n in o?o[n]+1:1;return o},i.median=function(e,t){return t&&(e=e.map(Bi.$(t))),e=e.filter(Bi.isValid).sort(Bi.cmp),i.quantile(e,.5)},i.quartile=function(e,t){t&&(e=e.map(Bi.$(t))),e=e.filter(Bi.isValid).sort(Bi.cmp);var n=i.quantile;return[n(e,.25),n(e,.5),n(e,.75)]},i.quantile=function(e,t,n){void 0===n&&(n=t,t=Bi.identity),t=Bi.$(t);var r=(e.length-1)*n+1,i=Math.floor(r),o=+t(e[i-1]),a=r-i;return a?o+a*(t(e[i])-o):o},i.sum=function(e,t){t=Bi.$(t);for(var n,r=0,i=0,o=e.length;i<o;++i)n=t?t(e[i]):e[i],Bi.isValid(n)&&(r+=n);return r},i.mean=function(e,t){t=Bi.$(t);var n,r,i,o,a,u=0;for(r=0,o=0,i=e.length;r<i;++r)a=t?t(e[r]):e[r],Bi.isValid(a)&&(n=a-u,u+=n/++o);return u},i.mean.geometric=function(e,t){t=Bi.$(t);var n,r,i,o,a=1;for(o=0,n=0,r=e.length;o<r;++o)if(i=t?t(e[o]):e[o],Bi.isValid(i)){if(i<=0)throw Error("Geometric mean only defined for positive values.");a*=i,++n}return a=n>0?Math.pow(a,1/n):0},i.mean.harmonic=function(e,t){t=Bi.$(t);var n,r,i,o,a=0;for(o=0,n=0,r=e.length;o<r;++o)i=t?t(e[o]):e[o],Bi.isValid(i)&&(a+=1/i,++n);return n/a},i.variance=function(e,t){if(t=Bi.$(t),!Bi.isArray(e)||e.length<2)return 0;var n,r,i,o,a=0,u=0;for(r=0,i=0;r<e.length;++r)o=t?t(e[r]):e[r],Bi.isValid(o)&&(n=o-a,a+=n/++i,u+=n*(o-a));return u/=i-1},i.stdev=function(e,t){return Math.sqrt(i.variance(e,t))},i.modeskew=function(e,t){var n=i.mean(e,t),r=i.median(e,t),o=i.stdev(e,t);return 0===o?0:(n-r)/o},i.min=function(e,t){return i.extent(e,t)[0]},i.max=function(e,t){return i.extent(e,t)[1]},i.extent=function(e,t){t=Bi.$(t);var n,r,i,o,a=e.length;for(o=0;o<a;++o)if(i=t?t(e[o]):e[o],Bi.isValid(i)){n=r=i;break}for(;o<a;++o)i=t?t(e[o]):e[o],Bi.isValid(i)&&(i<n&&(n=i),i>r&&(r=i));return[n,r]},i.extent.index=function(e,t){t=Bi.$(t);var n,r,i,o,a=-1,u=-1,s=e.length;for(o=0;o<s;++o)if(i=t?t(e[o]):e[o],Bi.isValid(i)){n=r=i,a=u=o;break}for(;o<s;++o)i=t?t(e[o]):e[o],Bi.isValid(i)&&(i<n&&(n=i,a=o),i>r&&(r=i,u=o));return[a,u]},i.dot=function(e,t,n){var r,i,o=0;if(n)for(t=Bi.$(t),n=Bi.$(n),r=0;r<e.length;++r)i=t(e[r])*n(e[r]),i===i&&(o+=i);else{if(e.length!==t.length)throw Error("Array lengths must match.");for(r=0;r<e.length;++r)i=e[r]*t[r],i===i&&(o+=i)}return o},i.dist=function(e,t,n,r){var i,o,a=Bi.isFunction(n)||Bi.isString(n),u=e,s=a?e:t,c=a?r:n,l=2===c||null==c,d=e.length,f=0;for(a&&(t=Bi.$(t),n=Bi.$(n)),o=0;o<d;++o)i=a?t(u[o])-n(s[o]):u[o]-s[o],f+=l?i*i:Math.pow(Math.abs(i),c);return l?Math.sqrt(f):Math.pow(f,1/c)},i.cohensd=function(e,t,n){var r=n?e.map(Bi.$(t)):e,o=n?e.map(Bi.$(n)):t,a=i.mean(r),u=i.mean(o),s=i.count.valid(r),c=i.count.valid(o);if(s+c-2<=0)return 0;var l=i.variance(r),d=i.variance(o),f=Math.sqrt(((s-1)*l+(c-1)*d)/(s+c-2));return 0===f?0:(a-u)/f},i.covariance=function(e,t,n){var r,o,a,u,s,c=n?e.map(Bi.$(t)):e,l=n?e.map(Bi.$(n)):t,d=c.length,f=i.mean(c),p=i.mean(l),y=0,g=0;if(d!==l.length)throw Error("Input lengths must match.");for(r=0;r<d;++r)if(o=c[r],u=Bi.isValid(o),a=l[r],s=Bi.isValid(a),u&&s)y+=(o-f)*(a-p),++g;else if(u||s)throw Error("Valid values must align.");return y/(g-1)},i.rank=function(e,t){t=Bi.$(t)||Bi.identity;var n,r,i,o=e.map(function(e,n){return{idx:n,val:t(e)}}).sort(Bi.comparator("val")),a=e.length,u=Array(a),s=-1,c={};for(n=0;n<a;++n){if(r=o[n].val,s<0&&c===r)s=n-1;else if(s>-1&&c!==r){for(i=1+(n-1+s)/2;s<n;++s)u[o[s].idx]=i;s=-1}u[o[n].idx]=n+1,c=r}if(s>-1)for(i=1+(a-1+s)/2;s<a;++s)u[o[s].idx]=i;return u},i.cor=function(e,t,n){var r=n;n=r?e.map(Bi.$(n)):t,t=r?e.map(Bi.$(t)):e;var o=i.dot(t,n),a=i.mean(t),u=i.mean(n),s=i.stdev(t),c=i.stdev(n),l=e.length;return(o-l*a*u)/((l-1)*s*c)},i.cor.rank=function(e,t,n){var r,o,a,u=n?i.rank(e,t):i.rank(e),s=n?i.rank(e,n):i.rank(t),c=e.length;for(r=0,o=0;r<c;++r)a=u[r]-s[r],o+=a*a;return 1-6*o/(c*(c*c-1))},i.cor.dist=function(e,t,n){var r,o,a,u,s=n?e.map(Bi.$(t)):e,c=n?e.map(Bi.$(n)):t,l=i.dist.mat(s),d=i.dist.mat(c),f=l.length;for(r=0,o=0,a=0,u=0;r<f;++r)o+=l[r]*l[r],a+=d[r]*d[r],u+=l[r]*d[r];return Math.sqrt(u/Math.sqrt(o*a))},i.linearRegression=function(e,t,n){var r,o,a=n?e.map(Bi.$(t)):e,u=n?e.map(Bi.$(n)):t,s=a.length,c=i.covariance(a,u),l=i.stdev(a),d=i.stdev(u),f=c/(l*l),p=i.mean(u)-f*i.mean(a),y={slope:f,intercept:p,R:c/(l*d),rss:0};for(o=0;o<s;++o)Bi.isValid(a[o])&&Bi.isValid(u[o])&&(r=f*a[o]+p-u[o],y.rss+=r*r);return y},i.bootstrap={},i.bootstrap.ci=function(e,t,n,r,o){var a,u,s,c,l,d,f;for(Bi.isFunction(t)||Bi.isString(t)?(a=e.map(Bi.$(t)),u=n,s=r,c=o):(a=e,u=t,s=n,c=r),u=u?+u:1e3,s=s||.05,l=Ec.random.bootstrap(a,c),f=0,d=Array(u);f<u;++f)d[f]=i.mean(l.samples(a.length));return d.sort(Bi.numcmp),[i.quantile(d,s/2),i.quantile(d,1-s/2)]},i.z={},i.z.ci=function(e,t,n){var r=e,o=t;(Bi.isFunction(t)||Bi.isString(t))&&(r=e.map(Bi.$(t)),o=n),o=o||.05;var a=.05===o?1.96:Ec.random.normal(0,1).icdf(1-o/2),u=i.mean(r),s=i.stdev(r)/Math.sqrt(i.count.valid(r));return[u-a*s,u+a*s]},i.z.test=function(e,i,o,a){return Bi.isFunction(o)||Bi.isString(o)?(a&&a.paired?n:r)(a,e,i,o):Bi.isArray(i)?(o&&o.paired?n:r)(o,e,i):Bi.isFunction(i)||Bi.isString(i)?t(o,e,i):t(i,e)},i.dist.mat=function(e){var t,n,r,i=e.length,o=i*i,a=Array(o),u=Ec.zeros(i),s=0;for(n=0;n<i;++n)for(a[n*i+n]=0,r=n+1;r<i;++r)a[n*i+r]=t=Math.abs(e[n]-e[r]),a[r*i+n]=t,u[n]+=t,u[r]+=t;for(n=0;n<i;++n)s+=u[n],u[n]/=i;for(s/=o,n=0;n<i;++n)for(r=n;r<i;++r)a[n*i+r]+=s-u[n]-u[r],a[r*i+n]=a[n*i+r];return a},i.entropy=function(e,t){t=Bi.$(t);var n,r,i=0,o=0,a=e.length;for(n=0;n<a;++n)i+=t?t(e[n]):e[n];if(0===i)return 0;for(n=0;n<a;++n)r=(t?t(e[n]):e[n])/i,r&&(o+=r*Math.log(r));return-o/Math.LN2},i.mutual=function(e,t,n,r){var i,o,a,u=r?e.map(Bi.$(t)):e,s=r?e.map(Bi.$(n)):t,c=r?e.map(Bi.$(r)):n,l={},d={},f=c.length,p=0,y=0,g=0;for(a=0;a<f;++a)l[u[a]]=0,d[s[a]]=0;for(a=0;a<f;++a)l[u[a]]+=c[a],d[s[a]]+=c[a],p+=c[a];for(o=1/(p*Math.LN2),a=0;a<f;++a)0!==c[a]&&(i=p*c[a]/(l[u[a]]*d[s[a]]),y+=c[a]*o*Math.log(i),g+=c[a]*o*Math.log(c[a]/p));return[y,1+y/g]},i.mutual.info=function(e,t,n,r){return i.mutual(e,t,n,r)[0]},i.mutual.dist=function(e,t,n,r){return i.mutual(e,t,n,r)[1]},i.profile=function(e,t){var n,r,o,a,u,s=0,c=0,l=0,d=0,f=null,p=null,y=0,g=[],h={};for(o=0;o<e.length;++o)a=t?t(e[o]):e[o],h[a]=a in h?h[a]+1:(d+=1,1),null==a?++l:Bi.isValid(a)&&(u="string"==typeof a?a.length:a,(null===f||u<f)&&(f=u),(null===p||u>p)&&(p=u),n=u-s,s+=n/++c,y+=n*(u-s),g.push(u));return y/=c-1,r=Math.sqrt(y),g.sort(Bi.cmp),{type:mc(e,t),unique:h,count:e.length,valid:c,missing:l,distinct:d,min:f,max:p,mean:s,stdev:r,median:a=i.quantile(g,.5),q1:i.quantile(g,.25),q3:i.quantile(g,.75),modeskew:0===r?0:(s-a)/r}},i.summary=function(e,t){t=t||Bi.keys(e[0]);var n=t.map(function(t){var n=i.profile(e,Bi.$(t));return n.field=t,n});return n.__summary__=!0,n}}),vc=Tc.summary,_c=Object.freeze({"default":Tc,__moduleExports:Tc,summary:vc}),Oc=n(function(e,t){!function(e,n){n(t)}(Ge,function(e){function t(e,n,r,a){function u(t){return e(t=new Date((+t))),t}return u.floor=u,u.round=function(t){var r=new Date((+t)),i=new Date(t-1);return e(r),e(i),n(i,1),t-r<i-t?r:i},u.ceil=function(t){return e(t=new Date(t-1)),n(t,1),t},u.offset=function(e,t){return n(e=new Date((+e)),null==t?1:Math.floor(t)),e},u.range=function(t,r,i){var o=[];if(t=new Date(t-1),r=new Date((+r)),i=null==i?1:Math.floor(i),!(t<r&&i>0))return o;for(n(t,1),e(t),t<r&&o.push(new Date((+t)));n(t,i),e(t),t<r;)o.push(new Date((+t)));return o},u.filter=function(r){return t(function(t){for(;e(t),!r(t);)t.setTime(t-1)},function(e,t){for(;--t>=0;)for(;n(e,1),!r(e););})},r&&(u.count=function(t,n){return i.setTime(+t),o.setTime(+n),e(i),e(o),Math.floor(r(i,o))},u.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?u.filter(a?function(t){return a(t)%e===0}:function(t){return u.count(0,t)%e===0}):u:null}),u}function n(e){return t(function(t){t.setHours(0,0,0,0),t.setDate(t.getDate()-(t.getDay()+7-e)%7)},function(e,t){e.setDate(e.getDate()+7*t)},function(e,t){return(t-e-6e4*(t.getTimezoneOffset()-e.getTimezoneOffset()))/6048e5})}function r(e){return t(function(t){t.setUTCHours(0,0,0,0),t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7)},function(e,t){e.setUTCDate(e.getUTCDate()+7*t)},function(e,t){return(t-e)/6048e5})}var i=new Date,o=new Date,a=t(function(){},function(e,t){e.setTime(+e+t)},function(e,t){return t-e});a.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?t(function(t){t.setTime(Math.floor(t/e)*e)},function(t,n){t.setTime(+t+n*e)},function(t,n){return(n-t)/e}):a:null};var u=t(function(e){e.setMilliseconds(0)},function(e,t){e.setTime(+e+1e3*t)},function(e,t){return(t-e)/1e3},function(e){return e.getSeconds()}),s=t(function(e){e.setSeconds(0,0)},function(e,t){e.setTime(+e+6e4*t)},function(e,t){return(t-e)/6e4},function(e){return e.getMinutes()}),c=t(function(e){e.setMinutes(0,0,0)},function(e,t){e.setTime(+e+36e5*t)},function(e,t){return(t-e)/36e5},function(e){return e.getHours()}),l=t(function(e){e.setHours(0,0,0,0)},function(e,t){e.setDate(e.getDate()+t)},function(e,t){return(t-e-6e4*(t.getTimezoneOffset()-e.getTimezoneOffset()))/864e5},function(e){return e.getDate()-1}),d=n(0),f=n(1),p=n(2),y=n(3),g=n(4),h=n(5),m=n(6),E=t(function(e){e.setHours(0,0,0,0),e.setDate(1)},function(e,t){e.setMonth(e.getMonth()+t)},function(e,t){return t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear())},function(e){return e.getMonth()}),T=t(function(e){e.setHours(0,0,0,0),e.setMonth(0,1)},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e,t){return t.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()}),v=t(function(e){e.setUTCMilliseconds(0)},function(e,t){e.setTime(+e+1e3*t)},function(e,t){return(t-e)/1e3},function(e){return e.getUTCSeconds()}),_=t(function(e){e.setUTCSeconds(0,0)},function(e,t){e.setTime(+e+6e4*t)},function(e,t){return(t-e)/6e4},function(e){return e.getUTCMinutes()}),O=t(function(e){e.setUTCMinutes(0,0,0)},function(e,t){e.setTime(+e+36e5*t)},function(e,t){return(t-e)/36e5},function(e){return e.getUTCHours()}),S=t(function(e){e.setUTCHours(0,0,0,0)},function(e,t){e.setUTCDate(e.getUTCDate()+t)},function(e,t){return(t-e)/864e5},function(e){return e.getUTCDate()-1}),N=r(0),A=r(1),P=r(2),C=r(3),I=r(4),b=r(5),R=r(6),D=t(function(e){e.setUTCHours(0,0,0,0),e.setUTCDate(1)},function(e,t){e.setUTCMonth(e.getUTCMonth()+t)},function(e,t){return t.getUTCMonth()-e.getUTCMonth()+12*(t.getUTCFullYear()-e.getUTCFullYear())},function(e){return e.getUTCMonth()}),L=t(function(e){e.setUTCHours(0,0,0,0),e.setUTCMonth(0,1)},function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)},function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()}),M=a.range,U=u.range,x=s.range,F=c.range,w=l.range,k=d.range,j=f.range,G=p.range,B=y.range,H=g.range,Y=h.range,W=m.range,Q=d.range,z=E.range,V=T.range,K=a,q=M,X=v.range,$=_.range,J=O.range,Z=S.range,ee=N.range,te=A.range,ne=P.range,re=C.range,ie=I.range,oe=b.range,ae=R.range,ue=N.range,se=D.range,ce=L.range,le="0.1.1";e.version=le,e.milliseconds=M,e.seconds=U,e.minutes=x,e.hours=F,e.days=w,e.sundays=k,e.mondays=j,e.tuesdays=G,e.wednesdays=B,e.thursdays=H,e.fridays=Y,e.saturdays=W,e.weeks=Q,e.months=z,e.years=V,e.utcMillisecond=K,e.utcMilliseconds=q,e.utcSeconds=X,e.utcMinutes=$,e.utcHours=J,e.utcDays=Z,e.utcSundays=ee,e.utcMondays=te,e.utcTuesdays=ne,e.utcWednesdays=re,e.utcThursdays=ie,e.utcFridays=oe,e.utcSaturdays=ae,e.utcWeeks=ue,e.utcMonths=se,e.utcYears=ce,e.millisecond=a,e.second=u,e.minute=s,e.hour=c,e.day=l,e.sunday=d,e.monday=f,e.tuesday=p,e.wednesday=y,e.thursday=g,e.friday=h,e.saturday=m,e.week=d,e.month=E,e.year=T,e.utcSecond=v,e.utcMinute=_,e.utcHour=O,e.utcDay=S,e.utcSunday=N,e.utcMonday=A,e.utcTuesday=P,e.utcWednesday=C,e.utcThursday=I,e.utcFriday=b,e.utcSaturday=R,e.utcWeek=N,e.utcMonth=D,e.utcYear=L,e.interval=t})}),Sc=Object.freeze({"default":Oc,__moduleExports:Oc}),Nc=Sc&&Oc||Sc,Ac=new Date,Pc=new Date(0,0,1).setFullYear(0),Cc=new Date(Date.UTC(0,0,1)).setUTCFullYear(0),Ic=[Pe("second",Nc.second,Pc),Pe("minute",Nc.minute,Pc),Pe("hour",Nc.hour,Pc),Pe("day",Nc.day,Pc,[1,7]),Pe("month",Nc.month,Pc,[1,3,6]),Pe("year",Nc.year,Pc),Ae("seconds",function(e){return new Date(1970,0,1,0,0,e)},function(e){return Ne(e).getSeconds()},null,0,59),Ae("minutes",function(e){return new Date(1970,0,1,0,e)},function(e){return Ne(e).getMinutes()},null,0,59),Ae("hours",function(e){return new Date(1970,0,1,e)},function(e){return Ne(e).getHours()},null,0,23),Ae("weekdays",function(e){return new Date(1970,0,4+e)},function(e){return Ne(e).getDay()},[1],0,6),Ae("dates",function(e){return new Date(1970,0,e)},function(e){return Ne(e).getDate()},[1],1,31),Ae("months",function(e){return new Date(1970,e%12,1)},function(e){return Ne(e).getMonth()},[1],0,11)],bc=[Pe("second",Nc.utcSecond,Cc),Pe("minute",Nc.utcMinute,Cc),Pe("hour",Nc.utcHour,Cc),Pe("day",Nc.utcDay,Cc,[1,7]),Pe("month",Nc.utcMonth,Cc,[1,3,6]),Pe("year",Nc.utcYear,Cc),Ae("seconds",function(e){return new Date(Date.UTC(1970,0,1,0,0,e))},function(e){return Ne(e).getUTCSeconds()},null,0,59),Ae("minutes",function(e){return new Date(Date.UTC(1970,0,1,0,e))},function(e){return Ne(e).getUTCMinutes()},null,0,59),Ae("hours",function(e){return new Date(Date.UTC(1970,0,1,e))},function(e){return Ne(e).getUTCHours()},null,0,23),Ae("weekdays",function(e){return new Date(Date.UTC(1970,0,4+e))},function(e){return Ne(e).getUTCDay()},[1],0,6),Ae("dates",function(e){return new Date(Date.UTC(1970,0,e))},function(e){return Ne(e).getUTCDate()},[1],1,31),Ae("months",function(e){return new Date(Date.UTC(1970,e%12,1))},function(e){return Ne(e).getUTCMonth()},[1],0,11)],Rc=[[31536e6,5],[7776e6,4],[2592e6,4],[12096e5,3],[6048e5,3],[1728e5,3],[864e5,3],[432e5,2],[216e5,2],[108e5,2],[36e5,2],[18e5,1],[9e5,1],[3e5,1],[6e4,1],[3e4,0],[15e3,0],[5e3,0],[1e3,0]],Dc=Ie(Ic),Lc=Ie(bc);Dc.utc=Lc;var Mc=Object.freeze({"default":Dc,__moduleExports:Dc,utc:Lc}),Uc=Mc&&Dc||Mc,xc=1e-15;be.date=function(e){if(!e)throw Error("Missing date binning options.");var t=e.utc?Uc.utc:Uc,n=e.min,r=e.max,i=e.maxbins||20,o=e.minbins||4,a=+r-+n,u=e.unit?t[e.unit]:t.find(a,o,i),s=be({min:null!=u.min?u.min:u.unit(n),max:null!=u.max?u.max:u.unit(r),maxbins:i,minstep:u.minstep,steps:u.step});return s.unit=u,s.index=Ue,e.raw||(s.value=Me),s};var Fc=be,wc=Object.freeze({"default":Fc,__moduleExports:Fc}),kc=_c&&Tc||_c,jc=wc&&Fc||wc,Gc=Ba&&ka||Ba,Bc=n(function(e,t){function n(e,t,n){void 0===t&&(t={}),void 0===n&&(n={fields:[]}),t=va.extend({},Gc.DEFAULT_QUERY_CONFIG,t);for(var o=kc.summary(e),a=mc.inferAll(e),s=n.fields.reduce(function(e,t){return e[t.name]=t,e},{}),c=o.map(function(n,r){var i,o=n.field,u="date"===a[o]?d.DATETIME:a[o],c=n.distinct;if(u===d.NUMBER)i=Sa.Type.QUANTITATIVE;else if(u===d.INTEGER)i=c<t.numberNominalLimit&&c/n.count<t.numberNominalProportion?Sa.Type.NOMINAL:Sa.Type.QUANTITATIVE;else if(u===d.DATETIME){i=Sa.Type.TEMPORAL,n.min=new Date(e[0][o]),n.max=new Date(e[0][o]);for(var l=0,f=e;l<f.length;l++){var p=f[l],y=new Date(p[o]).getTime();y<n.min.getTime()&&(n.min=new Date(y)),y>n.max.getTime()&&(n.max=new Date(y))}}else i=Sa.Type.NOMINAL;i===Sa.Type.NOMINAL&&c/n.count>t.minPercentUniqueForKey&&n.count>t.minCardinalityForKey&&(i=zs.ExpandedType.KEY);var g={name:o,originalIndex:r,vlType:i,type:u,stats:n,timeStats:{},binStats:{}},h=s[g.name];return g=va.extend(g,h)}),f=0,p=c;f<p.length;f++){var y=p[f];if(y.vlType===Sa.Type.QUANTITATIVE)for(var g=0,h=t["enum"].binProps.maxbins;g<h.length;g++){var m=h[g];y.binStats[m]=r(m,y.stats)}else if(y.vlType===Sa.Type.TEMPORAL)for(var E=0,T=t["enum"].timeUnit;E<T.length;E++){var v=T[E];void 0!==v&&(y.timeStats[v]=i(v,y.stats))}}var _=u({},n,{fields:c});return new l(_)}function r(e,t){var n=s({min:t.min,max:t.max,maxbins:e}),r=va.extend({},t);return r.unique=o(n,t.unique),r.distinct=(n.stop-n.start)/n.step,r.min=n.start,r.max=n.stop,r}function i(e,t){var n=va.extend({},t),r={};return va.keys(t.unique).forEach(function(n){var i,o="null"===n?null:new Date(n);i=null===o?null:isNaN(o.getTime())?"Invalid Date":(e===Oa.TimeUnit.DAY?o.getDay():Oa.convert(e,o)).toString(),r[i]=(r[i]||0)+t.unique[n]}),n.unique=r,n.distinct=va.keys(r).length,n}function o(e,t){var n={};for(var r in t){var i=void 0;i=null===r?null:isNaN(Number(r))?NaN:e.value(Number(r)),n[i]=(n[i]||0)+t[r]}return n}function a(e,t){return t.reduce(function(t,n){return e[n]?t+1:t},0)}var u=Ge&&Ge.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e};Object.defineProperty(t,"__esModule",{value:!0});var s=jc;t.build=n;var c={nominal:0,key:1,ordinal:2,temporal:3,quantitative:4},l=function(){function e(e){this._tableSchema=e,e.fields.sort(function(e,t){return c[e.vlType]<c[t.vlType]?-1:c[e.vlType]>c[t.vlType]?1:e.name.localeCompare(t.name)}),e.fields.forEach(function(e,t){return e.index=t}),this._fieldSchemaIndex=e.fields.reduce(function(e,t){return e[t.name]=t,e},{})}return e.prototype.fieldNames=function(){return this._tableSchema.fields.map(function(e){return e.name})},Object.defineProperty(e.prototype,"fieldSchemas",{get:function(){return this._tableSchema.fields},enumerable:!0,configurable:!0}),e.prototype.fieldSchema=function(e){return this._fieldSchemaIndex[e]},e.prototype.tableSchema=function(){var e=va.duplicate(this._tableSchema);return e.fields.sort(function(e,t){return e.originalIndex-t.originalIndex}),e},e.prototype.primitiveType=function(e){return this._fieldSchemaIndex[e]?this._fieldSchemaIndex[e].type:null},e.prototype.vlType=function(e){return this._fieldSchemaIndex[e]?this._fieldSchemaIndex[e].vlType:null},e.prototype.cardinality=function(e,t,n){void 0===t&&(t=!0),void 0===n&&(n=!1);var o=this._fieldSchemaIndex[e.field];if(e.aggregate||fs.isAutoCountQuery(e)&&e.autoCount)return 1;if(e.bin){var s=void 0;s="boolean"==typeof e.bin?{maxbins:iu.autoMaxBins(e.channel)}:"?"===e.bin?{"enum":[!0,!1]}:e.bin;var c=s.maxbins;return o.binStats[c]||(o.binStats[c]=r(c,o.stats)),o.binStats[c].distinct}if(e.timeUnit){if(t)switch(e.timeUnit){case Oa.TimeUnit.SECONDS:return 60;case Oa.TimeUnit.MINUTES:return 60;case Oa.TimeUnit.HOURS:return 24;case Oa.TimeUnit.DAY:return 7;case Oa.TimeUnit.DATE:return 31;case Oa.TimeUnit.MONTH:return 12;case Oa.TimeUnit.QUARTER:return 4;case Oa.TimeUnit.MILLISECONDS:return 1e3}var l=e.timeUnit,d=o.timeStats;return d&&d[l]||(d=u({},d,(f={},f[l]=i(e.timeUnit,o.stats),f))),n?d[l].distinct-a(d[l].unique,["Invalid Date",null]):d[l].distinct}return o?n?o.stats.distinct-a(o.stats.unique,[NaN,null]):o.stats.distinct:null;var f},e.prototype.timeUnitHasVariation=function(e){if(e.timeUnit){if(e.timeUnit===Oa.TimeUnit.DAY){var t=va.extend({},e,{timeUnit:Oa.TimeUnit.DATE});if(this.cardinality(t,!1,!0)<=1)return!1}for(var n=e.timeUnit,r=0,i=Oa.TIMEUNIT_PARTS;r<i.length;r++){var o=i[r];if(Oa.containsTimeUnit(n,o)){var a=va.extend({},e,{timeUnit:o});if(this.cardinality(a,!1,!0)<=1)return!1}}return!0}},e.prototype.domain=function(e){var t=this._fieldSchemaIndex[e.field],n=va.keys(t.stats.unique);return t.vlType===Sa.Type.QUANTITATIVE?[+t.stats.min,+t.stats.max]:t.type===d.DATETIME?[t.stats.min,t.stats.max]:t.type===d.INTEGER||t.type===d.NUMBER?(n=n.map(function(e){return+e}),n.sort(va.cmp)):t.vlType===Sa.Type.ORDINAL&&t.ordinalDomain?t.ordinalDomain:n.map(function(e){return"null"===e?null:e}).sort(va.cmp)},e.prototype.stats=function(e){var t=this._fieldSchemaIndex[e.field];return t?t.stats:null},e}();t.Schema=l;var d;!function(e){e[e.STRING="string"]="STRING",e[e.NUMBER="number"]="NUMBER",e[e.INTEGER="integer"]="INTEGER",e[e.BOOLEAN="boolean"]="BOOLEAN",e[e.DATETIME="datetime"]="DATETIME"}(d=t.PrimitiveType||(t.PrimitiveType={}))}),Hc=t(Bc),Yc=Bc.build,Wc=Bc.Schema,Qc=Bc.PrimitiveType,zc=Object.freeze({"default":Hc,__moduleExports:Bc,build:Yc,Schema:Wc,PrimitiveType:Qc}),Vc=n(function(e,t){var n=Ge&&Ge.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.constraint=e}return e.prototype.name=function(){return this.constraint.name},e.prototype.description=function(){return this.constraint.description},e.prototype.properties=function(){return this.constraint.properties},e.prototype.strict=function(){return this.constraint.strict},e}();t.AbstractConstraintModel=r;var i=function(e){function t(t){return e.call(this,t)||this}return n(t,e),t.prototype.hasAllRequiredPropertiesSpecific=function(e){return va.every(this.constraint.properties,function(t){if(Ta.isEncodingNestedProp(t)){var n=t.parent,r=t.child;return!e[n]||!Fa.isWildcard(e[n][r])}return!e[t]||!Fa.isWildcard(e[t])})},t.prototype.satisfy=function(e,t,n,r){return!this.constraint.allowWildcardForProperties&&!this.hasAllRequiredPropertiesSpecific(e)||this.constraint.satisfy(e,t,n,r)},t}(r);t.EncodingConstraintModel=i}),Kc=t(Vc),qc=Vc.AbstractConstraintModel,Xc=Vc.EncodingConstraintModel,$c=Object.freeze({"default":Kc,__moduleExports:Vc,AbstractConstraintModel:qc,EncodingConstraintModel:Xc}),Jc=zc&&Hc||zc,Zc=$c&&Kc||$c,el=n(function(e,t){var n=Ge&&Ge.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e};Object.defineProperty(t,"__esModule",{value:!0}),t.FIELD_CONSTRAINTS=[{name:"aggregateOpSupportedByType",description:"Aggregate function should be supported by data type.",properties:[Ta.Property.TYPE,Ta.Property.AGGREGATE],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n,r){return!e.aggregate||!zs.isDiscrete(e.type)}},{name:"asteriskFieldWithCountOnly",description:'Field="*" should be disallowed except aggregate="count"',properties:[Ta.Property.FIELD,Ta.Property.AGGREGATE],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n,r){return"*"===e.field==("count"===e.aggregate)}},{name:"minCardinalityForBin",description:"binned quantitative field should not have too low cardinality",properties:[Ta.Property.BIN,Ta.Property.FIELD,Ta.Property.TYPE],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n,r){if(e.bin&&e.type===Sa.Type.QUANTITATIVE){var i={channel:e.channel,field:e.field,type:e.type};return t.cardinality(i)>=r.minCardinalityForBin}return!0}},{name:"binAppliedForQuantitative",description:"bin should be applied to quantitative field only.",properties:[Ta.Property.TYPE,Ta.Property.BIN],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n,r){return!e.bin||e.type===Sa.Type.QUANTITATIVE}},{name:"channelFieldCompatible",description:"encoding channel's range type be compatible with channel type.",properties:[Ta.Property.CHANNEL,Ta.Property.TYPE,Ta.Property.BIN,Ta.Property.TIMEUNIT],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,r,i){var o=n({field:"f"},fs.toFieldDef(e,{schema:t,props:["bin","timeUnit","type"]}));return zu.channelCompatibility(o,e.channel).compatible}},{name:"hasFn",description:"A field with as hasFn flag should have one of aggregate, timeUnit, or bin.",properties:[Ta.Property.AGGREGATE,Ta.Property.BIN,Ta.Property.TIMEUNIT],allowWildcardForProperties:!0,strict:!0,satisfy:function(e,t,n,r){return!e.hasFn||(!!e.aggregate||!!e.bin||!!e.timeUnit)}},{name:"omitScaleZeroWithBinnedField",description:"Do not use scale zero with binned field",properties:[Ta.Property.SCALE,Ta.getEncodingNestedProp("scale","zero"),Ta.Property.BIN],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n,r){return!e.bin||!e.scale||e.scale.zero!==!0}},{name:"onlyOneTypeOfFunction",description:"Only of of aggregate, autoCount, timeUnit, or bin should be applied at the same time.",properties:[Ta.Property.AGGREGATE,Ta.Property.AUTOCOUNT,Ta.Property.TIMEUNIT,Ta.Property.BIN],allowWildcardForProperties:!0,strict:!0,satisfy:function(e,t,n,r){if(fs.isFieldQuery(e)){var i=(!Fa.isWildcard(e.aggregate)&&e.aggregate?1:0)+(!Fa.isWildcard(e.bin)&&e.bin?1:0)+(!Fa.isWildcard(e.timeUnit)&&e.timeUnit?1:0);return i<=1}return!0}},{name:"timeUnitAppliedForTemporal",description:"Time unit should be applied to temporal field only.",properties:[Ta.Property.TYPE,Ta.Property.TIMEUNIT],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n,r){return!e.timeUnit||e.type===Sa.Type.TEMPORAL}},{name:"timeUnitShouldHaveVariation",description:"A particular time unit should be applied only if they produce unique values.",properties:[Ta.Property.TIMEUNIT,Ta.Property.TYPE],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n,r){return!e.timeUnit||e.type!==Sa.Type.TEMPORAL||(!n.has("timeUnit")&&!r.constraintManuallySpecifiedValue||t.timeUnitHasVariation(e))}},{name:"scalePropertiesSupportedByScaleType",description:"Scale properties must be supported by correct scale type",properties:[].concat(Ta.SCALE_PROPS,[Ta.Property.SCALE,Ta.Property.TYPE]),allowWildcardForProperties:!0,strict:!0,satisfy:function(e,t,n,r){if(e.scale){var i=e.scale,o=fs.scaleType(e);if(void 0===o||null===o)return!0;for(var a in i)if("type"!==a&&"name"!==a&&"enum"!==a){var u=a;if("point"===o){if(!si.scaleTypeSupportProperty("point",u)&&!si.scaleTypeSupportProperty("band",u))return!1;
}else if(!si.scaleTypeSupportProperty(o,u))return!1}}return!0}},{name:"scalePropertiesSupportedByChannel",description:"Not all scale properties are supported by all encoding channels",properties:[].concat(Ta.SCALE_PROPS,[Ta.Property.SCALE,Ta.Property.CHANNEL]),allowWildcardForProperties:!0,strict:!0,satisfy:function(e,t,n,r){if(e){var i=e.channel,o=e.scale;if(i&&!Fa.isWildcard(i)&&o){if("row"===i||"column"===i)return!1;for(var a in o)if(o.hasOwnProperty(a)&&"type"!==a&&"name"!==a&&"enum"!==a){var u=void 0===si.channelScalePropertyIncompatability(i,a);if(!u)return!1}}}return!0}},{name:"typeMatchesPrimitiveType",description:"Data type should be supported by field's primitive type.",properties:[Ta.Property.FIELD,Ta.Property.TYPE],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n,r){if("*"===e.field)return!0;var i=t.primitiveType(e.field),o=e.type;if(!n.has("field")&&!n.has("type")&&!r.constraintManuallySpecifiedValue)return!0;switch(i){case Jc.PrimitiveType.BOOLEAN:case Jc.PrimitiveType.STRING:return o!==Sa.Type.QUANTITATIVE&&o!==Sa.Type.TEMPORAL;case Jc.PrimitiveType.NUMBER:case Jc.PrimitiveType.INTEGER:return o!==Sa.Type.TEMPORAL;case Jc.PrimitiveType.DATETIME:return o===Sa.Type.TEMPORAL;case null:return!1}throw new Error("Not implemented")}},{name:"typeMatchesSchemaType",description:"Enumerated data type of a field should match the field's type in the schema.",properties:[Ta.Property.FIELD,Ta.Property.TYPE],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n,r){return!(n.has("field")||n.has("type")||r.constraintManuallySpecifiedValue)||("*"===e.field?e.type===Sa.Type.QUANTITATIVE:t.vlType(e.field)===e.type)}},{name:"maxCardinalityForCategoricalColor",description:"Categorical channel should not have too high cardinality",properties:[Ta.Property.CHANNEL,Ta.Property.FIELD],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n,r){return e.channel!==Rr.Channel.COLOR||e.type!==Sa.Type.NOMINAL&&e.type!==zs.ExpandedType.KEY||t.cardinality(e)<=r.maxCardinalityForCategoricalColor}},{name:"maxCardinalityForFacet",description:"Row/column channel should not have too high cardinality",properties:[Ta.Property.CHANNEL,Ta.Property.FIELD,Ta.Property.BIN,Ta.Property.TIMEUNIT],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n,r){return e.channel!==Rr.Channel.ROW&&e.channel!==Rr.Channel.COLUMN||t.cardinality(e)<=r.maxCardinalityForFacet}},{name:"maxCardinalityForShape",description:"Shape channel should not have too high cardinality",properties:[Ta.Property.CHANNEL,Ta.Property.FIELD,Ta.Property.BIN,Ta.Property.TIMEUNIT],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n,r){return e.channel!==Rr.Channel.SHAPE||t.cardinality(e)<=r.maxCardinalityForShape}},{name:"dataTypeAndFunctionMatchScaleType",description:"Scale type must match data type",properties:[Ta.Property.TYPE,Ta.Property.SCALE,Ta.getEncodingNestedProp("scale","type"),Ta.Property.TIMEUNIT,Ta.Property.BIN],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n,r){if(e.scale){var i=e.type,o=fs.scaleType(e);if(zs.isDiscrete(i))return void 0===o||si.hasDiscreteDomain(o);if(i===Sa.Type.TEMPORAL)return e.timeUnit?va.contains([si.ScaleType.TIME,si.ScaleType.UTC,void 0],o)||si.hasDiscreteDomain(o):va.contains([si.ScaleType.TIME,si.ScaleType.UTC,void 0],o);if(i===Sa.Type.QUANTITATIVE)return e.bin?va.contains([si.ScaleType.LINEAR,void 0],o):va.contains([si.ScaleType.LOG,si.ScaleType.POW,si.ScaleType.SQRT,si.ScaleType.QUANTILE,si.ScaleType.QUANTIZE,si.ScaleType.LINEAR,void 0],o)}return!0}},{name:"stackIsOnlyUsedWithXY",description:"stack should only be allowed for x and y channels",properties:[Ta.Property.STACK,Ta.Property.CHANNEL],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n,r){return!e.stack||(e.channel===Rr.Channel.X||e.channel===Rr.Channel.Y)}}].map(function(e){return new Zc.EncodingConstraintModel(e)}),t.FIELD_CONSTRAINT_INDEX=t.FIELD_CONSTRAINTS.reduce(function(e,t){return e[t.name()]=t,e},{}),t.FIELD_CONSTRAINTS_BY_PROPERTY=t.FIELD_CONSTRAINTS.reduce(function(e,t){for(var n=0,r=t.properties();n<r.length;n++){var i=r[n];e.set(i,e.get(i)||[]),e.get(i).push(t)}return e},new Is.PropIndex)}),tl=t(el),nl=el.FIELD_CONSTRAINTS,rl=el.FIELD_CONSTRAINT_INDEX,il=el.FIELD_CONSTRAINTS_BY_PROPERTY,ol=Object.freeze({"default":tl,__moduleExports:el,FIELD_CONSTRAINTS:nl,FIELD_CONSTRAINT_INDEX:rl,FIELD_CONSTRAINTS_BY_PROPERTY:il}),al=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.VALUE_CONSTRAINTS=[{name:"doesNotSupportConstantValue",description:"row, column, x, y, order, and detail should not work with constant values.",properties:[Ta.Property.TYPE,Ta.Property.AGGREGATE],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n,r){return!va.contains(["row","column","x","y","detail","order"],e.channel)}}].map(function(e){return new Zc.EncodingConstraintModel(e)}),t.VALUE_CONSTRAINT_INDEX=t.VALUE_CONSTRAINTS.reduce(function(e,t){return e[t.name()]=t,e},{}),t.VALUE_CONSTRAINTS_BY_PROPERTY=t.VALUE_CONSTRAINTS.reduce(function(e,t){for(var n=0,r=t.properties();n<r.length;n++){var i=r[n];e.set(i,e.get(i)||[]),e.get(i).push(t)}return e},new Is.PropIndex)}),ul=t(al),sl=al.VALUE_CONSTRAINTS,cl=al.VALUE_CONSTRAINT_INDEX,ll=al.VALUE_CONSTRAINTS_BY_PROPERTY,dl=Object.freeze({"default":ul,__moduleExports:al,VALUE_CONSTRAINTS:sl,VALUE_CONSTRAINT_INDEX:cl,VALUE_CONSTRAINTS_BY_PROPERTY:ll}),fl=ol&&tl||ol,pl=dl&&ul||dl,yl=n(function(e,t){function n(e,t,n,r,i,o){for(var a=fl.FIELD_CONSTRAINTS_BY_PROPERTY.get(e)||[],u=r.getEncodingQueryByIndex(n),s=0,c=a;s<c.length;s++){var l=c[s];if(l.strict()||o[l.name()]){var d=l.satisfy(u,i,r.wildcardIndex.encodings[n],o);if(!d){var f="(enc) "+l.name();return o.verbose&&console.log(f+" failed with "+r.toShorthand()+" for "+t.name),f}}}for(var p=pl.VALUE_CONSTRAINTS_BY_PROPERTY.get(e)||[],y=0,g=p;y<g.length;y++){var l=g[y];if((l.strict()||o[l.name()])&&fs.isValueQuery(u)){var d=l.satisfy(u,i,r.wildcardIndex.encodings[n],o);if(!d){var f="(enc) "+l.name();return o.verbose&&console.log(f+" failed with "+r.toShorthand()+" for "+t.name),f}}}return null}Object.defineProperty(t,"__esModule",{value:!0}),t.checkEncoding=n}),gl=t(yl),hl=yl.checkEncoding,ml=Object.freeze({"default":gl,__moduleExports:yl,checkEncoding:hl}),El=n(function(e,t){function n(e,t,n,r,i){for(var o=a.get(e)||[],u=0,s=o;u<s.length;u++){var c=s[u];if(c.strict()||i[c.name()]){var l=c.satisfy(n,r,i);if(!l){var d="(spec) "+c.name();return i.verbose&&console.log(d+" failed with "+n.toShorthand()+" for "+t.name),d}}}return null}var r=Ge&&Ge.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=Rr.NONPOSITION_CHANNELS.reduce(function(e,t){return e[t]=!0,e},{}),o=function(e){function t(t){return e.call(this,t)||this}return r(t,e),t.prototype.hasAllRequiredPropertiesSpecific=function(e){return va.every(this.constraint.properties,function(t){if(t===Ta.Property.MARK)return!Fa.isWildcard(e.getMark());if(Ta.isEncodingNestedProp(t)){var n=t.parent,r=t.child;return va.every(e.getEncodings(),function(e){return!e[n]||!Fa.isWildcard(e[n][r])})}if(!Ta.isEncodingProperty(t))throw new Error("UNIMPLEMENTED");return va.every(e.getEncodings(),function(e){return!e[t]||!Fa.isWildcard(e[t])})})},t.prototype.satisfy=function(e,t,n){return!this.constraint.allowWildcardForProperties&&!this.hasAllRequiredPropertiesSpecific(e)||this.constraint.satisfy(e,t,n)},t}(Zc.AbstractConstraintModel);t.SpecConstraintModel=o,t.SPEC_CONSTRAINTS=[{name:"noRepeatedChannel",description:"Each encoding channel should only be used once.",properties:[Ta.Property.CHANNEL],allowWildcardForProperties:!0,strict:!0,satisfy:function(e,t,n){var r={};return va.every(e.getEncodings(),function(e){return!!Fa.isWildcard(e.channel)||!r[e.channel]&&(r[e.channel]=!0,!0)})}},{name:"alwaysIncludeZeroInScaleWithBarMark",description:"Do not recommend bar mark if scale does not start at zero",properties:[Ta.Property.MARK,Ta.Property.SCALE,Ta.getEncodingNestedProp("scale","zero"),Ta.Property.CHANNEL,Ta.Property.TYPE],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n){var r=e.getMark(),i=e.getEncodings();if(r===_a.Mark.BAR)for(var o=0,a=i;o<a.length;o++){var u=a[o];if(fs.isFieldQuery(u)&&(u.channel===Rr.Channel.X||u.channel===Rr.Channel.Y)&&u.type===Sa.Type.QUANTITATIVE&&u.scale&&u.scale.zero===!1)return!1}return!0}},{name:"autoAddCount",description:"Automatically adding count only for plots with only ordinal, binned quantitative, or temporal with timeunit fields.",properties:[Ta.Property.BIN,Ta.Property.TIMEUNIT,Ta.Property.TYPE,Ta.Property.AUTOCOUNT],allowWildcardForProperties:!0,strict:!1,satisfy:function(e,t,n){var r=va.some(e.getEncodings(),function(e){return fs.isEnabledAutoCountQuery(e)});if(r)return va.every(e.getEncodings(),function(e){if(fs.isValueQuery(e))return!1;if(fs.isAutoCountQuery(e))return!0;switch(e.type){case Sa.Type.QUANTITATIVE:return!!e.bin;case Sa.Type.TEMPORAL:return!!e.timeUnit;case Sa.Type.ORDINAL:case zs.ExpandedType.KEY:case Sa.Type.NOMINAL:return!0}throw new Error("Unsupported Type")});var i=e.wildcardIndex.encodingIndicesByProperty.get("autoCount")||[],o=va.every(i,function(t){var n=e.getEncodingQueryByIndex(t);return fs.isAutoCountQuery(n)&&!Fa.isWildcard(n.autoCount)});return!o||va.some(e.getEncodings(),function(e){return(fs.isFieldQuery(e)||fs.isAutoCountQuery(e))&&e.type===Sa.Type.QUANTITATIVE?!fs.isDisabledAutoCountQuery(e)&&(fs.isFieldQuery(e)&&(!e.bin||Fa.isWildcard(e.bin))):!(!fs.isFieldQuery(e)||e.type!==Sa.Type.TEMPORAL)&&(!e.timeUnit||Fa.isWildcard(e.timeUnit))})}},{name:"channelPermittedByMarkType",description:"Each encoding channel should be supported by the mark type",properties:[Ta.Property.CHANNEL,Ta.Property.MARK],allowWildcardForProperties:!0,strict:!0,satisfy:function(e,t,n){var r=e.getMark();return!!Fa.isWildcard(r)||va.every(e.getEncodings(),function(e){return!!Fa.isWildcard(e.channel)||Rr.supportMark(e.channel,r)})}},{name:"hasAllRequiredChannelsForMark",description:"All required channels for the specified mark should be specified",properties:[Ta.Property.CHANNEL,Ta.Property.MARK],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n){var r=e.getMark();switch(r){case _a.Mark.AREA:case _a.Mark.LINE:return e.channelUsed(Rr.Channel.X)&&e.channelUsed(Rr.Channel.Y);case _a.Mark.TEXT:return e.channelUsed(Rr.Channel.TEXT);case _a.Mark.BAR:case _a.Mark.CIRCLE:case _a.Mark.SQUARE:case _a.Mark.TICK:case _a.Mark.RULE:case _a.Mark.RECT:return e.channelUsed(Rr.Channel.X)||e.channelUsed(Rr.Channel.Y);case _a.Mark.POINT:return!e.wildcardIndex.hasProperty(Ta.Property.CHANNEL)||e.channelUsed(Rr.Channel.X)||e.channelUsed(Rr.Channel.Y)}throw new Error("hasAllRequiredChannelsForMark not implemented for mark"+JSON.stringify(r))}},{name:"omitAggregate",description:"Omit aggregate plots.",properties:[Ta.Property.AGGREGATE,Ta.Property.AUTOCOUNT],allowWildcardForProperties:!0,strict:!1,satisfy:function(e,t,n){return!e.isAggregate()}},{name:"omitAggregatePlotWithDimensionOnlyOnFacet",description:"Omit aggregate plots with dimensions only on facets as that leads to inefficient use of space.",properties:[Ta.Property.CHANNEL,Ta.Property.AGGREGATE,Ta.Property.AUTOCOUNT],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n){if(e.isAggregate()){var r=!1,i=!1,o=!1;if(e.specQuery.encodings.forEach(function(t,n){fs.isValueQuery(t)||fs.isDisabledAutoCountQuery(t)||fs.isFieldQuery(t)&&!t.aggregate&&(i=!0,va.contains([Rr.Channel.ROW,Rr.Channel.COLUMN],t.channel)?e.wildcardIndex.hasEncodingProperty(n,Ta.Property.CHANNEL)&&(o=!0):r=!0)}),i&&!r&&(o||n.constraintManuallySpecifiedValue))return!1}return!0}},{name:"omitAggregatePlotWithoutDimension",description:"Aggregate plots without dimension should be omitted",properties:[Ta.Property.AGGREGATE,Ta.Property.AUTOCOUNT,Ta.Property.BIN,Ta.Property.TIMEUNIT,Ta.Property.TYPE],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n){return!e.isAggregate()||va.some(e.getEncodings(),function(e){return!!(fs.isDimension(e)||fs.isFieldQuery(e)&&"temporal"===e.type)})}},{name:"omitBarLineAreaWithOcclusion",description:"Don't use bar, line or area to visualize raw plot as they often lead to occlusion.",properties:[Ta.Property.MARK,Ta.Property.AGGREGATE,Ta.Property.AUTOCOUNT],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n){return!va.contains([_a.Mark.BAR,_a.Mark.LINE,_a.Mark.AREA],e.getMark())||e.isAggregate()}},{name:"omitBarTickWithSize",description:"Do not map field to size channel with bar and tick mark",properties:[Ta.Property.CHANNEL,Ta.Property.MARK],allowWildcardForProperties:!0,strict:!1,satisfy:function(e,t,n){var r=e.getMark();if(va.contains([_a.Mark.TICK,_a.Mark.BAR],r)&&e.channelUsed(Rr.Channel.SIZE)){if(n.constraintManuallySpecifiedValue)return!1;for(var i=e.specQuery.encodings,o=0;o<i.length;o++){var a=i[o];if(a.channel===Rr.Channel.SIZE)return!e.wildcardIndex.hasEncodingProperty(o,Ta.Property.CHANNEL)}}return!0}},{name:"omitBarAreaForLogScale",description:"Do not use bar and area mark for x and y's log scale",properties:[Ta.Property.MARK,Ta.Property.CHANNEL,Ta.Property.SCALE,Ta.getEncodingNestedProp("scale","type"),Ta.Property.TYPE],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n){var r=e.getMark(),i=e.getEncodings();if(r===_a.Mark.AREA||r===_a.Mark.BAR)for(var o=0,a=i;o<a.length;o++){var u=a[o];if(fs.isFieldQuery(u)&&(u.channel===Rr.Channel.X||u.channel===Rr.Channel.Y)&&u.scale){var s=fs.scaleType(u);if(s===si.ScaleType.LOG)return!1}}return!0}},{name:"omitMultipleNonPositionalChannels",description:"Unless manually specified, do not use multiple non-positional encoding channel to avoid over-encoding.",properties:[Ta.Property.CHANNEL],allowWildcardForProperties:!0,strict:!1,satisfy:function(e,t,n){for(var r=e.specQuery.encodings,o=0,a=!1,u=0;u<r.length;u++){var s=r[u];if(!fs.isValueQuery(s)&&!fs.isDisabledAutoCountQuery(s)){var c=s.channel;if(!Fa.isWildcard(c)&&i[c+""]&&(o+=1,e.wildcardIndex.hasEncodingProperty(u,Ta.Property.CHANNEL)&&(a=!0),o>1&&(a||n.constraintManuallySpecifiedValue)))return!1}}return!0}},{name:"omitNonPositionalOrFacetOverPositionalChannels",description:"Do not use non-positional channels unless all positional channels are used",properties:[Ta.Property.CHANNEL],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n){for(var r=e.specQuery.encodings,i=!1,o=!1,a=!1,u=!1,s=0;s<r.length;s++){var c=r[s];if(!fs.isValueQuery(c)&&!fs.isDisabledAutoCountQuery(c)){var l=c.channel;l===Rr.Channel.X?a=!0:l===Rr.Channel.Y?u=!0:Fa.isWildcard(l)||(i=!0,e.wildcardIndex.hasEncodingProperty(s,Ta.Property.CHANNEL)&&(o=!0))}}return!(o||n.constraintManuallySpecifiedValue&&i)||a&&u}},{name:"omitRaw",description:"Omit raw plots.",properties:[Ta.Property.AGGREGATE,Ta.Property.AUTOCOUNT],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n){return!!e.isAggregate()}},{name:"omitRawContinuousFieldForAggregatePlot",description:"Aggregate plot should not use raw continuous field as group by values. (Quantitative should be binned. Temporal should have time unit.)",properties:[Ta.Property.AGGREGATE,Ta.Property.AUTOCOUNT,Ta.Property.TIMEUNIT,Ta.Property.BIN,Ta.Property.TYPE],allowWildcardForProperties:!0,strict:!1,satisfy:function(e,t,n){if(e.isAggregate())for(var r=e.specQuery.encodings,i=0;i<r.length;i++){var o=r[i];if(!fs.isValueQuery(o)&&!fs.isDisabledAutoCountQuery(o)){if(fs.isFieldQuery(o)&&o.type===Sa.Type.TEMPORAL&&!o.timeUnit&&(e.wildcardIndex.hasEncodingProperty(i,Ta.Property.TIMEUNIT)||n.constraintManuallySpecifiedValue))return!1;if(o.type===Sa.Type.QUANTITATIVE&&fs.isFieldQuery(o)&&!o.bin&&!o.aggregate){if(e.wildcardIndex.hasEncodingProperty(i,Ta.Property.BIN)||e.wildcardIndex.hasEncodingProperty(i,Ta.Property.AGGREGATE)||e.wildcardIndex.hasEncodingProperty(i,Ta.Property.AUTOCOUNT))return!1;if(n.constraintManuallySpecifiedValue)return!1}}}return!0}},{name:"omitRawDetail",description:"Do not use detail channel with raw plot.",properties:[Ta.Property.CHANNEL,Ta.Property.AGGREGATE,Ta.Property.AUTOCOUNT],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n){return!!e.isAggregate()||va.every(e.specQuery.encodings,function(t,r){return!(!fs.isValueQuery(t)&&!fs.isDisabledAutoCountQuery(t))||(t.channel!==Rr.Channel.DETAIL||!e.wildcardIndex.hasEncodingProperty(r,Ta.Property.CHANNEL)&&!n.constraintManuallySpecifiedValue)})}},{name:"omitRepeatedField",description:"Each field should be mapped to only one channel",properties:[Ta.Property.FIELD],allowWildcardForProperties:!0,strict:!1,satisfy:function(e,t,n){for(var r={},i={},o=e.specQuery.encodings,a=0;a<o.length;a++){var u=o[a];if(!fs.isValueQuery(u)&&!fs.isAutoCountQuery(u)){var s=void 0;if(u.field&&!Fa.isWildcard(u.field)&&(s=u.field),fs.isAutoCountQuery(u)&&!Fa.isWildcard(u.autoCount)&&(s="count_*"),s){if(e.wildcardIndex.hasEncodingProperty(a,Ta.Property.FIELD)&&(i[s]=!0),r[s]&&(i[s]||n.constraintManuallySpecifiedValue))return!1;r[s]=!0}}}return!0}},{name:"omitVerticalDotPlot",description:"Do not output vertical dot plot.",properties:[Ta.Property.CHANNEL],allowWildcardForProperties:!0,strict:!1,satisfy:function(e,t,n){var r=e.getEncodings();return 1!==r.length||r[0].channel!==Rr.Channel.Y}},{name:"hasAppropriateGraphicTypeForMark",description:"Has appropriate graphic type for mark",properties:[Ta.Property.CHANNEL,Ta.Property.MARK,Ta.Property.TYPE,Ta.Property.TIMEUNIT,Ta.Property.BIN,Ta.Property.AGGREGATE,Ta.Property.AUTOCOUNT],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n){var r=e.getMark();switch(r){case _a.Mark.AREA:case _a.Mark.LINE:if(e.isAggregate()){var i=e.getEncodingQueryByChannel(Rr.Channel.X),o=e.getEncodingQueryByChannel(Rr.Channel.Y),a=fs.isMeasure(i),u=fs.isMeasure(o);return i&&o&&a!==u&&!(fs.isFieldQuery(i)&&!a&&va.contains(["nominal","key"],i.type))&&!(fs.isFieldQuery(o)&&!u&&va.contains(["nominal","key"],o.type))}return!0;case _a.Mark.TEXT:return!0;case _a.Mark.BAR:case _a.Mark.TICK:if(e.channelUsed(Rr.Channel.SIZE))return!1;var s=e.getEncodingQueryByChannel(Rr.Channel.X),c=e.getEncodingQueryByChannel(Rr.Channel.Y),a=fs.isMeasure(s),u=fs.isMeasure(c);return a!==u;case _a.Mark.RECT:var l=e.getEncodingQueryByChannel(Rr.Channel.X),d=e.getEncodingQueryByChannel(Rr.Channel.Y),f=fs.isDimension(l),p=fs.isDimension(d),y=e.getEncodingQueryByChannel(Rr.Channel.COLOR),g=fs.isMeasure(y),h=!!fs.isFieldQuery(y)&&y.type===Sa.Type.ORDINAL,m=f&&p||f&&!e.channelUsed(Rr.Channel.Y)||p&&!e.channelUsed(Rr.Channel.X),E=!y||y&&(g||h);return m&&E;case _a.Mark.CIRCLE:case _a.Mark.POINT:case _a.Mark.SQUARE:case _a.Mark.RULE:return!0}throw new Error("hasAllRequiredChannelsForMark not implemented for mark"+r)}},{name:"omitInvalidStackSpec",description:"If stack is specified, must follow Vega-Lite stack rules",properties:[Ta.Property.STACK,Ta.Property.FIELD,Ta.Property.CHANNEL,Ta.Property.MARK,Ta.Property.AGGREGATE,Ta.Property.AUTOCOUNT,Ta.Property.SCALE,Ta.getEncodingNestedProp("scale","type"),Ta.Property.TYPE],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n){if(!e.wildcardIndex.hasProperty(Ta.Property.STACK))return!0;var r=e.getVlStack();return(null!==r||null===e.getStackOffset())&&r.fieldChannel===e.getStackChannel()}},{name:"omitNonSumStack",description:"Stack specifications that use non-summative aggregates should be omitted (even implicit ones)",properties:[Ta.Property.CHANNEL,Ta.Property.MARK,Ta.Property.AGGREGATE,Ta.Property.AUTOCOUNT,Ta.Property.SCALE,Ta.getEncodingNestedProp("scale","type"),Ta.Property.TYPE],allowWildcardForProperties:!1,strict:!0,satisfy:function(e,t,n){var r=e.getVlStack();if(null!=r){var i=e.getEncodingQueryByChannel(r.fieldChannel);if(!va.contains(ru.SUM_OPS,i.aggregate))return!1}return!0}},{name:"omitTableWithOcclusionIfAutoAddCount",description:"Plots without aggregation or autocount where x and y are both discrete should be omitted if autoAddCount is enabled as they often lead to occlusion",properties:[Ta.Property.CHANNEL,Ta.Property.TYPE,Ta.Property.TIMEUNIT,Ta.Property.BIN,Ta.Property.AGGREGATE,Ta.Property.AUTOCOUNT],allowWildcardForProperties:!1,strict:!1,satisfy:function(e,t,n){if(n.autoAddCount){var r=e.getEncodingQueryByChannel("x"),i=e.getEncodingQueryByChannel("y");if((!fs.isFieldQuery(r)||fs.isDimension(r))&&(!fs.isFieldQuery(i)||fs.isDimension(i)))return!!e.isAggregate()&&va.every(e.getEncodings(),function(e){var t=e.channel;return!(t!==Rr.Channel.X&&t!==Rr.Channel.Y&&t!==Rr.Channel.ROW&&t!==Rr.Channel.COLUMN&&fs.isFieldQuery(e)&&!e.aggregate)})}return!0}}].map(function(e){return new o(e)}),t.SPEC_CONSTRAINT_INDEX=t.SPEC_CONSTRAINTS.reduce(function(e,t){return e[t.name()]=t,e},{});var a=t.SPEC_CONSTRAINTS.reduce(function(e,t){for(var n=0,r=t.properties();n<r.length;n++){var i=r[n];e.set(i,e.get(i)||[]),e.get(i).push(t)}return e},new Is.PropIndex);t.checkSpec=n}),Tl=t(El),vl=El.SpecConstraintModel,_l=El.SPEC_CONSTRAINTS,Ol=El.SPEC_CONSTRAINT_INDEX,Sl=El.checkSpec,Nl=Object.freeze({"default":Tl,__moduleExports:El,SpecConstraintModel:vl,SPEC_CONSTRAINTS:_l,SPEC_CONSTRAINT_INDEX:Ol,checkSpec:Sl}),Al=ml&&gl||ml,Pl=Nl&&Tl||Nl,Cl=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.encoding=Al,t.spec=Pl}),Il=t(Cl),bl=Cl.encoding,Rl=Cl.spec,Dl=Object.freeze({"default":Il,__moduleExports:Cl,encoding:bl,spec:Rl}),Ll=n(function(e,t){function n(e){return i.get(e)}function r(e){return function(t,n,r){return function(i,o){function a(s){if(s===u.length)return void i.push(o.duplicate());var c=u[s],l=t.encodings[c].get(e),d=o.getEncodingQueryByIndex(c),f=o.getEncodingProperty(c,e);fs.isValueQuery(d)||fs.isDisabledAutoCountQuery(d)||!f?a(s+1):(l["enum"].forEach(function(t){null===t&&(t=void 0),o.setEncodingProperty(c,e,t,l);var i=Al.checkEncoding(e,l,c,o,n,r);if(!i){var u=Pl.checkSpec(e,l,o,n,r);u||a(s+1)}}),o.resetEncodingProperty(c,e,l))}var u=t.encodingIndicesByProperty.get(e);return a(0),i}}}Object.defineProperty(t,"__esModule",{value:!0});var i=new Is.PropIndex;t.getEnumerator=n,i.set("mark",function(e,t,n){return function(r,i){var o=i.getMark();return o["enum"].forEach(function(o){i.setMark(o);var a=Pl.checkSpec("mark",e.mark,i,t,n);a||r.push(i.duplicate())}),i.resetMark(),r}}),Ta.ENCODING_TOPLEVEL_PROPS.forEach(function(e){i.set(e,r(e))}),Ta.ENCODING_NESTED_PROPS.forEach(function(e){i.set(e,r(e))}),t.EncodingPropertyGeneratorFactory=r}),Ml=t(Ll),Ul=Ll.getEnumerator,xl=Ll.EncodingPropertyGeneratorFactory,Fl=Object.freeze({"default":Ml,__moduleExports:Ll,getEnumerator:Ul,EncodingPropertyGeneratorFactory:xl}),wl=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this._mark=void 0,this._encodings={},this._encodingIndicesByProperty=new Is.PropIndex}return e.prototype.setEncodingProperty=function(e,t,n){var r=this._encodings,i=r[e]=r[e]||new Is.PropIndex;i.set(t,n);var o=this._encodingIndicesByProperty;return o.set(t,o.get(t)||[]),o.get(t).push(e),this},e.prototype.hasEncodingProperty=function(e,t){return!!this._encodings[e]&&this._encodings[e].has(t)},e.prototype.hasProperty=function(e){if(Ta.isEncodingProperty(e))return this.encodingIndicesByProperty.has(e);if("mark"===e)return!!this.mark;throw new Error("Unimplemented for property "+e)},e.prototype.isEmpty=function(){return!this.mark&&0===this.encodingIndicesByProperty.size()},e.prototype.setMark=function(e){return this._mark=e,this},Object.defineProperty(e.prototype,"mark",{get:function(){return this._mark},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"encodings",{get:function(){return this._encodings},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"encodingIndicesByProperty",{get:function(){return this._encodingIndicesByProperty},enumerable:!0,configurable:!0}),e}();t.WildcardIndex=n}),kl=t(wl),jl=wl.WildcardIndex,Gl=Object.freeze({"default":kl,__moduleExports:wl,WildcardIndex:jl}),Bl=n(function(e,t){function n(e){return Bi.isObject(e)&&!!e.property}function r(e,t,r){return t=t||new Is.PropIndex,r=r||new Is.PropIndex,e.forEach(function(e){n(e)?(t.setByKey(e.property,!0),r.setByKey(e.property,e.replace)):t.setByKey(e,!0)}),{include:t,replaceIndex:r,replacer:Ks.getReplacerIndex(r)}}function i(e){return Bi.isArray(e)?e.map(function(e){if(n(e)){if(e.replace){var t=va.keys(e.replace).reduce(function(t,n){var r=e.replace[n];return(t[r]=t[r]||[]).push(n),t},{});return e.property+"["+va.keys(t).map(function(e){var n=t[e].sort();return n.join(",")+"=>"+e}).join(";")+"]"}return e.property}return e}).join(","):e}Object.defineProperty(t,"__esModule",{value:!0}),t.REPLACE_BLANK_FIELDS={"*":""},t.REPLACE_XY_CHANNELS={x:"xy",y:"xy"},t.REPLACE_FACET_CHANNELS={row:"facet",column:"facet"},t.REPLACE_MARK_STYLE_CHANNELS={color:"style",opacity:"style",shape:"style",size:"style"},t.isExtendedGroupBy=n,t.parseGroupBy=r,t.toString=i,t.GROUP_BY_FIELD_TRANSFORM=[Ta.Property.FIELD,Ta.Property.TYPE,Ta.Property.AGGREGATE,Ta.Property.BIN,Ta.Property.TIMEUNIT,Ta.Property.STACK],t.GROUP_BY_ENCODING=t.GROUP_BY_FIELD_TRANSFORM.concat([{property:Ta.Property.CHANNEL,replace:{x:"xy",y:"xy",color:"style",size:"style",shape:"style",opacity:"style",row:"facet",column:"facet"}}])}),Hl=t(Bl),Yl=Bl.REPLACE_BLANK_FIELDS,Wl=Bl.REPLACE_XY_CHANNELS,Ql=Bl.REPLACE_FACET_CHANNELS,zl=Bl.REPLACE_MARK_STYLE_CHANNELS,Vl=Bl.isExtendedGroupBy,Kl=Bl.parseGroupBy,ql=Bl.GROUP_BY_FIELD_TRANSFORM,Xl=Bl.GROUP_BY_ENCODING,$l=Object.freeze({"default":Hl,__moduleExports:Bl,REPLACE_BLANK_FIELDS:Yl,REPLACE_XY_CHANNELS:Wl,REPLACE_FACET_CHANNELS:Ql,REPLACE_MARK_STYLE_CHANNELS:zl,isExtendedGroupBy:Vl,parseGroupBy:Kl,GROUP_BY_FIELD_TRANSFORM:ql,GROUP_BY_ENCODING:Xl}),Jl=$l&&Hl||$l,Zl=n(function(e,t){function n(e,t){o[e]=t}function r(e,t){if(t){for(var n={name:"",path:"",items:[]},r={},i=[],a=[],u=[],s=0;s<t.length;s++){i.push(s>0?i[s-1].duplicate():new Is.PropIndex),a.push(s>0?a[s-1].duplicate():new Is.PropIndex);var c=t[s].groupBy;if(Bi.isArray(c)){var l=Jl.parseGroupBy(c,i[s],a[s]);u.push(l.replacer)}}return e.forEach(function(e){for(var a="",s=n,c=0;c<t.length;c++){var l=s.groupBy=t[c].groupBy;s.orderGroupBy=t[c].orderGroupBy;var d=Bi.isArray(l)?Ks.spec(e.specQuery,i[c],u[c]):o[l](e.specQuery);a+="/"+d,r[a]||(r[a]={name:d,path:a,items:[]},s.items.push(r[a])),s=r[a]}s.items.push(e)}),n}return{name:"",path:"",items:e}}function i(e,t){return o[t](e)}Object.defineProperty(t,"__esModule",{value:!0});var o={};t.registerKeyFn=n,t.FIELD="field",t.FIELD_TRANSFORM="fieldTransform",t.ENCODING="encoding",t.SPEC="spec",t.nest=r;var a=[Ta.Property.FIELD],u=Jl.parseGroupBy(a);t.getGroupByKey=i,n(t.FIELD,function(e){return Ks.spec(e,u.include,u.replacer)}),t.PARSED_GROUP_BY_FIELD_TRANSFORM=Jl.parseGroupBy(Jl.GROUP_BY_FIELD_TRANSFORM),n(t.FIELD_TRANSFORM,function(e){return Ks.spec(e,t.PARSED_GROUP_BY_FIELD_TRANSFORM.include,t.PARSED_GROUP_BY_FIELD_TRANSFORM.replacer)}),t.PARSED_GROUP_BY_ENCODING=Jl.parseGroupBy(Jl.GROUP_BY_ENCODING),n(t.ENCODING,function(e){return Ks.spec(e,t.PARSED_GROUP_BY_ENCODING.include,t.PARSED_GROUP_BY_ENCODING.replacer)}),n(t.SPEC,function(e){return JSON.stringify(e)})}),ed=t(Zl),td=Zl.registerKeyFn,nd=Zl.FIELD,rd=Zl.FIELD_TRANSFORM,id=Zl.ENCODING,od=Zl.SPEC,ad=Zl.nest,ud=Zl.getGroupByKey,sd=Zl.PARSED_GROUP_BY_FIELD_TRANSFORM,cd=Zl.PARSED_GROUP_BY_ENCODING,ld=Object.freeze({"default":ed,__moduleExports:Zl,registerKeyFn:td,FIELD:nd,FIELD_TRANSFORM:rd,ENCODING:id,SPEC:od,nest:ad,getGroupByKey:ud,PARSED_GROUP_BY_FIELD_TRANSFORM:sd,PARSED_GROUP_BY_ENCODING:cd}),dd=Gl&&kl||Gl,fd=ld&&ed||ld,pd=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,n,r,i){this._rankingScore={},this._spec=e,this._channelFieldCount=e.encodings.reduce(function(e,t){return Fa.isWildcard(t.channel)||fs.isAutoCountQuery(t)&&t.autoCount===!1||(e[t.channel+""]=1),e},{}),this._wildcardIndex=t,this._assignedWildcardIndex=i,this._opt=r,this._schema=n}return e.build=function(t,n,r){var i=new dd.WildcardIndex;if(Fa.isWildcard(t.mark)){var o=Fa.getDefaultName(Ta.Property.MARK);t.mark=Fa.initWildcard(t.mark,o,r["enum"].mark),i.setMark(t.mark)}if(t.encodings.forEach(function(e,t){fs.isAutoCountQuery(e)&&(console.warn("A field with autoCount should not be included as autoCount meant to be an internal object."),e.type=Sa.Type.QUANTITATIVE),fs.isFieldQuery(e)&&void 0===e.type&&(e.type=Fa.SHORT_WILDCARD),Ta.ENCODING_TOPLEVEL_PROPS.forEach(function(o){if(Fa.isWildcard(e[o])){var a=Fa.getDefaultName(o)+t,u=Fa.getDefaultEnumValues(o,n,r),s=e[o]=Fa.initWildcard(e[o],a,u);i.setEncodingProperty(t,o,s)}}),Ta.ENCODING_NESTED_PROPS.forEach(function(o){var a=e[o.parent];if(a){var u=o.child;if(Fa.isWildcard(a[u])){var s=Fa.getDefaultName(o)+t,c=Fa.getDefaultEnumValues(o,n,r),l=a[u]=Fa.initWildcard(a[u],s,c);i.setEncodingProperty(t,o,l)}}})}),r.autoAddCount){var a={name:Fa.getDefaultName(Ta.Property.CHANNEL)+t.encodings.length,"enum":Fa.getDefaultEnumValues(Ta.Property.CHANNEL,n,r)},u={name:Fa.getDefaultName(Ta.Property.AUTOCOUNT)+t.encodings.length,"enum":[!1,!0]},s={channel:a,autoCount:u,type:Sa.Type.QUANTITATIVE};t.encodings.push(s);var c=t.encodings.length-1;i.setEncodingProperty(c,Ta.Property.CHANNEL,a),i.setEncodingProperty(c,Ta.Property.AUTOCOUNT,u)}return new e(t,i,n,r,{})},Object.defineProperty(e.prototype,"wildcardIndex",{get:function(){return this._wildcardIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"schema",{get:function(){return this._schema},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"specQuery",{get:function(){return this._spec},enumerable:!0,configurable:!0}),e.prototype.duplicate=function(){return new e(va.duplicate(this._spec),this._wildcardIndex,this._schema,this._opt,va.duplicate(this._assignedWildcardIndex))},e.prototype.setMark=function(e){var t=this._wildcardIndex.mark.name;this._assignedWildcardIndex[t]=this._spec.mark=e},e.prototype.resetMark=function(){var e=this._spec.mark=this._wildcardIndex.mark;delete this._assignedWildcardIndex[e.name]},e.prototype.getMark=function(){return this._spec.mark},e.prototype.getEncodingProperty=function(e,t){var n=this._spec.encodings[e];return Ta.isEncodingNestedProp(t)?n[t.parent][t.child]:n[t]},e.prototype.setEncodingProperty=function(e,t,n,r){var i=this._spec.encodings[e];t===Ta.Property.CHANNEL&&i.channel&&!Fa.isWildcard(i.channel)&&this._channelFieldCount[i.channel]--,Ta.isEncodingNestedProp(t)?i[t.parent][t.child]=n:Ta.isEncodingNestedParent(t)&&n===!0?i[t]=va.extend({},i[t],{"enum":void 0,name:void 0}):i[t]=n,this._assignedWildcardIndex[r.name]=n,t===Ta.Property.CHANNEL&&(this._channelFieldCount[n]=(this._channelFieldCount[n]||0)+1)},e.prototype.resetEncodingProperty=function(e,t,n){var r=this._spec.encodings[e];t===Ta.Property.CHANNEL&&this._channelFieldCount[r.channel]--,Ta.isEncodingNestedProp(t)?r[t.parent][t.child]=n:r[t]=n,delete this._assignedWildcardIndex[n.name]},e.prototype.channelUsed=function(e){return this._channelFieldCount[e]>0},e.prototype.getEncodings=function(){return this._spec.encodings.filter(function(e){return!fs.isDisabledAutoCountQuery(e)})},e.prototype.getEncodingQueryByChannel=function(e){for(var t=0,n=this._spec.encodings;t<n.length;t++){var r=n[t];if(r.channel===e)return r}},e.prototype.getEncodingQueryByIndex=function(e){return this._spec.encodings[e]},e.prototype.isAggregate=function(){return Cs.isAggregate(this._spec)},e.prototype.getVlStack=function(){return Cs.getVlStack(this._spec)},e.prototype.getStackOffset=function(){return Cs.getStackOffset(this._spec)},e.prototype.getStackChannel=function(){return Cs.getStackChannel(this._spec)},e.prototype.toShorthand=function(e){if(e){if(Bi.isString(e))return fd.getGroupByKey(this.specQuery,e);var t=Jl.parseGroupBy(e);return Ks.spec(this._spec,t.include,t.replacer)}return Ks.spec(this._spec)},e.prototype.toSpec=function(e){if(Fa.isWildcard(this._spec.mark))return null;
var t={};return e=e||this._spec.data,e&&(t.data=e),this._spec.transform&&(t.transform=this._spec.transform),t.mark=this._spec.mark,t.encoding=fs.toEncoding(this.specQuery.encodings,{schema:this._schema,wildcardMode:"null"}),this._spec.width&&(t.width=this._spec.width),this._spec.height&&(t.height=this._spec.height),this._spec.background&&(t.background=this._spec.background),this._spec.padding&&(t.padding=this._spec.padding),this._spec.title&&(t.title=this._spec.title),null===t.encoding?null:((this._spec.config||this._opt.defaultSpecConfig)&&(t.config=va.extend({},this._opt.defaultSpecConfig,this._spec.config)),t)},e.prototype.getRankingScore=function(e){return this._rankingScore[e]},e.prototype.setRankingScore=function(e,t){this._rankingScore[e]=t},e}();t.SpecQueryModel=n}),yd=t(pd),gd=pd.SpecQueryModel,hd=Object.freeze({"default":yd,__moduleExports:pd,SpecQueryModel:gd}),md=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0})}),Ed=t(md),Td=Object.freeze({"default":Ed,__moduleExports:md}),vd=n(function(e,t){function n(e){if(e.groupBy){var t={groupBy:e.groupBy};e.orderBy&&(t.orderGroupBy=e.orderBy);var n={spec:va.duplicate(e.spec),nest:[t]};return e.chooseBy&&(n.chooseBy=e.chooseBy),e.config&&(n.config=e.config),n}return va.duplicate(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.normalize=n}),_d=t(vd),Od=vd.normalize,Sd=Object.freeze({"default":_d,__moduleExports:vd,normalize:Od}),Nd=Td&&Ed||Td,Ad=Sd&&_d||Sd,Pd=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.encoding=fs,t.groupBy=Jl,t.shorthand=Ks,t.spec=Cs,t.transform=Nd,t.normalize=Ad.normalize}),Cd=t(Pd),Id=Pd.encoding,bd=Pd.groupBy,Rd=Pd.shorthand,Dd=Pd.spec,Ld=Pd.transform,Md=Pd.normalize,Ud=Object.freeze({"default":Cd,__moduleExports:Pd,encoding:Id,groupBy:bd,shorthand:Rd,spec:Dd,transform:Ld,normalize:Md}),xd=n(function(e,t){function n(e){return void 0!==e.items}function r(e){for(var t=e.items[0];t&&n(t);)t=t.items[0];return t}function i(e,t){return o({},e,{items:e.items.map(function(e){return n(e)?i(e,t):t(e)})})}var o=Ge&&Ge.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e};Object.defineProperty(t,"__esModule",{value:!0}),t.isResultTree=n,t.getTopResultTreeItem=r,t.mapLeaves=i}),Fd=t(xd),wd=xd.isResultTree,kd=xd.getTopResultTreeItem,jd=xd.mapLeaves,Gd=Object.freeze({"default":Fd,__moduleExports:xd,isResultTree:wd,getTopResultTreeItem:kd,mapLeaves:jd}),Bd=n(function(e,t){function n(e){if(e.bin)return r.BIN_Q;if(e.timeUnit){var t=fs.scaleType(e);return si.hasDiscreteDomain(t)?r.TIMEUNIT_O:r.TIMEUNIT_T}return e.type}Object.defineProperty(t,"__esModule",{value:!0});var r;!function(e){e[e.Q=Sa.Type.QUANTITATIVE]="Q",e[e.BIN_Q="bin_"+Sa.Type.QUANTITATIVE]="BIN_Q",e[e.T=Sa.Type.TEMPORAL]="T",e[e.TIMEUNIT_T="timeUnit_time"]="TIMEUNIT_T",e[e.TIMEUNIT_O="timeUnit_"+Sa.Type.ORDINAL]="TIMEUNIT_O",e[e.O=Sa.Type.ORDINAL]="O",e[e.N=Sa.Type.NOMINAL]="N",e[e.K=zs.ExpandedType.KEY]="K",e[e.NONE="-"]="NONE"}(r=t.ExtendedType||(t.ExtendedType={})),t.Q=r.Q,t.BIN_Q=r.BIN_Q,t.T=r.T,t.TIMEUNIT_T=r.TIMEUNIT_T,t.TIMEUNIT_O=r.TIMEUNIT_O,t.O=r.O,t.N=r.N,t.K=r.K,t.NONE=r.NONE,t.getExtendedType=n}),Hd=t(Bd),Yd=Bd.ExtendedType,Wd=Bd.Q,Qd=Bd.BIN_Q,zd=Bd.T,Vd=Bd.TIMEUNIT_T,Kd=Bd.TIMEUNIT_O,qd=Bd.O,Xd=Bd.N,$d=Bd.K,Jd=Bd.NONE,Zd=Bd.getExtendedType,ef=Object.freeze({"default":Hd,__moduleExports:Bd,ExtendedType:Yd,Q:Wd,BIN_Q:Qd,T:zd,TIMEUNIT_T:Vd,TIMEUNIT_O:Kd,O:qd,N:Xd,K:$d,NONE:Jd,getExtendedType:Zd}),tf=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.type=e,this.scoreIndex=this.initScore()}return e.prototype.getFeatureScore=function(e){var t=this.type,n=this.scoreIndex[e];if(void 0!==n)return{type:t,feature:e,score:n}},e}();t.Scorer=n}),nf=t(tf),rf=tf.Scorer,of=Object.freeze({"default":nf,__moduleExports:tf,Scorer:rf}),af=ef&&Hd||ef,uf=of&&nf||of,sf=n(function(e,t){var n=Ge&&Ge.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),r=Ge&&Ge.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e};Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(){return e.call(this,"Axis")||this}return n(t,e),t.prototype.initScore=function(e){void 0===e&&(e={}),e=r({},Gc.DEFAULT_QUERY_CONFIG,e);var t={},n=[{feature:af.BIN_Q,opt:"preferredBinAxis"},{feature:af.T,opt:"preferredTemporalAxis"},{feature:af.TIMEUNIT_T,opt:"preferredTemporalAxis"},{feature:af.TIMEUNIT_O,opt:"preferredTemporalAxis"},{feature:af.O,opt:"preferredOrdinalAxis"},{feature:af.N,opt:"preferredNominalAxis"}];return n.forEach(function(n){e[n.opt]===Rr.Channel.X?t[n.feature+"_"+Rr.Channel.Y]=-.01:e[n.opt]===Rr.Channel.Y&&(t[n.feature+"_"+Rr.Channel.X]=-.01)}),t},t.prototype.featurize=function(e,t){return e+"_"+t},t.prototype.getScore=function(e,t,n){var r=this;return e.getEncodings().reduce(function(e,t){if(fs.isFieldQuery(t)||fs.isAutoCountQuery(t)){var n=af.getExtendedType(t),i=r.featurize(n,t.channel),o=r.getFeatureScore(i);o&&e.push(o)}return e},[])},t}(uf.Scorer);t.AxisScorer=i}),cf=t(sf),lf=sf.AxisScorer,df=Object.freeze({"default":cf,__moduleExports:sf,AxisScorer:lf}),ff=n(function(e,t){var n=Ge&&Ge.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(){return e.call(this,"Dimension")||this}return n(t,e),t.prototype.initScore=function(){return{row:-2,column:-2,color:0,opacity:0,size:0,shape:0}},t.prototype.getScore=function(e,t,n){var r=this;return e.isAggregate()&&e.getEncodings().reduce(function(e,t){if(fs.isAutoCountQuery(t)||fs.isFieldQuery(t)&&!t.aggregate){var n=r.getFeatureScore(t.channel+"");if(n&&n.score>e.score)return n}return e},{type:"Dimension",feature:"No Dimension",score:-5}),[]},t}(uf.Scorer);t.DimensionScorer=r}),pf=t(ff),yf=ff.DimensionScorer,gf=Object.freeze({"default":pf,__moduleExports:ff,DimensionScorer:yf}),hf=n(function(e,t){var n=Ge&&Ge.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),r=Ge&&Ge.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e};Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(){return e.call(this,"Facet")||this}return n(t,e),t.prototype.initScore=function(e){e=r({},Gc.DEFAULT_QUERY_CONFIG,e);var t={};return e.preferredFacet===Rr.Channel.ROW?t[Rr.Channel.COLUMN]=-.01:e.preferredFacet===Rr.Channel.COLUMN&&(t[Rr.Channel.ROW]=-.01),t},t.prototype.getScore=function(e,t,n){var r=this;return e.getEncodings().reduce(function(e,t){if(fs.isFieldQuery(t)||fs.isAutoCountQuery(t)){var n=r.getFeatureScore(t.channel);n&&e.push(n)}return e},[])},t}(uf.Scorer);t.FacetScorer=i}),mf=t(hf),Ef=hf.FacetScorer,Tf=Object.freeze({"default":mf,__moduleExports:hf,FacetScorer:Ef}),vf=n(function(e,t){var n=Ge&&Ge.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(){return e.call(this,"SizeChannel")||this}return n(t,e),t.prototype.initScore=function(){return{bar_size:-2,tick_size:-2}},t.prototype.getScore=function(e,t,n){var r=this,i=e.getMark();return e.getEncodings().reduce(function(e,t){if(fs.isFieldQuery(t)||fs.isAutoCountQuery(t)){var n=i+"_"+t.channel,o=r.getFeatureScore(n);o&&e.push(o)}return e},[])},t}(uf.Scorer);t.SizeChannelScorer=r}),_f=t(vf),Of=vf.SizeChannelScorer,Sf=Object.freeze({"default":_f,__moduleExports:vf,SizeChannelScorer:Of}),Nf=n(function(e,t){var n=Ge&&Ge.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.TERRIBLE=-10;var r=function(e){function r(){return e.call(this,"TypeChannel")||this}return n(r,e),r.prototype.initScore=function(){var e=this,n={},r={x:0,y:0,size:-.575,color:-.725,text:-2,opacity:-3,shape:t.TERRIBLE,row:t.TERRIBLE,column:t.TERRIBLE,detail:2*t.TERRIBLE};[af.Q,af.T,af.TIMEUNIT_T].forEach(function(t){va.keys(r).forEach(function(i){n[e.featurize(t,i)]=r[i]})});var i=va.extend({},r,{row:-.75,column:-.75,shape:-3.1,text:-3.2,detail:-4});[af.BIN_Q,af.TIMEUNIT_O,af.O].forEach(function(t){va.keys(i).forEach(function(r){n[e.featurize(t,r)]=i[r]})});var o={x:0,y:0,color:-.6,shape:-.65,row:-.7,column:-.7,text:-.8,detail:-2,size:-3,opacity:-3.1};return va.keys(o).forEach(function(t){n[e.featurize(af.N,t)]=o[t],n[e.featurize(af.K,t)]=va.contains(["x","y","detail"],t)?-1:o[t]-2}),n},r.prototype.featurize=function(e,t){return e+"_"+t},r.prototype.getScore=function(e,t,n){var r=this,i=e.getEncodings().reduce(function(e,t){if(fs.isFieldQuery(t)||fs.isAutoCountQuery(t)){var n=Ks.fieldDef(t);(e[n]=e[n]||[]).push(t)}return e},{}),o=[];return va.forEach(i,function(e){var t=e.reduce(function(e,t){if(fs.isFieldQuery(t)||fs.isAutoCountQuery(t)){var n=af.getExtendedType(t),i=r.featurize(n,t.channel),o=r.getFeatureScore(i);if(null===e||o.score>e.score)return o}return e},null);o.push(t)}),o},r}(uf.Scorer);t.TypeChannelScorer=r}),Af=t(Nf),Pf=Nf.TERRIBLE,Cf=Nf.TypeChannelScorer,If=Object.freeze({"default":Af,__moduleExports:Nf,TERRIBLE:Pf,TypeChannelScorer:Cf}),bf=n(function(e,t){function n(e,t,n,r){return e+"_"+t+"_"+n+"_"+r}function r(){var e=[af.Q,af.T],t=[af.BIN_Q,af.TIMEUNIT_O,af.O,af.N,af.K],r=t.concat([af.NONE]),i={};return e.forEach(function(t){e.forEach(function(e){var r={point:0,text:-.2,tick:-.5,rect:-1,bar:-2,line:-2,area:-2,rule:-2.5};va.forEach(r,function(r,o){var a=n(t,e,!0,o);i[a]=r});var o={point:0,text:-.2,tick:-.5,bar:-2,line:-2,area:-2,rule:-2.5};va.forEach(o,function(r,o){var a=n(t,e,!1,o);i[a]=r})})}),e.forEach(function(e){r.forEach(function(t){var r={tick:0,point:-.2,text:-.5,bar:-2,line:-2,area:-2,rule:-2.5};va.forEach(r,function(r,o){var a=n(e,t,!0,o);i[a]=r;var u=n(t,e,!0,o);i[u]=r})}),[af.TIMEUNIT_T].forEach(function(t){var r={point:0,text:-.5,tick:-1,bar:-2,line:-2,area:-2,rule:-2.5};va.forEach(r,function(r,o){var a=n(e,t,!0,o);i[a]=r;var u=n(t,e,!0,o);i[u]=r})}),[af.NONE,af.N,af.O,af.K].forEach(function(t){var r={bar:0,point:-.2,tick:-.25,text:-.3,line:-2,area:-2,rule:-2.5};va.forEach(r,function(r,o){var a=n(e,t,!1,o);i[a]=r;var u=n(t,e,!1,o);i[u]=r})}),[af.BIN_Q].forEach(function(t){var r={bar:0,point:-.2,tick:-.25,text:-.3,line:-.5,area:-.5,rule:-2.5};va.forEach(r,function(r,o){var a=n(e,t,!1,o);i[a]=r;var u=n(t,e,!1,o);i[u]=r})}),[af.TIMEUNIT_T,af.TIMEUNIT_O].forEach(function(t){var r={line:0,area:-.1,bar:-.2,point:-.3,tick:-.35,text:-.4,rule:-2.5};va.forEach(r,function(r,o){var a=n(e,t,!1,o);i[a]=r;var u=n(t,e,!1,o);i[u]=r})})}),[af.TIMEUNIT_T].forEach(function(e){[af.TIMEUNIT_T].forEach(function(t){var r={point:0,rect:-.1,text:-.5,tick:-1,bar:-2,line:-2,area:-2,rule:-2.5};va.forEach(r,function(r,o){var a=n(e,t,!0,o);i[a]=r}),va.forEach(r,function(r,o){var a=n(e,t,!1,o);i[a]=r})}),r.forEach(function(t){var r={tick:0,point:-.2,text:-.5,rect:-1,bar:-2,line:-2,area:-2,rule:-2.5};va.forEach(r,function(r,o){var a=n(e,t,!0,o);i[a]=r}),va.forEach(r,function(r,o){var a=n(t,e,!0,o);i[a]=r}),va.forEach(r,function(r,o){var a=n(e,t,!1,o);i[a]=r}),va.forEach(r,function(r,o){var a=n(t,e,!1,o);i[a]=r})})}),r.forEach(function(e){r.forEach(function(t){var r={point:0,rect:0,text:-.1,tick:-1,bar:-2,line:-2,area:-2,rule:-2.5};va.forEach(r,function(r,o){var a=n(e,t,!0,o);i[a]=r}),va.forEach(r,function(r,o){var a=n(e,t,!1,o);i[a]=r})})}),i}var i=Ge&&Ge.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(){return e.call(this,"Mark")||this}return i(t,e),t.prototype.initScore=function(){return r()},t.prototype.getScore=function(e,t,n){var r=e.getMark();r!==_a.Mark.CIRCLE&&r!==_a.Mark.SQUARE||(r=_a.Mark.POINT);var i=e.getEncodingQueryByChannel(Rr.Channel.X),o=i?af.getExtendedType(i):af.NONE,a=e.getEncodingQueryByChannel(Rr.Channel.Y),u=a?af.getExtendedType(a):af.NONE,s=!e.isAggregate(),c=o+"_"+u+"_"+s+"_"+r,l=this.getFeatureScore(c);return[l]},t}(uf.Scorer);t.MarkScorer=o,t.featurize=n}),Rf=t(bf),Df=bf.MarkScorer,Lf=bf.featurize,Mf=Object.freeze({"default":Rf,__moduleExports:bf,MarkScorer:Df,featurize:Lf}),Uf=df&&cf||df,xf=gf&&pf||gf,Ff=Tf&&mf||Tf,wf=Sf&&_f||Sf,kf=If&&Af||If,jf=Mf&&Rf||Mf,Gf=n(function(e,t){function n(e,t,n){var i=r.reduce(function(r,i){var o=i.getScore(e,t,n);return r.concat(o)},[]);return{score:i.reduce(function(e,t){return e+t.score},0),features:i}}Object.defineProperty(t,"__esModule",{value:!0});var r=[new Uf.AxisScorer,new xf.DimensionScorer,new Ff.FacetScorer,new jf.MarkScorer,new wf.SizeChannelScorer,new kf.TypeChannelScorer];t.effectiveness=n}),Bf=t(Gf),Hf=Gf.effectiveness,Yf=Object.freeze({"default":Bf,__moduleExports:Gf,effectiveness:Hf}),Wf=n(function(e,t){function n(e,t,n){var i=r(e,t,n);return{score:i.score,features:[i]}}function r(e,n,r){var i=e.getEncodings();if(e.isAggregate()){var o=function(e){return fs.isFieldQuery(e)&&(e.type===Sa.Type.QUANTITATIVE&&!e.bin&&!e.aggregate||e.type===Sa.Type.TEMPORAL&&!e.timeUnit)};if(va.some(i,o))return{type:t.name,score:.1,feature:"Aggregate with raw continuous"};if(va.some(i,function(e){return fs.isFieldQuery(e)&&fs.isDimension(e)})){var a=va.some(i,function(e){return fs.isFieldQuery(e)&&"count"===e.aggregate||fs.isEnabledAutoCountQuery(e)}),u=va.some(i,function(e){return fs.isFieldQuery(e)&&!!e.bin});return a?{type:t.name,score:.8,feature:"Aggregate with count"}:u?{type:t.name,score:.7,feature:"Aggregate with bin but without count"}:{type:t.name,score:.9,feature:"Aggregate without count and without bin"}}return{type:t.name,score:.3,feature:"Aggregate without dimension"}}return va.some(i,function(e){return fs.isFieldQuery(e)&&!fs.isDimension(e)})?{type:t.name,score:1,feature:"Raw with measure"}:{type:t.name,score:.2,feature:"Raw without measure"}}Object.defineProperty(t,"__esModule",{value:!0}),t.name="aggregationQuality",t.score=n}),Qf=t(Wf),zf=Wf.name,Vf=Wf.score,Kf=Object.freeze({"default":Qf,__moduleExports:Wf,name:zf,score:Vf}),qf=n(function(e,t){function n(e,t,n){var r=e.wildcardIndex.encodingIndicesByProperty.get("field");if(!r)return{score:0,features:[]};for(var i=e.specQuery.encodings,o=t.fieldSchemas.length,a=[],u=0,s=1,c=r.length-1;c>=0;c--){var l=r[c],d=i[l],f=void 0;if(fs.isFieldQuery(d)){f=d.field;var p=e.wildcardIndex.encodings[l].get("field"),y=t.fieldSchema(f).index,g=-y*s;u+=g,a.push({score:g,type:"fieldOrder",feature:"field "+p.name+" is "+f+" (#"+y+" in the schema)"}),s*=o}}return{score:u,features:a}}Object.defineProperty(t,"__esModule",{value:!0}),t.name="fieldOrder",t.score=n}),Xf=t(qf),$f=qf.name,Jf=qf.score,Zf=Object.freeze({"default":Xf,__moduleExports:qf,name:$f,score:Jf}),ep=Gd&&Fd||Gd,tp=Yf&&Bf||Yf,np=Kf&&Qf||Kf,rp=Zf&&Xf||Zf,ip=n(function(e,t){function n(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}function r(e,t){l[e]=t}function i(e){return l[e]}function o(e,t,n,r){return t.nest&&r!==t.nest.length?(e.items.forEach(function(e){o(e,t,n,r+1)}),t.nest[r].orderGroupBy&&e.items.sort(u(t.nest[r].orderGroupBy,n,t.config))):(t.orderBy||t.chooseBy)&&(e.items.sort(a(t.orderBy||t.chooseBy,n,t.config)),t.chooseBy&&e.items.length>0&&e.items.splice(1)),e}function a(e,t,n){return function(r,i){return e instanceof Array?s(e,r,i,t,n):s([e],r,i,t,n)}}function u(e,t,n){return function(r,i){var o=ep.getTopResultTreeItem(r),a=ep.getTopResultTreeItem(i);return e instanceof Array?s(e,o,a,t,n):s([e],o,a,t,n)}}function s(e,t,n,r,i){for(var o=0,a=e;o<a.length;o++){var u=a[o],s=c(n,u,r,i).score-c(t,u,r,i).score;if(0!==s)return s}return 0}function c(e,t,n,r){if(void 0!==e.getRankingScore(t))return e.getRankingScore(t);var o=i(t),a=o(e,n,r);return e.setRankingScore(t,a),a}Object.defineProperty(t,"__esModule",{value:!0}),n(tp),t.aggregation=np,t.fieldOrder=rp;var l={};t.register=r,t.get=i,t.rank=o,t.comparatorFactory=a,t.groupComparatorFactory=u,t.getScore=c,t.EFFECTIVENESS="effectiveness",r(t.EFFECTIVENESS,tp.effectiveness),r(np.name,np.score),r(rp.name,rp.score)}),op=t(ip),ap=ip.aggregation,up=ip.fieldOrder,sp=ip.register,cp=ip.get,lp=ip.rank,dp=ip.comparatorFactory,fp=ip.groupComparatorFactory,pp=ip.getScore,yp=ip.EFFECTIVENESS,gp=Object.freeze({"default":op,__moduleExports:ip,aggregation:ap,fieldOrder:up,register:sp,get:cp,rank:lp,comparatorFactory:dp,groupComparatorFactory:fp,getScore:pp,EFFECTIVENESS:yp}),hp=n(function(e,t){function n(e,t,n){var a={};return e=e.map(function(e){return n.smallRangeStepForHighCardinalityOrFacet&&(e=r(e,t,a,n)),n.nominalColorScaleForHighCardinality&&(e=i(e,t,a,n)),n.xAxisOnTopForHighYCardinalityWithoutColumn&&(e=o(e,t,a,n)),e})}function r(e,t,n,r){[Rr.Channel.ROW,Rr.Channel.Y,Rr.Channel.COLUMN,Rr.Channel.X].forEach(function(t){n[t]=e.getEncodingQueryByChannel(t)});var i=n[Rr.Channel.Y];if(void 0!==i&&fs.isFieldQuery(i)&&(n[Rr.Channel.ROW]||t.cardinality(i)>r.smallRangeStepForHighCardinalityOrFacet.maxCardinality)){void 0===i.scale&&(i.scale={});var o=fs.scaleType(i);i.scale&&(void 0===o||si.hasDiscreteDomain(o))&&(i.scale.rangeStep||(i.scale.rangeStep=12))}var a=n[Rr.Channel.X];if(fs.isFieldQuery(a)&&(n[Rr.Channel.COLUMN]||t.cardinality(a)>r.smallRangeStepForHighCardinalityOrFacet.maxCardinality)){void 0===a.scale&&(a.scale={});var u=fs.scaleType(a);a.scale&&(void 0===u||si.hasDiscreteDomain(u))&&(a.scale.rangeStep||(a.scale.rangeStep=12))}return e}function i(e,t,n,r){n[Rr.Channel.COLOR]=e.getEncodingQueryByChannel(Rr.Channel.COLOR);var i=n[Rr.Channel.COLOR];return fs.isFieldQuery(i)&&void 0!==i&&(i.type===Sa.Type.NOMINAL||i.type===zs.ExpandedType.KEY)&&t.cardinality(i)>r.nominalColorScaleForHighCardinality.maxCardinality&&(void 0===i.scale&&(i.scale={}),i.scale&&(i.scale.range||(i.scale.scheme=r.nominalColorScaleForHighCardinality.palette))),e}function o(e,t,n,r){if([Rr.Channel.COLUMN,Rr.Channel.X,Rr.Channel.Y].forEach(function(t){n[t]=e.getEncodingQueryByChannel(t)}),void 0===n[Rr.Channel.COLUMN]){var i=n[Rr.Channel.X],o=n[Rr.Channel.Y];fs.isFieldQuery(i)&&fs.isFieldQuery(o)&&void 0!==o&&o.field&&si.hasDiscreteDomain(fs.scaleType(o))&&void 0!==i&&t.cardinality(o)>r.xAxisOnTopForHighYCardinalityWithoutColumn.maxCardinality&&(void 0===i.axis&&(i.axis={}),i.axis&&!i.axis.orient&&(i.axis.orient="top"))}return e}Object.defineProperty(t,"__esModule",{value:!0}),t.stylize=n,t.smallRangeStepForHighCardinalityOrFacet=r,t.nominalColorScaleForHighCardinality=i,t.xAxisOnTopForHighYCardinalityWithoutColumn=o}),mp=t(hp),Ep=hp.stylize,Tp=hp.smallRangeStepForHighCardinalityOrFacet,vp=hp.nominalColorScaleForHighCardinality,_p=hp.xAxisOnTopForHighYCardinalityWithoutColumn,Op=Object.freeze({"default":mp,__moduleExports:hp,stylize:Ep,smallRangeStepForHighCardinalityOrFacet:Tp,nominalColorScaleForHighCardinality:vp,xAxisOnTopForHighYCardinalityWithoutColumn:_p}),Sp=Fl&&Ml||Fl,Np=hd&&yd||hd,Ap=Op&&mp||Op,Pp=n(function(e,t){function n(e,t,n){void 0===n&&(n=Gc.DEFAULT_QUERY_CONFIG);var r=Np.SpecQueryModel.build(e,t,n),i=r.wildcardIndex,o=[r];return n.propertyPrecedence.forEach(function(e){var r=Ta.fromKey(e);if(i.hasProperty(r)){var a=Sp.getEnumerator(r),u=a(i,t,n);o=o.reduce(u,[])}}),!n.stylize||null===n.nominalColorScaleForHighCardinality&&null===n.smallRangeStepForHighCardinalityOrFacet&&null===n.xAxisOnTopForHighYCardinalityWithoutColumn?o:Ap.stylize(o,t,n)}Object.defineProperty(t,"__esModule",{value:!0}),t.generate=n}),Cp=t(Pp),Ip=Pp.generate,bp=Object.freeze({"default":Cp,__moduleExports:Pp,generate:Ip}),Rp=bp&&Cp||bp,Dp=gp&&op||gp,Lp=n(function(e,t){function n(e,t,n){e=r({},Ad.normalize(e),{config:r({},Gc.DEFAULT_QUERY_CONFIG,n,e.config)});var i=Rp.generate(e.spec,t,e.config),o=fd.nest(i,e.nest),a=Dp.rank(o,e,t,0);return{query:e,result:a}}var r=Ge&&Ge.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e};Object.defineProperty(t,"__esModule",{value:!0}),t.recommend=n}),Mp=t(Lp),Up=Lp.recommend,xp=Object.freeze({"default":Mp,__moduleExports:Lp,recommend:Up}),Fp="compassql",wp="0.20.3",kp="CompassQL visualization query language",jp="build/compassql.js",Gp="build/compassql.min.js",Bp="build/compassql.min.js",Hp="build/src/cql.ts",Yp="build/src/cql.d.ts",Wp="./build/src/cql",Qp={test:"test"},zp={prebuild:"mkdir -p build",build:"tsc && cp package.json build/src/ && rollup -c","build:examples":"npm run build && ./scripts/build-examples.sh","build:examples-only":"./scripts/build-examples.sh",postbuild:"uglifyjs build/compassql.js -cm --source-map build/compassql.min.js.map > build/compassql.min.js",clean:"rm -rf build",deploy:"npm run clean && npm run lint && npm run test && scripts/deploy.sh",lint:"tslint -c tslint.json src/**/*.ts test/**/*.ts",schema:"npm run prebuild && typescript-json-schema --required true src/query.ts Query > build/compassql-schema.json",test:"jest --maxWorkers=4 && npm run lint","check:examples":"./scripts/check-examples.sh","watch:build":"npm run build && concurrently --kill-others -n Typescript,Rollup 'tsc -w' 'rollup -c -w'","watch:test":"jest --watch"},Vp={type:"git",url:"git+https://github.com/uwdata/CompassQL.git"},Kp=["visualization","recommendation"],qp={name:"UW Interactive Data Lab",url:"http://idl.cs.washington.edu"},Xp=["Kanit Wongsuphasawat <kanitw@gmail.com> (http://kanitw.yellowpigz.com)","Dominik Moritz <domoritz@cs.washington.edu> (http://domoritz.de)","Jeffrey Heer <jheer@uw.edu> (http://jheer.org)"],$p="BSD-3-Clause",Jp={url:"https://github.com/uwdata/compassql/issues"},Zp="https://github.com/uwdata/compassql#readme",ey={"@types/chai":"^4.1.3","@types/d3":"^4.13.0","@types/jest":"^22.2.3",chai:"^4.1.2",codecov:"~1.0.1",concurrently:"^3.5.1",d3:"~4",exorcist:"~0.4.0",jest:"^22.4.3",rollup:"^0.58.2","rollup-plugin-commonjs":"^9.1.0","rollup-plugin-json":"^2.3.0","rollup-plugin-node-resolve":"^3.3.0","source-map-support":"~0.4.0","ts-jest":"^22.4.4",tslint:"~4.3.1",typescript:"^2.3.4","uglify-js":"~2.6.1","vega-datasets":"latest"},ty={datalib:"~1.7.0","typescript-json-schema":"^0.9.0","vega-lite":"2.4.0","vega-typings":"^0.2.15"},ny={transform:{"^.+\\.tsx?$":"ts-jest"},testRegex:"(/__tests__/.*|(\\.|/)(test|spec))\\.(jsx?|tsx?)$",moduleFileExtensions:["ts","tsx","js","jsx","json","node"],testPathIgnorePatterns:["node_modules","<rootDir>/build","scripts","src"],coverageDirectory:"./coverage/",collectCoverage:!0},ry={name:Fp,version:wp,description:kp,main:jp,unpkg:Gp,jsdelivr:Bp,module:Hp,types:Yp,typings:Wp,directories:Qp,scripts:zp,repository:Vp,keywords:Kp,author:qp,collaborators:Xp,license:$p,bugs:Jp,homepage:Zp,devDependencies:ey,dependencies:ty,jest:ny},iy=Object.freeze({name:Fp,version:wp,description:kp,main:jp,unpkg:Gp,jsdelivr:Bp,module:Hp,types:Yp,typings:Wp,directories:Qp,scripts:zp,repository:Vp,keywords:Kp,author:qp,collaborators:Xp,license:$p,bugs:Jp,homepage:Zp,devDependencies:ey,dependencies:ty,jest:ny,"default":ry}),oy=Dl&&Il||Dl,ay=Ud&&Cd||Ud,uy=xp&&Mp||xp,sy=iy&&ry||iy,cy=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.config=Gc,t.constraint=oy,t.enumerate=Sp,t.wildcard=Fa,t.model=Np,t.nest=fd,t.property=Ta,t.query=ay,t.ranking=Dp,t.result=ep,t.schema=Jc,t.util=va,t.generate=Rp.generate,t.recommend=uy.recommend,t.version=sy.version}),ly=t(cy),dy=cy.config,fy=cy.constraint,py=cy.enumerate,yy=cy.wildcard,gy=cy.model,hy=cy.nest,my=cy.property,Ey=cy.query,Ty=cy.ranking,vy=cy.result,_y=cy.schema,Oy=cy.util,Sy=cy.generate,Ny=cy.recommend,Ay=cy.version;e["default"]=ly,e.config=dy,e.constraint=fy,e.enumerate=py,e.wildcard=yy,e.model=gy,e.nest=hy,e.property=my,e.query=Ey,e.ranking=Ty,e.result=vy,e.schema=_y,e.util=Oy,e.generate=Sy,e.recommend=Ny,e.version=Ay,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=build/compassql.min.js.map
